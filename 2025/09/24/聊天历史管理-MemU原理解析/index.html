<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"caihaoran-00.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å‰è¨€éšç€ç©å…·çš„ä¸æ–­ä¼˜åŒ–è¿­ä»£ï¼Œè®¤ä¸ºå¯¹èŠå¤©å†å²çš„ç®¡ç†éœ€è¦ä¸‹äº›åŠŸå¤«ã€‚ç›®å‰å¹¶æ²¡æœ‰å¯¹é•¿æœŸè®°å¿†åšæ–‡ç« ï¼Œåªæœ‰çŸ­æœŸè®°å¿†ï¼ˆä½¿ç”¨æœ€è¿‘çš„äº”è½®å¯¹è¯ï¼‰ï¼Œå¯¼è‡´çš„æœ€å¤§çš„é—®é¢˜æ˜¯æ¯æ¬¡æ–°å¯¹è¯éƒ½æ˜¯æ²¡æœ‰ä»»ä½•è®°å¿†çš„ï¼Œæ˜¯â€œä»0å¼€å§‹â€çš„ï¼Œæœ¬æ–‡å°†è®°å½•å¯¹è®°å¿†ç³»ç»Ÿçš„æ€è€ƒä»¥åŠå¯¹MemUçš„åŸç†è§£æï¼Œç›®æ ‡åŒ…æ‹¬ä¸¤æ–¹é¢ï¼Œä¸€æ˜¯æ€ä¹ˆç§‘å­¦ç»æµçš„ç®¡ç†èŠå¤©å†å²ï¼ŒäºŒæ˜¯MemUçš„åŸç†æœ‰å¯å€Ÿé‰´çš„åœ°æ–¹å—ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="èŠå¤©å†å²ç®¡ç†&amp;MemUåŸç†è§£æ">
<meta property="og:url" content="https://caihaoran-00.github.io/2025/09/24/%E8%81%8A%E5%A4%A9%E5%8E%86%E5%8F%B2%E7%AE%A1%E7%90%86-MemU%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/index.html">
<meta property="og:site_name" content="Chr&#39;s Blog">
<meta property="og:description" content="å‰è¨€éšç€ç©å…·çš„ä¸æ–­ä¼˜åŒ–è¿­ä»£ï¼Œè®¤ä¸ºå¯¹èŠå¤©å†å²çš„ç®¡ç†éœ€è¦ä¸‹äº›åŠŸå¤«ã€‚ç›®å‰å¹¶æ²¡æœ‰å¯¹é•¿æœŸè®°å¿†åšæ–‡ç« ï¼Œåªæœ‰çŸ­æœŸè®°å¿†ï¼ˆä½¿ç”¨æœ€è¿‘çš„äº”è½®å¯¹è¯ï¼‰ï¼Œå¯¼è‡´çš„æœ€å¤§çš„é—®é¢˜æ˜¯æ¯æ¬¡æ–°å¯¹è¯éƒ½æ˜¯æ²¡æœ‰ä»»ä½•è®°å¿†çš„ï¼Œæ˜¯â€œä»0å¼€å§‹â€çš„ï¼Œæœ¬æ–‡å°†è®°å½•å¯¹è®°å¿†ç³»ç»Ÿçš„æ€è€ƒä»¥åŠå¯¹MemUçš„åŸç†è§£æï¼Œç›®æ ‡åŒ…æ‹¬ä¸¤æ–¹é¢ï¼Œä¸€æ˜¯æ€ä¹ˆç§‘å­¦ç»æµçš„ç®¡ç†èŠå¤©å†å²ï¼ŒäºŒæ˜¯MemUçš„åŸç†æœ‰å¯å€Ÿé‰´çš„åœ°æ–¹å—ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-09-24T02:29:48.000Z">
<meta property="article:modified_time" content="2025-09-30T10:27:10.433Z">
<meta property="article:author" content="Chr">
<meta property="article:tag" content="èŠå¤©å†å²">
<meta property="article:tag" content="è®°å¿†">
<meta property="article:tag" content="MemU">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://caihaoran-00.github.io/2025/09/24/%E8%81%8A%E5%A4%A9%E5%8E%86%E5%8F%B2%E7%AE%A1%E7%90%86-MemU%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://caihaoran-00.github.io/2025/09/24/%E8%81%8A%E5%A4%A9%E5%8E%86%E5%8F%B2%E7%AE%A1%E7%90%86-MemU%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/","path":"2025/09/24/èŠå¤©å†å²ç®¡ç†-MemUåŸç†è§£æ/","title":"èŠå¤©å†å²ç®¡ç†&MemUåŸç†è§£æ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>èŠå¤©å†å²ç®¡ç†&MemUåŸç†è§£æ | Chr's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Chr's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Record and Share</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A3%E6%96%87"><span class="nav-number">2.</span> <span class="nav-text">æ­£æ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">2.1.</span> <span class="nav-text">å®‰è£…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C"><span class="nav-number">2.2.</span> <span class="nav-text">è¿è¡Œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="nav-number">2.3.</span> <span class="nav-text">åŸç†åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">2.3.1.</span> <span class="nav-text">å®¢æˆ·ç«¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-number">2.3.2.</span> <span class="nav-text">æœåŠ¡ç«¯</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#API%E8%B7%AF%E7%94%B1%E5%B1%82%EF%BC%88routers-memory-py%EF%BC%89"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">APIè·¯ç”±å±‚ï¼ˆrouters&#x2F;memory.pyï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5"><span class="nav-number">2.3.2.1.1.</span> <span class="nav-text">1. æ¨¡å—å¯¼å…¥</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%AB%AF%E7%82%B91%EF%BC%9A%E5%AF%B9%E8%AF%9D%E8%AE%B0%E5%BF%86%E5%8C%96-memorize"><span class="nav-number">2.3.2.1.2.</span> <span class="nav-text">ç«¯ç‚¹1ï¼šå¯¹è¯è®°å¿†åŒ– (&#x2F;memorize)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%98%B6%E6%AE%B5%E5%B0%8F%E8%8A%82"><span class="nav-number">2.3.2.1.3.</span> <span class="nav-text">é˜¶æ®µå°èŠ‚</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#memory-retrieve-default-categories"><span class="nav-number">2.3.2.1.4.</span> <span class="nav-text">memory&#x2F;retrieve&#x2F;default-categories</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#memory-retrieve-related-memory-items"><span class="nav-number">2.3.2.1.5.</span> <span class="nav-text">memory&#x2F;retrieve&#x2F;related-memory-items</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#memory-retrieve-related-clustered-categories"><span class="nav-number">2.3.2.1.6.</span> <span class="nav-text">memory&#x2F;retrieve&#x2F;related-clustered-categories</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.3.3.</span> <span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%9D%E8%80%83"><span class="nav-number">2.3.4.</span> <span class="nav-text">æ€è€ƒ</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chr</p>
  <div class="site-description" itemprop="description">Welcome to my little world</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">105</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">124</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:1299964565@qq.com" title="E-Mail â†’ mailto:1299964565@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://caihaoran-00.github.io/2025/09/24/%E8%81%8A%E5%A4%A9%E5%8E%86%E5%8F%B2%E7%AE%A1%E7%90%86-MemU%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chr">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chr's Blog">
      <meta itemprop="description" content="Welcome to my little world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="èŠå¤©å†å²ç®¡ç†&MemUåŸç†è§£æ | Chr's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          èŠå¤©å†å²ç®¡ç†&MemUåŸç†è§£æ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-09-24 10:29:48" itemprop="dateCreated datePublished" datetime="2025-09-24T10:29:48+08:00">2025-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-09-30 18:27:10" itemprop="dateModified" datetime="2025-09-30T18:27:10+08:00">2025-09-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>22k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>1:22</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éšç€ç©å…·çš„ä¸æ–­ä¼˜åŒ–è¿­ä»£ï¼Œè®¤ä¸ºå¯¹èŠå¤©å†å²çš„ç®¡ç†éœ€è¦ä¸‹äº›åŠŸå¤«ã€‚ç›®å‰å¹¶æ²¡æœ‰å¯¹é•¿æœŸè®°å¿†åšæ–‡ç« ï¼Œåªæœ‰çŸ­æœŸè®°å¿†ï¼ˆä½¿ç”¨æœ€è¿‘çš„äº”è½®å¯¹è¯ï¼‰ï¼Œå¯¼è‡´çš„æœ€å¤§çš„é—®é¢˜æ˜¯æ¯æ¬¡æ–°å¯¹è¯éƒ½æ˜¯æ²¡æœ‰ä»»ä½•è®°å¿†çš„ï¼Œæ˜¯â€œä»0å¼€å§‹â€çš„ï¼Œæœ¬æ–‡å°†è®°å½•å¯¹è®°å¿†ç³»ç»Ÿçš„æ€è€ƒä»¥åŠå¯¹<code>MemU</code>çš„åŸç†è§£æï¼Œç›®æ ‡åŒ…æ‹¬ä¸¤æ–¹é¢ï¼Œä¸€æ˜¯æ€ä¹ˆç§‘å­¦ç»æµçš„ç®¡ç†èŠå¤©å†å²ï¼ŒäºŒæ˜¯<code>MemU</code>çš„åŸç†æœ‰å¯å€Ÿé‰´çš„åœ°æ–¹å—ã€‚</p>
<span id="more"></span>

<hr>
<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>åœ¨æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œå…ˆæ˜ç¡®ä¸‹æœ¬æ–‡æ‰€è¯´çš„çŸ­æœŸè®°å¿†å’Œé•¿æœŸè®°å¿†æ‰€æŒ‡ï¼š</p>
<p><strong>çŸ­æœŸè®°å¿† &#x3D; å½“å‰å¯¹è¯è½®æ¬¡çš„ä¸Šä¸‹æ–‡ï¼ˆå‡ è½®å¯¹è¯å†…å®¹ï¼‰<br>é•¿æœŸè®°å¿† &#x3D; ç”¨æˆ·ä¸AIå†å²äº¤äº’ä¸­æ²‰æ·€çš„ä¸ªæ€§åŒ–ä¿¡æ¯ï¼ˆåå¥½ã€ä¹ æƒ¯ã€é‡è¦äº‹ä»¶ã€æ€§æ ¼ç”»åƒç­‰ï¼‰</strong></p>
<p>ä¸€èˆ¬å„è‡ªçš„å®ç°æ–¹å¼å¦‚ä¸‹ï¼š<br><strong>çŸ­æœŸè®°å¿†ï¼š</strong></p>
<ul>
<li><strong>ç›´æ¥æ‹¼æ¥ä¸Šä¸‹æ–‡</strong>ï¼šæŠŠæœ€è¿‘ N è½®å¯¹è¯ï¼ˆç”¨æˆ·+AIï¼‰ä½œä¸º prompt çš„ä¸€éƒ¨åˆ†ä¼ ç»™æ¨¡å‹ã€‚</li>
<li><strong>æ»‘åŠ¨çª—å£æœºåˆ¶</strong>ï¼šåªä¿ç•™æœ€è¿‘ K ä¸ª token æˆ–æœ€è¿‘ M æ¡æ¶ˆæ¯ã€‚</li>
<li><strong>æ‘˜è¦å‹ç¼©ï¼ˆè¿›é˜¶ï¼‰</strong>ï¼šå¯¹å‰é¢å¤šè½®å¯¹è¯åšæ‘˜è¦ï¼ŒèŠ‚çœ tokenï¼Œä¿ç•™è¯­ä¹‰ã€‚</li>
</ul>
<blockquote>
<p>ç†è®ºä¸Šæ‘˜è¦å‹ç¼©æ–¹æ¡ˆçš„ä¸Šé™æœ€é«˜ï¼Œä½†å®é™…æ“ä½œä¸‹æ¥å‘ç°è¿™ç§æ–¹å¼ä¸ç¡®å®šæ€§è¾ƒå¤§ï¼Œä¸”æˆæœ¬è¾ƒé«˜ï¼Œæœ€ç»ˆå‡ºäºæ•ˆæœä¸æˆæœ¬å‡è¡¡è€ƒè™‘ï¼Œé€‰æ‹©æœ€è¿‘çš„5æ®µå¯¹è¯ä½œä¸ºçŸ­æœŸè®°å¿†ã€‚</p>
</blockquote>
<p><strong>é•¿æœŸè®°å¿†ï¼š</strong></p>
<ul>
<li><strong>å‘é‡æ•°æ®åº“ï¼ˆå¦‚ Pinecone, Milvus, Weaviateï¼‰</strong>ï¼šå­˜å‚¨ç”¨æˆ·å†å²å¯¹è¯ç‰‡æ®µ&#x2F;å…³é”®äº‹ä»¶çš„ embeddingï¼ŒæŒ‰éœ€æ£€ç´¢ã€‚</li>
<li><strong>å›¾æ•°æ®åº“ï¼ˆå¦‚ Neo4jï¼‰</strong>ï¼šå­˜å‚¨â€œç”¨æˆ·-AIâ€ä¹‹é—´çš„å…³ç³»ç½‘ç»œï¼ˆå¦‚â€œå–œæ¬¢ç§‘å¹»ç”µå½±â€ã€â€œè®¨åŒé¦™èœâ€ã€â€œå¦ˆå¦ˆå«æå¥³å£«â€ï¼‰ã€‚</li>
<li><strong>ç»“æ„åŒ–çŸ¥è¯†åº“</strong>ï¼šç”¨ JSON &#x2F; SQL å­˜å‚¨ç”¨æˆ·æ¡£æ¡ˆï¼ˆUser Profileï¼‰ã€‚</li>
<li><strong>è®°å¿†æ‘˜è¦ + æ—¶é—´æˆ³</strong>ï¼šå®šæœŸå¯¹å†å²å¯¹è¯ç”Ÿæˆæ‘˜è¦ï¼Œå¹¶æ‰“æ ‡ç­¾å½’æ¡£ã€‚</li>
</ul>
<p>è¿™å°±æ˜¯æœ¬æ–‡é‡ç‚¹æ¢ç´¢çš„å†…å®¹ï¼Œç›®å‰è¾ƒä¸ºå‡ºåçš„é•¿æœŸè®°å¿†ç®¡ç†å·¥å…·åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/getzep/zep">zep</a>ï¼š2023-4-17å‘å¸ƒï¼Œ3.7k Star</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/mem0ai/mem0">mem0</a>ï¼š2023-06-12å‘å¸ƒï¼Œ40.4k Star</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/letta-ai/letta"> Lettaï¼ˆåŸ MemGPTï¼‰</a>ï¼š2023-10-08å‘å¸ƒï¼Œ18.5k Star</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/GibsonAI/memori">memori</a>ï¼š2025-7-20ï¼Œ1.1k Star</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/NevaMind-AI/memU">memU</a>ï¼š2025-8-3å‘å¸ƒï¼Œ2.3k Star</p>
</li>
</ul>
<p>å•ä»ä¸Šé¢æ•°æ®æ¥çœ‹ï¼Œå¤§å®¶å¯¹mem0ã€ Lettaï¼ˆåŸ MemGPTï¼‰ã€memUçš„è®¤å¯åº¦é«˜ä¸€äº›ï¼Œä¸”memUä½œä¸ºç›®å‰çš„è¾ƒæ–°å¼€æºé¡¹ç›®ï¼Œä»‹ç»ä¸­ç§°ï¼šMemU æ˜¯ä¸€ä¸ªä¸º AI ä¼´ä¾£è®¾è®¡çš„å¼€æºè®°å¿†æ¡†æ¶â€”â€”é«˜ç²¾åº¦ã€å¿«é€Ÿæ£€ç´¢ã€ä½æˆæœ¬ã€‚å®ƒå……å½“ä¸€ä¸ªæ™ºèƒ½çš„â€œè®°å¿†æ–‡ä»¶å¤¹â€ï¼Œé€‚åº”ä¸åŒçš„ AI ä¼´ä¾£åœºæ™¯ã€‚ä½¿ç”¨ memUï¼Œä½ å¯ä»¥æ„å»ºçœŸæ­£è®°å¾—ä½ çš„ AI ä¼´ä¾£ã€‚å®ƒä»¬å­¦ä¹ ä½ æ˜¯è°ï¼Œä½ å…³å¿ƒä»€ä¹ˆï¼Œå¹¶é€šè¿‡æ¯ä¸€æ¬¡äº’åŠ¨ä¸ä½ å…±åŒæˆé•¿ã€‚</p>
<p>æˆ‘å†³å®šå…ˆä»memUå…¥æ‰‹ï¼Œå­¦ä¹ å…¶åŸç†ï¼Œä»¥æ±‚å°†å…¶å…³é”®æ€è·¯æ•´åˆåˆ°æˆ‘ä»¬çš„ç©å…·çš„è®°å¿†ç³»ç»Ÿä¸­ï¼ŒLetâ€™s goã€‚</p>
<hr>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>MemUå®˜æ–¹ä»‹ç»çš„è‡ªæ‰˜ç®¡æ¨¡å¼æ¨èä½¿ç”¨Docker Composeæ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œé‰´äºéœ€è¦å­¦ä¹ å…¶åŸç†ï¼Œæˆ‘é‡‡ç”¨æœ¬åœ°æºç éƒ¨ç½²æ–¹å¼ã€‚</p>
<p>å¯é€šè¿‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/chr/æ¡Œé¢/memory_framework</span><br><span class="line">uv venv memu-local-env</span><br><span class="line"><span class="built_in">source</span> memu-local-env/bin/activate</span><br><span class="line">uv pip install --python memu-local-env -e <span class="string">&quot;./memU[dev]&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ–¹å¼è¿›è¡Œå®‰è£…ï¼Œç„¶åè¿›è¡Œ.env æ–‡ä»¶çš„é…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /home/chr/æ¡Œé¢/memory_framework/memU/env.example /home/chr/æ¡Œé¢/memory_framework/.env</span><br><span class="line"></span><br><span class="line">nano .<span class="built_in">env</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾åˆ°å…¶ä¸­çš„å¦‚ä¸‹é…ç½®å¡«å†™ä½ å®é™…è¦ä½¿ç”¨é…ç½®</span></span><br><span class="line"><span class="comment"># Qwen API Configuration (ä½¿ç”¨OpenAIå…¼å®¹æ¥å£)</span></span><br><span class="line">OPENAI_API_KEY=your-actual-qwen-api-key-here</span><br><span class="line">OPENAI_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1</span><br><span class="line">MEMU_OPENAI_MODEL=qwen-plus</span><br><span class="line"></span><br><span class="line"><span class="comment"># åµŒå…¥æ¨¡å‹é…ç½® (Qwenå…¼å®¹OpenAIæ¥å£)</span></span><br><span class="line">MEMU_EMBEDDING_PROVIDER=openai</span><br><span class="line">OPENAI_API_KEY=your-actual-qwen-api-key-here  <span class="comment"># åŒæ ·çš„APIå¯†é’¥</span></span><br><span class="line">OPENAI_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1</span><br><span class="line">MEMU_EMBEDDING_MODEL=text-embedding-v3</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p><strong>æœåŠ¡ç«¯ï¼š</strong></p>
<p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬è¿›è¡ŒæœåŠ¡ç«¯çš„å¯åŠ¨ï¼š</p>
<blockquote>
<p> æ³¨æ„åœ¨å¯åŠ¨æœåŠ¡ç«¯ä¹‹å‰éœ€è¦å…ˆé…ç½®<code>.env</code>æ–‡ä»¶ï¼Œä»¥è°ƒç”¨äº‘ç«¯<code>LLM</code>å’Œ<code>embedding</code>æ¨¡å‹</p>
</blockquote>
<figure class="highlight sh"><figcaption><span>start_memu_local.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># start_memu_local.sh - Start MemU local server for learning</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸš€ Starting MemU Local Server for Learning...&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=============================================&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if we&#x27;re in the right directory</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;memu-local-env&quot;</span> ] || [ ! -d <span class="string">&quot;memU&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âŒ Error: Please run this script from /home/chr/æ¡Œé¢/memory_framework/&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Current directory: <span class="subst">$(pwd)</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if virtual environment is activated</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$VIRTUAL_ENV</span>&quot;</span> == *<span class="string">&quot;memu-local-env&quot;</span>* ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âœ… Virtual environment is already activated&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ğŸ”„ Activating virtual environment...&quot;</span></span><br><span class="line">    <span class="built_in">source</span> memu-local-env/bin/activate</span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;âŒ Failed to activate virtual environment&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if .env file exists</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;.env&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ğŸ”„ Creating .env file from template...&quot;</span></span><br><span class="line">    <span class="built_in">cp</span> memU/env.example .<span class="built_in">env</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âœ… Created .env file. Please edit it to add your API key:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   nano .env&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Then run this script again.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if API key is set properly (not the placeholder)</span></span><br><span class="line"><span class="keyword">if</span> grep -q <span class="string">&quot;your-qwen-api-key-here&quot;</span> .<span class="built_in">env</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âš ï¸  Qwen API key not set properly in .env file&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Please edit .env and add your actual Qwen API key:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   nano .env&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if embeddings are enabled</span></span><br><span class="line"><span class="keyword">if</span> grep -q <span class="string">&quot;MEMU_ENABLE_EMBEDDINGS=false&quot;</span> .<span class="built_in">env</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âš ï¸  Embeddings are disabled. For full functionality, consider enabling them.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ”§ Configuration:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Host: 0.0.0.0&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Port: 8000&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Memory Dir: ./memory&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   LLM Provider: Qwen (OpenAI-compatible)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Embeddings: enabled (using Qwen&#x27;s text-embedding-v3 model)&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ“¡ Server will be available at:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   API: http://localhost:8000&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Docs: http://localhost:8000/docs&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Health: http://localhost:8000/health&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ“ Press Ctrl+C to stop the server&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start MemU server</span></span><br><span class="line">memu-server start</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…ç›´æ¥å¯åŠ¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memu-server start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>memu-server startå‘½ä»¤æ˜¯é€šè¿‡pyproject.tomlæ–‡ä»¶ä¸­çš„[project.scripts]éƒ¨åˆ†å®šä¹‰çš„ï¼š<br> memu-server &#x3D; â€œmemu.server.cli:mainâ€</p>
<p>  è¿™æ„å‘³ç€å½“ä½ è¿è¡Œmemu-server startæ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨memu.server.cliæ¨¡å—ä¸­çš„main()å‡½æ•°ï¼Œå¹¶ä¼ é€’startä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ã€‚</p>
</blockquote>
<p>é€šè¿‡è„šæœ¬æ–¹å¼å¯åŠ¨åä¼šçœ‹åˆ°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">(memu-local-env) chr@chr:~/æ¡Œé¢/memory_framework$ ./start_memu_local.sh</span><br><span class="line">ğŸš€ Starting MemU Local Server <span class="keyword">for</span> Learning...</span><br><span class="line">=============================================</span><br><span class="line">âœ… Virtual environment is already activated</span><br><span class="line">ğŸ”§ Configuration:</span><br><span class="line">   Host: 0.0.0.0</span><br><span class="line">   Port: 8000</span><br><span class="line">   Memory Dir: ./memory</span><br><span class="line">   LLM Provider: Qwen (OpenAI-compatible)</span><br><span class="line">   Embeddings: enabled (using Qwen<span class="string">&#x27;s text-embedding-v3 model)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ğŸ“¡ Server will be available at:</span></span><br><span class="line"><span class="string">   API: http://localhost:8000</span></span><br><span class="line"><span class="string">   Docs: http://localhost:8000/docs</span></span><br><span class="line"><span class="string">   Health: http://localhost:8000/health</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ğŸ“ Press Ctrl+C to stop the server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ğŸš€ Starting MemU Server...</span></span><br><span class="line"><span class="string">   Host: 0.0.0.0</span></span><br><span class="line"><span class="string">   Port: 8000</span></span><br><span class="line"><span class="string">   Debug: True</span></span><br><span class="line"><span class="string">   Memory Dir: ./memory</span></span><br><span class="line"><span class="string">   LLM Provider: openai</span></span><br><span class="line"><span class="string">   Embeddings: True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">INFO:     Will watch for changes in these directories: [&#x27;</span>/home/chr/æ¡Œé¢/memory_framework<span class="string">&#x27;]</span></span><br><span class="line"><span class="string">INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)</span></span><br><span class="line"><span class="string">INFO:     Started reloader process [2891620] using WatchFiles</span></span><br><span class="line"><span class="string">INFO:     Started server process [2891623]</span></span><br><span class="line"><span class="string">INFO:     Waiting for application startup.</span></span><br><span class="line"><span class="string">INFO:     Application startup complete.</span></span><br></pre></td></tr></table></figure>



<p><strong>å®¢æˆ·ç«¯ï¼š</strong></p>
<p>å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç±»ä¼¼ï¼Œå¯é€šè¿‡è„šæœ¬æ–¹å¼æˆ–ç›´æ¥å¯åŠ¨çš„æ–¹å¼è¿›è¡Œï¼Œè„šæœ¬ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># test_memu_local.sh - Test MemU local server</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ§ª Testing MemU Local Server with Qwen API...&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;===========================================&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if we&#x27;re in the right directory</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;memu-local-env&quot;</span> ] || [ ! -d <span class="string">&quot;memU&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âŒ Error: Please run this script from /home/chr/æ¡Œé¢/memory_framework/&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Current directory: <span class="subst">$(pwd)</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if virtual environment is activated</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$VIRTUAL_ENV</span>&quot;</span> == *<span class="string">&quot;memu-local-env&quot;</span>* ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âœ… Virtual environment is already activated&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ğŸ”„ Activating virtual environment...&quot;</span></span><br><span class="line">    <span class="built_in">source</span> memu-local-env/bin/activate</span><br><span class="line">    <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;âŒ Failed to activate virtual environment&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if server is running</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ” Checking if server is running...&quot;</span></span><br><span class="line">curl -s http://localhost:8000/health &gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âš ï¸  Server doesn&#x27;t seem to be running at http://localhost:8000&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Please start the server first with:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   ./start_memu_local.sh&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;âœ… Server is running&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the test server script</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸƒ Running test server script...&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Note: All tests should pass because Qwen API supports both LLM and embedding models.&quot;</span></span><br><span class="line">python <span class="string">&quot;memU/example/server/test_server.py&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç›´æ¥å¯åŠ¨ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python memU/example/server/test_server.py</span><br></pre></td></tr></table></figure>

<p>æˆ‘é€šè¿‡è„šæœ¬æ–¹å¼è¿›è¡Œå¯åŠ¨ï¼Œå¯åŠ¨åä¼šçœ‹åˆ°ï¼š</p>
<blockquote>
<p>15:30:10ç§’å¼€å§‹ï¼Œ15:31:47ç»“æŸï¼Œå°±ä¸€è½®å¯¹è¯ï¼Œç”¨äº†å¿«100ç§’ï¼Ÿï¼ˆç–‘æƒ‘.jpgï¼‰ï¼Œå’±ä»¬ä¸‹é¢åˆ†æçš„åŸç†çš„æ—¶å€™çœ‹çœ‹ä¸ºå•¥è€—æ—¶è¿™ä¹ˆä¹…ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">(memu-local-env) chr@chr:~/æ¡Œé¢/memory_framework$ ./test_memu_local.sh</span><br><span class="line">ğŸ§ª Testing MemU Local Server with Qwen API...</span><br><span class="line">===========================================</span><br><span class="line">âœ… Virtual environment is already activated</span><br><span class="line">ğŸ” Checking <span class="keyword">if</span> server is running...</span><br><span class="line">âœ… Server is running</span><br><span class="line">ğŸƒ Running <span class="built_in">test</span> server script...</span><br><span class="line">Note: All tests should pass because Qwen API supports both LLM and embedding models.</span><br><span class="line">ğŸš€ MemU Server API Test</span><br><span class="line">==================================================</span><br><span class="line">ğŸ” Testing server health...</span><br><span class="line">âœ… Server is healthy</span><br><span class="line">   Response: &#123;<span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;healthy&#x27;</span>, <span class="string">&#x27;server&#x27;</span>: <span class="string">&#x27;memu-server&#x27;</span>, <span class="string">&#x27;version&#x27;</span>: <span class="string">&#x27;0.1.0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">ğŸ“ Testing conversation memorization...</span><br><span class="line">âœ… Memorization started successfully</span><br><span class="line">   Task ID: 260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">   Status: PENDING</span><br><span class="line"></span><br><span class="line">â³ Checking task status <span class="keyword">for</span> 260ae5ac-3ddf-4060-9159-fda315580df1...</span><br><span class="line">   Attempt 1: Status = PROCESSING</span><br><span class="line">	...ï¼ˆæ‰‹åŠ¨ç¼©å‡ï¼‰</span><br><span class="line">   Attempt 47: Status = PROCESSING</span><br><span class="line">   Attempt 48: Status = SUCCESS</span><br><span class="line">âœ… Task completed successfully</span><br><span class="line">   Result: &#123;&#125;</span><br><span class="line"></span><br><span class="line">ğŸ“‚ Testing default categories retrieval...</span><br><span class="line">âœ… Default categories retrieved successfully</span><br><span class="line">   Total categories: 1</span><br><span class="line">   - event: 2 memories</span><br><span class="line"></span><br><span class="line">ğŸ” Testing related memory items search...</span><br><span class="line">âœ… Related memory items retrieved successfully</span><br><span class="line">   Query: Python programming <span class="built_in">help</span></span><br><span class="line">   Total found: 4</span><br><span class="line">   1. Score: 0.657</span><br><span class="line">      Content: Test User discussed working on a Python project and expressed a need <span class="keyword">for</span> <span class="built_in">help</span> with APIs, prompting t...</span><br><span class="line">   2. Score: 0.637</span><br><span class="line">      Content: On 2025-09-24, Test User discussed working on a Python project requiring API integration and express...</span><br><span class="line">   3. Score: 0.438</span><br><span class="line">      Content: Test User initiated a conversation with the assistant on 2025-09-24, greeting the assistant and aski...</span><br><span class="line"></span><br><span class="line">ğŸ—‚ï¸ Testing related clustered categories search...</span><br><span class="line">âœ… Related clustered categories retrieved successfully</span><br><span class="line">   Query: programming assistance</span><br><span class="line">   Total categories found: 1</span><br><span class="line">   - programming assistance: Score 0.628, 2 memories</span><br><span class="line"></span><br><span class="line">ğŸ‰ Test completed!</span><br><span class="line"></span><br><span class="line">Next steps:</span><br><span class="line">1. Check the ./memory directory <span class="keyword">for</span> generated files</span><br><span class="line">2. Try the interactive API docs at http://localhost:8000/docs</span><br><span class="line">3. Integrate with your applications using the MemU SDK</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™ä¹Ÿèƒ½çœ‹åˆ°æœåŠ¡ç«¯çª—å£ä¹Ÿå¤šäº†ä¸€äº›æ‰“å°ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">2025-09-24 15:30:09 | memu.server.middleware:26 | INFO | Request: GET /health - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:09 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /health</span><br><span class="line">INFO:     127.0.0.1:46984 - <span class="string">&quot;GET /health HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:09 | memu.server.middleware:26 | INFO | Request: GET /health - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:09 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /health</span><br><span class="line">INFO:     127.0.0.1:46986 - <span class="string">&quot;GET /health HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:09 | memu.server.middleware:26 | INFO | Request: POST /api/v1/memory/memorize - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:09 | memu.server.services.memory_service:48 | INFO | Memory service initialized with directory: ./memory</span><br><span class="line">2025-09-24 15:30:09 | memu.server.routers.memory:67 | INFO | Starting memorization <span class="keyword">for</span> user test_user_123, agent test_agent_456</span><br><span class="line">2025-09-24 15:30:09 | memu.server.services.task_service:53 | INFO | Created task 260ae5ac-3ddf-4060-9159-fda315580df1 of <span class="built_in">type</span> memorize</span><br><span class="line">2025-09-24 15:30:09 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.001s - Path: /api/v1/memory/memorize</span><br><span class="line">INFO:     127.0.0.1:46988 - <span class="string">&quot;POST /api/v1/memory/memorize HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:09 | memu.server.routers.memory:119 | INFO | Processing memorization task 260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">2025-09-24 15:30:09 | memu.server.services.task_service:102 | INFO | Updated task 260ae5ac-3ddf-4060-9159-fda315580df1 to status PROCESSING</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.file_manager:53 | INFO | MemoryFileManager initialized with directory: memory</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.embeddings:455 | INFO | Embedding provider: openai</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.embeddings:456 | INFO | Embedding model: text-embedding-v3</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.embeddings:457 | INFO | Embedding model <span class="built_in">type</span>: sentence_transformers</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.embeddings:458 | INFO | Embedding device: cpu</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.embeddings:62 | INFO | OpenAI embedding client initialized with model: text-embedding-v3</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.memory_agent:63 | INFO | Embeddings enabled <span class="keyword">for</span> semantic retrieval</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.memory_agent:78 | INFO | Memory Core initialized: 2 memory types, embeddings: True</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.memory_agent:124 | INFO | Memory Agent initialized: 6 actions available</span><br><span class="line">2025-09-24 15:30:09 | memu.server.services.memory_service:158 | INFO | Using directory structure: ./memory/test_agent_456/test_user_123/ <span class="keyword">for</span> character: Test User</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.memory_agent:181 | INFO | session <span class="built_in">date</span> unavaiable, use system datetime</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.memory_agent:184 | INFO | ğŸš€ Starting iterative conversation processing <span class="keyword">for</span> Test User</span><br><span class="line">2025-09-24 15:30:09 | memu.memory.memory_agent:246 | INFO | ğŸ”„ Iteration 1/20</span><br><span class="line">2025-09-24 15:30:09 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:09 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:46990 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:11 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:11 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:46992 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:13 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:13 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:46994 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:15 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:15 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:57628 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:16 | memu.memory.memory_agent:297 | INFO | ğŸ”§ Calling <span class="keyword">function</span>: add_activity_memory</span><br><span class="line">2025-09-24 15:30:17 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:17 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:57638 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:19 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:19 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:57648 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:20 | memu.memory.memory_agent:306 | INFO |     Function <span class="keyword">time</span> used: 4.17 seconds</span><br><span class="line">2025-09-24 15:30:20 | memu.memory.memory_agent:246 | INFO | ğŸ”„ Iteration 2/20</span><br><span class="line">2025-09-24 15:30:21 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:21 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:57660 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:23 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:23 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:57670 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:25 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:25 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:50302 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:27 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:27 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:50304 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:29 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:29 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:50318 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:31 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:31 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:50328 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:32 | memu.memory.memory_agent:297 | INFO | ğŸ”§ Calling <span class="keyword">function</span>: run_theory_of_mind</span><br><span class="line">2025-09-24 15:30:33 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:33 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.001s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:50342 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:35 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:35 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:45216 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:37 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:37 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:45218 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:39 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:39 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:45234 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:41 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:41 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:45242 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:43 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:43 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:45244 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:45 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:45 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36764 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:47 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:47 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36776 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:49 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:49 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36786 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:51 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:51 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36796 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:52 | memu.memory.memory_agent:306 | INFO |     Function <span class="keyword">time</span> used: 19.73 seconds</span><br><span class="line">2025-09-24 15:30:52 | memu.memory.memory_agent:246 | INFO | ğŸ”„ Iteration 3/20</span><br><span class="line">2025-09-24 15:30:53 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:53 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36804 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:55 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:55 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:42848 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:57 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:57 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:42860 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:30:59 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:30:59 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:42868 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:01 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:01 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:42884 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:03 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:03 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:42892 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:05 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:05 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:39886 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:07 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:07 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:39898 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:09 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:09 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:39906 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:11 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:11 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:39918 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:13 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:13 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:39924 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:13 | memu.memory.memory_agent:297 | INFO | ğŸ”§ Calling <span class="keyword">function</span>: generate_memory_suggestions</span><br><span class="line">2025-09-24 15:31:15 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:15 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36624 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:17 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:17 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36632 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:18 | memu.memory.memory_agent:306 | INFO |     Function <span class="keyword">time</span> used: 4.70 seconds</span><br><span class="line">2025-09-24 15:31:18 | memu.memory.memory_agent:246 | INFO | ğŸ”„ Iteration 4/20</span><br><span class="line">2025-09-24 15:31:19 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:19 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36638 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:21 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:21 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36654 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:23 | memu.memory.memory_agent:297 | INFO | ğŸ”§ Calling <span class="keyword">function</span>: update_memory_with_suggestions</span><br><span class="line">2025-09-24 15:31:23 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:23 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36662 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:25 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:25 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:33330 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:27 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:27 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:33342 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:28 | memu.memory.memory_agent:306 | INFO |     Function <span class="keyword">time</span> used: 5.39 seconds</span><br><span class="line">2025-09-24 15:31:28 | memu.memory.memory_agent:246 | INFO | ğŸ”„ Iteration 5/20</span><br><span class="line">2025-09-24 15:31:29 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:29 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.002s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:33350 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:31 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:31 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:33352 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:31 | memu.memory.memory_agent:297 | INFO | ğŸ”§ Calling <span class="keyword">function</span>: link_related_memories</span><br><span class="line">2025-09-24 15:31:32 | memu.memory.memory_agent:306 | INFO |     Function <span class="keyword">time</span> used: 0.54 seconds</span><br><span class="line">2025-09-24 15:31:32 | memu.memory.memory_agent:246 | INFO | ğŸ”„ Iteration 6/20</span><br><span class="line">2025-09-24 15:31:33 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:33 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:33360 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:35 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:35 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36884 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:37 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:37 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36886 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:39 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:39 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36890 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:40 | memu.memory.memory_agent:297 | INFO | ğŸ”§ Calling <span class="keyword">function</span>: cluster_memories</span><br><span class="line">2025-09-24 15:31:41 | memu.memory.memory_agent:306 | INFO |     Function <span class="keyword">time</span> used: 0.81 seconds</span><br><span class="line">2025-09-24 15:31:41 | memu.memory.memory_agent:246 | INFO | ğŸ”„ Iteration 7/20</span><br><span class="line">2025-09-24 15:31:41 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:41 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36900 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:43 | memu.memory.memory_agent:272 | INFO | âœ… LLM indicated processing is complete</span><br><span class="line">2025-09-24 15:31:43 | memu.memory.memory_agent:361 | INFO | ğŸ‰ Conversation processing completed after 7 iterations</span><br><span class="line">2025-09-24 15:31:43 | memu.memory.memory_agent:365 | INFO | ğŸ”§ Made 6 <span class="keyword">function</span> calls</span><br><span class="line">2025-09-24 15:31:43 | memu.server.services.memory_service:171 | INFO | Memory processing completed <span class="keyword">for</span> test_agent_456:test_user_123</span><br><span class="line">2025-09-24 15:31:43 | memu.server.services.task_service:102 | INFO | Updated task 260ae5ac-3ddf-4060-9159-fda315580df1 to status SUCCESS</span><br><span class="line">2025-09-24 15:31:43 | memu.server.routers.memory:137 | INFO | Memorization task 260ae5ac-3ddf-4060-9159-fda315580df1 completed successfully</span><br><span class="line">2025-09-24 15:31:43 | memu.server.middleware:26 | INFO | Request: GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:43 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.000s - Path: /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1</span><br><span class="line">INFO:     127.0.0.1:36912 - <span class="string">&quot;GET /api/v1/memory/memorize/status/260ae5ac-3ddf-4060-9159-fda315580df1 HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:45 | memu.server.middleware:26 | INFO | Request: POST /api/v1/memory/retrieve/default-categories - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:45 | memu.server.routers.memory:186 | INFO | Retrieving default categories <span class="keyword">for</span> user test_user_123</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.file_manager:53 | INFO | MemoryFileManager initialized with directory: memory</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:455 | INFO | Embedding provider: openai</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:456 | INFO | Embedding model: text-embedding-v3</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:457 | INFO | Embedding model <span class="built_in">type</span>: sentence_transformers</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:458 | INFO | Embedding device: cpu</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:62 | INFO | OpenAI embedding client initialized with model: text-embedding-v3</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.recall_agent:54 | INFO | Semantic search enabled</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.recall_agent:65 | INFO | Recall Agent initialized with memory directory: memory</span><br><span class="line">2025-09-24 15:31:45 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.044s - Path: /api/v1/memory/retrieve/default-categories</span><br><span class="line">INFO:     127.0.0.1:43182 - <span class="string">&quot;POST /api/v1/memory/retrieve/default-categories HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:45 | memu.server.middleware:26 | INFO | Request: POST /api/v1/memory/retrieve/related-memory-items - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:45 | memu.server.routers.memory:212 | INFO | Retrieving related memory items <span class="keyword">for</span> user test_user_123, query: <span class="string">&#x27;Python programming help&#x27;</span></span><br><span class="line">2025-09-24 15:31:45 | memu.memory.file_manager:53 | INFO | MemoryFileManager initialized with directory: memory</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:455 | INFO | Embedding provider: openai</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:456 | INFO | Embedding model: text-embedding-v3</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:457 | INFO | Embedding model <span class="built_in">type</span>: sentence_transformers</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:458 | INFO | Embedding device: cpu</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:62 | INFO | OpenAI embedding client initialized with model: text-embedding-v3</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.recall_agent:54 | INFO | Semantic search enabled</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.recall_agent:65 | INFO | Recall Agent initialized with memory directory: memory</span><br><span class="line">2025-09-24 15:31:45 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.263s - Path: /api/v1/memory/retrieve/related-memory-items</span><br><span class="line">INFO:     127.0.0.1:43186 - <span class="string">&quot;POST /api/v1/memory/retrieve/related-memory-items HTTP/1.1&quot;</span> 200 OK</span><br><span class="line">2025-09-24 15:31:45 | memu.server.middleware:26 | INFO | Request: POST /api/v1/memory/retrieve/related-clustered-categories - Client: 127.0.0.1</span><br><span class="line">2025-09-24 15:31:45 | memu.server.routers.memory:243 | INFO | Retrieving clustered categories <span class="keyword">for</span> user test_user_123, query: <span class="string">&#x27;programming assistance&#x27;</span></span><br><span class="line">2025-09-24 15:31:45 | memu.memory.file_manager:53 | INFO | MemoryFileManager initialized with directory: memory</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:455 | INFO | Embedding provider: openai</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:456 | INFO | Embedding model: text-embedding-v3</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:457 | INFO | Embedding model <span class="built_in">type</span>: sentence_transformers</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:458 | INFO | Embedding device: cpu</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.embeddings:62 | INFO | OpenAI embedding client initialized with model: text-embedding-v3</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.recall_agent:54 | INFO | Semantic search enabled</span><br><span class="line">2025-09-24 15:31:45 | memu.memory.recall_agent:65 | INFO | Recall Agent initialized with memory directory: memory</span><br><span class="line">2025-09-24 15:31:46 | memu.server.middleware:38 | INFO | Response: 200 - Time: 0.471s - Path: /api/v1/memory/retrieve/related-clustered-categories</span><br><span class="line">INFO:     127.0.0.1:43200 - <span class="string">&quot;POST /api/v1/memory/retrieve/related-clustered-categories HTTP/1.1&quot;</span> 200 OK</span><br></pre></td></tr></table></figure>

<p>å†çœ‹memoryæ–‡ä»¶å¤¹ï¼Œä¹Ÿå¤šäº†ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™åº”è¯¥å°±æ˜¯å­˜çš„è®°å¿†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ embeddings</span><br><span class="line">â”‚Â Â  â””â”€â”€ test_agent_456</span><br><span class="line">â”‚Â Â      â””â”€â”€ test_user_123</span><br><span class="line">â”‚Â Â          â”œâ”€â”€ activity_embeddings.json</span><br><span class="line">â”‚Â Â          â””â”€â”€ event_embeddings.json</span><br><span class="line">â””â”€â”€ test_agent_456</span><br><span class="line">    â””â”€â”€ test_user_123</span><br><span class="line">        â”œâ”€â”€ activity.md</span><br><span class="line">        â”œâ”€â”€ event.md</span><br><span class="line">        â””â”€â”€ programming_assistance.md</span><br></pre></td></tr></table></figure>

<p>è¿™äº›æ˜¯å•¥ï¼Ÿä¸‹é¢å’±ä»¬å°±æ¥å¥½å¥½åˆ†æåˆ†æã€‚</p>
<hr>
<h3 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h3><h4 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h4><p>ç²¾åè‚¯å®šéƒ½åœ¨æœåŠ¡ç«¯ä»£ç ï¼Œå®¢æˆ·ç«¯ä»£ç åªæ˜¯è°ƒç”¨äº†ä¸‹<code>API</code>æ¥å£ï¼Œå’±ä»¬å…ˆä»ç®€å•çš„<strong>å®¢æˆ·ç«¯</strong>çœ‹èµ·å§ï¼š</p>
<p><strong>æ€»ä½“è°ƒç”¨é¡ºåºï¼š</strong></p>
<ol>
<li>âœ… <code>/health</code> â€”â€” å¥åº·æ£€æŸ¥</li>
<li>âœ… <code>/api/v1/memory/memorize</code> â€”â€” æäº¤å¯¹è¯è®°å¿†ä»»åŠ¡</li>
<li>âœ… <code>/api/v1/memory/memorize/status/&#123;task_id&#125;</code> â€”â€” è½®è¯¢ä»»åŠ¡çŠ¶æ€ï¼ˆç›´åˆ° SUCCESS&#x2F;FAILUREï¼‰</li>
<li>âœ… <code>/api/v1/memory/retrieve/default-categories</code> â€”â€” è·å–é»˜è®¤è®°å¿†åˆ†ç±»</li>
<li>âœ… <code>/api/v1/memory/retrieve/related-memory-items</code> â€”â€” æœç´¢ç›¸å…³è®°å¿†æ¡ç›®</li>
<li>âœ… <code>/api/v1/memory/retrieve/related-clustered-categories</code> â€”â€” æœç´¢ç›¸å…³èšç±»åˆ†ç±»</li>
</ol>
<p><strong>1ï¸âƒ£ æ¥å£ï¼šå¥åº·æ£€æŸ¥ <code>/health</code></strong></p>
<ul>
<li><p><strong>HTTP æ–¹æ³•</strong>ï¼š<code>GET</code></p>
</li>
<li><p><strong>URL</strong>ï¼š<code>http://localhost:8000/health</code></p>
</li>
<li><p><strong>è¯·æ±‚å‚æ•°</strong>ï¼šæ— </p>
</li>
<li><p><strong>Headers</strong>ï¼šæ— ç‰¹æ®Šè¦æ±‚</p>
</li>
<li><p><strong>ç”¨é€”</strong>ï¼šæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ</p>
</li>
<li><p><strong>æˆåŠŸå“åº”ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   &#x27;status&#x27;<span class="punctuation">:</span> &#x27;healthy&#x27;<span class="punctuation">,</span></span><br><span class="line">   &#x27;server&#x27;<span class="punctuation">:</span> &#x27;memu-server&#x27;<span class="punctuation">,</span></span><br><span class="line">   &#x27;version&#x27;<span class="punctuation">:</span> &#x27;<span class="number">0.1</span><span class="number">.0</span>&#x27;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>å¤±è´¥å¤„ç†</strong>ï¼šè„šæœ¬ç»ˆæ­¢ï¼Œæç¤ºæœåŠ¡å™¨æœªè¿è¡Œ</p>
</li>
</ul>
<p>2ï¸âƒ£ æ¥å£ï¼šæäº¤è®°å¿†ä»»åŠ¡ <code>/api/v1/memory/memorize</code></p>
<ul>
<li><p><strong>HTTP æ–¹æ³•</strong>ï¼š<code>POST</code></p>
</li>
<li><p><strong>URL</strong>ï¼š<code>http://localhost:8000/api/v1/memory/memorize</code></p>
</li>
<li><p><strong>Headers</strong>ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br></pre></td></tr></table></figure></li>
<li><p><strong>è¯·æ±‚ Bodyï¼ˆJSONï¼‰</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;conversation_text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;User: Hello! How are you today?...&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_user_123&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Test User&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;agent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_agent_456&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;agent_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Test Assistant&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¿…å¡«</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>conversation_text</code></td>
<td>string</td>
<td>âœ…</td>
<td>å¤šè½®å¯¹è¯æ–‡æœ¬ï¼Œæ ¼å¼ä¸º <code>User: ...\nAssistant: ...</code></td>
</tr>
<tr>
<td><code>user_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>ç”¨æˆ·å”¯ä¸€æ ‡è¯†</td>
</tr>
<tr>
<td><code>user_name</code></td>
<td>string</td>
<td>âœ…</td>
<td>ç”¨æˆ·æ˜¾ç¤ºå</td>
</tr>
<tr>
<td><code>agent_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>AIåŠ©æ‰‹å”¯ä¸€æ ‡è¯†</td>
</tr>
<tr>
<td><code>agent_name</code></td>
<td>string</td>
<td>âœ…</td>
<td>AIåŠ©æ‰‹æ˜¾ç¤ºå</td>
</tr>
</tbody></table>
</li>
<li><p><strong>æˆåŠŸå“åº”</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;task_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;task_abc123&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PENDING&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>è„šæœ¬è¡Œä¸º</strong>ï¼šæå– <code>task_id</code> ä¾›ä¸‹ä¸€æ­¥è½®è¯¢ä½¿ç”¨</p>
</li>
</ul>
<p>3ï¸âƒ£ æ¥å£ï¼šè½®è¯¢ä»»åŠ¡çŠ¶æ€ <code>/api/v1/memory/memorize/status/&#123;task_id&#125;</code></p>
<ul>
<li><p><strong>HTTP æ–¹æ³•</strong>ï¼š<code>GET</code></p>
</li>
<li><p><strong>URL</strong>ï¼š<code>http://localhost:8000/api/v1/memory/memorize/status/&#123;task_id&#125;</code></p>
<ul>
<li>ç¤ºä¾‹ï¼š<code>.../status/task_abc123</code></li>
</ul>
</li>
<li><p><strong>è¯·æ±‚å‚æ•°</strong>ï¼šæ— ï¼ˆtask_id åœ¨è·¯å¾„ä¸­ï¼‰</p>
</li>
<li><p><strong>è½®è¯¢æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>æœ€å¤šå°è¯• 200 æ¬¡ï¼ˆçº¦ 30 ç§’ï¼‰</li>
<li>æ¯æ¬¡é—´éš” 2 ç§’</li>
<li>çŠ¶æ€ä¸º <code>SUCCESS</code> æˆ– <code>FAILURE</code> æ—¶åœæ­¢</li>
</ul>
</li>
<li><p><strong>æˆåŠŸå“åº”ï¼ˆçŠ¶æ€ SUCCESSï¼‰</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SUCCESS&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      ...</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¤±è´¥å“åº”ï¼ˆçŠ¶æ€ FAILUREï¼‰</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;FAILURE&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Failed to parse conversation text&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è„šæœ¬è¡Œä¸º</strong>ï¼š</p>
<ul>
<li>æˆåŠŸ â†’ ç»§ç»­åç»­æµ‹è¯•</li>
<li>å¤±è´¥ â†’ è¾“å‡ºé”™è¯¯ï¼Œä½†ä»ç»§ç»­ï¼ˆéé˜»å¡æ€§ï¼‰</li>
</ul>
</li>
</ul>
<p>4ï¸âƒ£ æ¥å£ï¼šè·å–é»˜è®¤åˆ†ç±» <code>/api/v1/memory/retrieve/default-categories</code></p>
<ul>
<li><p><strong>HTTP æ–¹æ³•</strong>ï¼š<code>POST</code></p>
</li>
<li><p><strong>URL</strong>ï¼š<code>http://localhost:8000/api/v1/memory/retrieve/default-categories</code></p>
</li>
<li><p><strong>Headers</strong>ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br></pre></td></tr></table></figure></li>
<li><p><strong>è¯·æ±‚ Bodyï¼ˆJSONï¼‰</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_user_123&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;agent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_agent_456&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;include_inactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¿…å¡«</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>user_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>ç”¨æˆ·ID</td>
</tr>
<tr>
<td><code>agent_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>åŠ©æ‰‹ID</td>
</tr>
<tr>
<td><code>include_inactive</code></td>
<td>boolean</td>
<td>âœ…</td>
<td>æ˜¯å¦åŒ…å«æœªæ¿€æ´»&#x2F;ç©ºåˆ†ç±»</td>
</tr>
</tbody></table>
</li>
<li><p><strong>æˆåŠŸå“åº”</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;total_categories&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;categories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;event&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;memory_count&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>5ï¸âƒ£ æ¥å£ï¼šæœç´¢ç›¸å…³è®°å¿†æ¡ç›® <code>/api/v1/memory/retrieve/related-memory-items</code></p>
<ul>
<li><p><strong>HTTP æ–¹æ³•</strong>ï¼š<code>POST</code></p>
</li>
<li><p><strong>URL</strong>ï¼š<code>http://localhost:8000/api/v1/memory/retrieve/related-memory-items</code></p>
</li>
<li><p><strong>Headers</strong>ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br></pre></td></tr></table></figure></li>
<li><p><strong>è¯·æ±‚ Bodyï¼ˆJSONï¼‰</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_user_123&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;agent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_agent_456&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python programming help&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;top_k&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;min_similarity&quot;</span><span class="punctuation">:</span> <span class="number">0.3</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¿…å¡«</th>
<th>é»˜è®¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>user_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>-</td>
<td>ç”¨æˆ·ID</td>
</tr>
<tr>
<td><code>agent_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>-</td>
<td>åŠ©æ‰‹ID</td>
</tr>
<tr>
<td><code>query</code></td>
<td>string</td>
<td>âœ…</td>
<td>-</td>
<td>æœç´¢å…³é”®è¯&#x2F;å¥å­</td>
</tr>
<tr>
<td><code>top_k</code></td>
<td>int</td>
<td>âœ…</td>
<td>-</td>
<td>è¿”å›å‰ K ä¸ªæœ€ç›¸å…³ç»“æœ</td>
</tr>
<tr>
<td><code>min_similarity</code></td>
<td>float</td>
<td>âœ…</td>
<td>-</td>
<td>æœ€ä½ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆ0~1ï¼‰</td>
</tr>
</tbody></table>
</li>
<li><p><strong>æˆåŠŸå“åº”</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Python programming help&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;total_found&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;related_memories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;similarity_score&quot;</span><span class="punctuation">:</span> <span class="number">0.657</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;memory&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Test User discussed working on a Python project and expressed a ...&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;similarity_score&quot;</span><span class="punctuation">:</span> <span class="number">0.637</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;memory&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;On 2025-09-24, Test User discussed working on a Python project...&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>6ï¸âƒ£ æ¥å£ï¼šæœç´¢ç›¸å…³èšç±»åˆ†ç±» <code>/api/v1/memory/retrieve/related-clustered-categories</code></p>
<ul>
<li><p><strong>HTTP æ–¹æ³•</strong>ï¼š<code>POST</code></p>
</li>
<li><p><strong>URL</strong>ï¼š<code>http://localhost:8000/api/v1/memory/retrieve/related-clustered-categories</code></p>
</li>
<li><p><strong>Headers</strong>ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br></pre></td></tr></table></figure></li>
<li><p><strong>è¯·æ±‚ Bodyï¼ˆJSONï¼‰</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_user_123&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;agent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_agent_456&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;category_query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;programming assistance&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;top_k&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;min_similarity&quot;</span><span class="punctuation">:</span> <span class="number">0.3</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å¿…å¡«</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>user_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>ç”¨æˆ·ID</td>
</tr>
<tr>
<td><code>agent_id</code></td>
<td>string</td>
<td>âœ…</td>
<td>åŠ©æ‰‹ID</td>
</tr>
<tr>
<td><code>category_query</code></td>
<td>string</td>
<td>âœ…</td>
<td>åˆ†ç±»æœç´¢å…³é”®è¯</td>
</tr>
<tr>
<td><code>top_k</code></td>
<td>int</td>
<td>âœ…</td>
<td>è¿”å›å‰ K ä¸ªæœ€ç›¸å…³åˆ†ç±»</td>
</tr>
<tr>
<td><code>min_similarity</code></td>
<td>float</td>
<td>âœ…</td>
<td>æœ€ä½ç›¸ä¼¼åº¦é˜ˆå€¼</td>
</tr>
</tbody></table>
</li>
<li><p><strong>æˆåŠŸå“åº”</strong>ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;category_query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;programming assistance&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;total_categories_found&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;clustered_categories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;programming assistance&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;similarity_score&quot;</span><span class="punctuation">:</span> <span class="number">0.628</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;memory_count&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>ğŸ§­ æ€»ç»“è¡¨æ ¼ï¼šæ¥å£è°ƒç”¨é¡ºåºä¸€è§ˆ</p>
<table>
<thead>
<tr>
<th>æ­¥éª¤</th>
<th>æ¥å£è·¯å¾„</th>
<th>æ–¹æ³•</th>
<th>ä¸»è¦å‚æ•°</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>/health</code></td>
<td>GET</td>
<td>æ— </td>
<td>æœåŠ¡å™¨å¥åº·æ£€æŸ¥</td>
</tr>
<tr>
<td>2</td>
<td><code>/api/v1/memory/memorize</code></td>
<td>POST</td>
<td><code>conversation_text</code>, <code>user_id</code>, <code>agent_id</code> ç­‰</td>
<td>æäº¤å¯¹è¯è®°å¿†ä»»åŠ¡ï¼Œè¿”å› task_id</td>
</tr>
<tr>
<td>3</td>
<td><code>/api/v1/memory/memorize/status/&#123;task_id&#125;</code></td>
<td>GET</td>
<td><code>task_id</code>ï¼ˆè·¯å¾„ï¼‰</td>
<td>è½®è¯¢ä»»åŠ¡çŠ¶æ€ï¼Œç›´åˆ°å®Œæˆ</td>
</tr>
<tr>
<td>4</td>
<td><code>/api/v1/memory/retrieve/default-categories</code></td>
<td>POST</td>
<td><code>user_id</code>, <code>agent_id</code>, <code>include_inactive</code></td>
<td>è·å–ç”¨æˆ·-åŠ©æ‰‹ç»„åˆä¸‹çš„é»˜è®¤è®°å¿†åˆ†ç±»</td>
</tr>
<tr>
<td>5</td>
<td><code>/api/v1/memory/retrieve/related-memory-items</code></td>
<td>POST</td>
<td><code>query</code>, <code>top_k</code>, <code>min_similarity</code></td>
<td>æ ¹æ®è¯­ä¹‰æœç´¢ç›¸å…³è®°å¿†æ¡ç›®</td>
</tr>
<tr>
<td>6</td>
<td><code>/api/v1/memory/retrieve/related-clustered-categories</code></td>
<td>POST</td>
<td><code>category_query</code>, <code>top_k</code>, <code>min_similarity</code></td>
<td>æ ¹æ®è¯­ä¹‰æœç´¢ç›¸å…³è®°å¿†åˆ†ç±»ï¼ˆèšç±»ï¼‰</td>
</tr>
</tbody></table>
<p>ğŸ¯ ä¸šåŠ¡æµç¨‹æ€»ç»“ï¼š</p>
<blockquote>
<p>è¿™ä¸ªè„šæœ¬å®Œæ•´æ¨¡æ‹Ÿäº†ä¸€ä¸ªâ€œå¯¹è¯ â†’ è®°å¿† â†’ æ£€ç´¢â€çš„é—­ç¯ï¼š</p>
</blockquote>
<ol>
<li><strong>å…ˆç¡®è®¤æœåŠ¡æ´»ç€</strong>ï¼ˆhealth checkï¼‰</li>
<li><strong>æŠŠä¸€æ®µå¯¹è¯â€œå–‚â€ç»™ç³»ç»Ÿè®°å¿†</strong>ï¼ˆmemorizeï¼‰</li>
<li><strong>ç­‰å¾…ç³»ç»Ÿå¼‚æ­¥å¤„ç†å®Œæˆ</strong>ï¼ˆpollingï¼‰</li>
<li><strong>æŸ¥çœ‹ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆäº†å“ªäº›è®°å¿†åˆ†ç±»</strong>ï¼ˆdefault categoriesï¼‰</li>
<li><strong>ç”¨è‡ªç„¶è¯­è¨€æœç´¢ç›¸å…³è®°å¿†å†…å®¹</strong>ï¼ˆrelated memoriesï¼‰</li>
<li><strong>ç”¨è‡ªç„¶è¯­è¨€æœç´¢ç›¸å…³è®°å¿†åˆ†ç±»</strong>ï¼ˆclustered categoriesï¼‰</li>
</ol>
<p>â†’ <strong>é€‚åˆæµ‹è¯•â€œé•¿æœŸè®°å¿†ç³»ç»Ÿâ€çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚</strong></p>
<hr>
<h4 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h4><p>é€šè¿‡memu-server startè°ƒç”¨çš„æ˜¯memu.server.cliæ¨¡å—ä¸­çš„main()å‡½æ•°ï¼Œå¹¶ä¼ é€’startä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ã€‚cli.pyæ–‡ä»¶è¿˜æœ‰åˆå§‹åŒ–.envç¯å¢ƒçš„åŠŸèƒ½ã€‚cli.pyä½œä¸ºå¯åŠ¨æœåŠ¡ç«¯çš„ç¬¬ä¸€ç«™ï¼Œå®ƒï¼š </p>
<ul>
<li><p>é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æœåŠ¡</p>
</li>
<li><p>éªŒè¯å¿…è¦ API Key</p>
</li>
<li><p>å¯åŠ¨ FastAPI Web æœåŠ¡ï¼ˆå®é™…é€»è¾‘åœ¨ <code>main.py</code>ï¼‰</p>
<blockquote>
<pre><code># Start server
uvicorn.run(
    &quot;memu.server.main:app&quot;,
    host=host,
    port=port,
    reload=debug,
    log_level=&quot;info&quot; if not debug else &quot;debug&quot;
)
</code></pre>
</blockquote>
</li>
<li><p>æä¾› <code>start</code> å’Œ <code>init-env</code> ä¸¤ä¸ªå‘½ä»¤</p>
</li>
</ul>
<p>å®ƒå’Œä¹‹å‰çš„æµ‹è¯•è„šæœ¬æ„æˆå®Œæ•´çš„â€œæœåŠ¡ç«¯ + å®¢æˆ·ç«¯â€æµ‹è¯•é—­ç¯ã€‚ </p>
<hr>
<p>**ä½†<code>cli.py</code>åªæ˜¯â€œå¯åŠ¨è„šæœ¬â€ï¼Œ<code>main.py</code>æ‰æ˜¯çœŸæ­£çš„â€œæœåŠ¡ç«¯â€ï¼Œ**è¿è¡Œåˆ°<code>memu.servermain:app</code>æ—¶ï¼Œä¼šæ‰§è¡Œ&#x2F;è°ƒç”¨<code>main.py</code>ä¸­çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.middleware.cors <span class="keyword">import</span> CORSMiddleware</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .routers <span class="keyword">import</span> memory</span><br><span class="line"><span class="keyword">from</span> .middleware <span class="keyword">import</span> LoggingMiddleware</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure logging</span></span><br><span class="line"><span class="keyword">from</span> ..utils.logging <span class="keyword">import</span> get_logger</span><br><span class="line">logger = get_logger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create FastAPI application</span></span><br><span class="line">app = FastAPI(</span><br><span class="line">    title=<span class="string">&quot;MemU Self-Hosted Server&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;Self-hosted server for MemU memory management system&quot;</span>,</span><br><span class="line">    version=<span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">    docs_url=<span class="string">&quot;/docs&quot;</span>,</span><br><span class="line">    redoc_url=<span class="string">&quot;/redoc&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read server config from environment</span></span><br><span class="line">HOST = os.getenv(<span class="string">&quot;MEMU_HOST&quot;</span>, <span class="string">&quot;0.0.0.0&quot;</span>)</span><br><span class="line">PORT = <span class="built_in">int</span>(os.getenv(<span class="string">&quot;MEMU_PORT&quot;</span>, <span class="string">&quot;8000&quot;</span>))</span><br><span class="line">DEBUG = os.getenv(<span class="string">&quot;MEMU_DEBUG&quot;</span>, <span class="string">&quot;false&quot;</span>).lower() == <span class="string">&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line">cors_origins_env = os.getenv(<span class="string">&quot;MEMU_CORS_ORIGINS&quot;</span>, <span class="string">&quot;*&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> cors_origins_env == <span class="string">&quot;*&quot;</span>:</span><br><span class="line">    CORS_ORIGINS = [<span class="string">&quot;*&quot;</span>]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    CORS_ORIGINS = [origin.strip() <span class="keyword">for</span> origin <span class="keyword">in</span> cors_origins_env.split(<span class="string">&quot;,&quot;</span>) <span class="keyword">if</span> origin.strip()]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add CORS middleware</span></span><br><span class="line">app.add_middleware(</span><br><span class="line">    CORSMiddleware,</span><br><span class="line">    allow_origins=CORS_ORIGINS,</span><br><span class="line">    allow_credentials=<span class="literal">True</span>,</span><br><span class="line">    allow_methods=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">    allow_headers=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add logging middleware</span></span><br><span class="line">app.add_middleware(LoggingMiddleware)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Include routers</span></span><br><span class="line">app.include_router(memory.router, prefix=<span class="string">&quot;/api/v1/memory&quot;</span>, tags=[<span class="string">&quot;memory&quot;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">root</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Root endpoint - health check&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;MemU Self-Hosted Server&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;status&quot;</span>: <span class="string">&quot;running&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/health&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">health_check</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Health check endpoint&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;status&quot;</span>: <span class="string">&quot;healthy&quot;</span>,</span><br><span class="line">        <span class="string">&quot;server&quot;</span>: <span class="string">&quot;memu-server&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">Exception</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">global_exception_handler</span>(<span class="params">request: Request, exc: Exception</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Global exception handler&quot;&quot;&quot;</span></span><br><span class="line">    logger.error(<span class="string">f&quot;Global exception handler caught: <span class="subst">&#123;exc&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> JSONResponse(</span><br><span class="line">        status_code=<span class="number">500</span>,</span><br><span class="line">        content=&#123;</span><br><span class="line">            <span class="string">&quot;detail&quot;</span>: <span class="string">&quot;Internal server error&quot;</span>,</span><br><span class="line">            <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(exc)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä»£ç è§£é‡Šï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger = get_logger(__name__)</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ›å»ºä¸€ä¸ªå¸¦æ¨¡å—åçš„æ—¥å¿—è®°å½•å™¨ï¼ˆä¾¿äºè¿½è¸ªæ—¥å¿—æ¥æºï¼‰</li>
</ul>
<p><strong>åˆ›å»º FastAPI åº”ç”¨å¯¹è±¡</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create FastAPI application</span></span><br><span class="line">app = FastAPI(</span><br><span class="line">    title=<span class="string">&quot;MemU Self-Hosted Server&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;Self-hosted server for MemU memory management system&quot;</span>,</span><br><span class="line">    version=<span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">    docs_url=<span class="string">&quot;/docs&quot;</span>,</span><br><span class="line">    redoc_url=<span class="string">&quot;/redoc&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>title</code></td>
<td>API æ–‡æ¡£æ ‡é¢˜ï¼ˆæ˜¾ç¤ºåœ¨ Swagger UI é¡¶éƒ¨ï¼‰</td>
</tr>
<tr>
<td><code>description</code></td>
<td>API æ–‡æ¡£æè¿°ï¼ˆæ”¯æŒ Markdownï¼‰</td>
</tr>
<tr>
<td><code>version</code></td>
<td>åº”ç”¨ç‰ˆæœ¬å·</td>
</tr>
<tr>
<td><code>docs_url=&quot;/docs&quot;</code></td>
<td>å¯ç”¨ Swagger UI æ–‡æ¡£ï¼Œè®¿é—® <code>http://localhost:8000/docs</code></td>
</tr>
<tr>
<td><code>redoc_url=&quot;/redoc&quot;</code></td>
<td>å¯ç”¨ ReDoc æ–‡æ¡£ï¼ˆå¦ä¸€ç§ API æ–‡æ¡£é£æ ¼ï¼‰</td>
</tr>
</tbody></table>
<blockquote>
<p>è¿™è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ª <strong>FastAPI åº”ç”¨å¯¹è±¡</strong>ï¼Œåç»­æ‰€æœ‰è·¯ç”±ã€ä¸­é—´ä»¶éƒ½æ³¨å†Œåˆ°è¿™ä¸ª <code>app</code> ä¸Šã€‚</p>
</blockquote>
<p><strong>è¯»å–ç¯å¢ƒå˜é‡é…ç½®</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Read server config from environment</span></span><br><span class="line">HOST = os.getenv(<span class="string">&quot;MEMU_HOST&quot;</span>, <span class="string">&quot;0.0.0.0&quot;</span>)</span><br><span class="line">PORT = <span class="built_in">int</span>(os.getenv(<span class="string">&quot;MEMU_PORT&quot;</span>, <span class="string">&quot;8000&quot;</span>))</span><br><span class="line">DEBUG = os.getenv(<span class="string">&quot;MEMU_DEBUG&quot;</span>, <span class="string">&quot;false&quot;</span>).lower() == <span class="string">&quot;true&quot;</span></span><br><span class="line"></span><br><span class="line">cors_origins_env = os.getenv(<span class="string">&quot;MEMU_CORS_ORIGINS&quot;</span>, <span class="string">&quot;*&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> cors_origins_env == <span class="string">&quot;*&quot;</span>:</span><br><span class="line">    CORS_ORIGINS = [<span class="string">&quot;*&quot;</span>]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    CORS_ORIGINS = [origin.strip() <span class="keyword">for</span> origin <span class="keyword">in</span> cors_origins_env.split(<span class="string">&quot;,&quot;</span>) <span class="keyword">if</span> origin.strip()]</span><br></pre></td></tr></table></figure>

<p>é€è¡Œè§£é‡Šï¼š</p>
<table>
<thead>
<tr>
<th>ä»£ç </th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>HOST = ...</code></td>
<td>ä»ç¯å¢ƒå˜é‡è¯»å–ç›‘å¬åœ°å€ï¼Œé»˜è®¤ <code>0.0.0.0</code>ï¼ˆå…è®¸æ‰€æœ‰ç½‘ç»œè®¿é—®ï¼‰</td>
</tr>
<tr>
<td><code>PORT = ...</code></td>
<td>è¯»å–ç«¯å£ï¼Œé»˜è®¤ <code>8000</code></td>
</tr>
<tr>
<td><code>DEBUG = ...</code></td>
<td>è¯»å–æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼ï¼ˆç”¨äºçƒ­é‡è½½ç­‰ï¼‰</td>
</tr>
<tr>
<td><code>cors_origins_env = ...</code></td>
<td>è¯»å–å…è®¸è·¨åŸŸçš„æ¥æºï¼Œé»˜è®¤ <code>*</code>ï¼ˆæ‰€æœ‰æ¥æºï¼‰</td>
</tr>
<tr>
<td><code>if cors_origins_env == &quot;*&quot;: ...</code></td>
<td>å¦‚æœæ˜¯ <code>*</code>ï¼Œä¿ç•™é€šé…ç¬¦ï¼›å¦åˆ™æŒ‰é€—å·åˆ†å‰²æˆåˆ—è¡¨ï¼ˆå¦‚ <code>&quot;https://a.com,https://b.com&quot;</code>ï¼‰</td>
</tr>
</tbody></table>
<blockquote>
<p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šè¿™äº›å˜é‡<strong>åœ¨ Uvicorn é€šè¿‡ <code>&quot;memu.server.main:app&quot;</code> å¯åŠ¨æ—¶ä¸ä¼šè¢«ä½¿ç”¨</strong>ï¼ˆå› ä¸º host&#x2F;port ç”± Uvicorn å‘½ä»¤è¡Œå‚æ•°æ§åˆ¶ï¼‰ã€‚<br>å®ƒä»¬åªåœ¨<strong>ç›´æ¥è¿è¡Œ <code>main.py</code></strong>ï¼ˆå¦‚ <code>python main.py</code>ï¼‰æ—¶ç”¨äº <code>uvicorn.run(...)</code>ã€‚</p>
</blockquote>
<p> <strong>æ³¨å†Œä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰</strong></p>
<ol>
<li>CORS ä¸­é—´ä»¶ï¼ˆè·¨åŸŸæ”¯æŒï¼‰</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add CORS middleware</span></span><br><span class="line">app.add_middleware(</span><br><span class="line">    CORSMiddleware,</span><br><span class="line">    allow_origins=CORS_ORIGINS,</span><br><span class="line">    allow_credentials=<span class="literal">True</span>,</span><br><span class="line">    allow_methods=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">    allow_headers=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ä½œç”¨ï¼š</p>
<ul>
<li>å…è®¸æµè§ˆå™¨å‰ç«¯ï¼ˆå¦‚ React&#x2F;Vueï¼‰ä»ä¸åŒåŸŸåè°ƒç”¨ API</li>
<li>é˜²æ­¢æµè§ˆå™¨å› â€œåŒæºç­–ç•¥â€æ‹¦æˆªè¯·æ±‚</li>
</ul>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>allow_origins</code></td>
<td>å…è®¸çš„æ¥æºåŸŸååˆ—è¡¨ï¼ˆ<code>[&quot;*&quot;]</code> è¡¨ç¤ºå…¨éƒ¨ï¼‰</td>
</tr>
<tr>
<td><code>allow_credentials=True</code></td>
<td>å…è®¸æºå¸¦ Cookieï¼ˆå¦‚è®¤è¯ä¿¡æ¯ï¼‰</td>
</tr>
<tr>
<td><code>allow_methods=[&quot;*&quot;]</code></td>
<td>å…è®¸æ‰€æœ‰ HTTP æ–¹æ³•ï¼ˆGET&#x2F;POST&#x2F;PUT ç­‰ï¼‰</td>
</tr>
<tr>
<td><code>allow_headers=[&quot;*&quot;]</code></td>
<td>å…è®¸æ‰€æœ‰è¯·æ±‚å¤´</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>ç”Ÿäº§å»ºè®®</strong>ï¼šä¸è¦ç”¨ <code>*</code>ï¼Œåº”æ˜ç¡®æŒ‡å®šå‰ç«¯åŸŸåï¼Œå¦‚ <code>[&quot;https://your-app.com&quot;]</code></p>
</blockquote>
<ol start="2">
<li>è‡ªå®šä¹‰æ—¥å¿—ä¸­é—´ä»¶</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add logging middleware</span></span><br><span class="line">app.add_middleware(LoggingMiddleware)</span><br></pre></td></tr></table></figure>

<p>ä½œç”¨ï¼š</p>
<ul>
<li>æ¯æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šè¢«è®°å½•ï¼ˆæ–¹æ³•ã€è·¯å¾„ã€è€—æ—¶ã€çŠ¶æ€ç ç­‰ï¼‰</li>
<li>å®ç°åœ¨ <code>memu/server/middleware.py</code> ä¸­ï¼ˆä½ æ²¡æä¾›ï¼Œä½†é€šå¸¸ä¼šè®°å½•è¯·æ±‚&#x2F;å“åº”ï¼‰</li>
</ul>
<blockquote>
<p>ğŸ’¡ ä¸­é—´ä»¶æ‰§è¡Œé¡ºåºï¼š<strong>CORS â†’ Logging â†’ è·¯ç”±å¤„ç† â†’ Logging â†’ CORS</strong>ï¼ˆè¯·æ±‚è¿›ã€å“åº”å‡ºï¼‰</p>
</blockquote>
<p><strong>æ³¨å†Œè·¯ç”±ï¼ˆRoutersï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Include routers</span></span><br><span class="line">app.include_router(memory.router, prefix=<span class="string">&quot;/api/v1/memory&quot;</span>, tags=[<span class="string">&quot;memory&quot;</span>])</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šï¼š</p>
<ul>
<li><code>memory.router</code>ï¼šæ¥è‡ª <code>memu/server/routers/memory.py</code> ä¸­å®šä¹‰çš„ <code>APIRouter()</code> å¯¹è±¡</li>
<li><code>prefix=&quot;/api/v1/memory&quot;</code>ï¼šæ‰€æœ‰è¯¥è·¯ç”±ä¸‹çš„è·¯å¾„éƒ½è‡ªåŠ¨åŠ ä¸Šæ­¤å‰ç¼€</li>
<li><code>tags=[&quot;memory&quot;]</code>ï¼šåœ¨ API æ–‡æ¡£ä¸­å½’ç±»åˆ° â€œmemoryâ€ æ ‡ç­¾ä¸‹ï¼Œä¾¿äºåˆ†ç»„æŸ¥çœ‹</li>
</ul>
<p>ä¸¾ä¾‹ï¼š</p>
<p>å¦‚æœ <code>memory.py</code> ä¸­æœ‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.post(<span class="params"><span class="string">&quot;/memorize&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">memorize</span>(<span class="params">...</span>): ...</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæœ€ç»ˆ API è·¯å¾„æ˜¯ï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="regexp">/api/</span>v1<span class="regexp">/memory/m</span>emorize</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™æ˜¯ FastAPI æ¨èçš„<strong>æ¨¡å—åŒ–è·¯ç”±ç»„ç»‡æ–¹å¼</strong>ï¼Œé¿å…æ‰€æœ‰è·¯ç”±æŒ¤åœ¨ <code>main.py</code>ã€‚</p>
</blockquote>
<p><strong>æ ¹è·¯å¾„ä¸å¥åº·æ£€æŸ¥è·¯ç”±</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">root</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Root endpoint - health check&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;MemU Self-Hosted Server&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;status&quot;</span>: <span class="string">&quot;running&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/health&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">health_check</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Health check endpoint&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;status&quot;</span>: <span class="string">&quot;healthy&quot;</span>,</span><br><span class="line">        <span class="string">&quot;server&quot;</span>: <span class="string">&quot;memu-server&quot;</span>,</span><br><span class="line">        <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p> ä½œç”¨ï¼š</p>
<table>
<thead>
<tr>
<th>è·¯å¾„</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td><code>GET /</code></td>
<td>æ¬¢è¿é¡µï¼Œç¡®è®¤æœåŠ¡æ˜¯å¦å¯åŠ¨</td>
</tr>
<tr>
<td><code>GET /health</code></td>
<td><strong>å¥åº·æ£€æŸ¥</strong>ï¼Œä¾›ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚ Kubernetesã€Prometheusï¼‰æˆ–æµ‹è¯•è„šæœ¬è°ƒç”¨</td>
</tr>
</tbody></table>
<blockquote>
<p>è¿”å› JSON è€Œä¸æ˜¯ HTMLï¼Œä¾¿äºç¨‹åºè§£æã€‚</p>
</blockquote>
<p><strong>å…¨å±€å¼‚å¸¸å¤„ç†å™¨</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.exception_handler(<span class="params">Exception</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">global_exception_handler</span>(<span class="params">request: Request, exc: Exception</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Global exception handler&quot;&quot;&quot;</span></span><br><span class="line">    logger.error(<span class="string">f&quot;Global exception handler caught: <span class="subst">&#123;exc&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> JSONResponse(</span><br><span class="line">        status_code=<span class="number">500</span>,</span><br><span class="line">        content=&#123;</span><br><span class="line">            <span class="string">&quot;detail&quot;</span>: <span class="string">&quot;Internal server error&quot;</span>,</span><br><span class="line">            <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(exc)</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>ä½œç”¨ï¼š</p>
<ul>
<li>æ•è·<strong>æ‰€æœ‰æœªå¤„ç†çš„å¼‚å¸¸</strong>ï¼ˆå¦‚æ•°æ®åº“è¿æ¥å¤±è´¥ã€ç©ºæŒ‡é’ˆç­‰ï¼‰</li>
<li>é¿å…ç”¨æˆ·çœ‹åˆ° Python é”™è¯¯å †æ ˆï¼ˆå®‰å…¨ + ç”¨æˆ·ä½“éªŒï¼‰</li>
<li><strong>è®°å½•å®Œæ•´é”™è¯¯æ—¥å¿—</strong>ï¼ˆ<code>exc_info=True</code> ä¼šæ‰“å° tracebackï¼‰</li>
<li>è¿”å›ç»Ÿä¸€çš„ JSON é”™è¯¯æ ¼å¼</li>
</ul>
<p>âš ï¸ æ³¨æ„ï¼š</p>
<ul>
<li>è¿™ä¸ªå¤„ç†å™¨<strong>åªæ•è·æœªè¢«å…¶ä»–å¼‚å¸¸å¤„ç†å™¨å¤„ç†çš„å¼‚å¸¸</strong></li>
<li>ä¸è¦åœ¨è¿™é‡Œå¤„ç†ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆå¦‚â€œç”¨æˆ·ä¸å­˜åœ¨â€ï¼‰ï¼Œé‚£äº›åº”åœ¨è·¯ç”±ä¸­ä¸»åŠ¨è¿”å› <code>404</code></li>
</ul>
<p>æ€»ç»“ï¼šè¿™æ®µä»£ç çš„æ•´ä½“ç»“æ„</p>
<table>
<thead>
<tr>
<th>æ¨¡å—</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å¯¼å…¥</strong></td>
<td>åŠ è½½æ‰€éœ€å·¥å…·ã€è·¯ç”±ã€ä¸­é—´ä»¶ã€æ—¥å¿—</td>
</tr>
<tr>
<td><strong>åˆ›å»º app</strong></td>
<td>åˆå§‹åŒ– FastAPI åº”ç”¨ï¼Œé…ç½®æ–‡æ¡£</td>
</tr>
<tr>
<td><strong>è¯»å–é…ç½®</strong></td>
<td>ä»ç¯å¢ƒå˜é‡è·å–è¿è¡Œå‚æ•°ï¼ˆä¸»è¦ç”¨äºç›´æ¥è¿è¡Œæ¨¡å¼ï¼‰</td>
</tr>
<tr>
<td><strong>ä¸­é—´ä»¶</strong></td>
<td>æ·»åŠ  CORSï¼ˆè·¨åŸŸï¼‰å’Œæ—¥å¿—è®°å½•</td>
</tr>
<tr>
<td><strong>è·¯ç”±æ³¨å†Œ</strong></td>
<td>æŒ‚è½½è®°å¿†ç®¡ç† APIï¼ˆ<code>/api/v1/memory/...</code>ï¼‰</td>
</tr>
<tr>
<td><strong>åŸºç¡€è·¯ç”±</strong></td>
<td>æä¾› <code>/</code> å’Œ <code>/health</code> ç”¨äºæœåŠ¡çŠ¶æ€æ£€æŸ¥</td>
</tr>
<tr>
<td><strong>å¼‚å¸¸å¤„ç†</strong></td>
<td>å…¨å±€å…œåº•ï¼Œé˜²æ­¢å´©æºƒï¼Œè®°å½•é”™è¯¯</td>
</tr>
</tbody></table>
<hr>
<p>å¯ä»¥è¯´<code>main.py</code>çš„æ ¸å¿ƒä»£ç æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Include routers</span></span><br><span class="line">app.include_router(memory.router, prefix=<span class="string">&quot;/api/v1/memory&quot;</span>, tags=[<span class="string">&quot;memory&quot;</span>])</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„ä»£ç åœ¨ï¼š<code>/home/chr/æ¡Œé¢/memory_framework/memU/memu/server/routers/memory.py</code>ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡Œä»£ç çš„è§£æï¼š</p>
<ol>
<li><strong>é¦–å…ˆï¼šAPIè·¯ç”±å±‚</strong></li>
</ol>
<p>â€‹    <code> /home/chr/æ¡Œé¢/memory_framework/memU/memu/server/routers/memory.py</code></p>
<ul>
<li>ç›®çš„ï¼šäº†è§£æ‰€æœ‰å¯ç”¨çš„APIç«¯ç‚¹</li>
<li>å†…å®¹ï¼šAPIè·¯å¾„ã€è¯·æ±‚&#x2F;å“åº”æ ¼å¼ã€å‚æ•°éªŒè¯</li>
<li>ä½œç”¨ï¼šè¿™æ˜¯ç³»ç»Ÿçš„å…¥å£å±‚ï¼Œå®šä¹‰äº†ç”¨æˆ·èƒ½åšä»€ä¹ˆ</li>
</ul>
<ol start="2">
<li><strong>ç„¶åï¼šæœåŠ¡å±‚</strong></li>
</ol>
<p>   <code>/home/chr/æ¡Œé¢/memory_framework/memU/memu/server/services/memory_service.py</code></p>
<ul>
<li>ç›®çš„ï¼šäº†è§£ä¸šåŠ¡é€»è¾‘å¤„ç†æµç¨‹</li>
<li>å†…å®¹ï¼šè°ƒç”¨æ ¸å¿ƒç»„ä»¶ã€å¤„ç†å‚æ•°ã€ç»„åˆåŠŸèƒ½</li>
<li>ä½œç”¨ï¼šè¿™æ˜¯ä¸šåŠ¡é€»è¾‘å±‚ï¼Œè¿æ¥APIå’Œæ ¸å¿ƒå¼•æ“</li>
</ul>
<ol start="3">
<li><strong>æ¥ç€ï¼šæ ¸å¿ƒè®°å¿†å¼•æ“</strong></li>
</ol>
<p>   <code> /home/chr/æ¡Œé¢/memory_framework/memU/memu/memory/memory_agent.py</code></p>
<ul>
<li>ç›®çš„ï¼šäº†è§£è®°å¿†åŒ–çš„æ ¸å¿ƒç®—æ³•</li>
<li>å†…å®¹ï¼šå¯¹è¯å¤„ç†ã€è®°å¿†ç”Ÿæˆã€åµŒå…¥å¤„ç†</li>
<li>ä½œç”¨ï¼šè¿™æ˜¯è®°å¿†å¤„ç†å¼•æ“ï¼Œæ ¸å¿ƒçš„AIé€»è¾‘</li>
</ul>
<ol start="4">
<li><strong>å†çœ‹ï¼šè®°å¿†æ£€ç´¢å¼•æ“</strong></li>
</ol>
<p>   <code> /home/chr/æ¡Œé¢/memory_framework/memU/memu/memory/recall_agent.py</code></p>
<ul>
<li>ç›®çš„ï¼šäº†è§£æ£€ç´¢çš„æ ¸å¿ƒç®—æ³•</li>
<li>å†…å®¹ï¼šè¯­ä¹‰æœç´¢ã€ç±»åˆ«æ£€ç´¢ã€ç›¸ä¼¼åº¦åŒ¹é…</li>
<li>ä½œç”¨ï¼šè¿™æ˜¯æ£€ç´¢å¼•æ“ï¼Œæä¾›è®°å¿†æŸ¥è¯¢èƒ½åŠ›</li>
</ul>
<ol start="5">
<li><strong>æœ€åï¼šåµŒå…¥å’Œå­˜å‚¨</strong></li>
</ol>
<p>   <code>/home/chr/æ¡Œé¢/memory_framework/memU/memu/memory/embeddings.py</code><br>   <code>/home/chr/æ¡Œé¢/memory_framework/memU/memu/memory/file_manager.py</code></p>
<ul>
<li>ç›®çš„ï¼šäº†è§£å‘é‡åŒ–å’Œæ•°æ®æŒä¹…åŒ–</li>
<li>å†…å®¹ï¼šå‘é‡è®¡ç®—ã€æ–‡ä»¶å­˜å‚¨ã€ç´¢å¼•ç®¡ç†</li>
<li>ä½œç”¨ï¼šè¿™æ˜¯åŸºç¡€è®¾æ–½å±‚</li>
</ul>
<hr>
<h5 id="APIè·¯ç”±å±‚ï¼ˆrouters-memory-pyï¼‰"><a href="#APIè·¯ç”±å±‚ï¼ˆrouters-memory-pyï¼‰" class="headerlink" title="APIè·¯ç”±å±‚ï¼ˆrouters&#x2F;memory.pyï¼‰"></a>APIè·¯ç”±å±‚ï¼ˆrouters&#x2F;memory.pyï¼‰</h5><h6 id="1-æ¨¡å—å¯¼å…¥"><a href="#1-æ¨¡å—å¯¼å…¥" class="headerlink" title="1. æ¨¡å—å¯¼å…¥"></a>1. æ¨¡å—å¯¼å…¥</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> APIRouter, HTTPException, BackgroundTasks, Depends</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ..models <span class="keyword">import</span> (</span><br><span class="line">    MemorizeRequest,</span><br><span class="line">    MemorizeResponse,</span><br><span class="line">    TaskStatusResponse,</span><br><span class="line">    DefaultCategoriesRequest,</span><br><span class="line">    DefaultCategoriesResponse,</span><br><span class="line">    RelatedMemoryItemsRequest,</span><br><span class="line">    RelatedMemoryItemsResponse,</span><br><span class="line">    RelatedClusteredCategoriesRequest,</span><br><span class="line">    RelatedClusteredCategoriesResponse,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> ..services.memory_service <span class="keyword">import</span> MemoryService</span><br><span class="line"><span class="keyword">from</span> ..services.task_service <span class="keyword">import</span> TaskService</span><br><span class="line"><span class="keyword">from</span> ...utils.logging <span class="keyword">import</span> get_logger</span><br></pre></td></tr></table></figure>

<h6 id="ç«¯ç‚¹1ï¼šå¯¹è¯è®°å¿†åŒ–-memorize"><a href="#ç«¯ç‚¹1ï¼šå¯¹è¯è®°å¿†åŒ–-memorize" class="headerlink" title="ç«¯ç‚¹1ï¼šå¯¹è¯è®°å¿†åŒ– (&#x2F;memorize)"></a><strong>ç«¯ç‚¹1ï¼šå¯¹è¯è®°å¿†åŒ– (&#x2F;memorize)</strong></h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.post(<span class="params"><span class="string">&quot;/memorize&quot;</span>, response_model=MemorizeResponse</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">memorize_conversation</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: MemorizeRequest,</span></span><br><span class="line"><span class="params">    background_tasks: BackgroundTasks,</span></span><br><span class="line"><span class="params">    memory_svc: MemoryService = Depends(<span class="params">get_memory_service</span>),</span></span><br><span class="line"><span class="params">    task_svc: TaskService = Depends(<span class="params">get_task_service</span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Start memorization process for conversation data</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    This endpoint starts a background task to process and memorize conversation data.</span></span><br><span class="line"><span class="string">    Returns a task ID that can be used to track the progress.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        logger.info(</span><br><span class="line">            <span class="string">f&quot;Starting memorization for user <span class="subst">&#123;request.user_id&#125;</span>, agent <span class="subst">&#123;request.agent_id&#125;</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Validate request</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> request.conversation_text <span class="keyword">and</span> <span class="keyword">not</span> request.conversation:</span><br><span class="line">            <span class="keyword">raise</span> HTTPException(</span><br><span class="line">                status_code=<span class="number">422</span>,</span><br><span class="line">                detail=<span class="string">&quot;Either conversation_text or conversation must be provided&quot;</span></span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Create task</span></span><br><span class="line">        task_id = task_svc.create_task(<span class="string">&quot;memorize&quot;</span>, &#123;</span><br><span class="line">            <span class="string">&quot;user_id&quot;</span>: request.user_id,</span><br><span class="line">            <span class="string">&quot;user_name&quot;</span>: request.user_name,</span><br><span class="line">            <span class="string">&quot;agent_id&quot;</span>: request.agent_id,</span><br><span class="line">            <span class="string">&quot;agent_name&quot;</span>: request.agent_name,</span><br><span class="line">            <span class="string">&quot;conversation_text&quot;</span>: request.conversation_text,</span><br><span class="line">            <span class="string">&quot;conversation&quot;</span>: [msg.<span class="built_in">dict</span>() <span class="keyword">for</span> msg <span class="keyword">in</span> request.conversation] <span class="keyword">if</span> request.conversation <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&quot;session_date&quot;</span>: request.session_date <span class="keyword">or</span> datetime.now().isoformat(),</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Start background task</span></span><br><span class="line">        background_tasks.add_task(</span><br><span class="line">            _process_memorization_task,</span><br><span class="line">            task_id,</span><br><span class="line">            request,</span><br><span class="line">            memory_svc,</span><br><span class="line">            task_svc</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> MemorizeResponse(</span><br><span class="line">            task_id=task_id,</span><br><span class="line">            status=<span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">            message=<span class="string">&quot;Memorization task started successfully&quot;</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> HTTPException:</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;Error starting memorization: <span class="subst">&#123;e&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="built_in">str</span>(e))</span><br></pre></td></tr></table></figure>

<p>ä½œç”¨ï¼š<strong>æ¥æ”¶ä¸€æ®µå¯¹è¯ï¼Œå¯åŠ¨ä¸€ä¸ªâ€œåå°ä»»åŠ¡â€å»åˆ†æè¿™æ®µå¯¹è¯ã€æå–è®°å¿†ï¼Œç„¶åç«‹åˆ»è¿”å›ä¸€ä¸ªâ€œä»»åŠ¡ç¼–å·â€ï¼Œè®©ç”¨æˆ·åç»­æŸ¥è¯¢è¿›åº¦ã€‚</strong></p>
<p><strong>å‡½æ•°å®šä¹‰ï¼ˆè£…é¥°å™¨ + ç­¾åï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@router.post(<span class="params"><span class="string">&quot;/memorize&quot;</span>, response_model=MemorizeResponse</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">memorize_conversation</span>(<span class="params"></span></span><br><span class="line"><span class="params">    request: MemorizeRequest,</span></span><br><span class="line"><span class="params">    background_tasks: BackgroundTasks,</span></span><br><span class="line"><span class="params">    memory_svc: MemoryService = Depends(<span class="params">get_memory_service</span>),</span></span><br><span class="line"><span class="params">    task_svc: TaskService = Depends(<span class="params">get_task_service</span>),</span></span><br><span class="line"><span class="params"></span>):</span><br></pre></td></tr></table></figure>

<ol>
<li><strong><code>@router.post(&quot;/memorize&quot;, response_model=MemorizeResponse)</code></strong></li>
</ol>
<ul>
<li><p><strong><code>@router.post</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ª <strong>FastAPI è·¯ç”±è£…é¥°å™¨</strong>ï¼Œè¡¨ç¤ºï¼š</p>
<blockquote>
<p>â€œå½“æœ‰äººå‘é€ <strong>POST è¯·æ±‚</strong> åˆ° <strong><code>/memorize</code></strong> è·¯å¾„æ—¶ï¼Œå°±è¿è¡Œæˆ‘ä¸‹é¢è¿™ä¸ªå‡½æ•°ï¼â€</p>
</blockquote>
</li>
<li><p><strong><code>response_model=MemorizeResponse</code></strong>ï¼š  </p>
<blockquote>
<p>â€œæ— è®ºå‡½æ•°è¿”å›ä»€ä¹ˆï¼Œ<strong>æœ€ç»ˆè¿”å›ç»™ç”¨æˆ·çš„ JSON ç»“æ„</strong>ï¼Œå¿…é¡»ç¬¦åˆ <code>MemorizeResponse</code> è¿™ä¸ªæ¨¡å‹ã€‚â€<br>ï¼ˆæ¯”å¦‚å¿…é¡»åŒ…å« <code>task_id</code>, <code>status</code>, <code>message</code> å­—æ®µï¼‰</p>
<figure class="highlight python"><figcaption><span>models.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MemorizeResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Response model for memorize API&quot;&quot;&quot;</span></span><br><span class="line">    task_id: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;Task identifier for tracking&quot;</span>)</span><br><span class="line">    status: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;Task status&quot;</span>)</span><br><span class="line">    message: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;Response message&quot;</span>)</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<ol start="2">
<li><strong><code>async def memorize_conversation(...)</code></strong></li>
</ol>
<ul>
<li><strong><code>async def</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ª <strong>å¼‚æ­¥å‡½æ•°</strong>ï¼Œæ„å‘³ç€å®ƒå¯ä»¥åœ¨ç­‰å¾… I&#x2F;Oï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ï¼‰æ—¶â€œè®©å‡ºæ§åˆ¶æƒâ€ï¼Œè®©æœåŠ¡å™¨åŒæ—¶å¤„ç†å…¶ä»–è¯·æ±‚ã€‚</li>
<li><strong>å‡½æ•°å <code>memorize_conversation</code></strong>ï¼šæ¸…æ™°è¡¨è¾¾åŠŸèƒ½ â€”â€” â€œè®°å¿†å¯¹è¯â€</li>
</ul>
<ol start="3">
<li><strong>å‚æ•°åˆ—è¡¨</strong></li>
</ol>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
<th>å¦‚ä½•ä¼ å…¥ï¼Ÿ</th>
</tr>
</thead>
<tbody><tr>
<td><code>request: MemorizeRequest</code></td>
<td>Pydantic æ¨¡å‹</td>
<td><strong>ç”¨æˆ·å‘æ¥çš„æ•°æ®</strong>ï¼ˆå¯¹è¯å†…å®¹ã€ç”¨æˆ·IDç­‰ï¼‰</td>
<td>è‡ªåŠ¨ä» HTTP è¯·æ±‚ä½“ï¼ˆJSONï¼‰è§£æ</td>
</tr>
<tr>
<td><code>background_tasks: BackgroundTasks</code></td>
<td>FastAPI å·¥å…·ç±»</td>
<td><strong>ç”¨æ¥å¯åŠ¨åå°ä»»åŠ¡</strong></td>
<td>FastAPI è‡ªåŠ¨æ³¨å…¥</td>
</tr>
<tr>
<td><code>memory_svc: MemoryService = Depends(get_memory_service)</code></td>
<td>æœåŠ¡ç±»å®ä¾‹</td>
<td><strong>è®°å¿†ä¸šåŠ¡é€»è¾‘</strong>ï¼ˆæå–ã€å­˜å‚¨ç­‰ï¼‰</td>
<td>é€šè¿‡ <code>Depends(get_memory_service)</code> æ³¨å…¥</td>
</tr>
<tr>
<td><code>task_svc: TaskService = Depends(get_task_service)</code></td>
<td>æœåŠ¡ç±»å®ä¾‹</td>
<td><strong>ä»»åŠ¡ç®¡ç†</strong>ï¼ˆåˆ›å»ºã€æŸ¥è¯¢çŠ¶æ€ï¼‰</td>
<td>é€šè¿‡ <code>Depends(get_task_service)</code> æ³¨å…¥</td>
</tr>
</tbody></table>
<blockquote>
<figure class="highlight python"><figcaption><span>models.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MemorizeRequest</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Request model for memorize API&quot;&quot;&quot;</span></span><br><span class="line">    conversation_text: <span class="type">Optional</span>[<span class="built_in">str</span>] = Field(</span><br><span class="line">        <span class="literal">None</span>, description=<span class="string">&quot;Conversation as plain text&quot;</span></span><br><span class="line">    )</span><br><span class="line">    conversation: <span class="type">Optional</span>[<span class="type">List</span>[ConversationMessage]] = Field(</span><br><span class="line">        <span class="literal">None</span>, description=<span class="string">&quot;Conversation as structured messages&quot;</span></span><br><span class="line">    )</span><br><span class="line">    user_id: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;User identifier&quot;</span>)</span><br><span class="line">    user_name: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;User display name&quot;</span>)</span><br><span class="line">    agent_id: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;Agent identifier&quot;</span>)</span><br><span class="line">    agent_name: <span class="built_in">str</span> = Field(..., description=<span class="string">&quot;Agent display name&quot;</span>)</span><br><span class="line">    session_date: <span class="type">Optional</span>[<span class="built_in">str</span>] = Field(</span><br><span class="line">        <span class="literal">None</span>, description=<span class="string">&quot;Session date in ISO format&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>âœ… <strong>å…³é”®æ¦‚å¿µï¼šä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰</strong>  </p>
<ul>
<li><strong>åœ¨è¿™é‡Œæœ€å¤§çš„ä½œç”¨æ˜¯å®ç°å•ä¾‹ï¼Œè€Œä¸åŒæ¯æ¬¡è°ƒç”¨è¯¥æ¥å£æ˜¯éƒ½åˆå§‹åŒ–åˆ›å»º<code>MemoryService()</code> å®ä¾‹</strong></li>
<li>ä½ ä¸ç”¨è‡ªå·± <strong>åˆ›å»º <code>MemoryService()</code> å®ä¾‹</strong></li>
<li>FastAPI ä¼š<strong>è‡ªåŠ¨è°ƒç”¨ <code>get_memory_service()</code></strong>ï¼ŒæŠŠè¿”å›çš„å®ä¾‹å¡è¿› <code>memory_svc</code>  </li>
<li>è¿™æ ·å‡½æ•°åªå…³å¿ƒâ€œç”¨æœåŠ¡â€ï¼Œä¸å…³å¿ƒâ€œæ€ä¹ˆåˆ›å»ºæœåŠ¡â€</li>
</ul>
</blockquote>
<p><strong>å‡½æ•°å†…éƒ¨é€»è¾‘</strong></p>
<p><strong>æ‰“æ—¥å¿—ï¼ˆè®°å½•å¼€å§‹ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.info(<span class="string">f&quot;Starting memorization for user <span class="subst">&#123;request.user_id&#125;</span>, agent <span class="subst">&#123;request.agent_id&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šåœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­è®°å½•â€œè°åœ¨è¯·æ±‚è®°å¿†åŠŸèƒ½â€</li>
<li><strong>ç¤ºä¾‹è¾“å‡º</strong>ï¼š<br><code>INFO: Starting memorization for user test_user_123, agent test_agent_456</code></li>
</ul>
<blockquote>
<p>æ—¥å¿—æ˜¯æ’æŸ¥é—®é¢˜çš„â€œé»‘åŒ£å­â€ï¼Œéå¸¸é‡è¦ï¼</p>
</blockquote>
<p><strong>éªŒè¯è¾“å…¥ï¼ˆé˜²é”™ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> request.conversation_text <span class="keyword">and</span> <span class="keyword">not</span> request.conversation:</span><br><span class="line">    <span class="keyword">raise</span> HTTPException(</span><br><span class="line">        status_code=<span class="number">422</span>,</span><br><span class="line">        detail=<span class="string">&quot;Either conversation_text or conversation must be provided&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p> ä¸ºä»€ä¹ˆéœ€è¦éªŒè¯ï¼Ÿ</p>
<ul>
<li>ç”¨æˆ·å¯èƒ½å‘ä¸€ä¸ªç©ºè¯·æ±‚ï¼Œæ¯”å¦‚ï¼š<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123&quot;</span> <span class="punctuation">&#125;</span>  <span class="comment">// æ²¡æœ‰å¯¹è¯å†…å®¹ï¼</span></span><br></pre></td></tr></table></figure></li>
<li>è¿™ä¼šå¯¼è‡´åç»­é€»è¾‘å´©æºƒï¼Œæ‰€ä»¥<strong>æå‰æ‹¦æˆª</strong></li>
</ul>
<p>çŠ¶æ€ç  <code>422</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li><strong>422 Unprocessable Entity</strong>ï¼šè¯­ä¹‰æ­£ç¡®ï¼Œä½†ä¸šåŠ¡é€»è¾‘æ— æ³•å¤„ç†ï¼ˆæ¯” <code>400</code> æ›´ç²¾ç¡®ï¼‰</li>
</ul>
<p><strong>åˆ›å»ºä»»åŠ¡ï¼ˆç”Ÿæˆâ€œä»»åŠ¡ç¼–å·â€ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">task_id = task_svc.create_task(<span class="string">&quot;memorize&quot;</span>, &#123;</span><br><span class="line">    <span class="string">&quot;user_id&quot;</span>: request.user_id,</span><br><span class="line">    <span class="string">&quot;user_name&quot;</span>: request.user_name,</span><br><span class="line">    <span class="string">&quot;agent_id&quot;</span>: request.agent_id,</span><br><span class="line">    <span class="string">&quot;agent_name&quot;</span>: request.agent_name,</span><br><span class="line">    <span class="string">&quot;conversation_text&quot;</span>: request.conversation_text,</span><br><span class="line">    <span class="string">&quot;conversation&quot;</span>: [msg.<span class="built_in">dict</span>() <span class="keyword">for</span> msg <span class="keyword">in</span> request.conversation] <span class="keyword">if</span> request.conversation <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&quot;session_date&quot;</span>: request.session_date <span class="keyword">or</span> datetime.now().isoformat(),</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>é€å­—æ®µè§£é‡Šï¼š</strong></p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>&quot;memorize&quot;</code></td>
<td>ä»»åŠ¡ç±»å‹ï¼ˆåŒºåˆ†å…¶ä»–ä»»åŠ¡ï¼Œå¦‚â€œæ€»ç»“â€ã€â€œç¿»è¯‘â€ï¼‰</td>
</tr>
<tr>
<td><code>user_id</code> &#x2F; <code>agent_id</code></td>
<td>ç”¨æˆ·å’Œ AI åŠ©æ‰‹çš„å”¯ä¸€æ ‡è¯†</td>
</tr>
<tr>
<td><code>conversation_text</code></td>
<td>åŸå§‹å¯¹è¯å­—ç¬¦ä¸²ï¼ˆå¦‚ <code>&quot;User: Hello...\nAssistant: Hi...&quot;</code>ï¼‰</td>
</tr>
<tr>
<td><code>conversation</code></td>
<td>ç»“æ„åŒ–å¯¹è¯åˆ—è¡¨ï¼ˆå¦‚ <code>[&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello&quot;&#125;, ...]</code>ï¼‰</td>
</tr>
<tr>
<td><code>session_date</code></td>
<td>å¯¹è¯å‘ç”Ÿçš„æ—¶é—´ï¼ˆé»˜è®¤å½“å‰æ—¶é—´ï¼‰</td>
</tr>
</tbody></table>
<p><strong>ä¸ºä»€ä¹ˆæœ‰ä¸¤ç§å¯¹è¯æ ¼å¼ï¼Ÿ</strong></p>
<ul>
<li><code>conversation_text</code>ï¼šç®€å•å­—ç¬¦ä¸²ï¼Œé€‚åˆæ—§ç³»ç»Ÿ</li>
<li><code>conversation</code>ï¼šç»“æ„åŒ–æ¶ˆæ¯åˆ—è¡¨ï¼Œé€‚åˆç°ä»£ LLM APIï¼ˆå¦‚ OpenAI çš„ <code>messages</code> æ ¼å¼ï¼‰</li>
</ul>
<p><strong><code>task_svc.create_task()</code> åšäº†ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li>åœ¨å†…å­˜æˆ–æ•°æ®åº“ä¸­<strong>åˆ›å»ºä¸€æ¡ä»»åŠ¡è®°å½•</strong>ï¼Œä¾‹å¦‚ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tasks = &#123;</span><br><span class="line">    <span class="string">&quot;task_abc123&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;memorize&quot;</span>,</span><br><span class="line">        <span class="string">&quot;status&quot;</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: &#123; ... &#125;,  <span class="comment"># ä¸Šé¢ä¼ å…¥çš„å­—å…¸</span></span><br><span class="line">        <span class="string">&quot;created_at&quot;</span>: <span class="string">&quot;2025-09-25T10:00:00&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>è¿”å›å”¯ä¸€ <code>task_id</code>ï¼ˆå¦‚ <code>&quot;task_abc123&quot;</code>ï¼‰</li>
</ul>
<p><strong>å¯åŠ¨åå°ä»»åŠ¡</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">background_tasks.add_task(</span><br><span class="line">    _process_memorization_task,</span><br><span class="line">    task_id,</span><br><span class="line">    request,</span><br><span class="line">    memory_svc,</span><br><span class="line">    task_svc</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>è¿™è¡Œä»£ç åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</strong></p>
<blockquote>
<p><strong>å®ƒå‘Šè¯‰ FastAPIï¼šâ€œç­‰ HTTP å“åº”å‘å‡ºå»åï¼Œè¯·åœ¨åå°æ‚„æ‚„è¿è¡Œ <code>_process_memorization_task</code> å‡½æ•°ï¼Œå¹¶ä¼ è¿™äº›å‚æ•°ï¼â€</strong></p>
</blockquote>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦â€œåå°ä»»åŠ¡â€ï¼Ÿ</strong></p>
<ul>
<li><strong>LLM è°ƒç”¨å¾ˆæ…¢</strong>ï¼ˆå¯èƒ½ 2~5 ç§’ï¼‰</li>
<li>å¦‚æœåŒæ­¥æ‰§è¡Œï¼Œç”¨æˆ·ä¼šå¡åœ¨â€œåŠ è½½ä¸­â€¦â€å¾ˆä¹…</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šå…ˆè¿”å› <code>&#123;&quot;task_id&quot;: &quot;xxx&quot;, &quot;status&quot;: &quot;PENDING&quot;&#125;</code>ï¼Œè®©ç”¨æˆ·å»åšåˆ«çš„äº‹</li>
</ul>
<p><strong>åå°ä»»åŠ¡å‡½æ•° <code>_process_memorization_task</code> ä¼šåšä»€ä¹ˆï¼Ÿ</strong></p>
<ol>
<li>è°ƒç”¨ <code>memory_svc.memorize_conversation(...)</code> â†’ è®© LLM åˆ†æå¯¹è¯</li>
<li>æå–è®°å¿†ç‚¹ï¼ˆå¦‚â€œç”¨æˆ·å–œæ¬¢ Pythonâ€ï¼‰</li>
<li>å­˜å‚¨åˆ°è®°å¿†åº“</li>
<li>æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º <code>SUCCESS</code> æˆ– <code>FAILURE</code></li>
</ol>
<blockquote>
<p><strong>è¿™å°±æ˜¯â€œå¼‚æ­¥å†™â€çš„ç²¾é«“</strong>ï¼šå†™æ“ä½œæ…¢ â†’ æ”¾åå°ï¼›è¯»æ“ä½œå¿« â†’ ç›´æ¥è¿”å›ã€‚</p>
</blockquote>
<p><strong>è¿”å›å“åº”ï¼ˆç«‹å³ï¼ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> MemorizeResponse(</span><br><span class="line">    task_id=task_id,</span><br><span class="line">    status=<span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">    message=<span class="string">&quot;Memorization task started successfully&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>è¿”å›ä»€ä¹ˆç»™ç”¨æˆ·ï¼Ÿ</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;task_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;task_abc123&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PENDING&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Memorization task started successfully&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>ç”¨æˆ·æ‹¿åˆ°è¿™ä¸ªååšä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li>ç”¨ <code>task_id</code> å»è½®è¯¢ <code>/memorize/status/task_abc123</code></li>
<li>ç›´åˆ° <code>status</code> å˜æˆ <code>SUCCESS</code></li>
</ul>
<p><strong>é”™è¯¯å¤„ç†ï¼ˆå…œåº•ï¼‰</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> HTTPException:</span><br><span class="line">    <span class="keyword">raise</span>  <span class="comment"># é€ä¼ å·²çŸ¥é”™è¯¯ï¼ˆå¦‚ 422ï¼‰</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    logger.error(<span class="string">f&quot;Error starting memorization: <span class="subst">&#123;e&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="built_in">str</span>(e))</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆåˆ†ä¸¤ç§å¼‚å¸¸ï¼Ÿ</strong></p>
<ul>
<li><strong><code>HTTPException</code></strong>ï¼šä½ ä¸»åŠ¨æŠ›çš„ï¼ˆå¦‚ 422ï¼‰ï¼Œç›´æ¥è¿”å›ç»™ç”¨æˆ·</li>
<li><strong>å…¶ä»– <code>Exception</code></strong>ï¼šæ„å¤–é”™è¯¯ï¼ˆå¦‚æ•°æ®åº“è¿ä¸ä¸Šï¼‰ï¼Œè®°å½•æ—¥å¿—åè¿”å› 500</li>
</ul>
<blockquote>
<p>ğŸ’¡ <code>exc_info=True</code> ä¼šæ‰“å°å®Œæ•´é”™è¯¯å †æ ˆï¼Œæ–¹ä¾¿ debugï¼</p>
</blockquote>
<p><strong>_process_memorization_task</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_process_memorization_task</span>(<span class="params"></span></span><br><span class="line"><span class="params">    task_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    request: MemorizeRequest,</span></span><br><span class="line"><span class="params">    memory_svc: MemoryService,</span></span><br><span class="line"><span class="params">    task_svc: TaskService</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Background task to process memorization&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        logger.info(<span class="string">f&quot;Processing memorization task <span class="subst">&#123;task_id&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Update task status</span></span><br><span class="line">        task_svc.update_task(task_id, <span class="string">&quot;PROCESSING&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Process conversation</span></span><br><span class="line">        result = <span class="keyword">await</span> memory_svc.memorize_conversation(</span><br><span class="line">            conversation_text=request.conversation_text,</span><br><span class="line">            conversation=request.conversation,</span><br><span class="line">            user_id=request.user_id,</span><br><span class="line">            user_name=request.user_name,</span><br><span class="line">            agent_id=request.agent_id,</span><br><span class="line">            agent_name=request.agent_name,</span><br><span class="line">            session_date=request.session_date</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Update task with result</span></span><br><span class="line">        task_svc.update_task(task_id, <span class="string">&quot;SUCCESS&quot;</span>, result, <span class="literal">None</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;Memorization task <span class="subst">&#123;task_id&#125;</span> completed successfully&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;Error in memorization task <span class="subst">&#123;task_id&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">        task_svc.update_task(task_id, <span class="string">&quot;FAILURE&quot;</span>, <span class="literal">None</span>, <span class="built_in">str</span>(e))</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•° <strong><code>_process_memorization_task</code></strong> æ˜¯ <strong>MemU è®°å¿†ç³»ç»Ÿçš„æ ¸å¿ƒåå°å¤„ç†å™¨</strong>ï¼Œå®ƒè´Ÿè´£<strong>çœŸæ­£æ‰§è¡Œè€—æ—¶çš„è®°å¿†æå–å·¥ä½œ</strong>ã€‚</p>
<blockquote>
<p><strong>å®ƒæ˜¯ä¸€ä¸ªâ€œåå°å·¥äººâ€ï¼Œä¸“é—¨è´Ÿè´£ï¼š<br>1ï¸âƒ£ æŠŠç”¨æˆ·æäº¤çš„å¯¹è¯äº¤ç»™ LLM åˆ†æ<br>2ï¸âƒ£ æå–å‡ºç»“æ„åŒ–è®°å¿†ï¼ˆå¦‚â€œç”¨æˆ·å–œæ¬¢ Pythonâ€ï¼‰<br>3ï¸âƒ£ å­˜å‚¨åˆ°è®°å¿†åº“<br>4ï¸âƒ£ æ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼ˆæˆåŠŸ&#x2F;å¤±è´¥ï¼‰<br>è€Œä¸”å…¨ç¨‹åœ¨åå°é»˜é»˜å¹²æ´»ï¼Œä¸é˜»å¡ç”¨æˆ·çš„ HTTP è¯·æ±‚ã€‚</strong></p>
</blockquote>
<p><strong>æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="keyword">await</span> memory_svc.memorize_conversation(</span><br><span class="line">    conversation_text=request.conversation_text,</span><br><span class="line">    conversation=request.conversation,</span><br><span class="line">    user_id=request.user_id,</span><br><span class="line">    user_name=request.user_name,</span><br><span class="line">    agent_id=request.agent_id,</span><br><span class="line">    agent_name=request.agent_name,</span><br><span class="line">    session_date=request.session_date</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[åŸå§‹å¯¹è¯] --&gt; B&#123;é€‰æ‹©è¾“å…¥æ ¼å¼&#125;</span><br><span class="line">    B --&gt;|conversation_text| C[è§£æä¸ºæ¶ˆæ¯åˆ—è¡¨]</span><br><span class="line">    B --&gt;|conversation| C</span><br><span class="line">    C --&gt; D[è°ƒç”¨ LLM æç¤ºè¯]</span><br><span class="line">    D --&gt; E[LLM è¿”å› JSON]</span><br><span class="line">    E --&gt; F[è§£æè®°å¿†æ¡ç›®]</span><br><span class="line">    F --&gt; G[ç”Ÿæˆå‘é‡åµŒå…¥]</span><br><span class="line">    G --&gt; H[å­˜å‚¨åˆ°è®°å¿†åº“]</span><br><span class="line">    H --&gt; I[è¿”å›ç»“æœ]</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŒ‰ä½<code>CTRL</code>é”®ç„¶åç‚¹å‡»<code>memorize_conversation</code>è·³è½¬åˆ°<code>memory_service.py</code>ä¸­çœ‹çœ‹å…·ä½“å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">memorize_conversation</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    conversation_text: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    conversation: <span class="type">Optional</span>[<span class="type">List</span>[ConversationMessage]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    user_id: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params">    user_name: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params">    agent_id: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params">    agent_name: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params">    session_date: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Process and memorize conversation using MemoryAgent</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        conversation_text: Conversation as plain text</span></span><br><span class="line"><span class="string">        conversation: Conversation as structured messages</span></span><br><span class="line"><span class="string">        user_id: User identifier</span></span><br><span class="line"><span class="string">        user_name: User display name</span></span><br><span class="line"><span class="string">        agent_id: Agent identifier</span></span><br><span class="line"><span class="string">        agent_name: Agent display name</span></span><br><span class="line"><span class="string">        session_date: Session date</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        Dict with processing results</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Create a fresh MemoryAgent instance per request to avoid shared state across async jobs</span></span><br><span class="line">        llm_client = <span class="variable language_">self</span>._get_llm_client()</span><br><span class="line">        memory_agent = MemoryAgent(</span><br><span class="line">            llm_client=llm_client,</span><br><span class="line">            memory_dir=<span class="built_in">str</span>(<span class="variable language_">self</span>.memory_path),</span><br><span class="line">            enable_embeddings=<span class="variable language_">self</span>.enable_embeddings,</span><br><span class="line">            agent_id=agent_id,</span><br><span class="line">            user_id=user_id</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Convert conversation to the format expected by MemoryAgent</span></span><br><span class="line">        conversation_data = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> conversation_text:</span><br><span class="line">            <span class="comment"># Split plain text into messages (simple heuristic)</span></span><br><span class="line">            lines = conversation_text.strip().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">                    role, content = line.split(<span class="string">&#x27;:&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                    conversation_data.append(&#123;</span><br><span class="line">                        <span class="string">&quot;role&quot;</span>: role.strip().lower(),</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: content.strip()</span><br><span class="line">                    &#125;)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># Add as system message if no role specified</span></span><br><span class="line">                    conversation_data.append(&#123;</span><br><span class="line">                        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: line.strip()</span><br><span class="line">                    &#125;)</span><br><span class="line">        <span class="keyword">elif</span> conversation:</span><br><span class="line">            conversation_data = [</span><br><span class="line">                &#123;<span class="string">&quot;role&quot;</span>: msg.role, <span class="string">&quot;content&quot;</span>: msg.content&#125;</span><br><span class="line">                <span class="keyword">for</span> msg <span class="keyword">in</span> conversation</span><br><span class="line">            ]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Either conversation_text or conversation must be provided&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Use user_name as character_name (no longer encode agent_id and user_id)</span></span><br><span class="line">        character_name = user_name</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Log the directory structure being used</span></span><br><span class="line">        logger.info(<span class="string">f&quot;Using directory structure: <span class="subst">&#123;os.getenv(<span class="string">&#x27;MEMU_MEMORY_DIR&#x27;</span>)&#125;</span>/<span class="subst">&#123;agent_id&#125;</span>/<span class="subst">&#123;user_id&#125;</span>/ for character: <span class="subst">&#123;character_name&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Run the memory processing</span></span><br><span class="line">        <span class="comment"># <span class="doctag">TODO:</span> if there&#x27;s already a memorization task on the same (agent_id, user_id) running,</span></span><br><span class="line">        <span class="comment">#       should let the new task wait for the old one to finish</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run_memory_agent</span>():</span><br><span class="line">            <span class="keyword">return</span> memory_agent.run(</span><br><span class="line">                conversation_data,</span><br><span class="line">                character_name,</span><br><span class="line">                session_date=session_date</span><br><span class="line">            )</span><br><span class="line">        result = <span class="keyword">await</span> asyncio.get_event_loop().run_in_executor(<span class="literal">None</span>, run_memory_agent)</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">f&quot;Memory processing completed for <span class="subst">&#123;agent_id&#125;</span>:<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;Error in memorize_conversation: <span class="subst">&#123;e&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<p>å…ˆå›åˆ°åå°æ‰“å°çš„æ—¥å¿—çœ‹ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2025-09-24 15:30:09 | memu.server.services.memory_service:158 | INFO | Using directory structure: ./memory/test_agent_456/test_user_123/ <span class="keyword">for</span> character: Test User</span><br><span class="line">...</span><br><span class="line">2025-09-24 15:31:43 | memu.server.services.memory_service:171 | INFO | Memory processing completed <span class="keyword">for</span> test_agent_456:test_user_123</span><br></pre></td></tr></table></figure>



<p><strong>ä¸€è½®å¯¹è¯è¿™ä¸€æ­¥å°±ç”¨äº†94ç§’ï¼Ÿ</strong></p>
<p>ä¸Šé¢çš„<code>memorize_conversation</code>å‡½æ•°çš„æ ¸å¿ƒæ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run_memory_agent</span>():</span><br><span class="line">    <span class="keyword">return</span> memory_agent.run(</span><br><span class="line">        conversation_data,</span><br><span class="line">        character_name,</span><br><span class="line">        session_date=session_date</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¿™ä¸€æ­¥ç”¨äº†94ç§’ï¼Œå’±ä»¬å†è·³runé‡Œé¢çœ‹çœ‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        conversation: <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]],</span></span><br><span class="line"><span class="params">        character_name: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        max_iterations: <span class="built_in">int</span> = <span class="number">20</span>,</span></span><br><span class="line"><span class="params">        session_date: <span class="built_in">str</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Intelligent conversation processing using iterative function calling</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This function allows the LLM to autonomously decide which memory operations to perform</span></span><br><span class="line"><span class="string">        through function calling, iterating until the LLM decides it&#x27;s complete or max iterations reached.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            conversation: List of conversation messages</span></span><br><span class="line"><span class="string">            character_name: Name of the character to store memories for</span></span><br><span class="line"><span class="string">            max_iterations: Maximum number of function calling iterations (default: 20)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Dict containing processing results and file paths</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> conversation <span class="keyword">or</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(conversation, <span class="built_in">list</span>):</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                    <span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid conversation format. Expected list of message dictionaries.&quot;</span>,</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> character_name:</span><br><span class="line">                <span class="keyword">return</span> &#123;<span class="string">&quot;success&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;error&quot;</span>: <span class="string">&quot;Character name is required.&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                session_date = datetime.fromisoformat(session_date).strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logger.info(<span class="string">f&quot;session date unavaiable, use system datetime&quot;</span>)</span><br><span class="line">                session_date = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)</span><br><span class="line"></span><br><span class="line">            logger.info(</span><br><span class="line">                <span class="string">f&quot;ğŸš€ Starting iterative conversation processing for <span class="subst">&#123;character_name&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Convert conversation to text for processing</span></span><br><span class="line">            conversation_text = <span class="variable language_">self</span>._convert_conversation_to_text(conversation)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Initialize results tracking</span></span><br><span class="line">            results = &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;character_name&quot;</span>: character_name,</span><br><span class="line">                <span class="string">&quot;session_date&quot;</span>: session_date,</span><br><span class="line">                <span class="string">&quot;conversation_length&quot;</span>: <span class="built_in">len</span>(conversation),</span><br><span class="line">                <span class="string">&quot;iterations&quot;</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">&quot;function_calls&quot;</span>: [],</span><br><span class="line">                <span class="comment"># &quot;files_generated&quot;: [],</span></span><br><span class="line">                <span class="string">&quot;processing_log&quot;</span>: [],</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Get function schemas for LLM</span></span><br><span class="line">            function_schemas = <span class="variable language_">self</span>.get_functions_schema()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Build initial system message</span></span><br><span class="line">            system_message = <span class="string">f&quot;&quot;&quot;You are a memory processing agent. Follow this structured process to analyze and store conversation information for &quot;<span class="subst">&#123;character_name&#125;</span>&quot;:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CONVERSATION TO PROCESS:</span></span><br><span class="line"><span class="string"><span class="subst">&#123;conversation_text&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CHARACTER: <span class="subst">&#123;character_name&#125;</span></span></span><br><span class="line"><span class="string">SESSION DATE: <span class="subst">&#123;session_date&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PROCESSING WORKFLOW:</span></span><br><span class="line"><span class="string">1. STORE TO ACTIVITY: Call add_activity_memory with the COMPLETE RAW CONVERSATION TEXT as the &#x27;content&#x27; parameter. This will automatically append to existing activity memories. DO NOT extract, modify, or summarize the conversation - pass the entire original conversation text exactly as shown above.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. THEORY OF MIND: Call run_theory_of_mind to analyze the subtle information behind the conversation and extract the theory of mind of the characters.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. GENERATE SUGGESTIONS: Call generate_memory_suggestions with the available memory items to get suggestions for what should be added to each category.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. UPDATE CATEGORIES: For each category that should be updated (based on suggestions), call update_memory_with_suggestions to update that category with the new memory items and suggestions. This will return structured modifications.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5. LINK MEMORIES: For each category that was modified, call link_related_memories with link_all_items=true and write_to_memory=true to add relevant links between ALL memories in that category.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6. CLUSTER MEMORIES: Call cluster_memories to cluster the memories into different categories.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IMPORTANT GUIDELINES:</span></span><br><span class="line"><span class="string">- Step 1: CRITICAL: For add_activity_memory, the &#x27;content&#x27; parameter MUST be the complete original conversation text exactly as shown above. Do NOT modify, extract, or summarize it.</span></span><br><span class="line"><span class="string">- Step 2: Use both the original conversation and the extracted activity memoryitems from step 1 for the theory of mind analysis</span></span><br><span class="line"><span class="string">- Step 3: Use BOTH the extracted memory items from step 1 and theory-of-mind items from step 2 for generating suggestions. You can simply concatenate the two lists of memory items and pass them to the subsequent function.</span></span><br><span class="line"><span class="string">- Step 4: Use the memory suggestions from step 3 to update EVERY memory categories in suggestions.</span></span><br><span class="line"><span class="string">- Step 5-6: Use the new memory items returned from step 4 for linking and clustering memories. DO NOT include the memory items returned from step 1 and 2.</span></span><br><span class="line"><span class="string">- Each memory item should have its own memory_id and focused content</span></span><br><span class="line"><span class="string">- Follow the suggestions when updating categories</span></span><br><span class="line"><span class="string">- The update_memory_with_suggestions function will return structured format with memory_id and content</span></span><br><span class="line"><span class="string">- Always link related memories after updating categories by setting link_all_items=true and write_to_memory=true</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Start with step 1 and work through the process systematically. When you complete all steps, respond with &quot;PROCESSING_COMPLETE&quot;.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Start iterative function calling</span></span><br><span class="line">            messages = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: system_message&#125;]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> iteration <span class="keyword">in</span> <span class="built_in">range</span>(max_iterations):</span><br><span class="line">                results[<span class="string">&quot;iterations&quot;</span>] = iteration + <span class="number">1</span></span><br><span class="line">                logger.info(<span class="string">f&quot;ğŸ”„ Iteration <span class="subst">&#123;iteration + <span class="number">1</span>&#125;</span>/<span class="subst">&#123;max_iterations&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="comment"># Call LLM with function calling enabled</span></span><br><span class="line">                    response = <span class="variable language_">self</span>.memory_core.llm_client.chat_completion(</span><br><span class="line">                        messages=messages,</span><br><span class="line">                        tools=[</span><br><span class="line">                            &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>, <span class="string">&quot;function&quot;</span>: schema&#125;</span><br><span class="line">                            <span class="keyword">for</span> schema <span class="keyword">in</span> function_schemas</span><br><span class="line">                        ],</span><br><span class="line">                        tool_choice=<span class="string">&quot;auto&quot;</span>,</span><br><span class="line">                        temperature=<span class="number">0.3</span>,</span><br><span class="line">                    )</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> response.success:</span><br><span class="line">                        logger.error(<span class="string">f&quot;LLM call failed: <span class="subst">&#123;response.error&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># Add assistant response to conversation</span></span><br><span class="line">                    assistant_message = &#123;</span><br><span class="line">                        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;content&quot;</span>: response.content <span class="keyword">or</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># Check if processing is complete</span></span><br><span class="line">                    <span class="keyword">if</span> response.content <span class="keyword">and</span> <span class="string">&quot;PROCESSING_COMPLETE&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">                        logger.info(<span class="string">&quot;âœ… LLM indicated processing is complete&quot;</span>)</span><br><span class="line">                        results[<span class="string">&quot;processing_log&quot;</span>].append(</span><br><span class="line">                            <span class="string">f&quot;Iteration <span class="subst">&#123;iteration + <span class="number">1</span>&#125;</span>: Processing completed&quot;</span></span><br><span class="line">                        )</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># Handle tool calls if present</span></span><br><span class="line">                    <span class="keyword">if</span> response.tool_calls:</span><br><span class="line">                        assistant_message[<span class="string">&quot;tool_calls&quot;</span>] = response.tool_calls</span><br><span class="line">                        messages.append(assistant_message)</span><br><span class="line"></span><br><span class="line">                        <span class="comment"># Execute each tool call</span></span><br><span class="line">                        <span class="keyword">for</span> tool_call <span class="keyword">in</span> response.tool_calls:</span><br><span class="line">                            function_name = tool_call.function.name</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">try</span>:</span><br><span class="line">                                arguments = json.loads(tool_call.function.arguments)</span><br><span class="line">                            <span class="keyword">except</span> json.JSONDecodeError <span class="keyword">as</span> e:</span><br><span class="line">                                logger.error(<span class="string">f&quot;Failed to parse function arguments: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                                logger.error(<span class="string">f&quot;Function name: <span class="subst">&#123;function_name&#125;</span>&quot;</span>)</span><br><span class="line">                                logger.error(</span><br><span class="line">                                    <span class="string">f&quot;Arguments raw: <span class="subst">&#123;<span class="built_in">repr</span>(tool_call.function.arguments)&#125;</span>&quot;</span></span><br><span class="line">                                )</span><br><span class="line">                                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                            logger.info(<span class="string">f&quot;ğŸ”§ Calling function: <span class="subst">&#123;function_name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                            <span class="comment"># Execute the function call</span></span><br><span class="line">                            time_start = time.time()</span><br><span class="line">                            function_result = <span class="variable language_">self</span>.call_function(</span><br><span class="line">                                function_name, arguments</span><br><span class="line">                            )</span><br><span class="line">                            time_end = time.time()</span><br><span class="line"></span><br><span class="line">                            logger.info(</span><br><span class="line">                                <span class="string">f&quot;    Function time used: <span class="subst">&#123;time_end - time_start:<span class="number">.2</span>f&#125;</span> seconds&quot;</span></span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">                            <span class="comment"># Track function call</span></span><br><span class="line">                            call_record = &#123;</span><br><span class="line">                                <span class="string">&quot;iteration&quot;</span>: iteration + <span class="number">1</span>,</span><br><span class="line">                                <span class="string">&quot;function_name&quot;</span>: function_name,</span><br><span class="line">                                <span class="string">&quot;arguments&quot;</span>: arguments,</span><br><span class="line">                                <span class="string">&quot;result&quot;</span>: function_result,</span><br><span class="line">                            &#125;</span><br><span class="line">                            results[<span class="string">&quot;function_calls&quot;</span>].append(call_record)</span><br><span class="line"></span><br><span class="line">                            <span class="comment"># Add tool result to conversation</span></span><br><span class="line">                            tool_message = &#123;</span><br><span class="line">                                <span class="string">&quot;role&quot;</span>: <span class="string">&quot;tool&quot;</span>,</span><br><span class="line">                                <span class="string">&quot;tool_call_id&quot;</span>: <span class="built_in">getattr</span>(</span><br><span class="line">                                    tool_call, <span class="string">&quot;id&quot;</span>, <span class="string">f&quot;call_<span class="subst">&#123;iteration&#125;</span>_<span class="subst">&#123;function_name&#125;</span>&quot;</span></span><br><span class="line">                                ),</span><br><span class="line">                                <span class="string">&quot;content&quot;</span>: json.dumps(</span><br><span class="line">                                    function_result, ensure_ascii=<span class="literal">False</span></span><br><span class="line">                                ),</span><br><span class="line">                            &#125;</span><br><span class="line">                            messages.append(tool_message)</span><br><span class="line"></span><br><span class="line">                            results[<span class="string">&quot;processing_log&quot;</span>].append(</span><br><span class="line">                                <span class="string">f&quot;Iteration <span class="subst">&#123;iteration + <span class="number">1</span>&#125;</span>: Called <span class="subst">&#123;function_name&#125;</span> - &quot;</span></span><br><span class="line">                                + (</span><br><span class="line">                                    <span class="string">&quot;Success&quot;</span></span><br><span class="line">                                    <span class="keyword">if</span> function_result.get(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">                                    <span class="keyword">else</span> <span class="string">f&quot;Failed: <span class="subst">&#123;function_result.get(<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;Unknown error&#x27;</span>)&#125;</span>&quot;</span></span><br><span class="line">                                )</span><br><span class="line">                            )</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># No tool calls, add response and continue</span></span><br><span class="line">                        messages.append(assistant_message)</span><br><span class="line">                        <span class="keyword">if</span> response.content:</span><br><span class="line">                            results[<span class="string">&quot;processing_log&quot;</span>].append(</span><br><span class="line">                                <span class="string">f&quot;Iteration <span class="subst">&#123;iteration + <span class="number">1</span>&#125;</span>: <span class="subst">&#123;response.content[:<span class="number">100</span>]&#125;</span>...&quot;</span></span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    logger.error(<span class="string">f&quot;Error in iteration <span class="subst">&#123;iteration + <span class="number">1</span>&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                    results[<span class="string">&quot;processing_log&quot;</span>].append(</span><br><span class="line">                        <span class="string">f&quot;Iteration <span class="subst">&#123;iteration + <span class="number">1</span>&#125;</span>: Error - <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Finalize results</span></span><br><span class="line">            <span class="keyword">if</span> results[<span class="string">&quot;iterations&quot;</span>] &gt;= max_iterations:</span><br><span class="line">                logger.warning(<span class="string">f&quot;âš ï¸ Reached maximum iterations (<span class="subst">&#123;max_iterations&#125;</span>)&quot;</span>)</span><br><span class="line">                results[<span class="string">&quot;processing_log&quot;</span>].append(</span><br><span class="line">                    <span class="string">f&quot;Reached maximum iterations (<span class="subst">&#123;max_iterations&#125;</span>)&quot;</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            logger.info(</span><br><span class="line">                <span class="string">f&quot;ğŸ‰ Conversation processing completed after <span class="subst">&#123;results[<span class="string">&#x27;iterations&#x27;</span>]&#125;</span> iterations&quot;</span></span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># logger.info(f&quot;ğŸ“ Generated &#123;len(results[&#x27;files_generated&#x27;])&#125; files&quot;)</span></span><br><span class="line">            logger.info(<span class="string">f&quot;ğŸ”§ Made <span class="subst">&#123;<span class="built_in">len</span>(results[<span class="string">&#x27;function_calls&#x27;</span>])&#125;</span> function calls&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(<span class="string">f&quot;Error in conversation processing: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                <span class="string">&quot;character_name&quot;</span>: character_name,</span><br><span class="line">                <span class="string">&quot;timestamp&quot;</span>: datetime.now().isoformat(),</span><br><span class="line">            &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å’±ä»¬å…ˆçœ‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get function schemas for LLM</span></span><br><span class="line">function_schemas = <span class="variable language_">self</span>.get_functions_schema()</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯è·å–functionçš„æè¿°ä¿¡æ¯çš„ï¼Œä»¥ä¾¿LLMèƒ½æ­£ç¡®çš„è°ƒç”¨å·¥å…·ï¼Œç‚¹å‡»è¿›å»ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_functions_schema</span>(<span class="params">self</span>) -&gt; <span class="type">List</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get OpenAI-compatible function schemas for all memory functions</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        List of function schemas that can be used with OpenAI function calling</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    schemas = []</span><br><span class="line">    <span class="keyword">for</span> action <span class="keyword">in</span> <span class="variable language_">self</span>.actions.values():</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            schema = action.get_schema()</span><br><span class="line">            schemas.append(schema)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            logger.error(</span><br><span class="line">                <span class="string">f&quot;Failed to get schema for action <span class="subst">&#123;action.action_name&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line">    <span class="keyword">return</span> schemas</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­çš„<code>self.actions</code>æ˜¯åœ¨<code>memory_agent.py</code>ä¸­è¿›è¡Œåˆå§‹åŒ–çš„ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MemoryAgent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Modern Memory Agent with Action-Based Architecture</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Uses independent action modules for each memory operation:</span></span><br><span class="line"><span class="string">    - add_activity_memory: Add new activity memory content with strict formatting</span></span><br><span class="line"><span class="string">    - get_available_categories: Get available categories (excluding activity)</span></span><br><span class="line"><span class="string">    - link_related_memories: Find and link related memories using embedding search</span></span><br><span class="line"><span class="string">    - generate_memory_suggestions: Generate suggestions for memory categories</span></span><br><span class="line"><span class="string">    - update_memory_with_suggestions: Update memory categories based on suggestions</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Each action is implemented as a separate module in the actions/ directory.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, *,</span></span><br><span class="line"><span class="params">        llm_client: BaseLLMClient,</span></span><br><span class="line"><span class="params">        agent_id: <span class="built_in">str</span> = <span class="string">&quot;default_agent&quot;</span>,</span></span><br><span class="line"><span class="params">        user_id: <span class="built_in">str</span> = <span class="string">&quot;default_user&quot;</span>,</span></span><br><span class="line"><span class="params">        memory_dir: <span class="built_in">str</span> = <span class="string">&quot;memu/server/memory&quot;</span>,</span></span><br><span class="line"><span class="params">        enable_embeddings: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initialize Memory Agent</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            llm_client: LLM client for processing conversations</span></span><br><span class="line"><span class="string">            memory_dir: Directory to store memory files</span></span><br><span class="line"><span class="string">            enable_embeddings: Whether to generate embeddings for semantic search</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># Initialize memory core</span></span><br><span class="line">        <span class="variable language_">self</span>.memory_core = MemoryCore(llm_client, memory_dir, enable_embeddings, agent_id, user_id)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Initialize actions</span></span><br><span class="line">        <span class="variable language_">self</span>.actions = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>._load_actions()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Build function registry for compatibility</span></span><br><span class="line">        <span class="variable language_">self</span>.function_registry = <span class="variable language_">self</span>._build_function_registry()</span><br><span class="line"></span><br><span class="line">        logger.info(<span class="string">f&quot;Memory Agent initialized: <span class="subst">&#123;<span class="built_in">len</span>(self.actions)&#125;</span> actions available&quot;</span>)</span><br></pre></td></tr></table></figure>

<p> é€šè¿‡<code>_load_actions()</code>æ–¹æ³•å¡«å……å­—å…¸</p>
<pre><code>def _load_actions(self):
    &quot;&quot;&quot;Load all available actions from the registry&quot;&quot;&quot;
    for action_name, action_class in ACTION_REGISTRY.items():
        try:
            # åˆ›å»ºåŠ¨ä½œå®ä¾‹ï¼Œä¼ å…¥memory_core
            action_instance = action_class(self.memory_core)

            # å°†åŠ¨ä½œå®ä¾‹å­˜å‚¨åˆ°self.actionså­—å…¸ä¸­
            self.actions[action_name] = action_instance
          	logger.debug(f&quot;Loaded action: &#123;action_name&#125;&quot;)
       	except Exception as e:
           	logger.error(f&quot;Failed to load action &#123;action_name&#125;: &#123;e&#125;&quot;)
</code></pre>
<p>è¿™é‡Œçš„<code>ACTION_REGISTRY</code>æ¥æºäº<code>from .actions import ACTION_REGISTRY</code></p>
<p> <code>ACTION_REGISTRY</code>å®šä¹‰åœ¨ <code>memU/memu/memory/actions/__init__.py</code> ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ACTION_REGISTRY = &#123;</span><br><span class="line">    <span class="string">&quot;add_activity_memory&quot;</span>: AddActivityMemoryAction,</span><br><span class="line">    <span class="string">&quot;link_related_memories&quot;</span>: LinkRelatedMemoriesAction,</span><br><span class="line">    <span class="string">&quot;generate_memory_suggestions&quot;</span>: GenerateMemorySuggestionsAction,</span><br><span class="line">    <span class="string">&quot;update_memory_with_suggestions&quot;</span>: UpdateMemoryWithSuggestionsAction,</span><br><span class="line">    <span class="string">&quot;run_theory_of_mind&quot;</span>: RunTheoryOfMindAction,</span><br><span class="line">    <span class="string">&quot;cluster_memories&quot;</span>: ClusterMemoriesAction,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åˆå§‹åŒ–æ—¶åº</strong></p>
<pre><code>1. MemoryAgent.__init__()
  â†“
  â†“
3. self._load_actions()
  â†“
4. éå† ACTION_REGISTRY
  â†“
5. action_instance = action_class(self.memory_core)  # åˆ›å»ºå®ä¾‹
   â†“
6. self.actions[action_name] = action_instance  # å­˜å‚¨åˆ°å­—å…¸
  â†“
7. ç°åœ¨ self.actions = &#123;
        &quot;add_activity_memory&quot;: AddActivityMemoryActionå®ä¾‹,
        &quot;link_related_memories&quot;: LinkRelatedMemoriesActionå®ä¾‹,
        # ...
      &#125;
</code></pre>
<p>  è¿™æ˜¯<code>MemU</code>çš„æ’ä»¶åŒ–æ¶æ„ï¼šé€šè¿‡ <code>ACTION_REGISTRY</code>é›†ä¸­ç®¡ç†æ‰€æœ‰åŠ¨ä½œç±»å‹ï¼Œæ„é€ å‡½æ•°æ—¶åŠ¨æ€åŠ è½½æ‰€æœ‰åŠ¨ä½œå®ä¾‹åˆ° <code>self.actions </code>å­—å…¸ä¸­ï¼Œç„¶åå¯ä»¥åœ¨get_functions_schema() ä¸­ç»Ÿä¸€è·å–æ‰€æœ‰åŠ¨ä½œçš„schemaã€‚æ‰€æœ‰å‡½æ•°&#x2F;å·¥å…·ç±»çš„å®ç°åœ¨<code>memU/memu/memory/actions</code>ä¸­ã€‚</p>
<p>å†çœ‹<code>memory_agent.py</code>ä¸­å®šä¹‰çš„ç³»ç»Ÿæç¤ºè¯ï¼Œç¿»è¯‘æˆä¸­æ–‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºåˆå§‹ç³»ç»Ÿæç¤ºæ¶ˆæ¯</span></span><br><span class="line">system_message = <span class="string">f&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªè®°å¿†å¤„ç†ä»£ç†ã€‚è¯·éµå¾ªä»¥ä¸‹ç»“æ„åŒ–æµç¨‹ï¼Œä¸ºâ€œ<span class="subst">&#123;character_name&#125;</span>â€åˆ†æå¹¶å­˜å‚¨å¯¹è¯ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">éœ€å¤„ç†çš„å¯¹è¯å†…å®¹ï¼š</span></span><br><span class="line"><span class="string"><span class="subst">&#123;conversation_text&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è§’è‰²åç§°ï¼š<span class="subst">&#123;character_name&#125;</span></span></span><br><span class="line"><span class="string">ä¼šè¯æ—¥æœŸï¼š<span class="subst">&#123;session_date&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¤„ç†å·¥ä½œæµï¼š</span></span><br><span class="line"><span class="string">1. **å­˜å‚¨åˆ°æ´»åŠ¨è®°å¿†**ï¼šè°ƒç”¨ `add_activity_memory` å‡½æ•°ï¼Œå¹¶å°†**å®Œæ•´çš„åŸå§‹å¯¹è¯æ–‡æœ¬**ä½œä¸º `content` å‚æ•°ä¼ å…¥ã€‚è¿™å°†è‡ªåŠ¨è¿½åŠ åˆ°ç°æœ‰çš„æ´»åŠ¨è®°å¿†ä¸­ã€‚**åˆ‡å‹¿**å¯¹å¯¹è¯è¿›è¡Œæå–ã€ä¿®æ”¹æˆ–æ‘˜è¦â€”â€”å¿…é¡»åŸå°ä¸åŠ¨åœ°ä¼ é€’ä¸Šæ–¹æ‰€ç¤ºçš„å®Œæ•´åŸå§‹å¯¹è¯æ–‡æœ¬ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. **å¿ƒæ™ºç†è®ºåˆ†æ**ï¼šè°ƒç”¨ `run_theory_of_mind` å‡½æ•°ï¼Œåˆ†æå¯¹è¯èƒŒåçš„éšå«ä¿¡æ¯ï¼Œå¹¶æå–è§’è‰²çš„å¿ƒæ™ºæ¨¡å‹ï¼ˆå¦‚æƒ…ç»ªã€æ„å›¾ã€æ€§æ ¼ç‰¹å¾ç­‰ï¼‰ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. **ç”Ÿæˆè®°å¿†å»ºè®®**ï¼šè°ƒç”¨ `generate_memory_suggestions` å‡½æ•°ï¼ŒåŸºäºå½“å‰å¯ç”¨çš„è®°å¿†æ¡ç›®ï¼Œä¸ºæ¯ä¸ªåˆ†ç±»ç”Ÿæˆåº”æ·»åŠ å†…å®¹çš„å»ºè®®ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. **æ›´æ–°åˆ†ç±»è®°å¿†**ï¼šé’ˆå¯¹æ¯ä¸€æ¡éœ€è¦æ›´æ–°çš„åˆ†ç±»ï¼ˆåŸºäºæ­¥éª¤3çš„å»ºè®®ï¼‰ï¼Œè°ƒç”¨ `update_memory_with_suggestions` å‡½æ•°ï¼Œä½¿ç”¨æ–°çš„è®°å¿†æ¡ç›®å’Œå»ºè®®æ¥æ›´æ–°è¯¥åˆ†ç±»ã€‚æ­¤æ“ä½œå°†è¿”å›ç»“æ„åŒ–çš„ä¿®æ”¹ç»“æœã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5. **å…³è”è®°å¿†æ¡ç›®**ï¼šå¯¹äºæ¯ä¸€ä¸ªè¢«ä¿®æ”¹çš„åˆ†ç±»ï¼Œè°ƒç”¨ `link_related_memories` å‡½æ•°ï¼Œå¹¶è®¾ç½® `link_all_items=true` å’Œ `write_to_memory=true`ï¼Œä»¥åœ¨è¯¥åˆ†ç±»å†…çš„**æ‰€æœ‰è®°å¿†æ¡ç›®ä¹‹é—´**å»ºç«‹ç›¸å…³æ€§é“¾æ¥ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6. **èšç±»è®°å¿†æ¡ç›®**ï¼šè°ƒç”¨ `cluster_memories` å‡½æ•°ï¼Œå°†è®°å¿†æ¡ç›®èšç±»åˆ°ä¸åŒçš„ç±»åˆ«ä¸­ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">é‡è¦å‡†åˆ™ï¼š</span></span><br><span class="line"><span class="string">- **æ­¥éª¤1ï¼ˆå…³é”®ï¼‰**ï¼šè°ƒç”¨ `add_activity_memory` æ—¶ï¼Œ`content` å‚æ•°**å¿…é¡»**æ˜¯ä¸Šæ–¹æ‰€ç¤ºçš„å®Œæ•´åŸå§‹å¯¹è¯æ–‡æœ¬ï¼Œ**ä¸å¾—**è¿›è¡Œä»»ä½•ä¿®æ”¹ã€æå–æˆ–æ‘˜è¦ã€‚</span></span><br><span class="line"><span class="string">- **æ­¥éª¤2**ï¼šè¿›è¡Œå¿ƒæ™ºç†è®ºåˆ†ææ—¶ï¼Œéœ€åŒæ—¶ä½¿ç”¨åŸå§‹å¯¹è¯å’Œæ­¥éª¤1ä¸­æå–çš„æ´»åŠ¨è®°å¿†æ¡ç›®ã€‚</span></span><br><span class="line"><span class="string">- **æ­¥éª¤3**ï¼šç”Ÿæˆå»ºè®®æ—¶ï¼Œéœ€**åŒæ—¶ä½¿ç”¨**æ­¥éª¤1æå–çš„è®°å¿†æ¡ç›®å’Œæ­¥éª¤2ç”Ÿæˆçš„å¿ƒæ™ºç†è®ºæ¡ç›®ã€‚ä½ å¯ä»¥ç®€å•åœ°å°†è¿™ä¸¤ç»„è®°å¿†æ¡ç›®åˆå¹¶æˆä¸€ä¸ªåˆ—è¡¨ï¼Œä¼ é€’ç»™åç»­å‡½æ•°ã€‚</span></span><br><span class="line"><span class="string">- **æ­¥éª¤4**ï¼šä½¿ç”¨æ­¥éª¤3ç”Ÿæˆçš„è®°å¿†å»ºè®®ï¼Œæ›´æ–°å»ºè®®ä¸­æåˆ°çš„**æ¯ä¸€ä¸ª**è®°å¿†åˆ†ç±»ã€‚</span></span><br><span class="line"><span class="string">- **æ­¥éª¤5-6**ï¼šè¿›è¡Œè®°å¿†å…³è”å’Œèšç±»æ—¶ï¼Œ**ä»…ä½¿ç”¨**æ­¥éª¤4è¿”å›çš„æ–°è®°å¿†æ¡ç›®ï¼Œ**ä¸è¦åŒ…å«**æ­¥éª¤1å’Œæ­¥éª¤2è¿”å›çš„è®°å¿†æ¡ç›®ã€‚</span></span><br><span class="line"><span class="string">- æ¯ä¸ªè®°å¿†æ¡ç›®éƒ½åº”æ‹¥æœ‰å”¯ä¸€çš„ `memory_id` å’Œèšç„¦æ˜ç¡®çš„å†…å®¹ã€‚</span></span><br><span class="line"><span class="string">- æ›´æ–°åˆ†ç±»æ—¶ï¼Œè¯·ä¸¥æ ¼éµå¾ªå»ºè®®å†…å®¹ã€‚</span></span><br><span class="line"><span class="string">- `update_memory_with_suggestions` å‡½æ•°å°†è¿”å›åŒ…å« `memory_id` å’Œå†…å®¹çš„ç»“æ„åŒ–æ ¼å¼ã€‚</span></span><br><span class="line"><span class="string">- æ›´æ–°åˆ†ç±»åï¼ŒåŠ¡å¿…é€šè¿‡è®¾ç½® `link_all_items=true` å’Œ `write_to_memory=true` æ¥å…³è”ç›¸å…³è®°å¿†ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¯·ä»æ­¥éª¤1å¼€å§‹ï¼Œç³»ç»Ÿæ€§åœ°å®Œæˆæ•´ä¸ªæµç¨‹ã€‚å½“æ‰€æœ‰æ­¥éª¤æ‰§è¡Œå®Œæ¯•åï¼Œè¯·å›å¤â€œPROCESSING_COMPLETEâ€ã€‚&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå®šä¹‰äº†æ‰§è¡Œå•å…ƒæ€ä¹ˆè¿›è¡Œæ“ä½œçš„æ‰‹å†Œã€‚é‚£ä¹ˆå’±ä»¬æ¥ä¸‹æ¥å°±çœ‹çœ‹è¿™äº›å·¥å…·æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼ˆä»£ç ä¸è´´å‡ºæ¥äº†ï¼‰,</p>
<table>
<thead>
<tr>
<th>å‡½æ•°åï¼ˆFunction Nameï¼‰</th>
<th>å¯¹åº”åŠ¨ä½œç±»ï¼ˆAction Classï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>add_activity_memory</code></td>
<td><code>AddActivityMemoryAction</code></td>
</tr>
<tr>
<td><code>link_related_memories</code></td>
<td><code>LinkRelatedMemoriesAction</code></td>
</tr>
<tr>
<td><code>generate_memory_suggestions</code></td>
<td><code>GenerateMemorySuggestionsAction</code></td>
</tr>
<tr>
<td><code>update_memory_with_suggestions</code></td>
<td><code>UpdateMemoryWithSuggestionsAction</code></td>
</tr>
<tr>
<td><code>run_theory_of_mind</code></td>
<td><code>RunTheoryOfMindAction</code></td>
</tr>
<tr>
<td><code>cluster_memories</code></td>
<td><code>ClusterMemoriesAction</code></td>
</tr>
</tbody></table>
<p><code>AddActivityMemoryAction</code>æ‰§è¡Œæµç¨‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1.</span> åˆå§‹åŒ–å’Œè¾“å…¥å¤„ç†</span><br><span class="line"></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params"></span></span><br><span class="line"><span class="params">    self,</span></span><br><span class="line"><span class="params">    character_name: <span class="built_in">str</span>,          <span class="comment"># æ¯”å¦‚ &quot;Alice&quot;</span></span></span><br><span class="line"><span class="params">    content: <span class="built_in">str</span>,                 <span class="comment"># åŸå§‹å¯¹è¯å†…å®¹</span></span></span><br><span class="line"><span class="params">    session_date: <span class="built_in">str</span> = <span class="literal">None</span>,     <span class="comment"># æ—¥æœŸï¼Œå¦‚æœæ²¡æä¾›åˆ™ä½¿ç”¨å½“å‰æ—¥æœŸ</span></span></span><br><span class="line"><span class="params">    generate_embeddings: <span class="built_in">bool</span> = <span class="literal">True</span>,  <span class="comment"># æ˜¯å¦ç”ŸæˆåµŒå…¥å‘é‡</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line"></span><br><span class="line">  è¾“å…¥ç¤ºä¾‹ï¼š</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;character_name&quot;</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: <span class="string">&quot;User: Hi, I&#x27;m Alice and I work with Python.\nAssistant: Great to meet </span></span><br><span class="line"><span class="string">you, Alice!\nUser: I&#x27;m interested in machine learning projects.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;session_date&quot;</span>: <span class="string">&quot;2025-09-24&quot;</span>,</span><br><span class="line">    <span class="string">&quot;generate_embeddings&quot;</span>: <span class="literal">True</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="number">2.</span> è®¾ç½®æ—¥æœŸå’Œæ ¼å¼åŒ–å†…å®¹</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> session_date:</span><br><span class="line">    session_date = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¥éª¤1ï¼šä½¿ç”¨LLMæ ¼å¼åŒ–å†…å®¹</span></span><br><span class="line">formatted_content = <span class="variable language_">self</span>._format_content_with_llm(</span><br><span class="line">    character_name, content, session_date</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">  `_format_content_with_llm`å†…éƒ¨æµç¨‹ï¼š</span><br><span class="line">   - è¾“å…¥ï¼šåŸå§‹å¯¹è¯ + è§’è‰²å + æ—¥æœŸ</span><br><span class="line">   - LLMæç¤ºï¼šè¦æ±‚å°†å¯¹è¯è½¬æ¢ä¸ºä¸å«ä»£è¯ã€è‡ªåŒ…å«çš„æ´»åŠ¨è®°å¿†é¡¹</span><br><span class="line">   - è¾“å‡ºï¼šæ ¼å¼åŒ–åçš„å†…å®¹</span><br><span class="line"></span><br><span class="line">  ç¤ºä¾‹è½¬æ¢ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥: <span class="string">&quot;User: Hi, I&#x27;m Alice and I work with Python.\nAssistant: Great to meet you, Alice</span></span><br><span class="line"><span class="string">!\nUser: I&#x27;m interested in machine learning projects.&quot;</span></span><br><span class="line"></span><br><span class="line">è¾“å‡º: <span class="string">&quot;Alice introduced herself as a Python developer and expressed interest in machine</span></span><br><span class="line"><span class="string">     learning projects.\nAlice mentioned that she works with Python and is exploring machine</span></span><br><span class="line"><span class="string">     learning opportunities.&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="number">3.</span> æ·»åŠ è®°å¿†IDå’Œæ—¶é—´æˆ³</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ­¥éª¤2ï¼šä¸ºæ¯ä¸ªè®°å¿†é¡¹æ·»åŠ å”¯ä¸€IDå’Œæ—¶é—´æˆ³</span></span><br><span class="line">   memory_items, content_with_ids = <span class="variable language_">self</span>._add_memory_ids_with_timestamp(</span><br><span class="line">        formatted_content, session_date</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">  `_add_memory_ids_with_timestamp`å†…éƒ¨æµç¨‹ï¼š</span><br><span class="line">   - åˆ†å‰²å†…å®¹ï¼šå°†æ ¼å¼åŒ–åçš„å†…å®¹æŒ‰è¡Œåˆ†å‰²</span><br><span class="line">   - ç”ŸæˆIDï¼šä¸ºæ¯è¡Œç”Ÿæˆå”¯ä¸€è®°å¿†ID</span><br><span class="line">   - æ·»åŠ å…ƒæ•°æ®ï¼šåŒ…å«æ—¶é—´æˆ³å’Œé“¾æ¥ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">  ç¤ºä¾‹å¤„ç†ï¼š</span><br><span class="line"></span><br><span class="line">     è¾“å…¥: <span class="string">&quot;Alice introduced herself as a Python developer and expressed interest in </span></span><br><span class="line"><span class="string">      machine learning projects.\nAlice mentioned that she works with Python and is </span></span><br><span class="line"><span class="string">      exploring machine learning opportunities.&quot;</span></span><br><span class="line">     </span><br><span class="line">     è¾“å‡º (content_with_ids):</span><br><span class="line">     <span class="string">&quot;[mem_123abc][mentioned at 2025-09-24] Alice introduced herself as a Python developer</span></span><br><span class="line"><span class="string">      and expressed interest in machine learning projects. []\n[mem_456def][mentioned at</span></span><br><span class="line"><span class="string">      2025-09-24] Alice mentioned that she works with Python and is exploring machine</span></span><br><span class="line"><span class="string">      learning opportunities. []&quot;</span></span><br><span class="line">     </span><br><span class="line">     è¾“å‡º (memory_items):</span><br><span class="line">     [</span><br><span class="line">         &#123;<span class="string">&quot;memory_id&quot;</span>: <span class="string">&quot;mem_123abc&quot;</span>, <span class="string">&quot;mentioned_at&quot;</span>: <span class="string">&quot;2025-09-24&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Alice </span></span><br><span class="line"><span class="string">      introduced herself as a Python developer...&quot;</span>, <span class="string">&quot;links&quot;</span>: <span class="string">&quot;&quot;</span>&#125;,</span><br><span class="line">         &#123;<span class="string">&quot;memory_id&quot;</span>: <span class="string">&quot;mem_456def&quot;</span>, <span class="string">&quot;mentioned_at&quot;</span>: <span class="string">&quot;2025-09-24&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Alice </span></span><br><span class="line"><span class="string">      mentioned that she works with Python...&quot;</span>, <span class="string">&quot;links&quot;</span>: <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">  <span class="number">4.</span> ä¿å­˜åˆ°æ–‡ä»¶å­˜å‚¨</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ­¥éª¤3ï¼šä¿å­˜è®°å¿†å†…å®¹åˆ°æ–‡ä»¶</span></span><br><span class="line">    success = <span class="variable language_">self</span>._append_memory_content(</span><br><span class="line">       character_name, <span class="string">&quot;activity&quot;</span>, content_with_ids</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">  `_append_memory_content`å†…éƒ¨æµç¨‹ï¼š</span><br><span class="line">   - ç¡®å®šæ–‡ä»¶è·¯å¾„ï¼šmemory_dir/&#123;agent_id&#125;/&#123;user_id&#125;/activity.md</span><br><span class="line">   - è¯»å–ç°æœ‰å†…å®¹ï¼šå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå…ˆè¯»å–</span><br><span class="line">   - è¿½åŠ æ–°å†…å®¹ï¼šå°†æ–°çš„è®°å¿†é¡¹è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾</span><br><span class="line">   - å†™å…¥æ–‡ä»¶ï¼šä¿å­˜åˆ°ç£ç›˜</span><br><span class="line"></span><br><span class="line">  ç¤ºä¾‹æ–‡ä»¶å†…å®¹ï¼š</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Activity Memories for Alice</span></span><br><span class="line">     </span><br><span class="line">     [mem_123abc][mentioned at <span class="number">2025</span>-09-<span class="number">24</span>] Alice introduced herself <span class="keyword">as</span> a Python developer</span><br><span class="line">     <span class="keyword">and</span> expressed interest <span class="keyword">in</span> machine learning projects. []</span><br><span class="line">     </span><br><span class="line">    [mem_456def][mentioned at <span class="number">2025</span>-09-<span class="number">24</span>] Alice mentioned that she works <span class="keyword">with</span> Python <span class="keyword">and</span> <span class="keyword">is</span></span><br><span class="line">     exploring machine learning opportunities. []</span><br><span class="line"></span><br><span class="line">  <span class="number">5.</span> ç”ŸæˆåµŒå…¥å‘é‡ï¼ˆå¯é€‰ï¼‰</span><br><span class="line"></span><br><span class="line">     <span class="comment"># æ­¥éª¤4ï¼šå¦‚æœå¯ç”¨ä¸”æˆåŠŸä¿å­˜ï¼Œç”ŸæˆåµŒå…¥å‘é‡</span></span><br><span class="line">     <span class="keyword">if</span> success <span class="keyword">and</span> generate_embeddings <span class="keyword">and</span> <span class="variable language_">self</span>.embeddings_enabled:</span><br><span class="line">         result = <span class="variable language_">self</span>._add_memory_item_embedding(</span><br><span class="line">             character_name, <span class="string">&quot;activity&quot;</span>, memory_items</span><br><span class="line">         )</span><br><span class="line"></span><br><span class="line">  `_add_memory_item_embedding`å†…éƒ¨æµç¨‹ï¼š</span><br><span class="line">   - åŠ è½½ç°æœ‰åµŒå…¥ï¼šè¯»å–å·²æœ‰çš„åµŒå…¥æ•°æ®</span><br><span class="line">   - ä¸ºæ¯ä¸ªæ–°é¡¹ç”ŸæˆåµŒå…¥ï¼š</span><br><span class="line">     - è°ƒç”¨<span class="variable language_">self</span>.embedding_client.embed(item[<span class="string">&quot;content&quot;</span>])</span><br><span class="line">     - ç”Ÿæˆ<span class="number">1536</span>ç»´ï¼ˆæˆ–å…¶å®ƒç»´æ•°ï¼‰çš„å‘é‡</span><br><span class="line">   - æ„å»ºåµŒå…¥æ•°æ®ç»“æ„ï¼š</span><br><span class="line"></span><br><span class="line">      new_embedding = &#123;</span><br><span class="line">          <span class="string">&quot;item_id&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;character_name&#125;</span>_activity_item_<span class="subst">&#123;<span class="built_in">len</span>(existing_embeddings)&#125;</span>&quot;</span>,</span><br><span class="line">          <span class="string">&quot;memory_id&quot;</span>: item[<span class="string">&quot;memory_id&quot;</span>],</span><br><span class="line">          <span class="string">&quot;text&quot;</span>: item[<span class="string">&quot;content&quot;</span>],</span><br><span class="line">          <span class="string">&quot;full_line&quot;</span>: <span class="string">f&quot;[<span class="subst">&#123;item[<span class="string">&#x27;memory_id&#x27;</span>]&#125;</span>][mentioned at <span class="subst">&#123;item[<span class="string">&#x27;mentioned_at&#x27;</span>]&#125;</span>] <span class="subst">&#123;item[</span></span></span><br><span class="line"><span class="subst"><span class="string">      <span class="string">&#x27;content&#x27;</span>]&#125;</span> [<span class="subst">&#123;item[<span class="string">&#x27;links&#x27;</span>]&#125;</span>]&quot;</span>,</span><br><span class="line">          <span class="string">&quot;embedding&quot;</span>: embedding_vector,  <span class="comment"># 1536ç»´å‘é‡</span></span><br><span class="line">          <span class="string">&quot;line_number&quot;</span>: <span class="built_in">len</span>(existing_embeddings) + <span class="number">1</span>,</span><br><span class="line">          <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">              <span class="string">&quot;character&quot;</span>: character_name,</span><br><span class="line">             <span class="string">&quot;category&quot;</span>: <span class="string">&quot;activity&quot;</span>,</span><br><span class="line">             <span class="string">&quot;length&quot;</span>: <span class="built_in">len</span>(item[<span class="string">&quot;content&quot;</span>]),</span><br><span class="line">             <span class="string">&quot;mentioned_at&quot;</span>: item[<span class="string">&quot;mentioned_at&quot;</span>],</span><br><span class="line">             <span class="string">&quot;timestamp&quot;</span>: datetime.now().isoformat(),</span><br><span class="line">         &#125;,</span><br><span class="line">     &#125;</span><br><span class="line">   - ä¿å­˜åµŒå…¥æ•°æ®ï¼šå†™å…¥embeddings/&#123;agent_id&#125;/&#123;user_id&#125;/activity_embeddings.json</span><br><span class="line"></span><br><span class="line">  <span class="number">6.</span> è¿”å›ç»“æœ</span><br><span class="line"></span><br><span class="line">    <span class="number">1</span> <span class="keyword">if</span> success:</span><br><span class="line">    <span class="number">2</span>     <span class="keyword">return</span> <span class="variable language_">self</span>._add_metadata(&#123;</span><br><span class="line">    <span class="number">3</span>         <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="number">4</span>         <span class="string">&quot;character_name&quot;</span>: character_name,</span><br><span class="line">    <span class="number">5</span>         <span class="string">&quot;category&quot;</span>: <span class="string">&quot;activity&quot;</span>,</span><br><span class="line">    <span class="number">6</span>         <span class="string">&quot;session_date&quot;</span>: session_date,</span><br><span class="line">    <span class="number">7</span>         <span class="string">&quot;memory_items_added&quot;</span>: <span class="built_in">len</span>(memory_items),</span><br><span class="line">    <span class="number">8</span>         <span class="string">&quot;memory_items&quot;</span>: memory_items,</span><br><span class="line">    <span class="number">9</span>         <span class="string">&quot;message&quot;</span>: <span class="string">f&quot;Successfully generated <span class="subst">&#123;<span class="built_in">len</span>(memory_items)&#125;</span> self-contained </span></span><br><span class="line"><span class="string">      activity memory items for <span class="subst">&#123;character_name&#125;</span>&quot;</span>,</span><br><span class="line">   <span class="number">10</span>     &#125;)</span><br><span class="line"></span><br><span class="line">  è¿”å›ç¤ºä¾‹ï¼š</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="string">&quot;success&quot;</span>: true,</span><br><span class="line">          <span class="string">&quot;character_name&quot;</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">          <span class="string">&quot;category&quot;</span>: <span class="string">&quot;activity&quot;</span>,</span><br><span class="line">          <span class="string">&quot;session_date&quot;</span>: <span class="string">&quot;2025-09-24&quot;</span>,</span><br><span class="line">          <span class="string">&quot;memory_items_added&quot;</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="string">&quot;memory_items&quot;</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                  <span class="string">&quot;memory_id&quot;</span>: <span class="string">&quot;mem_123abc&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;mentioned_at&quot;</span>: <span class="string">&quot;2025-09-24&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Alice introduced herself as a Python developer and expressed </span></span><br><span class="line"><span class="string">      interest in machine learning projects.&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;links&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">             &#125;</span><br><span class="line">         ],</span><br><span class="line">         <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Successfully generated 2 self-contained activity memory items for Alice&quot;</span></span><br><span class="line">     &#125;<span class="number">1</span></span><br><span class="line"></span><br><span class="line">  å®Œæ•´çš„æ•°æ®æµå‘</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span> åŸå§‹å¯¹è¯    â†’   LLMæ ¼å¼åŒ– â†’   æ·»åŠ ID/æ—¶é—´æˆ³ â†’ ä¿å­˜åˆ°æ–‡ä»¶   â†’   ç”ŸæˆåµŒå…¥å‘é‡  â†’  è¿”å›ç»“æœ</span><br><span class="line">   <span class="number">2</span>     â†“            â†“              â†“              â†“           â†“            â†“</span><br><span class="line">   <span class="number">3</span> User: Hi... â†’ Aliceä»‹ç»... â†’ [<span class="built_in">id</span>][date]... â†’ activity.md â†’ [å‘é‡]... â†’ JSONç»“æœ</span><br><span class="line"></span><br><span class="line">  è¿™ä¸ªæµç¨‹ç¡®ä¿äº†ï¼š</span><br><span class="line">   <span class="number">1.</span> æ ¼å¼ä¸€è‡´æ€§ï¼šæ‰€æœ‰è®°å¿†é¡¹éƒ½æœ‰ç»Ÿä¸€æ ¼å¼</span><br><span class="line">   <span class="number">2.</span> å”¯ä¸€æ ‡è¯†ï¼šæ¯ä¸ªè®°å¿†é¡¹éƒ½æœ‰å”¯ä¸€ID</span><br><span class="line">   <span class="number">3.</span> æŒä¹…å­˜å‚¨ï¼šä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">   <span class="number">4.</span> å¯æ£€ç´¢æ€§ï¼šç”ŸæˆåµŒå…¥å‘é‡ç”¨äºè¯­ä¹‰æœç´¢</span><br><span class="line">   <span class="number">5.</span> å…ƒæ•°æ®å®Œæ•´ï¼šåŒ…å«æ—¶é—´ã€æ¥æºç­‰ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<p>å’±ä»¬å…ˆä¸€èµ·çœ‹ä¸‹è¿™é‡Œçš„ç³»ç»Ÿæç¤ºè¯ï¼Œè½¬åŒ–ä¸ºä¸­æ–‡åï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç”¨äºæœ‰æ„ä¹‰æ´»åŠ¨åˆ†ç»„çš„å¢å¼ºæç¤ºè¯</span></span><br><span class="line">        format_prompt = <span class="string">f&quot;&quot;&quot;ä½ æ­£åœ¨ä¸º <span class="subst">&#123;user_name&#125;</span> æ ¼å¼åŒ– <span class="subst">&#123;session_date&#125;</span> çš„æ´»åŠ¨è®°å¿†å†…å®¹ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">éœ€è¦æ ¼å¼åŒ–çš„åŸå§‹å†…å®¹ï¼š</span></span><br><span class="line"><span class="string"><span class="subst">&#123;content&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**å…³é”®è¦æ±‚ï¼šå°†ç›¸å…³å†…å®¹åˆ†ç»„ä¸ºæœ‰æ„ä¹‰çš„æ´»åŠ¨**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¯·æ ¹æ®ä»¥ä¸‹è§„åˆ™ï¼Œå°†æ­¤åŸå§‹å†…å®¹è½¬æ¢ä¸ºæ ¼å¼æ­£ç¡®çš„æ´»åŠ¨è®°å¿†æ¡ç›®ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**æœ‰æ„ä¹‰çš„æ´»åŠ¨åˆ†ç»„è¦æ±‚ï¼š**</span></span><br><span class="line"><span class="string">- å°†ç›¸å…³çš„å¥å­/é™ˆè¿°åˆå¹¶ä¸ºå•ä¸€ã€å…¨é¢çš„æ´»åŠ¨æè¿°</span></span><br><span class="line"><span class="string">- æ¯ä¸ªæ´»åŠ¨éƒ½åº”æ˜¯å¯¹æ‰€å‘ç”Ÿäº‹ä»¶çš„å®Œæ•´ã€ç‹¬ç«‹çš„æè¿°</span></span><br><span class="line"><span class="string">- å°†ç›¸å…³çš„å¯¹è¯ã€è¡ŒåŠ¨å’Œä¸Šä¸‹æ–‡æ•´åˆä¸ºè¿è´¯çš„æ´»åŠ¨å—</span></span><br><span class="line"><span class="string">- ä»…ä¸ºçœŸæ­£ä¸åŒçš„æ´»åŠ¨æˆ–ä¸»é¢˜åˆ›å»ºå•ç‹¬çš„æ¡ç›®</span></span><br><span class="line"><span class="string">- æ¯ä¸ªæ´»åŠ¨æ¡ç›®éƒ½åº”è®²è¿°ä¸€ä¸ªå®Œæ•´çš„â€œæ•…äº‹â€æˆ–â€œäº‹ä»¶â€</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**ç‹¬ç«‹è®°å¿†è¦æ±‚ï¼š**</span></span><br><span class="line"><span class="string">- æ¯ä¸ªæ´»åŠ¨æ¡ç›®éƒ½å¿…é¡»æ˜¯å®Œæ•´ä¸”ç‹¬ç«‹çš„</span></span><br><span class="line"><span class="string">- å§‹ç»ˆåŒ…å«å®Œæ•´ä¸»è¯­ï¼ˆä¸è¦ä½¿ç”¨â€œå¥¹/ä»–/ä»–ä»¬/å®ƒâ€ï¼‰</span></span><br><span class="line"><span class="string">- åˆ‡å‹¿ä½¿ç”¨ä¾èµ–ä¸Šä¸‹æ–‡çš„ä»£è¯ï¼ˆä¸è¦ç”¨â€œå¥¹â€ã€â€œä»–â€ã€â€œä»–ä»¬â€ã€â€œå®ƒâ€ï¼‰</span></span><br><span class="line"><span class="string">- åœ¨æ¯ä¸ªæ¡ç›®ä¸­åŒ…å«å…·ä½“çš„äººåã€åœ°ç‚¹ã€æ—¥æœŸå’Œå®Œæ•´ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="string">- æ¯ä¸ªæ´»åŠ¨éƒ½åº”æ— éœ€é˜…è¯»å…¶ä»–æ¡ç›®å³å¯ç†è§£</span></span><br><span class="line"><span class="string">- åœ¨æ´»åŠ¨æè¿°ä¸­åŒ…å«æ‰€æœ‰ç›¸å…³ç»†èŠ‚ã€æƒ…æ„Ÿå’Œç»“æœ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**æ ¼å¼è¦æ±‚ï¼š**</span></span><br><span class="line"><span class="string">1. æ¯è¡Œ = ä¸€ä¸ªå®Œæ•´ã€æœ‰æ„ä¹‰çš„æ´»åŠ¨ï¼ˆå¯åŒ…å«å¤šä¸ªç›¸å…³å¥å­ï¼‰</span></span><br><span class="line"><span class="string">2. ä¸è¦ä½¿ç”¨ Markdown æ ‡é¢˜ã€é¡¹ç›®ç¬¦å·ã€ç¼–å·æˆ–ä»»ä½•ç»“æ„</span></span><br><span class="line"><span class="string">3. ä»…ä½¿ç”¨çº¯æ–‡æœ¬</span></span><br><span class="line"><span class="string">4. ä¸“æ³¨äºå…¨é¢ã€æœ‰æ„ä¹‰çš„æ´»åŠ¨æè¿°</span></span><br><span class="line"><span class="string">5. ä½¿ç”¨å…·ä½“çš„äººåã€å¤´è¡”ã€åœ°ç‚¹å’Œæ—¥æœŸ</span></span><br><span class="line"><span class="string">6. æ¯è¡Œä»¥å¥å·ç»“å°¾</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**è‰¯å¥½ç¤ºä¾‹ï¼ˆæœ‰æ„ä¹‰çš„æ´»åŠ¨ï¼Œæ¯è¡Œä¸€ä¸ªï¼‰ï¼š**</span></span><br><span class="line"><span class="string"><span class="subst">&#123;character_name&#125;</span> å‚åŠ äº†ä¸€ä¸ª LGBTQ æ”¯æŒå°ç»„ï¼Œåœ¨é‚£é‡Œ <span class="subst">&#123;character_name&#125;</span> å¬åˆ°äº†é¼“èˆäººå¿ƒçš„è·¨æ€§åˆ«è€…æ•…äº‹ï¼Œå¹¶æ„Ÿåˆ°å¿«ä¹ã€æ„Ÿæ©ã€è¢«æ¥çº³ï¼ŒåŒæ—¶è·å¾—äº†æ‹¥æŠ± <span class="subst">&#123;character_name&#125;</span> çœŸå®è‡ªæˆ‘çš„å‹‡æ°”ã€‚</span></span><br><span class="line"><span class="string"><span class="subst">&#123;character_name&#125;</span> ä¸ Melanie è®¨è®ºäº†æœªæ¥çš„èŒä¸šè§„åˆ’ï¼Œè¡¨è¾¾äº†å¯¹å¿ƒç†å’¨è¯¢å’Œå¿ƒç†å¥åº·å·¥ä½œçš„æµ“åšå…´è¶£ï¼Œä»¥å¸®åŠ©æœ‰ç±»ä¼¼é—®é¢˜çš„äººï¼ŒMelanie é¼“åŠ± <span class="subst">&#123;character_name&#125;</span>ï¼Œè¯´ <span class="subst">&#123;character_name&#125;</span> å‡­å€Ÿ <span class="subst">&#123;character_name&#125;</span> çš„å…±æƒ…èƒ½åŠ›å’Œç†è§£åŠ›ä¼šæˆä¸ºä¸€åå‡ºè‰²çš„å’¨è¯¢å¸ˆã€‚</span></span><br><span class="line"><span class="string"><span class="subst">&#123;character_name&#125;</span> èµèµäº† Melanie å»å¹´åˆ›ä½œçš„æ¹–è¾¹æ—¥å‡ºç”»ä½œï¼Œç§°èµäº†å…¶è‰²å½©èåˆï¼Œå¹¶è®¨è®ºäº†ç»˜ç”»å¦‚ä½•æˆä¸ºè¡¨è¾¾æƒ…æ„Ÿå’Œåœ¨æ¼«é•¿ä¸€å¤©åæ”¾æ¾çš„ç»ä½³é€”å¾„ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**ä¸è‰¯ç¤ºä¾‹ï¼ˆè¿‡äºé›¶ç¢ï¼‰ï¼š**</span></span><br><span class="line"><span class="string"><span class="subst">&#123;character_name&#125;</span> å»äº†ä¸€ä¸ª LGBTQ æ”¯æŒå°ç»„ã€‚</span></span><br><span class="line"><span class="string"><span class="subst">&#123;character_name&#125;</span> å¬åˆ°äº†è·¨æ€§åˆ«è€…çš„æ•…äº‹ã€‚</span></span><br><span class="line"><span class="string"><span class="subst">&#123;character_name&#125;</span> æ„Ÿåˆ°å¿«ä¹å’Œæ„Ÿæ©ã€‚</span></span><br><span class="line"><span class="string"><span class="subst">&#123;character_name&#125;</span> è·å¾—äº†æ‹¥æŠ± <span class="subst">&#123;character_name&#125;</span> çœŸå®è‡ªæˆ‘çš„å‹‡æ°”ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**æ´»åŠ¨åˆ†ç»„æŒ‡å—ï¼š**</span></span><br><span class="line"><span class="string">- å…³äºåŒä¸€ä¸»é¢˜çš„å¯¹è¯ â†’ å•ä¸€æ´»åŠ¨</span></span><br><span class="line"><span class="string">- ç›¸å…³è¡ŒåŠ¨åŠå…¶ç»“æœ â†’ å•ä¸€æ´»åŠ¨</span></span><br><span class="line"><span class="string">- å¯¹ç‰¹å®šäº‹ä»¶çš„æƒ…æ„Ÿååº” â†’ åŒ…å«åœ¨ä¸»è¦æ´»åŠ¨ä¸­</span></span><br><span class="line"><span class="string">- è¿ç»­çš„ç›¸å…³äº‹ä»¶ â†’ å•ä¸€ç»¼åˆæ€§æ´»åŠ¨</span></span><br><span class="line"><span class="string">- ä¸åŒä¸»é¢˜æˆ–æ— å…³äº‹ä»¶ â†’ åˆ†å¼€çš„æ´»åŠ¨</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**è´¨é‡æ ‡å‡†ï¼š**</span></span><br><span class="line"><span class="string">- åˆ‡å‹¿ä½¿ç”¨â€œä»–â€ã€â€œå¥¹â€ã€â€œä»–ä»¬â€ã€â€œå®ƒâ€â€”â€”å§‹ç»ˆä½¿ç”¨äººç‰©çš„çœŸå®å§“å</span></span><br><span class="line"><span class="string">- åˆ‡å‹¿ä½¿ç”¨â€œé‚£æœ¬ä¹¦â€ã€â€œé‚£ä¸ªåœ°æ–¹â€ã€â€œé‚£ä¸ªæœ‹å‹â€â€”â€”å§‹ç»ˆåŒ…å«å®Œæ•´æ ‡é¢˜å’Œå§“å</span></span><br><span class="line"><span class="string">- æ¯ä¸ªæ´»åŠ¨éƒ½å¿…é¡»å®Œæ•´å¹¶è®²è¿°å®Œæ•´æ•…äº‹</span></span><br><span class="line"><span class="string">- åŒ…å«æƒ…æ„ŸèƒŒæ™¯ã€ç»“æœå’Œæ„ä¹‰</span></span><br><span class="line"><span class="string">- æ™ºèƒ½åœ°åˆå¹¶ç›¸å…³å†…å®¹ï¼Œåˆ›å»ºæœ‰æ„ä¹‰çš„æ´»åŠ¨æ‘˜è¦</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¯·å°†åŸå§‹å†…å®¹è½¬æ¢ä¸ºæ ¼å¼æ­£ç¡®çš„æ´»åŠ¨è®°å¿†æ¡ç›®ï¼ˆæ¯è¡Œä¸€ä¸ªæœ‰æ„ä¹‰çš„æ´»åŠ¨ï¼‰ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>memory_items</code>å’Œ<code>content_with_ids</code>åˆ†åˆ«çš„ä½œç”¨ï¼Ÿ</p>
<p>ä¿å­˜çš„<code>activity.md</code>å’Œ<code>activity_embeddings.json</code>åˆ†åˆ«ç”¨åœ¨å“ªé‡Œ?</p>
<table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>activity.md</th>
<th>activity_embeddings.json</th>
</tr>
</thead>
<tbody><tr>
<td>æ£€ç´¢ç±»å‹</td>
<td>å…¨æ–‡æ£€ç´¢ï¼ˆå…³é”®è¯ï¼‰</td>
<td>è¯­ä¹‰æ£€ç´¢ï¼ˆå‘é‡ç›¸ä¼¼åº¦ï¼‰</td>
</tr>
<tr>
<td>æ£€ç´¢é€Ÿåº¦</td>
<td>è¾ƒæ…¢ï¼ˆæ–‡ä»¶I&#x2F;Oï¼‰</td>
<td>è¾ƒå¿«ï¼ˆå‘é‡è®¡ç®—ï¼‰</td>
</tr>
<tr>
<td>å­˜å‚¨æ ¼å¼</td>
<td>äººç±»å¯è¯»æ–‡æœ¬</td>
<td>JSON+å‘é‡</td>
</tr>
<tr>
<td>ä¸»è¦ç”¨é€”</td>
<td>æŒä¹…å­˜å‚¨ã€å¤‡ä»½</td>
<td>è¯­ä¹‰æœç´¢</td>
</tr>
<tr>
<td>æ›´æ–°é¢‘ç‡</td>
<td>é¢‘ç¹æ›´æ–°</td>
<td>éšæ–‡æœ¬æ›´æ–°è€Œæ›´æ–°</td>
</tr>
<tr>
<td>ä¾èµ–æ€§</td>
<td>ç‹¬ç«‹å­˜åœ¨</td>
<td>ä¾èµ–activity.mdå†…å®¹</td>
</tr>
</tbody></table>
<p><code>run_theory_of_mind</code></p>
<p>è¿™ä¸€æ­¥çš„ä½œç”¨æ˜¯é€šè¿‡ä¸Šä¸€ä¸ªå‡½æ•°å¾—åˆ°çš„æ´»åŠ¨é¡¹ï¼Œæ™ºèƒ½çš„æŒ–æ˜éšå«ä¿¡æ¯ï¼Œå®ç°ä»å¯¹è¯ä¸­æ¨å¯¼å‡ºæœªæ˜ç¡®è¡¨è¾¾ä½†å¯åˆç†æ¨æ–­çš„ä¿¡æ¯ã€‚ä¼šç”Ÿæˆæ¨ç†è¿‡ç¨‹<code>reasoning_process</code>å’Œæ¨ç†é¡¹<code>theory_of_mind_items</code>ã€‚</p>
<p>çœ‹ä¸‹è¿™é‡Œçš„æç¤ºè¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">        theory_of_mind_prompt = <span class="string">f&quot;&quot;&quot;ä½ æ­£åœ¨ä¸º <span class="subst">&#123;user_name&#125;</span> åˆ†æä»¥ä¸‹å¯¹è¯å’Œæ´»åŠ¨è®°å¿†æ¡ç›®ï¼Œè¯•å›¾æ¨æ–­å‡º <span class="subst">&#123;user_name&#125;</span> åœ¨å¯¹è¯ä¸­**æœªæ˜ç¡®æåŠ**ï¼Œä½†å¯èƒ½æ„æ¬²è¡¨è¾¾æˆ–å¬è€…å¯ä»¥åˆç†æ¨æ–­å‡ºçš„ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¯¹è¯å†…å®¹ï¼š</span></span><br><span class="line"><span class="string"><span class="subst">&#123;conversation_text&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ´»åŠ¨è®°å¿†æ¡ç›®ï¼š</span></span><br><span class="line"><span class="string"><span class="subst">&#123;activity_items_text&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**å…³é”®è¦æ±‚ï¼šæ¨ç†ç»“æœå¿…é¡»æ˜¯ç‹¬ç«‹çš„è®°å¿†æ¡ç›®**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä½ çš„ä»»åŠ¡æ˜¯è¿ç”¨æ¨ç†èƒ½åŠ›ï¼Œæ¨æ–­å‡ºå¯¹è¯ä¸­æœªæ˜ç¡®è¯´æ˜çš„ä¿¡æ¯ï¼Œä½†è¿™äº›ä¿¡æ¯å¯èƒ½æ˜¯è§’è‰²æ„æ¬²è¡¨è¾¾çš„ï¼Œæˆ–å¬è€…å¯ä»¥åˆç†æ¨æ–­å‡ºçš„ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**ç‹¬ç«‹è®°å¿†æ¡ç›®è¦æ±‚ï¼š**</span></span><br><span class="line"><span class="string">- ä»…ä½¿ç”¨çº¯æ–‡æœ¬ï¼Œä¸è¦ä½¿ç”¨ Markdown è¯­æ³•</span></span><br><span class="line"><span class="string">- æ¯ä¸ªè®°å¿†æ¡ç›®éƒ½å¿…é¡»æ˜¯å®Œæ•´ä¸”ç‹¬ç«‹çš„</span></span><br><span class="line"><span class="string">- å§‹ç»ˆåŒ…å«å®Œæ•´ä¸»è¯­ï¼ˆä¸è¦ä½¿ç”¨â€œå¥¹/ä»–/ä»–ä»¬/å®ƒâ€ï¼‰</span></span><br><span class="line"><span class="string">- åˆ‡å‹¿ä½¿ç”¨ä¾èµ–ä¸Šä¸‹æ–‡çš„ä»£è¯ï¼ˆä¸è¦ç”¨â€œå¥¹â€ã€â€œä»–â€ã€â€œä»–ä»¬â€ã€â€œå®ƒâ€ï¼‰</span></span><br><span class="line"><span class="string">- åœ¨æ¯ä¸ªæ¡ç›®ä¸­åŒ…å«å…·ä½“çš„äººåã€åœ°ç‚¹ã€æ—¥æœŸå’Œå®Œæ•´ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="string">- æ¯ä¸ªè®°å¿†æ¡ç›®éƒ½åº”æ— éœ€é˜…è¯»å…¶ä»–æ¡ç›®å³å¯ç†è§£</span></span><br><span class="line"><span class="string">- ä½ å¯ä»¥ä½¿ç”¨â€œperhapsâ€ï¼ˆæˆ–è®¸ï¼‰ã€â€œmaybeâ€ï¼ˆå¯èƒ½ï¼‰ç­‰è¯è¯­æ¥è¡¨æ˜è¯¥ä¿¡æ¯æ˜¯é€šè¿‡æ¨ç†å¾—å‡ºçš„ï¼Œå¹¶é 100% ç¡®å®š</span></span><br><span class="line"><span class="string">- æ¡ç›®ä¸­**æ— éœ€**åŒ…å«è¯æ®æˆ–æ¨ç†è¿‡ç¨‹</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**æ¨ç†æŒ‡å—ï¼š**</span></span><br><span class="line"><span class="string">- è¿ç”¨ä½ çš„æ¨ç†èƒ½åŠ›ï¼Œæ¨æ–­å‡ºå¯¹è¯ä¸­æœªæ˜ç¡®æåŠçš„ä¿¡æ¯</span></span><br><span class="line"><span class="string">- ä½¿ç”¨æ´»åŠ¨è®°å¿†æ¡ç›®ä½œä¸ºå‚è€ƒï¼Œè¾…åŠ©ä½ çš„æ¨ç†è¿‡ç¨‹å’Œæ¨æ–­</span></span><br><span class="line"><span class="string">- **ä¸è¦é‡å¤**æ´»åŠ¨è®°å¿†æ¡ç›®ä¸­å·²åŒ…å«çš„ä¿¡æ¯</span></span><br><span class="line"><span class="string">- ä½¿ç”¨æƒ…æ€å‰¯è¯ï¼ˆå¦‚ perhapsã€probablyã€likely ç­‰ï¼‰æ¥è¡¨æ˜ä½ å¯¹è¯¥æ¨æ–­çš„ç½®ä¿¡åº¦</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**å®Œæ•´å¥å­ç¤ºä¾‹ï¼š**</span></span><br><span class="line"><span class="string">æ­£ç¡®ï¼š&quot;<span class="subst">&#123;user_name&#125;</span> å¯èƒ½æœ‰æµ·å¤–å·¥ä½œç»éªŒ&quot;</span></span><br><span class="line"><span class="string">é”™è¯¯ï¼š&quot;æœ‰æµ·å¤–å·¥ä½œç»éªŒ&quot;ï¼ˆç¼ºå°‘ä¸»è¯­ï¼‰</span></span><br><span class="line"><span class="string">é”™è¯¯ï¼š&quot;ä»–å¯èƒ½æœ‰æµ·å¤–å·¥ä½œç»éªŒ&quot;ï¼ˆä½¿ç”¨ä»£è¯ä½œä¸»è¯­ï¼‰</span></span><br><span class="line"><span class="string">æ­£ç¡®ï¼š&quot;<span class="subst">&#123;user_name&#125;</span> æˆ–è®¸ä¸å¤ªå–œæ¬¢ä»Šå¹´å¤å¤©å»æ¬§æ´²çš„æ—…è¡Œ&quot;</span></span><br><span class="line"><span class="string">é”™è¯¯ï¼š&quot;<span class="subst">&#123;user_name&#125;</span> æˆ–è®¸ä¸å¤ªå–œæ¬¢ä»–çš„æ—…è¡Œ&quot;ï¼ˆç¼ºå°‘åœ°ç‚¹å’Œæ—¶é—´ï¼‰</span></span><br><span class="line"><span class="string">æ­£ç¡®ï¼š&quot;ã€Šå“ˆåˆ©Â·æ³¢ç‰¹ã€‹ç³»åˆ—å¯¹ <span class="subst">&#123;user_name&#125;</span> çš„ç«¥å¹´å¯èƒ½å¾ˆé‡è¦&quot;</span></span><br><span class="line"><span class="string">é”™è¯¯ï¼š&quot;ã€Šå“ˆåˆ©Â·æ³¢ç‰¹ã€‹ç³»åˆ—å¯¹ <span class="subst">&#123;user_name&#125;</span> çš„ç«¥å¹´å¯èƒ½å¾ˆé‡è¦ï¼Œå› ä¸ºå¥¹å¤šæ¬¡æåˆ°å¹¶å‘æœ‹å‹æ¨è&quot;ï¼ˆæ— éœ€åŒ…å«è¯æ®æˆ–æ¨ç†è¿‡ç¨‹ï¼‰</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**è¾“å‡ºæ ¼å¼ï¼š**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**REASONING PROCESS:**</span></span><br><span class="line"><span class="string">[è¯·è¯´æ˜ä½ çš„æ¨ç†è¿‡ç¨‹ï¼šå¯¹è¯èƒŒåå¯èƒ½éšè—äº†å“ªäº›éšå«ä¿¡æ¯ï¼Ÿä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•å¾—å‡ºç»“è®ºï¼Ÿä»¥åŠä½ çš„ç½®ä¿¡åº¦å¦‚ä½•ï¼Ÿ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**INFERENCE ITEMS:**</span></span><br><span class="line"><span class="string">[æ¯è¡Œä¸€æ¡æ¨æ–­ç»“æœï¼Œä¸è¦ä½¿ç”¨ Markdown æ ‡é¢˜ã€ç»“æ„ã€ç¼–å·æˆ–é¡¹ç›®ç¬¦å·ï¼Œæ¯è¡Œä»¥å¥å·ç»“å°¾]</span></span><br><span class="line"><span class="string">[ç»è¿‡ä»”ç»†æ¨ç†åï¼Œå¦‚æœä½ è®¤ä¸ºæ— æ³•ä»å¯¹è¯ä¸­æ¨æ–­å‡ºä»»ä½•è¶…å‡ºæ´»åŠ¨è®°å¿†æ¡ç›®ä¸­å·²æ˜ç¡®æåŠçš„éšå«ä¿¡æ¯ï¼Œå¯ä»¥å°†æ­¤éƒ¨åˆ†ç•™ç©ºã€‚**ä¸è¦**è¾“å‡ºâ€œæ— å¯ç”¨æ¨æ–­â€ä¹‹ç±»çš„å†…å®¹ã€‚]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<p><code>GenerateMemorySuggestionsAction</code></p>
<p>è¿™ä¸ªå‡½æ•°çš„ç›®çš„æ˜¯åˆ†æè®°å¿†é¡¹å¹¶ç”Ÿæˆåˆ†ç±»å’Œæ›´æ–°å»ºè®®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">å®é™…æ‰§è¡Œç¤ºä¾‹</span><br><span class="line"></span><br><span class="line">è¾“å…¥</span><br><span class="line"></span><br><span class="line">   memory_items = [</span><br><span class="line">       &#123;<span class="string">&quot;memory_id&quot;</span>: <span class="string">&quot;mem_123&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Alice expressed love for hiking and mentioned </span></span><br><span class="line"><span class="string">   going to mountains last week&quot;</span>&#125;,</span><br><span class="line">       &#123;<span class="string">&quot;memory_id&quot;</span>: <span class="string">&quot;mem_456&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Alice is probably adventurous and enjoys </span></span><br><span class="line"><span class="string">   outdoor activities.&quot;</span>&#125;</span><br><span class="line">   ]</span><br><span class="line"></span><br><span class="line">LLMå“åº”ç¤ºä¾‹</span><br><span class="line"></span><br><span class="line">    **CATEGORY SUGGESTIONS:**</span><br><span class="line">    profile: Add information about adventurous personality and outdoor interests</span><br><span class="line">    event: Record mountain hiking activity as significant outdoor event</span><br><span class="line">    activity: Add hiking and outdoor activities to recorded activities</span><br><span class="line">    </span><br><span class="line">    **MEMORY-CATEGORY MAPPING:**</span><br><span class="line">    interests: mem_123,mem_456</span><br><span class="line">   personality: mem_456</span><br><span class="line">    </span><br><span class="line">   **DETAILED SUGGESTIONS:**</span><br><span class="line">   For interests category:</span><br><span class="line">   - Item mem_123: Add specific hiking interest</span><br><span class="line">   - Item mem_456: Add adventurous personality trait</span><br><span class="line"></span><br><span class="line">è§£æåçš„è¾“å‡º</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;success&quot;</span>: True,</span><br><span class="line">       <span class="string">&quot;category_suggestions&quot;</span>: &#123;</span><br><span class="line">           <span class="string">&quot;profile&quot;</span>: <span class="string">&quot;Add information about adventurous personality and outdoor </span></span><br><span class="line"><span class="string">    interests&quot;</span>,</span><br><span class="line">            <span class="string">&quot;event&quot;</span>: <span class="string">&quot;Record mountain hiking activity as significant outdoor event&quot;</span>,</span><br><span class="line">            <span class="string">&quot;activity&quot;</span>: <span class="string">&quot;Add hiking and outdoor activities to recorded activities&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;memory_category_mapping&quot;</span>: &#123;</span><br><span class="line">           <span class="string">&quot;interests&quot;</span>: [<span class="string">&quot;mem_123&quot;</span>, <span class="string">&quot;mem_456&quot;</span>],</span><br><span class="line">           <span class="string">&quot;personality&quot;</span>: [<span class="string">&quot;mem_456&quot;</span>]</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">æ ¸å¿ƒä½œç”¨</span><br><span class="line"></span><br><span class="line"> 1. æ™ºèƒ½åˆ†ç±»ï¼šåˆ†æè®°å¿†é¡¹åº”è¯¥å½’å±åˆ°å“ªäº›ç±»åˆ«</span><br><span class="line"> 2. æ›´æ–°å»ºè®®ï¼šä¸ºæ¯ä¸ªç±»åˆ«ç”Ÿæˆå…·ä½“çš„æ›´æ–°å»ºè®®</span><br><span class="line"> 3. æ˜ å°„å…³ç³»ï¼šå»ºç«‹è®°å¿†é¡¹ä¸ç±»åˆ«ä¹‹é—´çš„æ˜ å°„å…³ç³»</span><br><span class="line"> 4. å†…å®¹ä¼˜åŒ–ï¼šå»ºè®®å¦‚ä½•æ•´åˆå’Œç»„ç»‡è®°å¿†å†…å®¹</span><br><span class="line"></span><br><span class="line">è¿™äº›å»ºè®®éšåä¼šè¢«update_memory_with_suggestionså‡½æ•°ä½¿ç”¨æ¥å®é™…æ›´æ–°å„ç±»åˆ«æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸‹è¿™é‡Œçš„æç¤ºè¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">            <span class="comment"># åˆ›å»ºå¢å¼ºæç¤ºè¯ï¼Œä¾› LLM åˆ†æå¹¶ç”Ÿæˆå»ºè®®</span></span><br><span class="line">            suggestions_prompt = <span class="string">f&quot;&quot;&quot;ä½ æ˜¯ä¸€ä½ä¸“å®¶ï¼Œè´Ÿè´£åˆ†æä¸º <span class="subst">&#123;character_name&#125;</span> æä¾›çš„è®°å¿†æ¡ç›®ï¼Œå¹¶å»ºè®®åº”å‘æ¯ä¸ªè®°å¿†åˆ†ç±»ä¸­æ·»åŠ å“ªäº›è®°å¿†å†…å®¹ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ–°è®°å¿†æ¡ç›®ï¼š</span></span><br><span class="line"><span class="string"><span class="subst">&#123;memory_items_text&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¯ç”¨åˆ†ç±»ï¼š<span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(available_categories)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**å…³é”®è¦æ±‚ï¼šå»ºè®®å¿…é¡»æ˜¯ç‹¬ç«‹çš„è®°å¿†æ¡ç›®**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**ç‹¬ç«‹è®°å¿†æ¡ç›®è¦æ±‚ï¼š**</span></span><br><span class="line"><span class="string">- æ¯ä¸ªè®°å¿†æ¡ç›®éƒ½å¿…é¡»æ˜¯å®Œæ•´ä¸”ç‹¬ç«‹çš„</span></span><br><span class="line"><span class="string">- å§‹ç»ˆåŒ…å«å®Œæ•´ä¸»è¯­ï¼ˆä¸è¦ä½¿ç”¨â€œå¥¹/ä»–/ä»–ä»¬/å®ƒâ€ï¼‰</span></span><br><span class="line"><span class="string">- åˆ‡å‹¿ä½¿ç”¨ä¾èµ–ä¸Šä¸‹æ–‡çš„ä»£è¯ï¼ˆä¸è¦ç”¨â€œå¥¹â€ã€â€œä»–â€ã€â€œä»–ä»¬â€ã€â€œå®ƒâ€ï¼‰</span></span><br><span class="line"><span class="string">- åœ¨æ¯ä¸ªæ¡ç›®ä¸­åŒ…å«å…·ä½“çš„äººåã€åœ°ç‚¹ã€æ—¥æœŸå’Œå®Œæ•´ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="string">- æ¯ä¸ªè®°å¿†æ¡ç›®éƒ½åº”æ— éœ€é˜…è¯»å…¶ä»–æ¡ç›®å³å¯ç†è§£</span></span><br><span class="line"><span class="string">- åœ¨è®°å¿†æè¿°ä¸­åŒ…å«æ‰€æœ‰ç›¸å…³ç»†èŠ‚ã€æƒ…æ„Ÿå’Œç»“æœ</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**åˆ†ç±»ç‰¹å®šè¦æ±‚ï¼š**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">é’ˆå¯¹æ¯ä¸ªåˆ†ç±»ï¼Œåˆ†ææ–°è®°å¿†æ¡ç›®ï¼Œå¹¶å»ºè®®åº”æå–å¹¶æ·»åŠ åˆ°è¯¥åˆ†ç±»ä¸­çš„å…·ä½“ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- **activityï¼ˆæ´»åŠ¨ï¼‰**ï¼šå¯¹è¯çš„è¯¦ç»†æè¿°ï¼ŒåŒ…æ‹¬æ—¶é—´ã€åœ°ç‚¹å’Œæ¶‰åŠçš„äººå‘˜</span></span><br><span class="line"><span class="string">- **profileï¼ˆä¸ªäººèµ„æ–™ï¼‰**ï¼š**ä»…é™**åŸºæœ¬ä¿¡æ¯ï¼ˆå¹´é¾„ã€æ‰€åœ¨åœ°ã€èŒä¸šã€æ•™è‚²èƒŒæ™¯ã€å®¶åº­çŠ¶å†µã€äººå£ç»Ÿè®¡ä¿¡æ¯ï¼‰â€”â€”**æ’é™¤**äº‹ä»¶ã€æ´»åŠ¨æˆ–å…¶åšè¿‡çš„äº‹æƒ…</span></span><br><span class="line"><span class="string">- **eventï¼ˆäº‹ä»¶ï¼‰**ï¼šå…·ä½“çš„äº‹ä»¶ã€æ—¥æœŸã€é‡Œç¨‹ç¢‘ã€é¢„çº¦ã€ä¼šè®®ã€å¸¦æœ‰æ—¶é—´å‚è€ƒçš„æ´»åŠ¨</span></span><br><span class="line"><span class="string">- **å…¶ä»–åˆ†ç±»**ï¼šé’ˆå¯¹æ¯ä¸ªç‰¹å®šåˆ†ç±»çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**å…³é”®åŒºåˆ†â€”â€”ä¸ªäººèµ„æ–™ vs æ´»åŠ¨/äº‹ä»¶ï¼š**</span></span><br><span class="line"><span class="string">- ä¸ªäººèµ„æ–™ï¼ˆæ­£ç¡®ï¼‰ï¼šâ€œAlice ä½åœ¨æ—§é‡‘å±±â€ï¼Œâ€œAlice 28 å²â€ï¼Œâ€œAlice åœ¨ TechFlow Solutions å·¥ä½œâ€</span></span><br><span class="line"><span class="string">- ä¸ªäººèµ„æ–™ï¼ˆé”™è¯¯ï¼‰ï¼šâ€œAlice å»å¾’æ­¥äº†â€ï¼ˆè¿™æ˜¯æ´»åŠ¨ï¼‰ï¼Œâ€œAlice å‚åŠ äº†ç ”è®¨ä¼šâ€ï¼ˆè¿™æ˜¯äº‹ä»¶ï¼‰</span></span><br><span class="line"><span class="string">- æ´»åŠ¨/äº‹ä»¶ï¼ˆæ­£ç¡®ï¼‰ï¼šâ€œAlice å»è“å²­å±±è„‰å¾’æ­¥äº†â€ï¼Œâ€œAlice å‚åŠ äº†æ‘„å½±ç ”è®¨ä¼šâ€</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**å»ºè®®è¦æ±‚ï¼š**</span></span><br><span class="line"><span class="string">- æ˜ç¡®æŒ‡å‡ºè®°å¿†æ¡ç›®åº”ä»¥ â€œ<span class="subst">&#123;character_name&#125;</span>â€ ä½œä¸ºä¸»è¯­</span></span><br><span class="line"><span class="string">- æåŠåº”åŒ…å«çš„å…·ä½“äººåã€åœ°ç‚¹ã€å¤´è¡”å’Œæ—¥æœŸ</span></span><br><span class="line"><span class="string">- ç¡®ä¿å»ºè®®èƒ½ç”Ÿæˆå®Œæ•´ã€ç‹¬ç«‹çš„è®°å¿†æ¡ç›®</span></span><br><span class="line"><span class="string">- é¿å…å»ºè®®ä¼šå¯¼è‡´ä½¿ç”¨ä»£è¯æˆ–ä¸å®Œæ•´å¥å­çš„å†…å®¹</span></span><br><span class="line"><span class="string">- å¯¹äºä¸ªäººèµ„æ–™ï¼š**ä»…å…³æ³¨**ç¨³å®šã€äº‹å®æ€§ã€äººå£ç»Ÿè®¡ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="string">- å¦‚æœä¸€æ¡è¾“å…¥è®°å¿†æ¡ç›®åŒ…å«å±äºå¤šä¸ªåˆ†ç±»çš„ä¿¡æ¯ï¼Œä½ åº”è¯¥åˆç†åœ°æ‹†åˆ†ä¿¡æ¯ï¼Œå¹¶ä¸ºæ‰€æœ‰ç›¸å…³åˆ†ç±»æä¾›å»ºè®®</span></span><br><span class="line"><span class="string">- **é‡è¦**ï¼šå¦‚æœè¾“å…¥è®°å¿†æ¡ç›®ä½¿ç”¨æƒ…æ€å‰¯è¯ï¼ˆå¦‚ perhapsã€probablyã€likely ç­‰ï¼‰æ¥è¡¨ç¤ºä¸ç¡®å®šçš„æ¨æ–­ï¼Œè¯·åœ¨ä½ çš„å»ºè®®ä¸­**åŸæ ·ä¿ç•™**è¿™äº›æƒ…æ€å‰¯è¯</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**è¾“å‡ºè¯´æ˜ï¼š**</span></span><br><span class="line"><span class="string">- **é‡è¦**ï¼š**åˆ‡å‹¿**å»ºè®®â€œå¯ç”¨åˆ†ç±»â€åˆ—è¡¨ä¹‹å¤–çš„åˆ†ç±»</span></span><br><span class="line"><span class="string">- ä»…è¾“å‡ºæœ‰æ–°è®°å¿†æ¡ç›®å»ºè®®çš„åˆ†ç±»</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**è¾“å‡ºæ ¼å¼ï¼š**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Category: [åˆ†ç±»åç§°]**</span></span><br><span class="line"><span class="string">- Suggestion: [åº”æ·»åŠ åˆ°æ­¤åˆ†ç±»çš„å…·ä½“ã€ç‹¬ç«‹çš„å†…å®¹ï¼Œç¡®ä¿åŒ…å«å®Œæ•´ä¸»è¯­å’Œå®Œæ•´ä¸Šä¸‹æ–‡]</span></span><br><span class="line"><span class="string">- Suggestion: [åº”æ·»åŠ åˆ°æ­¤åˆ†ç±»çš„å…·ä½“ã€ç‹¬ç«‹çš„å†…å®¹ï¼Œç¡®ä¿åŒ…å«å®Œæ•´ä¸»è¯­å’Œå®Œæ•´ä¸Šä¸‹æ–‡]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Category: [åˆ†ç±»åç§°]**</span></span><br><span class="line"><span class="string">- Suggestion: [åº”æ·»åŠ åˆ°æ­¤åˆ†ç±»çš„å…·ä½“ã€ç‹¬ç«‹çš„å†…å®¹ï¼Œç¡®ä¿åŒ…å«å®Œæ•´ä¸»è¯­å’Œå®Œæ•´ä¸Šä¸‹æ–‡]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="meta">... </span>å…¶ä»–åˆ†ç±» ...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<p><code>UpdateMemoryWithSuggestionsAction</code></p>
<blockquote>
<p>  æ ¸å¿ƒåŠŸèƒ½ï¼šæ ¹æ®å»ºè®®å†…å®¹æ›´æ–°æŒ‡å®šç±»åˆ«çš„è®°å¿†æ–‡ä»¶ï¼Œæ”¯æŒå››ç§æ“ä½œç±»å‹ã€‚</p>
<p>  å››ç§æ“ä½œç±»å‹çš„è¯¦ç»†è¯´æ˜ï¼š</p>
<pre><code>1. ADDï¼ˆæ·»åŠ ï¼‰
</code></pre>
<ul>
<li>åŠŸèƒ½ï¼šæ·»åŠ å…¨æ–°çš„è®°å¿†é¡¹åˆ°ç±»åˆ«ä¸­</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šå½“å»ºè®®åŒ…å«ç°æœ‰ç±»åˆ«ä¸­ä¸å­˜åœ¨çš„æ–°ä¿¡æ¯æ—¶</li>
</ul>
<pre><code>2. UPDATEï¼ˆæ›´æ–°ï¼‰  
</code></pre>
<ul>
<li>åŠŸèƒ½ï¼šä¿®æ”¹ç°æœ‰è®°å¿†é¡¹çš„å†…å®¹</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šå½“å»ºè®®æä¾›ç°æœ‰è®°å¿†é¡¹çš„æ›´æ–°æˆ–æ›´è¯¦ç»†ä¿¡æ¯æ—¶</li>
</ul>
<pre><code>3. DELETEï¼ˆåˆ é™¤ï¼‰
</code></pre>
<ul>
<li>åŠŸèƒ½ï¼šä»ç±»åˆ«ä¸­ç§»é™¤è¿‡æ—¶æˆ–ä¸æ­£ç¡®çš„è®°å¿†é¡¹</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šå½“å‘ç°ç°æœ‰è®°å¿†é¡¹å·²è¿‡æ—¶æˆ–é”™è¯¯æ—¶</li>
</ul>
<pre><code>4. TOUCHï¼ˆè§¦ç¢°ï¼‰
</code></pre>
<ul>
<li>åŠŸèƒ½ï¼šæ›´æ–°ç°æœ‰è®°å¿†é¡¹çš„æ—¶é—´æˆ³ï¼Œæ ‡è®°ä¸ºæœ€è¿‘è®¿é—®è¿‡</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šå½“ç°æœ‰è®°å¿†é¡¹å·²ç»å……åˆ†æ¶µç›–å»ºè®®å†…å®¹æ—¶ï¼Œåªéœ€æ ‡è®°ä¸ºæ´»è·ƒçŠ¶æ€</li>
<li>å…·ä½“å®ç°ï¼šåœ¨ä»£ç ä¸­çœ‹åˆ°æ³¨é‡Šâ€â€â€should update â€œupdated_atâ€ â€œâ€â€ï¼Œè¡¨ç¤ºåº”è¯¥æ›´æ–°æœ€åè®¿é—®æ—¶é—´æˆ³</li>
</ul>
<p>  æ€»ç»“</p>
<p>  ä¸€å¥è¯æ¦‚æ‹¬ï¼š<code>UpdateMemoryWithSuggestionsAction</code>è´Ÿè´£å°†LLMç”Ÿæˆçš„å»ºè®®å†…å®¹å®é™…åº”ç”¨åˆ°è®°å¿†æ–‡ä»¶ä¸­ï¼Œé€š<br>  è¿‡æ·»åŠ ã€æ›´æ–°ã€åˆ é™¤æˆ–è§¦ç¢°æ“ä½œæ¥ç»´æŠ¤è®°å¿†çš„å‡†ç¡®æ€§å’Œæ—¶æ•ˆæ€§ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">update_memory_with_suggestions å®é™…æ‰§è¡Œæµç¨‹</span><br><span class="line"></span><br><span class="line">  1. å‡½æ•°ç­¾åå’Œè¾“å…¥éªŒè¯</span><br><span class="line"></span><br><span class="line">   1 def execute(</span><br><span class="line">   2     self,</span><br><span class="line">   3     character_name: str,</span><br><span class="line">   4     category: str,           <span class="comment"># è¦æ›´æ–°çš„å…·ä½“ç±»åˆ«</span></span><br><span class="line">   5     suggestion: str,        <span class="comment"># æ¥è‡ªgenerate_memory_suggestionsçš„å»ºè®®</span></span><br><span class="line">   6     session_date: str = None,</span><br><span class="line">   7     generate_embeddings: bool = True,</span><br><span class="line">   8 ) -&gt; Dict[str, Any]:</span><br><span class="line"></span><br><span class="line">  è¾“å…¥æ¥æºï¼š</span><br><span class="line">   - character_name: è§’è‰²åï¼ˆå¦‚<span class="string">&quot;Alice&quot;</span>ï¼‰</span><br><span class="line">   - category: è¦æ›´æ–°çš„å…·ä½“ç±»åˆ«ï¼ˆå¦‚<span class="string">&quot;profile&quot;</span>ï¼‰</span><br><span class="line">   - suggestion: æ¥è‡ªgenerate_memory_suggestionsçš„è¯¥ç±»åˆ«å»ºè®®</span><br><span class="line">   - session_date: ä¼šè¯æ—¥æœŸ</span><br><span class="line"></span><br><span class="line">  2. æ ¸å¿ƒæ‰§è¡Œé€»è¾‘</span><br><span class="line"></span><br><span class="line">    1 <span class="comment"># 1. è¯»å–ç°æœ‰å†…å®¹</span></span><br><span class="line">    2 existing_content = self._read_memory_content(character_name, category)</span><br><span class="line">    3 existing_memory_items = self._extract_memory_items_from_content(existing_content)</span><br><span class="line">    4 </span><br><span class="line">    5 <span class="comment"># 2. æ„é€ æ“ä½œåˆ†ææç¤º</span></span><br><span class="line">    6 operation_response = self._analyze_memory_operation_from_suggestion(</span><br><span class="line">    7     category, character_name, formatted_existing_content, suggestion</span><br><span class="line">    8 )</span><br><span class="line">    9 </span><br><span class="line">   10 <span class="comment"># 3. è§£ææ“ä½œå¹¶æ‰§è¡Œ</span></span><br><span class="line">   11 operation_list = self._parse_operation_response(operation_response)</span><br><span class="line">   12 operation_executed, new_items = self._execute_operations(</span><br><span class="line">   13     character_name, category, operation_list, session_date,</span><br><span class="line">   14     existing_memory_items, generate_embeddings</span><br><span class="line">   15 )</span><br><span class="line"></span><br><span class="line">  3. æ“ä½œåˆ†ææç¤ºæ„é€ </span><br><span class="line"></span><br><span class="line">    1 operation_prompt = f<span class="string">&quot;&quot;</span><span class="string">&quot;You are an expert in analyzing the following memory update </span></span><br><span class="line"><span class="string">      scenario and determining the memory operations that should be performed.</span></span><br><span class="line"><span class="string">    2 </span></span><br><span class="line"><span class="string">    3 Character: &#123;character_name&#125;</span></span><br><span class="line"><span class="string">    4 Memory Category: &#123;category&#125;</span></span><br><span class="line"><span class="string">    5 </span></span><br><span class="line"><span class="string">    6 Existing Memory Items in &#123;category&#125;:</span></span><br><span class="line"><span class="string">    7 &#123;existing_content if existing_content else &quot;</span>No existing content<span class="string">&quot;&#125;</span></span><br><span class="line"><span class="string">    8 </span></span><br><span class="line"><span class="string">    9 Memory Update Suggestion:</span></span><br><span class="line"><span class="string">   10 &#123;suggestion&#125;</span></span><br><span class="line"><span class="string">   11 </span></span><br><span class="line"><span class="string">   12 **OPERATION TYPES:**</span></span><br><span class="line"><span class="string">   13 1. **ADD**: Add completely new memory items that doesn&#x27;t exist in Existing Memory </span></span><br><span class="line"><span class="string">      Items</span></span><br><span class="line"><span class="string">   14 2. **UPDATE**: Modify or enhance existing memory items with new details</span></span><br><span class="line"><span class="string">   15 3. **DELETE**: Remove outdated, incorrect, or irrelevant memory items</span></span><br><span class="line"><span class="string">   16 4. **TOUCH**: Touch memory items that already exists (only for updating timestamp)</span></span><br><span class="line"><span class="string">   17 </span></span><br><span class="line"><span class="string">   18 [... æ›´å¤šæŒ‡å¯¼ ...]</span></span><br><span class="line"><span class="string">   19 </span></span><br><span class="line"><span class="string">   20 **OUTPUT FORMAT:**</span></span><br><span class="line"><span class="string">   21 </span></span><br><span class="line"><span class="string">   22 **OPERATION:** [ADD/UPDATE/DELETE/TOUCH]</span></span><br><span class="line"><span class="string">   23 - Target Memory ID: [Only if operation is UPDATE, DELETE, or TOUCH]</span></span><br><span class="line"><span class="string">   24 - Memory Item Content: [Only if operation is ADD or UPDATE]</span></span><br><span class="line"><span class="string">   25 &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  4. æ“ä½œæ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">    1 def _execute_operations(self, ...):</span><br><span class="line">    2     <span class="keyword">for</span> operation <span class="keyword">in</span> operation_list:</span><br><span class="line">    3         <span class="keyword">if</span> operation[<span class="string">&quot;operation&quot;</span>] == <span class="string">&quot;ADD&quot;</span>:</span><br><span class="line">    4             <span class="comment"># åˆ›å»ºæ–°çš„è®°å¿†é¡¹</span></span><br><span class="line">    5             memory_id = self._generate_memory_id()</span><br><span class="line">    6             memory_item = &#123;</span><br><span class="line">    7                 <span class="string">&quot;memory_id&quot;</span>: memory_id,</span><br><span class="line">    8                 <span class="string">&quot;mentioned_at&quot;</span>: session_date,</span><br><span class="line">    9                 <span class="string">&quot;content&quot;</span>: operation[<span class="string">&quot;memory_content&quot;</span>],</span><br><span class="line">   10                 <span class="string">&quot;links&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">   11             &#125;</span><br><span class="line">   12             all_items.append(memory_item)</span><br><span class="line">   13 </span><br><span class="line">   14         <span class="keyword">elif</span> operation[<span class="string">&quot;operation&quot;</span>] == <span class="string">&quot;UPDATE&quot;</span>:</span><br><span class="line">   15             <span class="comment"># æ›´æ–°ç°æœ‰è®°å¿†é¡¹</span></span><br><span class="line">   16             <span class="keyword">for</span> item <span class="keyword">in</span> all_items:</span><br><span class="line">   17                 <span class="keyword">if</span> item[<span class="string">&quot;memory_id&quot;</span>] == operation[<span class="string">&quot;target_id&quot;</span>]:</span><br><span class="line">   18                     item[<span class="string">&quot;content&quot;</span>] = operation[<span class="string">&quot;memory_content&quot;</span>]</span><br><span class="line">   19 </span><br><span class="line">   20         <span class="comment"># ... å…¶ä»–æ“ä½œ ...</span></span><br><span class="line">   21 </span><br><span class="line">   22     <span class="comment"># ä¿å­˜æ›´æ–°åçš„å†…å®¹</span></span><br><span class="line">   23     new_content = self._format_memory_items(all_items)</span><br><span class="line">   24     self._save_memory_content(character_name, category, new_content)</span><br><span class="line"></span><br><span class="line">  5. å®é™…æ‰§è¡Œç¤ºä¾‹</span><br><span class="line"></span><br><span class="line">  è¾“å…¥ï¼š</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;character_name&quot;</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">        <span class="string">&quot;category&quot;</span>: <span class="string">&quot;profile&quot;</span>,</span><br><span class="line">        <span class="string">&quot;suggestion&quot;</span>: <span class="string">&quot;Alice has adventurous personality traits based on outdoor activity </span></span><br><span class="line"><span class="string">     interests\nAlice enjoys outdoor activities such as hiking and mountain climbing&quot;</span>,</span><br><span class="line">        <span class="string">&quot;session_date&quot;</span>: <span class="string">&quot;2025-09-24&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  ç°æœ‰profileå†…å®¹ï¼š</span><br><span class="line"></span><br><span class="line">    [mem_001][mentioned at 2025-09-20] Alice works as a software engineer []</span><br><span class="line">    [mem_002][mentioned at 2025-09-21] Alice enjoys reading books []</span><br><span class="line"></span><br><span class="line">  LLMåˆ†æåçš„æ“ä½œï¼š</span><br><span class="line"></span><br><span class="line">     **OPERATION:** ADD</span><br><span class="line">     - Memory Item Content: Alice has adventurous personality traits based on outdoor</span><br><span class="line">     activity interests</span><br><span class="line">     </span><br><span class="line">     **OPERATION:** ADD</span><br><span class="line">     - Memory Item Content: Alice enjoys outdoor activities such as hiking and mountain</span><br><span class="line">     climbing</span><br><span class="line">     </span><br><span class="line">  æ‰§è¡Œæ“ä½œå¹¶æŒä¹…åŒ–ï¼š</span><br><span class="line">    1.éå†æ“ä½œåˆ—è¡¨: </span><br><span class="line">        ADD: ä¸ºæ–°å†…å®¹ç”Ÿæˆ memory_idï¼Œåˆ›å»ºæ–°å†…å­˜é¡¹ï¼Œå¹¶è¿½åŠ åˆ° all_items åˆ—è¡¨ä¸­ã€‚</span><br><span class="line">        UPDATE: åœ¨ all_items ä¸­æ‰¾åˆ°åŒ¹é… target_id çš„é¡¹ï¼Œæ›¿æ¢å…¶ contentã€‚</span><br><span class="line">        DELETE: åœ¨ all_items ä¸­æ‰¾åˆ°åŒ¹é… target_id çš„é¡¹ï¼Œå¹¶å°†å…¶ç§»é™¤ã€‚</span><br><span class="line">        TOUCH: ï¼ˆå½“å‰ä¸ºå ä½ç¬¦ï¼‰æœªæ¥ç”¨äºæ›´æ–°æ—¶é—´æˆ³ã€‚</span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">    2.ä¿å­˜åˆ°ç£ç›˜: </span><br><span class="line">        è°ƒç”¨ _format_memory_items å°†æ›´æ–°åçš„ all_items åˆ—è¡¨é‡æ–°æ ¼å¼åŒ–ä¸ºæ–‡æœ¬ã€‚</span><br><span class="line">        è°ƒç”¨ _save_memory_content å°†æ–°æ–‡æœ¬è¦†ç›–å†™å…¥åŸè®°å¿†æ–‡ä»¶ã€‚</span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">    3.æ›´æ–°å‘é‡ï¼ˆå¯é€‰ï¼‰: </span><br><span class="line">        å¦‚æœå¯ç”¨äº†å‘é‡åŠŸèƒ½ï¼Œä¸”æœ‰æ–°å¢æˆ–æ›´æ–°çš„é¡¹ (updated_items)ï¼Œåˆ™è°ƒç”¨ _add_memory_item_embeddingã€‚</span><br><span class="line">        è¯¥æ–¹æ³•ä¼šä¸ºæ–°å†…å®¹ç”Ÿæˆå‘é‡ï¼Œå¹¶è¿½åŠ åˆ°å¯¹åº”çš„ category_embeddings.json æ–‡ä»¶ä¸­ã€‚</span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">    4.è¿”å›ç»“æœ: </span><br><span class="line">        è¿”å›ä¸€ä¸ªå…ƒç»„ (operation_executed, new_items)ï¼ŒåŒ…å«å·²æ‰§è¡Œçš„æ“ä½œåˆ—è¡¨å’Œæ–°å¢çš„å†…å­˜é¡¹ã€‚</span><br><span class="line">         </span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">  æ‰§è¡Œåç»“æœï¼š</span><br><span class="line"></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="string">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="string">&quot;character_name&quot;</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">          <span class="string">&quot;category&quot;</span>: <span class="string">&quot;profile&quot;</span>,</span><br><span class="line">          <span class="string">&quot;operation_executed&quot;</span>: [</span><br><span class="line">              &#123;<span class="string">&quot;operation&quot;</span>: <span class="string">&quot;ADD&quot;</span>, <span class="string">&quot;memory_content&quot;</span>: <span class="string">&quot;Alice has adventurous personality </span></span><br><span class="line"><span class="string">      traits...&quot;</span>&#125;,</span><br><span class="line">              &#123;<span class="string">&quot;operation&quot;</span>: <span class="string">&quot;ADD&quot;</span>, <span class="string">&quot;memory_content&quot;</span>: <span class="string">&quot;Alice enjoys outdoor activities...&quot;</span>&#125;</span><br><span class="line">          ],</span><br><span class="line">          <span class="string">&quot;new_memory_items&quot;</span>: [...],</span><br><span class="line">         <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Successfully performed 2 memory operations for profile&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">  æ›´æ–°åçš„profile.mdï¼š</span><br><span class="line"></span><br><span class="line">     [mem_001][mentioned at 2025-09-20] Alice works as a software engineer []</span><br><span class="line">     [mem_002][mentioned at 2025-09-21] Alice enjoys reading books []</span><br><span class="line">     [mem_789][mentioned at 2025-09-24] Alice has adventurous personality traits based on</span><br><span class="line">     outdoor activity interests []</span><br><span class="line">    [mem_abc][mentioned at 2025-09-24] Alice enjoys outdoor activities such as hiking and</span><br><span class="line">     mountain climbing []</span><br></pre></td></tr></table></figure>



<p><code>LinkRelatedMemoriesAction</code></p>
<p> ä¸€å¥è¯æ¦‚æ‹¬: <code>link_related_memories</code>é€šè¿‡è¯­ä¹‰ç›¸ä¼¼åº¦åˆ†æï¼Œæ™ºèƒ½åœ°åœ¨ç›¸å…³è®°å¿†é¡¹ä¹‹é—´å»ºç«‹é“¾æ¥å…³ç³»ï¼Œå½¢æˆ<br>  ä¸€ä¸ªäº’è”çš„è®°å¿†ç½‘ç»œï¼Œä¾¿äºåç»­çš„å…³è”æ£€ç´¢å’Œæ¨ç†ã€‚</p>
<p>å®é™…åº”ç”¨åœºæ™¯ç¤ºä¾‹</p>
<p>  å‡è®¾æœ‰ä¸€æ¡è®°å¿†:</p>
   <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[mem<span class="built_in">_</span>123][mentioned at 2025-09-24] Alice expressed love for hiking and mentioned going to mountains last week[]</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œlink_related_memoriesåå¯èƒ½å˜æˆ:</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[mem<span class="built_in">_</span>123][mentioned at 2025-09-24] Alice expressed love for hiking and mentioned going to mountains last week [mem<span class="built_in">_</span>456,mem<span class="built_in">_</span>789]</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>mem_456</code>å’Œ<code>mem_789</code>æ˜¯è¯­ä¹‰ä¸Šç›¸å…³çš„è®°å¿†é¡¹IDã€‚</p>
<blockquote>
<p>æƒ³è±¡ä½ æœ‰ä¸€æœ¬<strong>ä¸ªäººè®°å¿†ç¬”è®°æœ¬</strong>ï¼Œé‡Œé¢åˆ†äº†å¥½å‡ ä¸ªç« èŠ‚ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><strong>ã€æ´»åŠ¨ã€‘</strong>ï¼šè®°å½•ä½ æ¯å¤©å¹²äº†å•¥ï¼ˆâ€œä»Šå¤©å’Œå°æ˜èŠäº†Pythonâ€ï¼‰</li>
<li><strong>ã€ä¸ªäººèµ„æ–™ã€‘</strong>ï¼šè®°å½•ä½ çš„åŸºæœ¬ä¿¡æ¯ï¼ˆâ€œæˆ‘å«å¼ ä¸‰ï¼Œä½åœ¨åŒ—äº¬â€ï¼‰</li>
<li><strong>ã€äº‹ä»¶ã€‘</strong>ï¼šè®°å½•é‡è¦æ—¥å­ï¼ˆâ€œä¸‹å‘¨äºŒè¦å¼€é¡¹ç›®ä¼šâ€ï¼‰</li>
</ul>
<p>ç°åœ¨ï¼Œä½ æƒ³ç»™è¿™äº›è®°å¿†<strong>åŠ ä¸Šâ€œè¶…é“¾æ¥â€</strong>ï¼Œè®©ç›¸å…³çš„å†…å®¹èƒ½äº’ç›¸è·³è½¬ã€‚æ¯”å¦‚ï¼Œçœ‹åˆ°â€œå’Œå°æ˜èŠPythonâ€ï¼Œèƒ½è‡ªåŠ¨è·³åˆ°â€œæˆ‘å«å¼ ä¸‰â€å’Œâ€œä¸‹å‘¨äºŒè¦å¼€é¡¹ç›®ä¼šâ€ï¼Œå› ä¸ºå®ƒä»¬éƒ½ç›¸å…³ã€‚</p>
<p><code>link_all_items</code> å°±æ˜¯å†³å®šä½ <strong>æ€ä¹ˆåŠ è¿™äº›é“¾æ¥</strong>çš„ä¸¤ç§æ¨¡å¼ï¼š</p>
<p> è·¯çº¿ä¸€ï¼š<code>link_all_items = False</code>ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰â€”â€” <strong>â€œå•ç‚¹çªç ´â€</strong></p>
<ul>
<li><p><strong>æ€ä¹ˆå¹²</strong>ï¼Ÿ<br>ä½ <strong>åªç»™æŸä¸€æ¡ç‰¹å®šçš„è®°å¿†</strong>åŠ é“¾æ¥ã€‚<br>æ¯”å¦‚ï¼Œä½ åªå…³å¿ƒ <strong>â€œä»Šå¤©å’Œå°æ˜èŠäº†Pythonâ€</strong> è¿™ä¸€æ¡ï¼Œå°±åªç»™å®ƒæ‰¾å…³è”ã€‚</p>
</li>
<li><p><strong>è¿‡ç¨‹</strong>ï¼š  </p>
<ol>
<li>ä½ å‘Šè¯‰ç³»ç»Ÿï¼šâ€œè¯·ç»™ <strong>memory_id&#x3D;mem_123</strong> è¿™æ¡è®°å¿†åŠ é“¾æ¥â€ã€‚  </li>
<li>ç³»ç»Ÿå°±åªåˆ†æ <strong>è¿™ä¸€æ¡</strong>ï¼Œç„¶åå»å…¨æœ¬ç¬”è®°æœ¬é‡Œï¼ˆæ‰€æœ‰ç« èŠ‚ï¼‰æ‰¾å’Œå®ƒç›¸å…³çš„å†…å®¹ã€‚  </li>
<li>æ‰¾åˆ°åï¼ŒåªæŠŠé“¾æ¥åŠ åˆ° <strong>mem_123</strong> è¿™ä¸€è¡Œçš„æœ«å°¾ã€‚</li>
</ol>
</li>
<li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š  </p>
<ul>
<li><strong>å¢é‡æ›´æ–°</strong>ï¼šä½ åˆšæ–°å¢äº†ä¸€æ¡è®°å¿†ï¼Œæƒ³ç«‹åˆ»ç»™å®ƒå»ºç«‹å…³è”ã€‚</li>
<li><strong>ç²¾å‡†æ“ä½œ</strong>ï¼šä½ åªæƒ³å¤„ç†æŸä¸€æ¡ï¼Œä¸æƒ³åŠ¨å…¶ä»–çš„ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>æ€»ç»“</strong>ï¼š<strong>ä¸€æ¬¡åªå¤„ç†ä¸€æ¡ï¼Œç²¾å‡†ã€é«˜æ•ˆã€çœèµ„æºã€‚</strong></p>
</blockquote>
<p>è·¯çº¿äºŒï¼š<code>link_all_items = True</code> â€”â€” <strong>â€œå…¨é¢ä½“æ£€â€</strong></p>
<ul>
<li><p><strong>æ€ä¹ˆå¹²</strong>ï¼Ÿ<br>ä½ è®©ç³»ç»Ÿ<strong>æŠŠæ•´ä¸ªç« èŠ‚é‡Œæ‰€æœ‰çš„è®°å¿†</strong>éƒ½æ£€æŸ¥ä¸€éï¼Œç»™<strong>æ¯ä¸€æ¡</strong>éƒ½åŠ ä¸Šé“¾æ¥ã€‚</p>
</li>
<li><p><strong>è¿‡ç¨‹</strong>ï¼š  </p>
<ol>
<li>ä½ å‘Šè¯‰ç³»ç»Ÿï¼šâ€œè¯·ç»™ <strong>ã€æ´»åŠ¨ã€‘</strong> è¿™ä¸ªç« èŠ‚é‡Œçš„<strong>æ‰€æœ‰è®°å¿†</strong>éƒ½åŠ é“¾æ¥â€ã€‚  </li>
<li>ç³»ç»Ÿå°±<strong>é€æ¡éå†</strong>ã€æ´»åŠ¨ã€‘ç« èŠ‚é‡Œçš„æ¯ä¸€æ¡è®°å¿†ï¼ˆå¯èƒ½æ˜¯100æ¡ï¼‰ã€‚  </li>
<li>å¯¹<strong>æ¯ä¸€æ¡</strong>ï¼Œéƒ½é‡å¤â€œå•ç‚¹çªç ´â€çš„è¿‡ç¨‹ï¼šåˆ†æå®ƒï¼Œå»å…¨æœ¬ç¬”è®°æœ¬é‡Œæ‰¾å…³è”ï¼Œç„¶åæŠŠé“¾æ¥åŠ åˆ°å®ƒè‡ªå·±é‚£è¡Œæœ«å°¾ã€‚</li>
</ol>
</li>
<li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š  </p>
<ul>
<li><strong>åˆæ¬¡æ„å»º</strong>ï¼šä½ åˆšå¯¼å…¥äº†ä¸€å¤§å †æ—§è®°å¿†ï¼Œéœ€è¦ä¸€æ¬¡æ€§å»ºç«‹å®Œæ•´çš„çŸ¥è¯†ç½‘ç»œã€‚</li>
<li><strong>å…¨å±€æ›´æ–°</strong>ï¼šä½ ä¿®æ”¹äº†å‘é‡æ¨¡å‹æˆ–ç›¸ä¼¼åº¦ç®—æ³•ï¼Œéœ€è¦é‡æ–°è®¡ç®—æ‰€æœ‰è®°å¿†çš„å…³è”å…³ç³»ã€‚</li>
<li><strong>å®šæœŸç»´æŠ¤</strong>ï¼šæ¯å‘¨æ—¥åŠå¤œè‡ªåŠ¨è¿è¡Œä¸€æ¬¡ï¼Œç¡®ä¿æ‰€æœ‰è®°å¿†çš„é“¾æ¥éƒ½æ˜¯æœ€æ–°çš„ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>æ€»ç»“</strong>ï¼š<strong>ä¸€æ¬¡æ€§å¤„ç†æ•´ä¸ªç« èŠ‚ï¼Œå…¨é¢ã€å½»åº•ï¼Œä½†éå¸¸è€—æ—¶è€—åŠ›ã€‚</strong></p>
</blockquote>
<p>ä¸¤æ¡è·¯çš„è”ç³»</p>
<ol>
<li><p><strong>åº•å±‚é€»è¾‘ç›¸åŒ</strong>ï¼š<br>æ— è®ºæ˜¯å¤„ç†ä¸€æ¡è¿˜æ˜¯å¤„ç†ä¸€ç™¾æ¡ï¼Œ<strong>æ¯ä¸€æ¡è®°å¿†çš„å…³è”æŸ¥æ‰¾è¿‡ç¨‹</strong>ï¼ˆè®¡ç®—å‘é‡ã€è·¨åˆ†ç±»æœç´¢ã€ç­›é€‰ç»“æœï¼‰æ˜¯<strong>å®Œå…¨ä¸€æ ·çš„</strong>ã€‚<code>link_all_items=True</code> æœ¬è´¨ä¸Šå°±æ˜¯æŠŠ <code>link_all_items=False</code> çš„æµç¨‹<strong>å¾ªç¯æ‰§è¡Œ N æ¬¡</strong>ã€‚</p>
</li>
<li><p><strong>ç›®æ ‡ä¸€è‡´</strong>ï¼š<br>ä¸¤æ¡è·¯çš„æœ€ç»ˆç›®çš„éƒ½æ˜¯<strong>ä¸°å¯Œè®°å¿†ä¹‹é—´çš„å…³è”</strong>ï¼Œè®©æ•´ä¸ªè®°å¿†ç³»ç»Ÿä»â€œä¸€å †å­¤ç«‹çš„ç¬”è®°â€å˜æˆä¸€ä¸ªâ€œäº’è”äº’é€šçš„çŸ¥è¯†å›¾è°±â€ã€‚</p>
</li>
<li><p><strong>äº’è¡¥ä½¿ç”¨</strong>ï¼š  </p>
<ul>
<li>å¹³æ—¶ç”¨ <strong>â€œå•ç‚¹çªç ´â€</strong> (<code>False</code>) æ¥å¤„ç†æ–°è®°å¿†ï¼Œä¿è¯å®æ—¶æ€§ã€‚</li>
<li>å®šæœŸç”¨ <strong>â€œå…¨é¢ä½“æ£€â€</strong> (<code>True</code>) æ¥åšå…¨å±€ä¼˜åŒ–ï¼Œä¿è¯å®Œæ•´æ€§ã€‚</li>
</ul>
</li>
</ol>
<p>ä¸€å¥è¯ç»ˆææ€»ç»“</p>
<blockquote>
<p><strong><code>link_all_items=False</code> æ˜¯â€œå¤–ç§‘æ‰‹æœ¯åˆ€â€ï¼Œç²¾å‡†å¤„ç†å•æ¡è®°å¿†ï¼›<br><code>link_all_items=True</code> æ˜¯â€œå…¨èº«CTæ‰«æâ€ï¼Œå½»åº•æ£€æŸ¥æ•´ä¸ªåˆ†ç±»ã€‚<br>ä¸€ä¸ªç”¨äºæ—¥å¸¸ç»´æŠ¤ï¼Œä¸€ä¸ªç”¨äºå¤§ä¿®å¤§è¡¥ã€‚</strong></p>
</blockquote>
</blockquote>
<p><code>ClusterMemoriesAction</code></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">ClusterMemoriesAction åŠŸèƒ½æ€»ç»“</span><br><span class="line"></span><br><span class="line">æ ¸å¿ƒåŠŸèƒ½</span><br><span class="line">å°†ç›¸å…³è®°å¿†é¡¹èšç±»åˆ°ä¸»é¢˜ç±»åˆ«ä¸­ï¼Œè‡ªåŠ¨å‘ç°é‡è¦æˆ–é‡å¤çš„äº‹ä»¶æ¨¡å¼</span><br><span class="line"></span><br><span class="line">è¯¦ç»†åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">1. ç°æœ‰èšç±»åˆå¹¶</span><br><span class="line"></span><br><span class="line"> 1 <span class="params">#</span> å°†æ–°è®°å¿†é¡¹åˆå¹¶åˆ°ç°æœ‰çš„èšç±»ä¸­</span><br><span class="line"> 2 updated<span class="built_in">_</span>clusters = self.<span class="built_in">_</span>merge<span class="built_in">_</span>existing<span class="built_in">_</span>clusters(</span><br><span class="line"> 3     character<span class="built_in">_</span>name, conversation<span class="built_in">_</span>content, existing<span class="built_in">_</span>clusters,</span><br><span class="line"> 4     new<span class="built_in">_</span>memory<span class="built_in">_</span>items, new<span class="built_in">_</span>theory<span class="built_in">_</span>of<span class="built_in">_</span>mind<span class="built_in">_</span>items</span><br><span class="line"> 5 )</span><br><span class="line"> - åˆ†ææ–°è®°å¿†é¡¹ä¸ç°æœ‰èšç±»çš„ç›¸å…³æ€§</span><br><span class="line"> - å°†ç›¸å…³è®°å¿†é¡¹æ·»åŠ åˆ°å¯¹åº”èšç±»ä¸­</span><br><span class="line"></span><br><span class="line">2. æ–°èšç±»æ£€æµ‹</span><br><span class="line"></span><br><span class="line"> 1 <span class="params">#</span> å‘ç°æ–°çš„é‡è¦æˆ–é‡å¤äº‹ä»¶</span><br><span class="line"> 2 new<span class="built_in">_</span>clusters = self.<span class="built_in">_</span>detect<span class="built_in">_</span>new<span class="built_in">_</span>clusters(</span><br><span class="line"> 3     character<span class="built_in">_</span>name, conversation<span class="built_in">_</span>content, existing<span class="built_in">_</span>clusters,</span><br><span class="line"> 4     new<span class="built_in">_</span>memory<span class="built_in">_</span>items, new<span class="built_in">_</span>theory<span class="built_in">_</span>of<span class="built_in">_</span>mind<span class="built_in">_</span>items</span><br><span class="line"> 5 )</span><br><span class="line"> - è¯†åˆ«é‡è¦äº‹ä»¶ï¼ˆå¦‚ç»“å©šã€å‡èŒç­‰ï¼‰</span><br><span class="line"> - å‘ç°é‡å¤æ€§ã€å‘¨æœŸæ€§æˆ–å¸¸è§„æ€§æ´»åŠ¨</span><br><span class="line"> - åˆ›å»ºæ–°çš„ä¸»é¢˜èšç±»ç±»åˆ«</span><br><span class="line"></span><br><span class="line">3. æ™ºèƒ½èšç±»æ ‡å‡†</span><br><span class="line"> - é‡è¦æ€§ï¼šä¸€æ¬¡æ€§é‡å¤§äº‹ä»¶</span><br><span class="line"> - é‡å¤æ€§ï¼šå¤šæ¬¡æåŠçš„æ´»åŠ¨æˆ–ä¸»é¢˜</span><br><span class="line"> - å‘¨æœŸæ€§ï¼šå®šæœŸå‘ç”Ÿçš„äº‹ä»¶</span><br><span class="line"> - å¸¸è§„æ€§ï¼šæ—¥å¸¸ç”Ÿæ´»ä¹ æƒ¯æˆ–ä¾‹è¡Œå…¬äº‹</span><br><span class="line"></span><br><span class="line">4. èšç±»å­˜å‚¨</span><br><span class="line"></span><br><span class="line">   <span class="params">#</span> ä¸ºæ¯ä¸ªèšç±»åˆ›å»ºç‹¬ç«‹çš„æ–‡ä»¶</span><br><span class="line">  self.storage<span class="built_in">_</span>manager.create<span class="built_in">_</span>cluster<span class="built_in">_</span>category(cluster<span class="built_in">_</span>name)</span><br><span class="line">  self.storage<span class="built_in">_</span>manager.append<span class="built_in">_</span>memory<span class="built_in">_</span>file(cluster<span class="built_in">_</span>name, memory<span class="built_in">_</span>item)</span><br><span class="line"> - ä¸ºæ¯ä¸ªèšç±»ä¸»é¢˜åˆ›å»ºç‹¬ç«‹çš„è®°å¿†æ–‡ä»¶</span><br><span class="line"> - å°†ç›¸å…³è®°å¿†é¡¹ä¿å­˜åˆ°å¯¹åº”èšç±»æ–‡ä»¶ä¸­</span><br><span class="line"></span><br><span class="line">å®é™…åº”ç”¨ç¤ºä¾‹</span><br><span class="line"></span><br><span class="line">å‡è®¾æ–°å¢äº†è¿™äº›è®°å¿†é¡¹ï¼š</span><br><span class="line"></span><br><span class="line"> 1 - &quot;Alice expressed love for hiking and mentioned going to mountains&quot;</span><br><span class="line"> 2 - &quot;Alice mentioned enjoying photography in Blue Ridge Mountains&quot;</span><br><span class="line"> 3 - &quot;Alice said she goes hiking every weekend&quot;</span><br><span class="line"></span><br><span class="line">æ‰§è¡ŒClusterMemoriesActionåå¯èƒ½åˆ›å»ºï¼š</span><br><span class="line"></span><br><span class="line"> 1 /clusters/</span><br><span class="line"> 2   â”œâ”€â”€ hiking<span class="built_in">_</span>activities.md  <span class="params">#</span> åŒ…å«æ‰€æœ‰ä¸å¾’æ­¥ç›¸å…³è®°å¿†</span><br><span class="line"> 3   â””â”€â”€ outdoor<span class="built_in">_</span>photography.md <span class="params">#</span> åŒ…å«æ‰€æœ‰ä¸æˆ·å¤–æ‘„å½±ç›¸å…³è®°å¿†</span><br><span class="line"></span><br><span class="line">æ€»ç»“</span><br><span class="line"></span><br><span class="line">ä¸€å¥è¯æ¦‚æ‹¬ï¼š`ClusterMemoriesAction`é€šè¿‡å¯¹è®°å¿†é¡¹çš„ä¸»é¢˜åˆ†æå’Œæ¨¡å¼è¯†åˆ«ï¼Œè‡ªåŠ¨å°†ç›¸å…³è®°å¿†ç»„ç»‡åˆ°é€»è¾‘èšç±»ä¸­ï¼Œå½¢æˆç»“æ„åŒ–çš„ä¸»é¢˜åˆ†ç±»ä½“ç³»ã€‚</span><br></pre></td></tr></table></figure>

<p>  è¿™æ ·æ•´ä¸ªè®°å¿†å¤„ç†æµç¨‹å°±å®Œæˆäº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> å­˜å‚¨ â†’ <span class="number">2.</span> æ¨ç† â†’ <span class="number">3.</span> å»ºè®® â†’ <span class="number">4.</span> æ›´æ–° â†’ <span class="number">5.</span> é“¾æ¥ â†’ <span class="number">6.</span> èšç±»</span><br></pre></td></tr></table></figure>

<hr>
<h6 id="é˜¶æ®µå°èŠ‚"><a href="#é˜¶æ®µå°èŠ‚" class="headerlink" title="é˜¶æ®µå°èŠ‚"></a>é˜¶æ®µå°èŠ‚</h6><p>ç°åœ¨æˆ‘ä»¬çœ‹å®Œäº†&#x2F;memorizeç«¯å£çš„å…·ä½“å®ç°ï¼Œå¯¹è¿™ä¸ªç«¯å£çš„åŸç†æœ‰äº†ä¸ªæ•´ä½“çš„è®¤è¯†ï¼Œç°åœ¨æˆ‘ä»¬å†å›å¤´çœ‹ä¸‹<code>memory.py</code>çš„æ•´ä½“ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">1. POST /api/v1/memory/memorize</span><br><span class="line">   * åŠŸèƒ½: å¼€å§‹ä¸€ä¸ªè®°å¿†ä»»åŠ¡ã€‚</span><br><span class="line">   * æè¿°: </span><br><span class="line">     è¿™æ˜¯ä¸»è¦çš„å…¥å£ç‚¹ï¼Œç”¨äºè®©ç³»ç»Ÿâ€œè®°ä½â€ä¸€æ®µå¯¹è¯ã€‚å®ƒä¸ä¼šç«‹å³å®Œæˆè®°å¿†è¿‡ç¨‹ï¼Œå› </span><br><span class="line">     ä¸ºè¿™å¯èƒ½æ˜¯ä¸€ä¸ªè€—æ—¶æ“ä½œï¼ˆä¾‹å¦‚éœ€è¦è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œåˆ†æã€è®¡ç®—å‘é‡ç­‰ï¼‰ã€‚</span><br><span class="line">   * å·¥ä½œæ–¹å¼:</span><br><span class="line">       1. æ¥æ”¶åŒ…å«ç”¨æˆ·IDã€Agent IDä»¥åŠå¯¹è¯å†…å®¹çš„è¯·æ±‚ã€‚</span><br><span class="line">       2. åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ task_id æ¥è¿½è¸ªè¿™ä¸ªè®°å¿†ä»»åŠ¡ã€‚</span><br><span class="line">       3. å¯åŠ¨ä¸€ä¸ªåå°ä»»åŠ¡ (_process_memorization_task) </span><br><span class="line">          æ¥å®é™…å¤„ç†å¯¹è¯å†…å®¹ã€‚</span><br><span class="line">       4. ç«‹å³è¿”å› task_id å’Œ </span><br><span class="line">          <span class="string">&quot;PENDING&quot;</span>ï¼ˆå¤„ç†ä¸­ï¼‰çŠ¶æ€ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±ä¸ä¼šå› ä¸ºç­‰å¾…è€Œé˜»å¡ã€‚</span><br><span class="line">   * è¯·æ±‚ä½“ (`MemorizeRequest`): éœ€è¦ user_id, agent_id, ä»¥åŠ </span><br><span class="line">     conversation_text æˆ– conversationã€‚</span><br><span class="line">   * å“åº” (`MemorizeResponse`): è¿”å› task_id å’Œä»»åŠ¡åˆå§‹çŠ¶æ€ã€‚</span><br><span class="line">   </span><br><span class="line">  2. GET /api/v1/memory/memorize/status/&#123;task_id&#125;</span><br><span class="line">   * åŠŸèƒ½: æŸ¥è¯¢è®°å¿†ä»»åŠ¡çš„çŠ¶æ€ã€‚</span><br><span class="line">   * æè¿°: å®¢æˆ·ç«¯åœ¨è°ƒç”¨ä¸Šä¸€ä¸ªæ¥å£æ‹¿åˆ° task_id </span><br><span class="line">     åï¼Œå¯ä»¥å‘¨æœŸæ€§åœ°è°ƒç”¨è¿™ä¸ªæ¥å£æ¥æŸ¥è¯¢è®°å¿†ä»»åŠ¡çš„è¿›å±•ã€‚</span><br><span class="line">   * å·¥ä½œæ–¹å¼:</span><br><span class="line">       1. é€šè¿‡URLè·¯å¾„ä¸­çš„ task_id å»æŸ¥è¯¢ä»»åŠ¡ã€‚</span><br><span class="line">       2. è¿”å›ä»»åŠ¡çš„å½“å‰çŠ¶æ€ï¼ˆå¦‚ PENDING, PROCESSING, SUCCESS, </span><br><span class="line">          FAILUREï¼‰ã€å¤„ç†ç»“æœï¼ˆå¦‚æœæˆåŠŸï¼‰æˆ–é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰ã€‚</span><br><span class="line">   * è¯·æ±‚å‚æ•°: task_id (è·¯å¾„å‚æ•°)ã€‚</span><br><span class="line">   * å“åº” (`TaskStatusResponse`): </span><br><span class="line">     è¿”å›ä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬çŠ¶æ€ã€ç»“æœã€é”™è¯¯å’Œæ—¶é—´æˆ³ã€‚</span><br><span class="line"></span><br><span class="line">  3. POST /api/v1/memory/retrieve/default-categories</span><br><span class="line">   * åŠŸèƒ½: æ£€ç´¢é»˜è®¤åˆ†ç±»çš„è®°å¿†ã€‚</span><br><span class="line">   * æè¿°: è·å–ä¸€äº›é¢„è®¾å¥½çš„ã€æ ¸å¿ƒçš„è®°å¿†ç±»åˆ«ï¼ˆä¾‹å¦‚ç”¨æˆ·ç”»åƒã€å…³é”®äº‹ä»¶ç­‰ï¼‰åŠ</span><br><span class="line">     å…¶å†…å®¹ã€‚è¿™é€šå¸¸ç”¨äºå¿«é€Ÿå±•ç¤ºç”¨æˆ·çš„æ ¸å¿ƒä¿¡æ¯ã€‚</span><br><span class="line">   * å·¥ä½œæ–¹å¼: ç›´æ¥è°ƒç”¨ memory_service </span><br><span class="line">     æ¥è·å–æŒ‡å®šç”¨æˆ·å’ŒAgentçš„é»˜è®¤åˆ†ç±»è®°å¿†ã€‚</span><br><span class="line">   * è¯·æ±‚ä½“ (`DefaultCategoriesRequest`): éœ€è¦ user_id, agent_idã€‚</span><br><span class="line">   * å“åº” (`DefaultCategoriesResponse`): </span><br><span class="line">     è¿”å›ä¸€ä¸ªåŒ…å«å„ä¸ªé»˜è®¤åˆ†ç±»åŠå…¶å†…å®¹çš„ç»“æ„ã€‚</span><br><span class="line"></span><br><span class="line">  4. POST /api/v1/memory/retrieve/related-memory-items</span><br><span class="line">   * åŠŸèƒ½: æ£€ç´¢è¯­ä¹‰ç›¸å…³çš„è®°å¿†æ¡ç›®ã€‚</span><br><span class="line">   * æè¿°: è¿™æ˜¯æ ¸å¿ƒçš„è®°å¿†æ£€ç´¢åŠŸèƒ½ã€‚å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼ˆqueryï¼‰ï¼Œåç«¯é€š</span><br><span class="line">     è¿‡è¯­ä¹‰æœç´¢ï¼ˆé€šå¸¸æ˜¯å‘é‡æœç´¢ï¼‰æ¥æŸ¥æ‰¾ä¸è¿™ä¸ªæŸ¥è¯¢æœ€ç›¸å…³çš„è®°å¿†ç‰‡æ®µã€‚</span><br><span class="line">   * å·¥ä½œæ–¹å¼: è°ƒç”¨ memory_serviceï¼Œåè€…ä¼šå°†æŸ¥è¯¢è¯­å¥è½¬æ¢ä¸ºå‘é‡ï¼Œå¹¶åœ¨å‘é‡æ•°</span><br><span class="line">     æ®åº“ä¸­æœç´¢æœ€ç›¸ä¼¼çš„è®°å¿†æ¡ç›®ã€‚</span><br><span class="line">   * è¯·æ±‚ä½“ (`RelatedMemoryItemsRequest`): éœ€è¦ user_id, agent_id, query </span><br><span class="line">     (æŸ¥è¯¢è¯­å¥)ï¼Œä»¥åŠå¯é€‰çš„ top_k (è¿”å›æ•°é‡)ç­‰å‚æ•°ã€‚</span><br><span class="line">   * å“åº” (`RelatedMemoryItemsResponse`): </span><br><span class="line">     è¿”å›ä¸€ä¸ªæŒ‰ç›¸å…³æ€§æ’åºçš„è®°å¿†æ¡ç›®åˆ—è¡¨ã€‚</span><br><span class="line"></span><br><span class="line">  5. POST /api/v1/memory/retrieve/related-clustered-categories</span><br><span class="line">   * åŠŸèƒ½: æ£€ç´¢è¯­ä¹‰ç›¸å…³çš„è®°å¿†ç±»åˆ«ã€‚</span><br><span class="line">   * æè¿°: ä¸ä¸Šä¸€ä¸ªæ¥å£ç±»ä¼¼ï¼Œä½†è¿™ä¸ªæ¥å£æœç´¢çš„æ˜¯ç±»åˆ«ï¼ˆCategoryï¼‰è€Œä¸æ˜¯å•ä¸ª</span><br><span class="line">     è®°å¿†æ¡ç›®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ æƒ³çŸ¥é“â€œå…³äºç”¨æˆ·çš„å®¶åº­ï¼Œæœ‰å“ªäº›ç›¸å…³è®°å¿†ç±»åˆ«ï¼Ÿâ€æ—¶ï¼Œ</span><br><span class="line">     å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥å£ã€‚</span><br><span class="line">   * å·¥ä½œæ–¹å¼: è°ƒç”¨ memory_serviceï¼Œå¯¹â€œç±»åˆ«â€è¿›è¡Œè¯­ä¹‰æœç´¢ã€‚</span><br><span class="line">   * è¯·æ±‚ä½“ (`RelatedClusteredCategoriesRequest`): éœ€è¦ user_id, agent_id,</span><br><span class="line">      category_query (ç±»åˆ«æŸ¥è¯¢è¯­å¥)ç­‰ã€‚</span><br><span class="line">   * å“åº” (`RelatedClusteredCategoriesResponse`): </span><br><span class="line">     è¿”å›ä¸€ä¸ªæŒ‰ç›¸å…³æ€§æ’åºçš„è®°å¿†ç±»åˆ«åˆ—è¡¨ã€‚</span><br></pre></td></tr></table></figure>

<hr>
<h6 id="memory-retrieve-default-categories"><a href="#memory-retrieve-default-categories" class="headerlink" title="memory/retrieve/default-categories"></a><code>memory/retrieve/default-categories</code></h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">  è¯¥ç«¯ç‚¹è´Ÿè´£æ ¸å¿ƒçš„â€œè¯­ä¹‰æœç´¢â€åŠŸèƒ½ï¼Œç”¨äºæŸ¥æ‰¾ä¸ç”¨æˆ·æŸ¥è¯¢ç›¸å…³è”çš„è®°å¿†ã€‚æ­¤è¿‡ç¨‹æ¯”é»˜è®¤åˆ†ç±»æ£€ç´¢æ›´ä¸ºå¤æ‚ï¼Œæ¶‰åŠå‘é‡åµŒå…¥ï¼ˆvector embeddingsï¼‰ã€‚</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  è°ƒç”¨é“¾æ€»è§ˆ:</span><br><span class="line"></span><br><span class="line">  routers/memory.py -&gt; services/memory_service.py -&gt; </span><br><span class="line">  memory/memory_agent.py -&gt; memory/file_manager.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å®Œæ•´æ‰§è¡Œé¡ºåº</span><br><span class="line"></span><br><span class="line">   1. [å®¢æˆ·ç«¯] å‘é€ POST è¯·æ±‚åˆ° </span><br><span class="line">      /api/v1/memory/retrieve/default-categoriesï¼Œè¯·æ±‚ä½“ä¸­åŒ…å« user_id å’Œ </span><br><span class="line">      agent_idã€‚</span><br><span class="line"></span><br><span class="line">   2. [FastAPI] å°†è¯·æ±‚è·¯ç”±åˆ° routers/memory.py çš„ </span><br><span class="line">      retrieve_default_categories å‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line">   3. [`routers/memory.py`]</span><br><span class="line">       * è·å–ä¸€ä¸ª MemoryService å®ä¾‹ã€‚</span><br><span class="line">       * è°ƒç”¨ memory_service.retrieve_default_categories() æ–¹æ³•ï¼Œä¼ å…¥ </span><br><span class="line">         user_id å’Œ agent_idã€‚</span><br><span class="line"></span><br><span class="line">   4. [`services/memory_service.py`]</span><br><span class="line">       * åˆ›å»ºä¸€ä¸ª RecallAgent å®ä¾‹ï¼Œå¹¶ç”¨ user_id å’Œ agent_id </span><br><span class="line">         å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚</span><br><span class="line">       * è°ƒç”¨ recall_agent.retrieve_default_category() æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">   5. [`memory/recall_agent.py`]</span><br><span class="line">       * retrieve_default_category æ–¹æ³•å¼€å§‹æ‰§è¡Œã€‚</span><br><span class="line">       * å®ƒè·å–é¢„è®¾çš„é»˜è®¤åˆ†ç±»åˆ—è¡¨ [<span class="string">&quot;profile&quot;</span>, <span class="string">&quot;event&quot;</span>]ã€‚</span><br><span class="line">       * å®ƒéå†è¿™ä¸ªåˆ—è¡¨ã€‚</span><br><span class="line">       * å¯¹äº <span class="string">&quot;profile&quot;</span>ï¼Œå®ƒè°ƒç”¨ </span><br><span class="line">         self.storage_manager.read_memory_file(<span class="string">&quot;profile&quot;</span>)ã€‚</span><br><span class="line">       * å¯¹äº <span class="string">&quot;event&quot;</span>ï¼Œå®ƒè°ƒç”¨ </span><br><span class="line">         self.storage_manager.read_memory_file(<span class="string">&quot;event&quot;</span>)ã€‚</span><br><span class="line"></span><br><span class="line">   6. [`memory/file_manager.py`] (ç”± RecallAgent è°ƒç”¨)</span><br><span class="line">       * read_memory_file(<span class="string">&quot;profile&quot;</span>) æ–¹æ³•æ ¹æ® agent_id å’Œ user_id </span><br><span class="line">         æ„é€ å‡ºå®Œæ•´è·¯å¾„ï¼Œå¦‚ .../memory/&#123;agent_id&#125;/&#123;user_id&#125;/profile.mdã€‚</span><br><span class="line">       * è¯»å–è¯¥æ–‡ä»¶çš„å…¨éƒ¨æ–‡æœ¬å†…å®¹å¹¶è¿”å›ã€‚</span><br><span class="line">       * å¯¹ <span class="string">&quot;event&quot;</span> æ–‡ä»¶æ‰§è¡Œç›¸åŒæ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">   7. [è¿”å›è·¯å¾„]</span><br><span class="line">       * æ–‡ä»¶å†…å®¹è¿”å›ç»™ RecallAgentã€‚</span><br><span class="line">       * RecallAgent å°†å†…å®¹ç»„è£…æˆä¸€ä¸ªåˆ—è¡¨ï¼Œå†åŒ…è£…æˆå­—å…¸è¿”å›ç»™ </span><br><span class="line">         MemoryServiceã€‚</span><br><span class="line">       * MemoryService å°†è¿™ä¸ªå­—å…¸è½¬æ¢æˆ DefaultCategoriesResponse </span><br><span class="line">         APIæ¨¡å‹å¯¹è±¡ï¼Œè¿”å›ç»™ FastAPI Routerã€‚</span><br><span class="line">       * FastAPI å°†è¯¥å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONï¼Œä½œä¸ºHTTPå“åº”å‘é€å› [å®¢æˆ·ç«¯]ã€‚</span><br></pre></td></tr></table></figure>

<hr>
<h6 id="memory-retrieve-related-memory-items"><a href="#memory-retrieve-related-memory-items" class="headerlink" title="memory/retrieve/related-memory-items"></a><code>memory/retrieve/related-memory-items</code></h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> è°ƒç”¨é“¾æ€»è§ˆ:</span><br><span class="line"></span><br><span class="line">  routers/memory.py -&gt; services/memory_service.py -&gt; memory/recall_agent.py</span><br><span class="line">   -&gt; memory/embeddings.py &amp; memory/file_manager.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å®Œæ•´æ‰§è¡Œé¡ºåº</span><br><span class="line"></span><br><span class="line">   1. [å®¢æˆ·ç«¯] å‘é€å¸¦ query çš„è¯·æ±‚ã€‚</span><br><span class="line">   2. [`routers/memory.py`] å°†è¯·æ±‚å‚æ•°å®Œæ•´ä¼ é€’ç»™ MemoryServiceã€‚</span><br><span class="line">   3. [`services/memory_service.py`]</span><br><span class="line">       * è°ƒç”¨ RecallAgent çš„ retrieve_relevant_memories æ–¹æ³•ï¼Œä¼ å…¥ query </span><br><span class="line">         å’Œ top_kã€‚</span><br><span class="line">       * ç­‰å¾… RecallAgent è¿”å› top_k ä¸ªæœ€ç›¸å…³çš„å€™é€‰ç»“æœã€‚</span><br><span class="line">       * ç”¨å®¢æˆ·ç«¯æŒ‡å®šçš„ `min_similarity` è¿‡æ»¤è¿™ `top_k` ä¸ªç»“æœã€‚</span><br><span class="line">       * å°†æœ€ç»ˆç»“æœæ ¼å¼åŒ–åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</span><br><span class="line">   4. [`memory/recall_agent.py`] (æ ¸å¿ƒ)</span><br><span class="line">       * å°†æ–‡æœ¬ query è½¬æ¢ä¸ºæŸ¥è¯¢å‘é‡ã€‚</span><br><span class="line">       * æ‰¾åˆ°å¹¶éå†æ‰€æœ‰é¢„å…ˆå­˜å‚¨çš„ .json è®°å¿†å‘é‡æ–‡ä»¶ã€‚</span><br><span class="line">       * åœ¨æ–‡ä»¶å†…ï¼Œéå†æ¯ä¸€æ¡è®°å¿†å‘é‡ã€‚</span><br><span class="line">       * è®¡ç®—æŸ¥è¯¢å‘é‡ä¸æ¯æ¡è®°å¿†å‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚</span><br><span class="line">       * æ”¶é›†æ‰€æœ‰ç›¸ä¼¼åº¦ &gt; 0.1 çš„ç»“æœã€‚</span><br><span class="line">       * å¯¹æ‰€æœ‰æ”¶é›†åˆ°çš„ç»“æœæŒ‰ç›¸ä¼¼åº¦æ’åºã€‚</span><br></pre></td></tr></table></figure>

<hr>
<h6 id="memory-retrieve-related-clustered-categories"><a href="#memory-retrieve-related-clustered-categories" class="headerlink" title="memory/retrieve/related-clustered-categories"></a><code>memory/retrieve/related-clustered-categories</code></h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªæ¥å£çš„åŠŸèƒ½æ˜¯æ ¹æ®ç”¨æˆ·æå‡ºçš„ä¸€ä¸ªä¸»é¢˜æˆ–æ¦‚å¿µï¼ˆä¾‹å¦‚â€œå…³äºå·¥ä½œâ€ã€â€œå®¶åº­çŠ¶</span><br><span class="line">å†µâ€ï¼‰ï¼Œæ¥å¯»æ‰¾å¹¶è¿”å›æœ€ç›¸å…³çš„è®°å¿†ç±»åˆ«ã€‚</span><br><span class="line"></span><br><span class="line">è°ƒç”¨é“¾æ€»è§ˆ:</span><br><span class="line"></span><br><span class="line">routers/memory.py -&gt; services/memory_service.py -&gt; </span><br><span class="line">memory/recall_agent.py</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">å®Œæ•´æ‰§è¡Œé¡ºåº</span><br><span class="line"></span><br><span class="line"> <span class="number">1.</span> [å®¢æˆ·ç«¯] å‘é€ POST è¯·æ±‚åˆ° </span><br><span class="line">    /api/v1/memory/retrieve/related-clustered-categoriesï¼Œè¯·æ±‚ä½“ä¸­åŒ…å« </span><br><span class="line">    category_query (ä¸»é¢˜æŸ¥è¯¢)ã€‚</span><br><span class="line"></span><br><span class="line"> <span class="number">2.</span> [FastAPI] å°†è¯·æ±‚è·¯ç”±åˆ° routers/memory.py çš„ </span><br><span class="line">    retrieve_related_clustered_categories å‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line"> <span class="number">3.</span> [`routers/memory.py`]</span><br><span class="line">     * è·å–ä¸€ä¸ª MemoryService å®ä¾‹ã€‚</span><br><span class="line">     * è°ƒç”¨ memory_service.retrieve_related_clustered_categories() </span><br><span class="line">       æ–¹æ³•ï¼Œä¼ å…¥ category_query ç­‰å‚æ•°ã€‚</span><br><span class="line"></span><br><span class="line"> <span class="number">4.</span> [`services/memory_service.py`]</span><br><span class="line">     * åˆ›å»ºä¸€ä¸ª RecallAgent å®ä¾‹ã€‚</span><br><span class="line">     * è°ƒç”¨ recall_agent.retrieve_relevant_category() æ–¹æ³•ã€‚</span><br><span class="line">     * ç­‰å¾… RecallAgent è¿”å› top_k ä¸ªæœ€ç›¸å…³çš„å€™é€‰ç±»åˆ«åŠå…¶åŸå§‹å†…å®¹ã€‚</span><br><span class="line">     * ä½¿ç”¨å®¢æˆ·ç«¯ä¼ å…¥çš„ min_similarity è¿‡æ»¤è¿”å›çš„ç±»åˆ«ã€‚</span><br><span class="line">     * å¯¹äºé€šè¿‡è¿‡æ»¤çš„ç±»åˆ«ï¼Œè°ƒç”¨ _parse_memory_content </span><br><span class="line">       å°†å…¶åŸå§‹æ–‡æœ¬è§£æä¸ºç»“æ„åŒ–è®°å¿†é¡¹ã€‚</span><br><span class="line">     * å°†æœ€ç»ˆç»“æœåŒ…è£…æˆ RelatedClusteredCategoriesResponse å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line"> <span class="number">5.</span> [`memory/recall_agent.py`] (æ ¸å¿ƒ)</span><br><span class="line">     * è·å–æ‰€æœ‰è®°å¿†ç±»åˆ«ï¼Œå¹¶æ’é™¤ profile, event, activity ç­‰ç³»ç»Ÿç±»åˆ«ã€‚</span><br><span class="line">     * éå†å‰©ä½™çš„å€™é€‰ç±»åˆ«ã€‚</span><br><span class="line">     * å¯¹äºæ¯ä¸ªç±»åˆ«ï¼Œè¯»å–å…¶å®Œæ•´æ–‡ä»¶å†…å®¹ã€‚</span><br><span class="line">     * åŠ¨æ€åœ°å°† category_query </span><br><span class="line">       æ–‡æœ¬å’Œè¯¥ç±»åˆ«æ–‡ä»¶çš„å†…å®¹æ‘˜è¦ï¼ˆå‰<span class="number">1000</span>ä¸ªå­—ç¬¦ï¼‰åˆ†åˆ«è½¬æ¢ä¸ºå‘é‡ã€‚</span><br><span class="line">     * è®¡ç®—è¿™ä¸¤ä¸ªå‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œä½œä¸ºè¯¥ç±»åˆ«çš„ç›¸å…³æ€§åˆ†æ•°ã€‚</span><br><span class="line">     * æ”¶é›†æ‰€æœ‰ç±»åˆ«çš„åˆ†æ•°åï¼Œè¿›è¡Œæ’åºã€‚</span><br><span class="line">     * è¿”å›åˆ†æ•°æœ€é«˜çš„ top_k ä¸ªç±»åˆ«ï¼ˆåŒ…å«å…¶å®Œæ•´åŸå§‹å†…å®¹ï¼‰ç»™ </span><br><span class="line">       MemoryServiceã€‚</span><br><span class="line"></span><br><span class="line"> <span class="number">6.</span> [è¿”å›è·¯å¾„]</span><br><span class="line">     * MemoryService å¤„ç†å®Œæ•°æ®åï¼Œå°† RelatedClusteredCategoriesResponse</span><br><span class="line">        å¯¹è±¡è¿”å›ç»™ FastAPI Routerã€‚</span><br><span class="line">     * FastAPI å°†è¯¥å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONï¼Œä½œä¸ºHTTPå“åº”å‘é€å› [å®¢æˆ·ç«¯]ã€‚  </span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<hr>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p> MemUæ˜¯ä¸€ä¸ªå¯Œæœ‰è¿œè§çš„AIä¼´ä¾£è®°å¿†æ¡†æ¶ã€‚å®ƒä¸æ»¡è¶³äºè®©AIâ€œè®°ä½â€ï¼Œè€Œæ˜¯è‡´åŠ›äºè®©AIåƒäººä¸€æ ·â€œç†è§£å’Œç»„ç»‡â€è‡ªå·±çš„è®°å¿†ã€‚é€šè¿‡ä¸€ç³»åˆ—ç”±å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é©±åŠ¨çš„æ™ºèƒ½å·¥å…·ï¼Œå®ƒæ„å»ºäº†ä¸€ä¸ªèƒ½å¤Ÿè‡ªæˆ‘æ¼”åŒ–ã€å…³è”å’ŒæŠ½è±¡çš„åŠ¨æ€è®°å¿†ç½‘ç»œã€‚</p>
<p>  <strong>æ ¸å¿ƒä¼˜åŠ¿ä¸èƒ½åŠ›ï¼š</strong></p>
<ul>
<li><p>åŠ¨æ€çš„è‡ªç»„ç»‡èƒ½åŠ›: å®ƒæœ€å¤§çš„äº®ç‚¹æ˜¯èƒ½å¤Ÿè‡ªåŠ¨ä»é›¶æ•£çš„å¯¹è¯ä¸­â€œå‘ç°â€å¹¶â€œåˆ›é€ â€å‡ºæ–°çš„ä¸»é¢˜ï¼ˆå¦‚programming_assistance.mdï¼‰ï¼Œå¹¶å°†ç›¸å…³çš„è®°å¿†è¿›è¡Œèšç±»ã€‚åŒæ—¶ï¼Œå®ƒè¿˜èƒ½é€šè¿‡LinkRelatedMemoriesActionåœ¨ä¸åŒè®°å¿†ä¹‹é—´å»ºç«‹é“¾æ¥ï¼Œå°†å­¤ç«‹çš„ä¿¡æ¯ç‚¹ç¼–ç»‡æˆä¸€å¼ ç›¸äº’å…³è”çš„çŸ¥è¯†ç½‘ç»œï¼Œè®©AIå…·å¤‡è”æƒ³å’Œä¸¾ä¸€åä¸‰çš„èƒ½åŠ›ã€‚</p>
</li>
<li><p>æ‹ŸäººåŒ–çš„è®°å¿†æ›´æ–°ä¸é—å¿˜: å®ƒé€šè¿‡â€œè¯»å–-é‡å†™â€çš„æ¨¡å¼ï¼Œè®©LLMåœ¨å……åˆ†ç†è§£ä¸Šä¸‹æ–‡åï¼Œæ™ºèƒ½åœ°æ›´æ–°ã€ä¿®æ­£ç”šè‡³â€œé—å¿˜â€ï¼ˆåœ¨é‡å†™æ—¶çœç•¥ï¼‰è¿‡æ—¶çš„ä¿¡æ¯ã€‚è¿™æ¨¡æ‹Ÿäº†äººç±»è®°å¿†åŠ¨æ€ã€éæœºæ¢°çš„ç‰¹ç‚¹ï¼Œä½¿AIä¼´ä¾£çš„æˆé•¿æ›´ä¸ºè‡ªç„¶ã€‚</p>
</li>
<li><p>çµæ´»çš„åˆ†å±‚æ£€ç´¢: æ¡†æ¶æä¾›äº†ä»â€œå¿«é€Ÿäº‹å®æŸ¥è¯¢â€åˆ°â€œæ·±åº¦è¯­ä¹‰æœç´¢â€å†åˆ°â€œä¸»é¢˜æ¢ç´¢â€çš„å¤šç§æ£€ç´¢æ¨¡å¼ï¼Œä½¿AIå¯ä»¥æ ¹æ®å¯¹è¯éœ€è¦ï¼Œçµæ´»åœ°è°ƒç”¨ä¸åŒå±‚æ¬¡çš„è®°å¿†ï¼Œè¿›è¡Œæ›´æœ‰ç­–ç•¥æ€§çš„å›åº”ã€‚</p>
</li>
</ul>
<p>  <strong>ä¸»è¦å±€é™ä¸æŒ‘æˆ˜ï¼š</strong></p>
<ul>
<li>é«˜æ˜‚çš„è¿è¡Œæˆæœ¬: å…¶æ ¸å¿ƒçš„â€œæ™ºèƒ½åŒ–â€ä¸¥é‡ä¾èµ–å¤§æ¨¡å‹çš„å®æ—¶åˆ†æå’Œé‡å†™èƒ½åŠ›ï¼Œè¿™å¯¼è‡´äº†æé«˜çš„Tokenæ¶ˆè€—ã€‚æ¯ä¸€æ¬¡è®°å¿†çš„æ•´åˆéƒ½å¯èƒ½æ˜¯ä¸€æ¬¡æ˜‚è´µçš„APIè°ƒç”¨ï¼Œè¿™æ˜¯å…¶å¤§è§„æ¨¡åº”ç”¨é¢ä¸´çš„æœ€ä¸»è¦éšœç¢ã€‚</li>
<li>ä¼ ç»Ÿçš„å¯æ‰©å±•æ€§ç“¶é¢ˆ: å½“å‰åŸºäºæ–‡ä»¶ç³»ç»Ÿå’Œæš´åŠ›å‘é‡æœç´¢çš„å®ç°ï¼Œåœ¨é¢å¯¹é•¿æœŸäº¤äº’æ‰€äº§ç”Ÿçš„æµ·é‡æ•°æ®æ—¶ï¼Œä¼šè¿…é€Ÿé­é‡æ€§èƒ½ç“¶é¢ˆã€‚è‹¥ä¸å¼•å…¥ä¸“ä¸šçš„å‘é‡æ•°æ®åº“å’Œæ›´é«˜æ•ˆçš„å­˜å‚¨æ–¹æ¡ˆï¼Œç³»ç»Ÿå°†éš¾ä»¥ä¸ºç»§ã€‚</li>
<li>â€œé»‘ç›’â€ä¾èµ–ä¸æ§åˆ¶åŠ›ç¼ºå¤±: å°†è®°å¿†çš„ç»„ç»‡ã€æ›´æ–°å’Œé—å¿˜ç­‰æ ¸å¿ƒé€»è¾‘å®Œå…¨å§”æ‰˜ç»™LLMï¼Œä½¿å…¶è¡Œä¸ºå…·æœ‰ä¸å¯é¢„æµ‹æ€§ï¼Œè°ƒè¯•å›°éš¾ã€‚åŒæ—¶ï¼Œæ¡†æ¶ç¼ºå°‘è®©ç”¨æˆ·æˆ–å¼€å‘è€…èƒ½â€œæ‰‹æœ¯åˆ€å¼â€ç²¾ç¡®åˆ é™¤æˆ–ä¿®æ”¹å•æ¡é”™è¯¯è®°å¿†çš„ç›´æ¥APIï¼Œè¿™åœ¨éœ€è¦é«˜åº¦ç”¨æˆ·ä¿¡ä»»çš„ä¼´ä¾£åœºæ™¯ä¸­æ˜¯ä¸€ä¸ªæ˜¾è‘—çš„ç¼ºé™·ã€‚</li>
</ul>
<hr>
<h4 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h4><p>ç›®å‰è®°å¿†åŠŸèƒ½çš„å®ç°æ€è·¯æ˜¯é€šè¿‡æ¯æ—¥æ€»ç»“æ³¨å…¥åˆ°æç¤ºè¯ï¼Œä½†å¯ä»¥é¢„è§çš„æ˜¯ï¼š</p>
<ul>
<li>æ€»ç»“çš„å†…å®¹ä¸å¤Ÿç»†ï¼Œä¼šé—æ¼å†…å®¹ï¼ˆä¹Ÿç¡®å®ä¸æƒ³è®©æ€»ç»“çš„å¤ªç»†ï¼‰</li>
<li>æ³¨å…¥æ¨¡å¼ä¸çµæ´»ï¼Œç›´æ¥ä¸€æŠŠæ³¨å…¥ï¼Œæ²¡æœ‰embeddingåè¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—æœºåˆ¶</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%81%8A%E5%A4%A9%E5%8E%86%E5%8F%B2/" rel="tag"># èŠå¤©å†å²</a>
              <a href="/tags/%E8%AE%B0%E5%BF%86/" rel="tag"># è®°å¿†</a>
              <a href="/tags/MemU/" rel="tag"># MemU</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/09/19/%E6%8A%96%E9%9F%B3%E6%8E%A5%E6%94%B6%E4%B8%8E%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%EF%BC%88%E5%BC%B9%E5%B9%95%E8%AF%84%E8%AE%BA%E7%9B%B8%E5%85%B3%EF%BC%89%E8%B0%83%E7%A0%94/" rel="prev" title="æŠ–éŸ³æ¥æ”¶ä¸å‘é€æ¶ˆæ¯ï¼ˆå¼¹å¹•è¯„è®ºç›¸å…³ï¼‰è°ƒç ”">
                  <i class="fa fa-angle-left"></i> æŠ–éŸ³æ¥æ”¶ä¸å‘é€æ¶ˆæ¯ï¼ˆå¼¹å¹•è¯„è®ºç›¸å…³ï¼‰è°ƒç ”
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/10/17/%E5%9F%BA%E4%BA%8EYOLO-V8%E7%9A%84%E7%84%8A%E6%8E%A5%E7%BC%BA%E9%99%B7%E6%A3%80%E6%B5%8B%E8%AF%B4%E6%98%8E%E5%8F%8A%E4%BB%A3%E7%A0%81/" rel="next" title="åŸºäºYOLO V8çš„ç„Šæ¥ç¼ºé™·æ£€æµ‹è¯´æ˜åŠä»£ç ">
                  åŸºäºYOLO V8çš„ç„Šæ¥ç¼ºé™·æ£€æµ‹è¯´æ˜åŠä»£ç  <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Chr</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">446k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">27:01</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","src":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
