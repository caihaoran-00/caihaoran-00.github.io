<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"caihaoran-00.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前言前面我们一起看了MCP基础：从原理到实战，重点讲解了MCP的原理，并进行了一些实战，今天一起看下进阶篇，主要包含三个方面：  写一个MCP  Server 截获MCP Server的输入和输出，分析MCP底层协议 回头想MCP的含义和定位&#x2F;扮演的角色">
<meta property="og:type" content="article">
<meta property="og:title" content="MCP进阶：带你深入掌握MCP">
<meta property="og:url" content="https://caihaoran-00.github.io/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/index.html">
<meta property="og:site_name" content="Chr&#39;s Blog">
<meta property="og:description" content="前言前面我们一起看了MCP基础：从原理到实战，重点讲解了MCP的原理，并进行了一些实战，今天一起看下进阶篇，主要包含三个方面：  写一个MCP  Server 截获MCP Server的输入和输出，分析MCP底层协议 回头想MCP的含义和定位&#x2F;扮演的角色">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/image-20250619145352329.png">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/image-20250619150040766.png">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/image-20250619164316647.png">
<meta property="article:published_time" content="2025-06-12T10:06:16.000Z">
<meta property="article:modified_time" content="2025-06-20T03:34:10.220Z">
<meta property="article:author" content="Chr">
<meta property="article:tag" content="agent">
<meta property="article:tag" content="mcp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://caihaoran-00.github.io/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/image-20250619145352329.png">


<link rel="canonical" href="https://caihaoran-00.github.io/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://caihaoran-00.github.io/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/","path":"2025/06/12/MCP进阶：带你深入掌握MCP/","title":"MCP进阶：带你深入掌握MCP"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MCP进阶：带你深入掌握MCP | Chr's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Chr's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Record and Share</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A3%E6%96%87"><span class="nav-number">2.</span> <span class="nav-text">正文</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E4%B8%80%E4%B8%AAMCP-Server"><span class="nav-number">2.1.</span> <span class="nav-text">写一个MCP Server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%9E%90MCP%E5%BA%95%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="nav-number">2.2.</span> <span class="nav-text">分析MCP底层协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8MCP%E5%BA%95%E5%B1%82%E5%8D%8F%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8EMCP-Server%E9%80%9A%E4%BF%A1"><span class="nav-number">2.2.1.</span> <span class="nav-text">使用MCP底层协议直接与MCP Server通信</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B6%85%E8%B6%8A%E8%A1%A8%E8%B1%A1%EF%BC%9AMCP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%9C%9F%E5%AE%9E%E5%90%AB%E4%B9%89%E4%B8%8E%E5%AE%9A%E4%BD%8D"><span class="nav-number">2.3.</span> <span class="nav-text">超越表象：MCP协议的真实含义与定位</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-number">3.</span> <span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#weather-py%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A"><span class="nav-number">3.1.</span> <span class="nav-text">weather.py代码解释</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">4.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chr</p>
  <div class="site-description" itemprop="description">Welcome to my little world</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">91</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:1299964565@qq.com" title="E-Mail → mailto:1299964565@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://caihaoran-00.github.io/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chr">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chr's Blog">
      <meta itemprop="description" content="Welcome to my little world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="MCP进阶：带你深入掌握MCP | Chr's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MCP进阶：带你深入掌握MCP
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-06-12 18:06:16" itemprop="dateCreated datePublished" datetime="2025-06-12T18:06:16+08:00">2025-06-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-06-20 11:34:10" itemprop="dateModified" datetime="2025-06-20T11:34:10+08:00">2025-06-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>17 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前面我们一起看了<a href="https://caihaoran-00.github.io/2025/06/09/MCP%E5%9F%BA%E7%A1%80%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%90%86%E5%88%B0%E5%AE%9E%E6%88%98/">MCP基础：从原理到实战</a>，重点讲解了<code>MCP</code>的原理，并进行了一些实战，今天一起看下进阶篇，主要包含三个方面：</p>
<ul>
<li>写一个<code>MCP  Server</code></li>
<li>截获<code>MCP Server的输入和输出</code>，分析<code>MCP</code>底层协议</li>
<li>回头想<code>MCP</code>的含义和定位&#x2F;扮演的角色</li>
</ul>
<span id="more"></span>

<hr>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="写一个MCP-Server"><a href="#写一个MCP-Server" class="headerlink" title="写一个MCP Server"></a>写一个<code>MCP Server</code></h3><p>以下选择<code>Python</code>作为编程语言进行<code>MCP Server</code>的编写，关于<code>uv</code>的安装可以参考参考链接1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化项目</span></span><br><span class="line">uv init weather</span><br><span class="line"><span class="built_in">cd</span> weather</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并激活虚拟环境</span></span><br><span class="line">uv venv</span><br><span class="line"><span class="built_in">source</span> .venv/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加依赖</span></span><br><span class="line">uv add <span class="string">&quot;mcp[cli]&quot;</span> httpx</span><br></pre></td></tr></table></figure>

<p>使用<code>VScode</code>打开刚才创建的<code>weather</code>项目，创建<code>weather.py</code>，将下面的代码复制到你的文件中（代码的解析放在文末）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> mcp.server.fastmcp <span class="keyword">import</span> FastMCP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize FastMCP server</span></span><br><span class="line">mcp = FastMCP(<span class="string">&quot;weather&quot;</span>, log_level=<span class="string">&quot;ERROR&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Constants</span></span><br><span class="line">NWS_API_BASE = <span class="string">&quot;https://api.weather.gov&quot;</span></span><br><span class="line">USER_AGENT = <span class="string">&quot;weather-app/1.0&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">make_nws_request</span>(<span class="params">url: <span class="built_in">str</span></span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] | <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Make a request to the NWS API with proper error handling.&quot;&quot;&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: USER_AGENT,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/geo+json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient() <span class="keyword">as</span> client:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = <span class="keyword">await</span> client.get(url, headers=headers, timeout=<span class="number">30.0</span>)</span><br><span class="line">            response.raise_for_status()</span><br><span class="line">            <span class="keyword">return</span> response.json()</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_alert</span>(<span class="params">feature: <span class="built_in">dict</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Format an alert feature into a readable string.&quot;&quot;&quot;</span></span><br><span class="line">    props = feature[<span class="string">&quot;properties&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Event: <span class="subst">&#123;props.get(<span class="string">&#x27;event&#x27;</span>, <span class="string">&#x27;Unknown&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">Area: <span class="subst">&#123;props.get(<span class="string">&#x27;areaDesc&#x27;</span>, <span class="string">&#x27;Unknown&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">Severity: <span class="subst">&#123;props.get(<span class="string">&#x27;severity&#x27;</span>, <span class="string">&#x27;Unknown&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">Description: <span class="subst">&#123;props.get(<span class="string">&#x27;description&#x27;</span>, <span class="string">&#x27;No description available&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">Instructions: <span class="subst">&#123;props.get(<span class="string">&#x27;instruction&#x27;</span>, <span class="string">&#x27;No specific instructions provided&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_alerts</span>(<span class="params">state: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Get weather alerts for a US state.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        state: Two-letter US state code (e.g. CA, NY)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    url = <span class="string">f&quot;<span class="subst">&#123;NWS_API_BASE&#125;</span>/alerts/active/area/<span class="subst">&#123;state&#125;</span>&quot;</span></span><br><span class="line">    data = <span class="keyword">await</span> make_nws_request(url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> <span class="string">&quot;features&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unable to fetch alerts or no alerts found.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data[<span class="string">&quot;features&quot;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No active alerts for this state.&quot;</span></span><br><span class="line"></span><br><span class="line">    alerts = [format_alert(feature) <span class="keyword">for</span> feature <span class="keyword">in</span> data[<span class="string">&quot;features&quot;</span>]]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n---\n&quot;</span>.join(alerts)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_forecast</span>(<span class="params">latitude: <span class="built_in">float</span>, longitude: <span class="built_in">float</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Get weather forecast for a location.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        latitude: Latitude of the location</span></span><br><span class="line"><span class="string">        longitude: Longitude of the location</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># First get the forecast grid endpoint</span></span><br><span class="line">    points_url = <span class="string">f&quot;<span class="subst">&#123;NWS_API_BASE&#125;</span>/points/<span class="subst">&#123;latitude&#125;</span>,<span class="subst">&#123;longitude&#125;</span>&quot;</span></span><br><span class="line">    points_data = <span class="keyword">await</span> make_nws_request(points_url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> points_data:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unable to fetch forecast data for this location.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Get the forecast URL from the points response</span></span><br><span class="line">    forecast_url = points_data[<span class="string">&quot;properties&quot;</span>][<span class="string">&quot;forecast&quot;</span>]</span><br><span class="line">    forecast_data = <span class="keyword">await</span> make_nws_request(forecast_url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> forecast_data:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unable to fetch detailed forecast.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Format the periods into a readable forecast</span></span><br><span class="line">    periods = forecast_data[<span class="string">&quot;properties&quot;</span>][<span class="string">&quot;periods&quot;</span>]</span><br><span class="line">    forecasts = []</span><br><span class="line">    <span class="keyword">for</span> period <span class="keyword">in</span> periods[:<span class="number">5</span>]:  <span class="comment"># Only show next 5 periods</span></span><br><span class="line">        forecast = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"><span class="subst">&#123;period[<span class="string">&#x27;name&#x27;</span>]&#125;</span>:</span></span><br><span class="line"><span class="string">Temperature: <span class="subst">&#123;period[<span class="string">&#x27;temperature&#x27;</span>]&#125;</span>°<span class="subst">&#123;period[<span class="string">&#x27;temperatureUnit&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">Wind: <span class="subst">&#123;period[<span class="string">&#x27;windSpeed&#x27;</span>]&#125;</span> <span class="subst">&#123;period[<span class="string">&#x27;windDirection&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">Forecast: <span class="subst">&#123;period[<span class="string">&#x27;detailedForecast&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        forecasts.append(forecast)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n---\n&quot;</span>.join(forecasts)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># Initialize and run the server</span></span><br><span class="line">    mcp.run(transport=<span class="string">&#x27;stdio&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>接下来需要把这个<code>MCP Server</code>注册到<code>Cline</code>中，在参考链接1中有详细过程，这里简述一下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">点击侧边栏cline-&gt; MCP Severs -&gt; Installed -&gt; Configure MCP Servers</span><br></pre></td></tr></table></figure>

<p>这时候就会创建一个<code>clien_mcp_settings.json</code>，将下面内容复制进去：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mcpServers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;weather&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;disabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timeout&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uv&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;--directory&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;/home/chr/桌面/weather&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;run&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;weather.py&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;transportType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stdio&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：</p>
<ul>
<li><code>/home/chr/桌面/weather</code>是我的<code>weather.py</code>的绝对路径，需换成你的绝对路径</li>
<li>默认的<code>transportType</code>就是<code>stdio</code>，这里写出来只是为了说明有这个参数</li>
</ul>
</blockquote>
<p>然后你就可以问<code>Clien</code>天气信息了，比如：纽约明天天气怎么样。</p>
<hr>
<h3 id="分析MCP底层协议"><a href="#分析MCP底层协议" class="headerlink" title="分析MCP底层协议"></a>分析<code>MCP</code>底层协议</h3><p>那么自己创建了一个<code>MCP Server</code>，但我们并不知道<code>MCP</code>这个协议是如何运行的，因为<code>MCP</code>的库报我们完成了很多东西，我们并不知道它帮我们做了什么，那如何才能知道呢？首先大家需要知道的是，大部分<code>MCP Server</code>都是通过输出和输出与<code>MCP Host</code>进行通信的。</p>
<img src="/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/image-20250619145352329.png" class="" title="image-20250619145352329">

<p>如果这个<code>MCP Server</code>是在我们终端中启动的，那我们就可以直接看到它的输入和输出，但这些<code>MCP Server</code>是<code>Cline</code>启动的，只有<code>Cline</code>能看到，所以佬就想到通过一个叫做<code>mcp_logger.py</code>的脚本来截取<code>weather.py</code>的输入和输出</p>
<img src="/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/image-20250619150040766.png" class="" title="image-20250619150040766">

<p><code>mcp_logger.py</code>的内容见<a target="_blank" rel="noopener" href="https://github.com/MarkTechStation/VideoCode/blob/main/MCP%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97-%E8%BF%9B%E9%98%B6%E7%AF%87/weather/mcp_logger.py">这里</a>，创建该文件在<code>weather</code>项目中，然后修改下<code>cline_mcp_settings.json</code>的内容，更改启动参数：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mcpServers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;weather&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;disabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;timeout&quot;</span><span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;python&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;/home/chr/桌面/weather/mcp_logger.py&quot;</span></span><br><span class="line">        <span class="string">&quot;uv&quot;</span></span><br><span class="line">        <span class="string">&quot;--directory&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;/home/chr/桌面/weather&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;run&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;weather.py&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;transportType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;stdio&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>保存后就会在<code>/home/chr/桌面/weather/</code>目录下出现<code>mcp_io.log</code>，内容如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">输入: &#123;&quot;method&quot;:&quot;initialize&quot;,&quot;params&quot;:&#123;&quot;protocolVersion&quot;:&quot;2025-03-26&quot;,&quot;capabilities&quot;:&#123;&#125;,&quot;clientInfo&quot;:&#123;&quot;name&quot;:&quot;Cline&quot;,&quot;version&quot;:&quot;3.17.12&quot;&#125;&#125;,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:0&#125;</span><br><span class="line"></span><br><span class="line">输出: &#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:0,&quot;result&quot;:&#123;&quot;protocolVersion&quot;:&quot;2025-03-26&quot;,&quot;capabilities&quot;:&#123;&quot;experimental&quot;:&#123;&#125;,&quot;prompts&quot;:&#123;&quot;listChanged&quot;:false&#125;,&quot;resources&quot;:&#123;&quot;subscribe&quot;:false,&quot;listChanged&quot;:false&#125;,&quot;tools&quot;:&#123;&quot;listChanged&quot;:false&#125;&#125;,&quot;serverInfo&quot;:&#123;&quot;name&quot;:&quot;weather&quot;,&quot;version&quot;:&quot;1.9.4&quot;&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">输入: &#123;&quot;method&quot;:&quot;notifications/initialized&quot;,&quot;jsonrpc&quot;:&quot;2.0&quot;&#125;</span><br><span class="line"></span><br><span class="line">输入: &#123;&quot;method&quot;:&quot;tools/list&quot;,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1&#125;</span><br><span class="line"></span><br><span class="line">输出: &#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;result&quot;:&#123;&quot;tools&quot;:[&#123;&quot;name&quot;:&quot;get<span class="built_in">_</span>alerts&quot;,&quot;description&quot;:&quot;Get weather alerts for a US state.<span class="keyword">\n</span><span class="keyword">\nArgs</span>:<span class="keyword">\n</span>    state: Two-letter US state code (e.g. CA, NY)<span class="keyword">\n</span>&quot;,&quot;inputSchema&quot;:&#123;&quot;properties&quot;:&#123;&quot;state&quot;:&#123;&quot;title&quot;:&quot;State&quot;,&quot;type&quot;:&quot;string&quot;&#125;&#125;,&quot;required&quot;:[&quot;state&quot;],&quot;title&quot;:&quot;get<span class="built_in">_</span>alertsArguments&quot;,&quot;type&quot;:&quot;object&quot;&#125;&#125;,&#123;&quot;name&quot;:&quot;get<span class="built_in">_</span>forecast&quot;,&quot;description&quot;:&quot;Get weather forecast for a location.<span class="keyword">\n</span><span class="keyword">\nArgs</span>:<span class="keyword">\n</span>    latitude: Latitude of the location<span class="keyword">\n</span>    longitude: Longitude of the location<span class="keyword">\n</span>&quot;,&quot;inputSchema&quot;:&#123;&quot;properties&quot;:&#123;&quot;latitude&quot;:&#123;&quot;title&quot;:&quot;Latitude&quot;,&quot;type&quot;:&quot;number&quot;&#125;,&quot;longitude&quot;:&#123;&quot;title&quot;:&quot;Longitude&quot;,&quot;type&quot;:&quot;number&quot;&#125;&#125;,&quot;required&quot;:[&quot;latitude&quot;,&quot;longitude&quot;],&quot;title&quot;:&quot;get<span class="built_in">_</span>forecastArguments&quot;,&quot;type&quot;:&quot;object&quot;&#125;&#125;]&#125;&#125;</span><br><span class="line"></span><br><span class="line">输入: &#123;&quot;method&quot;:&quot;resources/list&quot;,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:2&#125;</span><br><span class="line"></span><br><span class="line">输出: &#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:2,&quot;result&quot;:&#123;&quot;resources&quot;:[]&#125;&#125;</span><br><span class="line"></span><br><span class="line">输入: &#123;&quot;method&quot;:&quot;resources/templates/list&quot;,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:3&#125;</span><br><span class="line"></span><br><span class="line">输出: &#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:3,&quot;result&quot;:&#123;&quot;resourceTemplates&quot;:[]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>注意：<code>输入：</code>和<code>输出：</code>是<code>mcp_logger.py</code>加的，不属于<code>Cline</code>与<code>MCP Server</code>的交互内容，输入指的是：<code>Cline-&gt;MCP Server</code>，输出反之。咱们看下第一部分：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;initialize&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;protocolVersion&quot;</span><span class="punctuation">:</span><span class="string">&quot;2025-03-26&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;capabilities&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;clientInfo&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Cline&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="string">&quot;3.17.12&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这是<code>Cline</code>告诉<code>MCP  Server</code>：你好，我是<code>Cline</code>，我的版本号是<code>3.17.12</code>，我用的协议版本是<code>2025-03-26</code>发布的。</p>
<p>第二部分：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;protocolVersion&quot;</span><span class="punctuation">:</span><span class="string">&quot;2025-03-26&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;capabilities&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;experimental&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;prompts&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;listChanged&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;subscribe&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;listChanged&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;listChanged&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;serverInfo&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;weather&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="string">&quot;1.9.4&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这是<code>MCP  Server</code>回复<code>Cline</code>：你也好，我用的协议版本也是<code>2025-03-26</code>发布的，我有一些能力是不支持的哦，分别是…，对了，我的名字叫做<code>weather</code>，版本号<code>1.9.4</code>，很高兴认识你。</p>
<p>第三和第四部分依次是<code>Cline</code>发送给<code>MCP  Server</code>：</p>
<ul>
<li>收到</li>
<li>给我下工具列表</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;notifications/initialized&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;tools/list&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>第五部分，<code>MCP  Server</code>回复<code>Cline</code>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_alerts&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;Get weather alerts for a US state.\n\nArgs:\n    state: Two-letter US state 									code (e.g. CA, NY)\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;inputSchema&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;State&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;string&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;state&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_alertsArguments&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;object&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_forecast&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;Get weather forecast for a location.\n\nArgs:\n    latitude: Latitude of the 					location\n    longitude: Longitude of the location\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;inputSchema&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;latitude&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Latitude&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;number&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;longitude&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Longitude&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;number&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;required&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;latitude&quot;</span><span class="punctuation">,</span><span class="string">&quot;longitude&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_forecastArguments&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;object&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以看出，其包含两个<code>tool</code>，一个是<code>get_alerts</code>，另一个是<code>get_forecast</code>，遵循的是同一种格式，我们以<code>get_forecast</code>为例进行讲解：</p>
<ul>
<li><p><code>name</code>-&gt;工具名，<code>weather.py</code>中定义的工具名：<code>get_forecast</code></p>
</li>
<li><p><code>description</code>-&gt;描述，<code>weather.py</code>中定义的工具函数中的描述（<code>docstring</code>）</p>
</li>
<li><p><code>inputSchema</code>：用于指定数据的输入格式规范，遵循的是<code>Json Schema</code>规范</p>
<blockquote>
<p><code>Json Schema</code>本身是<code>Json</code>，但能够用来描述另一个<code>Json</code>的结构。</p>
</blockquote>
</li>
</ul>
<p>注意：上述<code>Json</code>信息均是通过<code>@mcp.tool</code>这个装饰器自动提取的。</p>
<p>剩下的部分是<code>Cline</code>询问<code>MCP  Server</code>有没有资源和资源列表可用，<code>MCP Server</code>的回答都是没有：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;resources/list&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;resources/templates/list&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;resourceTemplates&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里先不展开讲资源和资源列表是什么。</p>
</blockquote>
<p>到此时，<code>Cline</code>对<code>MCP Server</code>的摸底就结束了，它就先不说话了，这一切都发生在注册工具的一瞬间，后续就是等待合适的时机使用<code>MCP Server</code>了。</p>
<p>我们再次询问<code>Cline</code>：明天纽约天气怎么样？回答完毕后，我们再打开<code>mcp_io.log</code>，原文如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">输入<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;initialize&quot;</span><span class="punctuation">,</span><span class="attr">&quot;params&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;protocolVersion&quot;</span><span class="punctuation">:</span><span class="string">&quot;2025-03-26&quot;</span><span class="punctuation">,</span><span class="attr">&quot;capabilities&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;clientInfo&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Cline&quot;</span><span class="punctuation">,</span><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="string">&quot;3.17.12&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">输出<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;protocolVersion&quot;</span><span class="punctuation">:</span><span class="string">&quot;2025-03-26&quot;</span><span class="punctuation">,</span><span class="attr">&quot;capabilities&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;experimental&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;prompts&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;listChanged&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;subscribe&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;listChanged&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;listChanged&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;serverInfo&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;weather&quot;</span><span class="punctuation">,</span><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span><span class="string">&quot;1.9.4&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">输入<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;notifications/initialized&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">输入<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;tools/list&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">输出<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_alerts&quot;</span><span class="punctuation">,</span><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;Get weather alerts for a US state.\n\nArgs:\n    state: Two-letter US state code (e.g. CA, NY)\n&quot;</span><span class="punctuation">,</span><span class="attr">&quot;inputSchema&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;state&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;State&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;required&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;state&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_alertsArguments&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;object&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_forecast&quot;</span><span class="punctuation">,</span><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span><span class="string">&quot;Get weather forecast for a location.\n\nArgs:\n    latitude: Latitude of the location\n    longitude: Longitude of the location\n&quot;</span><span class="punctuation">,</span><span class="attr">&quot;inputSchema&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;latitude&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Latitude&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;number&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;longitude&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;Longitude&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;number&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;required&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;latitude&quot;</span><span class="punctuation">,</span><span class="string">&quot;longitude&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_forecastArguments&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;object&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">输入<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;resources/list&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span></span><br><span class="line">输出<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;resources&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">输入<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;resources/templates/list&quot;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">&#125;</span></span><br><span class="line">输出<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;resourceTemplates&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">输入<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;tools/call&quot;</span><span class="punctuation">,</span><span class="attr">&quot;params&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_forecast&quot;</span><span class="punctuation">,</span><span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;latitude&quot;</span><span class="punctuation">:</span><span class="number">40.7128</span><span class="punctuation">,</span><span class="attr">&quot;longitude&quot;</span><span class="punctuation">:</span><span class="number">-74.006</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">输出<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;\nTonight:\nTemperature: 71°F\nWind: 5 mph SW\nForecast: A chance of showers and thunderstorms before 11pm, then a slight chance of showers and thunderstorms between 11pm and 2am. Mostly cloudy, with a low around 71. Southwest wind around 5 mph. Chance of precipitation is 30%.\n\n---\n\nJuneteenth:\nTemperature: 86°F\nWind: 5 to 14 mph SW\nForecast: A chance of showers and thunderstorms after 2pm. Some of the storms could be severe. Mostly sunny, with a high near 86. Southwest wind 5 to 14 mph. Chance of precipitation is 50%. New rainfall amounts between a tenth and quarter of an inch possible.\n\n---\n\nThursday Night:\nTemperature: 70°F\nWind: 12 to 15 mph W\nForecast: A chance of showers and thunderstorms before 11pm, then a chance of showers and thunderstorms between 11pm and 2am. Some of the storms could be severe. Mostly cloudy, with a low around 70. West wind 12 to 15 mph. Chance of precipitation is 50%. New rainfall amounts between a quarter and half of an inch possible.\n\n---\n\nFriday:\nTemperature: 81°F\nWind: 13 mph W\nForecast: Sunny, with a high near 81. West wind around 13 mph.\n\n---\n\nFriday Night:\nTemperature: 70°F\nWind: 6 to 10 mph W\nForecast: Mostly clear, with a low around 70. West wind 6 to 10 mph.\n&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;isError&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>咱们只看新增部分：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;method&quot;</span><span class="punctuation">:</span><span class="string">&quot;tools/call&quot;</span><span class="punctuation">,</span><span class="attr">&quot;params&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;get_forecast&quot;</span><span class="punctuation">,</span><span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;latitude&quot;</span><span class="punctuation">:</span><span class="number">40.7128</span><span class="punctuation">,</span><span class="attr">&quot;longitude&quot;</span><span class="punctuation">:</span><span class="number">-74.006</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">输出<span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;jsonrpc&quot;</span><span class="punctuation">:</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;result&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span><span class="punctuation">,</span><span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;\nTonight:\nTemperature: 71°F\nWind: 5 mph SW\nForecast: A chance of showers and thunderstorms before 11pm, then a slight chance of showers and thunderstorms between 11pm and 2am. Mostly cloudy, with a low around 71. Southwest wind around 5 mph. Chance of precipitation is 30%.\n\n---\n\nJuneteenth:\nTemperature: 86°F\nWind: 5 to 14 mph SW\nForecast: A chance of showers and thunderstorms after 2pm. Some of the storms could be severe. Mostly sunny, with a high near 86. Southwest wind 5 to 14 mph. Chance of precipitation is 50%. New rainfall amounts between a tenth and quarter of an inch possible.\n\n---\n\nThursday Night:\nTemperature: 70°F\nWind: 12 to 15 mph W\nForecast: A chance of showers and thunderstorms before 11pm, then a chance of showers and thunderstorms between 11pm and 2am. Some of the storms could be severe. Mostly cloudy, with a low around 70. West wind 12 to 15 mph. Chance of precipitation is 50%. New rainfall amounts between a quarter and half of an inch possible.\n\n---\n\nFriday:\nTemperature: 81°F\nWind: 13 mph W\nForecast: Sunny, with a high near 81. West wind around 13 mph.\n\n---\n\nFriday Night:\nTemperature: 70°F\nWind: 6 to 10 mph W\nForecast: Mostly clear, with a low around 70. West wind 6 to 10 mph.\n&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;isError&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>第一条是<code>Cline</code>告诉<code>MCP  Server</code>：我要调用<code>get_forecast</code>方法，参数是…</p>
<blockquote>
<p>注意这里的参数（arguments）是完全符合<code>inputSchema</code>中定义的<code>Json</code>规范的，证明定义是有效的。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;latitude&quot;</span><span class="punctuation">:</span><span class="number">40.7128</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;longitude&quot;</span><span class="punctuation">:</span><span class="number">-74.006</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote>
<p>第二条是<code>MCP  Server</code>回复给<code>Cline</code>的内容，重点是<code>text</code>字段中的内容，格式化后：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Tonight<span class="punctuation">:</span></span><br><span class="line">Temperature<span class="punctuation">:</span> <span class="number">71</span>°F</span><br><span class="line">Wind<span class="punctuation">:</span> <span class="number">5</span> mph SW</span><br><span class="line">Forecast<span class="punctuation">:</span> A chance of showers and thunderstorms before <span class="number">11</span>pm<span class="punctuation">,</span> then a slight chance of showers and thunderstorms between <span class="number">11</span>pm and <span class="number">2</span>am. Mostly cloudy<span class="punctuation">,</span> with a low around <span class="number">71.</span> Southwest wind around <span class="number">5</span> mph. Chance of precipitation is <span class="number">30</span>%.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Juneteenth<span class="punctuation">:</span></span><br><span class="line">Temperature<span class="punctuation">:</span> <span class="number">86</span>°F</span><br><span class="line">Wind<span class="punctuation">:</span> <span class="number">5</span> to <span class="number">14</span> mph SW</span><br><span class="line">Forecast<span class="punctuation">:</span> A chance of showers and thunderstorms after <span class="number">2</span>pm. Some of the storms could be severe. Mostly sunny<span class="punctuation">,</span> with a high near <span class="number">86.</span> Southwest wind <span class="number">5</span> to <span class="number">14</span> mph. Chance of precipitation is <span class="number">50</span>%. New rainfall amounts between a tenth and quarter of an inch possible.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Thursday Night<span class="punctuation">:</span></span><br><span class="line">Temperature<span class="punctuation">:</span> <span class="number">70</span>°F</span><br><span class="line">Wind<span class="punctuation">:</span> <span class="number">12</span> to <span class="number">15</span> mph W</span><br><span class="line">Forecast<span class="punctuation">:</span> A chance of showers and thunderstorms before <span class="number">11</span>pm<span class="punctuation">,</span> then a chance of showers and thunderstorms between <span class="number">11</span>pm and <span class="number">2</span>am. Some of the storms could be severe. Mostly cloudy<span class="punctuation">,</span> with a low around <span class="number">70.</span> West wind <span class="number">12</span> to <span class="number">15</span> mph. Chance of precipitation is <span class="number">50</span>%. New rainfall amounts between a quarter and half of an inch possible.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Friday<span class="punctuation">:</span></span><br><span class="line">Temperature<span class="punctuation">:</span> <span class="number">81</span>°F</span><br><span class="line">Wind<span class="punctuation">:</span> <span class="number">13</span> mph W</span><br><span class="line">Forecast<span class="punctuation">:</span> Sunny<span class="punctuation">,</span> with a high near <span class="number">81.</span> West wind around <span class="number">13</span> mph.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Friday Night<span class="punctuation">:</span></span><br><span class="line">Temperature<span class="punctuation">:</span> <span class="number">70</span>°F</span><br><span class="line">Wind<span class="punctuation">:</span> <span class="number">6</span> to <span class="number">10</span> mph W</span><br><span class="line">Forecast<span class="punctuation">:</span> Mostly clear<span class="punctuation">,</span> with a low around <span class="number">70.</span> West wind <span class="number">6</span> to <span class="number">10</span> mph.</span><br></pre></td></tr></table></figure>

<p>这是一些天气信息，<code>Cline</code>拿到<code>MCP Server</code>的返回结果后，它与<code>MCP Server</code>的交互就算结束了，之后<code>Cline</code>就会把结果发给模型，让模型去总结，我们最后看到的就是模型总结的结果。</p>
<h4 id="使用MCP底层协议直接与MCP-Server通信"><a href="#使用MCP底层协议直接与MCP-Server通信" class="headerlink" title="使用MCP底层协议直接与MCP Server通信"></a>使用<code>MCP</code>底层协议直接与<code>MCP Server</code>通信</h4><p> 刚才我们深挖了<code>MCP</code>协议的底层细节，明白了底层细节之后，我们甚至可以不用<code>MCP Host</code>就可以与<code>MCP Server</code>通信，只需要保证发送给<code>MCP Server</code>的数据符合上面我们看到的<code>log</code>中的格式，下面我们一起看下怎么操作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uv --directory /home/chr/桌面/weather run weather.py</span><br></pre></td></tr></table></figure>



<p>可见与我们<code>log</code>中的行为记录是一致的，现在我们就可以在不使用<code>mcp</code>库的前提下开发<code>MCP Server</code>了，只需要保证你的<code>MCP Server</code>符合<code>MCP</code>的这个规范就可以了，只不过会麻烦一些。</p>
<hr>
<h3 id="超越表象：MCP协议的真实含义与定位"><a href="#超越表象：MCP协议的真实含义与定位" class="headerlink" title="超越表象：MCP协议的真实含义与定位"></a>超越表象：<code>MCP</code>协议的真实含义与定位</h3><p>相信大家现在对<code>MCP</code>的细节都有一个比较清楚的认识了，咱们再回头看下在基础篇中的交互流程，现在是不是更清楚了呢？</p>
<img src="/2025/06/12/MCP%E8%BF%9B%E9%98%B6%EF%BC%9A%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1MCP/image-20250619164316647.png" class="" title="image-20250619164316647">

<p>这时候有小友可能有个疑问：<strong>为什么在<code>MCP</code>日志里面没有看到模型的影子，模型是怎么使用<code>MCP</code>协议的?</strong></p>
<p>其实啊，<code>MCP</code>协议规定的内容只包括上图包含的环节，与模型并没有什么关系，<code>MCP</code>协议主要规定了两部分的内容：</p>
<ul>
<li>每个<code>MCP Server</code>的函数列表</li>
<li>每个函数的调用方法</li>
</ul>
<p>当然，有些<code>MCP Server</code>内部还有资源可以使用，暂时忽略掉。上述两点可以总结为函数的注册与使用，我们可以看出这里面确实是没有模型什么事的，<code>MCP</code>协议规定的是如何发现和调用函数的，这套协议脱离大模型也是可以使用的，只是没人这么用罢了。<code>MCP</code>本身并没有规定与模型的交互方式，实际上不同的<code>MCP Host</code>与模型的交互方式确实会有很大差异，比如<code>Cline</code>用的是<code>XML</code>，而<code>Cherry Studio</code>使用的是<code>function call</code>。</p>
<p><strong>总之，<code>MCP</code>协议并没有规定如何与模型进行交互。</strong></p>
<p>我们再回头看看<code>MCP</code>（模型上下文协议）这个名字，什么是模型上下文？上下文就是环境，环境就是周围有哪些函数可以调用，从而<strong>获取外界的信息或者扩展模型的能力</strong>，比如获取天气信息、网络信息、文件信息等等。<code>MCP</code>就是让模型感知外界环境的一个协议，所以叫模型上下文协议。<br>这个名字合适吗？好坏不论，首先这个名字有一定的误导性，很容易让人觉得这个协议规定的是模型交互的内容，但实际上，我们最多只能说这个协议是给模型服务的，再者，这个名字太多玄妙，看起来很高端，作者难道是想让大家觉得<code>MCP</code>是个很高深的东西？</p>
<p>下篇预告：<code>MCP Host</code>是怎么与模型通信的。</p>
<hr>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="weather-py代码解释"><a href="#weather-py代码解释" class="headerlink" title="weather.py代码解释"></a><code>weather.py</code>代码解释</h3><p><strong>导入部分</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> mcp.server.fastmcp <span class="keyword">import</span> FastMCP</span><br></pre></td></tr></table></figure>
<ul>
<li><code>from typing import Any</code>: 从类型提示模块导入<code>Any</code>类型，表示可以是任何类型</li>
<li><code>import httpx</code>: 导入httpx库，这是一个异步HTTP客户端</li>
<li><code>from mcp.server.fastmcp import FastMCP</code>: 从<code>mcp</code>库中导入<code>FastMCP</code>类，用于创建服务器</li>
</ul>
<p><strong>服务器初始化</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mcp = FastMCP(<span class="string">&quot;weather&quot;</span>, log_level=<span class="string">&quot;ERROR&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>创建一个<code>FastMCP</code>服务器实例，命名为”weather”</li>
<li>设置日志级别为”ERROR”，表示只记录错误级别的日志</li>
</ul>
<p><strong>常量定义</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NWS_API_BASE = <span class="string">&quot;https://api.weather.gov&quot;</span></span><br><span class="line">USER_AGENT = <span class="string">&quot;weather-app/1.0&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>NWS_API_BASE</code>: 美国国家气象局<code>(NWS)API</code>的基础URL</li>
<li><code>USER_AGENT</code>: 用于HTTP请求的用户代理字符串，标识我们的应用</li>
</ul>
<p><strong>辅助函数: <code>make_nws_request</code></strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">make_nws_request</span>(<span class="params">url: <span class="built_in">str</span></span>) -&gt; <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] | <span class="literal">None</span>:</span><br></pre></td></tr></table></figure>
<ul>
<li>定义异步函数，接收URL字符串参数，返回字典或None</li>
<li>类型提示表示返回可能是字典(键是字符串，值任意)或None</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: USER_AGENT,</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/geo+json&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置HTTP请求头:<ul>
<li><code>User-Agent</code>: 标识我们的应用</li>
<li><code>Accept</code>: 指定我们接受geo+json格式的数据</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient() <span class="keyword">as</span> client:</span><br></pre></td></tr></table></figure>
<ul>
<li>创建异步HTTP客户端上下文管理器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = <span class="keyword">await</span> client.get(url, headers=headers, timeout=<span class="number">30.0</span>)</span><br><span class="line">    response.raise_for_status()</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br></pre></td></tr></table></figure>
<ul>
<li>尝试发送GET请求，带超时30秒</li>
<li><code>raise_for_status()</code>会在HTTP错误状态码(<code>4xx,5xx</code>)时抛出异常</li>
<li>成功则返回解析后的<code>JSON</code>数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<ul>
<li>捕获任何异常并返回None</li>
</ul>
<p><strong>辅助函数: format_alert</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">format_alert</span>(<span class="params">feature: <span class="built_in">dict</span></span>) -&gt; <span class="built_in">str</span>:</span><br></pre></td></tr></table></figure>
<ul>
<li>定义函数，接收字典参数，返回格式化字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    props = feature[<span class="string">&quot;properties&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Event: <span class="subst">&#123;props.get(<span class="string">&#x27;event&#x27;</span>, <span class="string">&#x27;Unknown&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">Area: <span class="subst">&#123;props.get(<span class="string">&#x27;areaDesc&#x27;</span>, <span class="string">&#x27;Unknown&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">Severity: <span class="subst">&#123;props.get(<span class="string">&#x27;severity&#x27;</span>, <span class="string">&#x27;Unknown&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">Description: <span class="subst">&#123;props.get(<span class="string">&#x27;description&#x27;</span>, <span class="string">&#x27;No description available&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">Instructions: <span class="subst">&#123;props.get(<span class="string">&#x27;instruction&#x27;</span>, <span class="string">&#x27;No specific instructions provided&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>从特征数据中提取properties</li>
<li>使用f-string格式化多行字符串，显示天气警报的各个属性</li>
<li>使用<code>.get()</code>方法提供默认值以防键不存在</li>
</ul>
<p><strong>工具函数: get_alerts</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_alerts</span>(<span class="params">state: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>@mcp.tool()</code>装饰器注册为<code>MCP</code>工具</li>
<li>异步函数，接收州代码字符串，返回格式化字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">f&quot;<span class="subst">&#123;NWS_API_BASE&#125;</span>/alerts/active/area/<span class="subst">&#123;state&#125;</span>&quot;</span></span><br><span class="line">data = <span class="keyword">await</span> make_nws_request(url)</span><br></pre></td></tr></table></figure>
<ul>
<li>构造<code>NWS API</code>的URL</li>
<li>调用之前定义的<code>make_nws_request</code>获取数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> <span class="string">&quot;features&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Unable to fetch alerts or no alerts found.&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>检查数据是否有效，没有则返回错误信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> data[<span class="string">&quot;features&quot;</span>]:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;No active alerts for this state.&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>检查是否有警报特征数据，没有则返回无警报信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alerts = [format_alert(feature) <span class="keyword">for</span> feature <span class="keyword">in</span> data[<span class="string">&quot;features&quot;</span>]]</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;\n---\n&quot;</span>.join(alerts)</span><br></pre></td></tr></table></figure>
<ul>
<li>使用列表推导式格式化所有警报特征</li>
<li>用分隔符<code>---</code>连接所有格式化后的警报</li>
</ul>
<p><strong>工具函数: get_forecast</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_forecast</span>(<span class="params">latitude: <span class="built_in">float</span>, longitude: <span class="built_in">float</span></span>) -&gt; <span class="built_in">str</span>:</span><br></pre></td></tr></table></figure>
<ul>
<li>另一个<code>MCP</code>工具，接收经纬度坐标，返回预报字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">points_url = <span class="string">f&quot;<span class="subst">&#123;NWS_API_BASE&#125;</span>/points/<span class="subst">&#123;latitude&#125;</span>,<span class="subst">&#123;longitude&#125;</span>&quot;</span></span><br><span class="line">points_data = <span class="keyword">await</span> make_nws_request(points_url)</span><br></pre></td></tr></table></figure>
<ul>
<li>构造获取预报点的URL并请求数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> points_data:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Unable to fetch forecast data for this location.&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>检查数据是否有效</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">forecast_url = points_data[<span class="string">&quot;properties&quot;</span>][<span class="string">&quot;forecast&quot;</span>]</span><br><span class="line">forecast_data = <span class="keyword">await</span> make_nws_request(forecast_url)</span><br></pre></td></tr></table></figure>
<ul>
<li>从点数据中提取预报URL并获取预报数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> forecast_data:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Unable to fetch detailed forecast.&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>检查预报数据是否有效</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    periods = forecast_data[<span class="string">&quot;properties&quot;</span>][<span class="string">&quot;periods&quot;</span>]</span><br><span class="line">    forecasts = []</span><br><span class="line">    <span class="keyword">for</span> period <span class="keyword">in</span> periods[:<span class="number">5</span>]:  <span class="comment"># Only show next 5 periods</span></span><br><span class="line">        forecast = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"><span class="subst">&#123;period[<span class="string">&#x27;name&#x27;</span>]&#125;</span>:</span></span><br><span class="line"><span class="string">Temperature: <span class="subst">&#123;period[<span class="string">&#x27;temperature&#x27;</span>]&#125;</span>°<span class="subst">&#123;period[<span class="string">&#x27;temperatureUnit&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">Wind: <span class="subst">&#123;period[<span class="string">&#x27;windSpeed&#x27;</span>]&#125;</span> <span class="subst">&#123;period[<span class="string">&#x27;windDirection&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">Forecast: <span class="subst">&#123;period[<span class="string">&#x27;detailedForecast&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        forecasts.append(forecast)</span><br></pre></td></tr></table></figure>
<ul>
<li>提取预报时段数据</li>
<li>只处理前5个时段(通常是未来几天)</li>
<li>格式化每个时段的预报信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">&quot;\n---\n&quot;</span>.join(forecasts)</span><br></pre></td></tr></table></figure>
<ul>
<li>用分隔符连接所有预报信息</li>
</ul>
<p>主程序入口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    mcp.run(transport=<span class="string">&#x27;stdio&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>当直接运行脚本时:<ul>
<li>启动<code>MCP</code>服务器</li>
<li>使用标准输入输出作为传输方式</li>
</ul>
</li>
</ul>
<p><strong>总结</strong></p>
<p>这段代码实现了一个天气服务，提供两个主要功能:</p>
<ol>
<li>获取美国各州的天气警报</li>
<li>获取指定经纬度的天气预报</li>
</ol>
<p>它使用<code>FastMCP</code>框架创建服务，通过<code>NWS API</code>获取天气数据，并将结果格式化为易读的字符串。</p>
<hr>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol>
<li><a href="https://caihaoran-00.github.io/2025/06/09/MCP%E5%9F%BA%E7%A1%80%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%90%86%E5%88%B0%E5%AE%9E%E6%88%98/">https://caihaoran-00.github.io/2025/06/09/MCP%E5%9F%BA%E7%A1%80%EF%BC%9A%E4%BB%8E%E5%8E%9F%E7%90%86%E5%88%B0%E5%AE%9E%E6%88%98/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/modelcontextprotocol/quickstart-resources/blob/main/weather-server-python/weather.py">https://github.com/modelcontextprotocol/quickstart-resources/blob/main/weather-server-python/weather.py</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/MarkTechStation/VideoCode/blob/main/MCP%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97-%E8%BF%9B%E9%98%B6%E7%AF%87/weather/weather.py">https://github.com/MarkTechStation/VideoCode/blob/main/MCP%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97-%E8%BF%9B%E9%98%B6%E7%AF%87/weather/weather.py</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/MarkTechStation/VideoCode/blob/main/MCP%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97-%E8%BF%9B%E9%98%B6%E7%AF%87/weather/mcp_logger.py">https://github.com/MarkTechStation/VideoCode/blob/main/MCP%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97-%E8%BF%9B%E9%98%B6%E7%AF%87/weather/mcp_logger.py</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/agent/" rel="tag"># agent</a>
              <a href="/tags/mcp/" rel="tag"># mcp</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/12/Python%E5%A4%87%E5%BF%98%E5%BD%95%EF%BC%9A%E9%AB%98%E9%A2%91%E6%98%93%E5%BF%98%E6%8A%80%E5%B7%A7%E9%80%9F%E6%9F%A5/" rel="prev" title="Python备忘录：高频易忘技巧速查">
                  <i class="fa fa-angle-left"></i> Python备忘录：高频易忘技巧速查
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/13/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%94%A4%E9%86%92%E8%AF%8D-KWS-%E8%B0%83%E7%A0%94%E4%B8%8E%E7%9B%AE%E5%89%8D%E6%83%B3%E6%B3%95/" rel="next" title="自定义唤醒词(KWS):调研与目前想法">
                  自定义唤醒词(KWS):调研与目前想法 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Chr</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">288k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">17:26</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","src":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
