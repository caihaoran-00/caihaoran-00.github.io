<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"caihaoran-00.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å‰è¨€ä»Šæ—©å‘¨ä¾‹ä¼šæ˜ç¡®æå‡ºäº†å››ä¸ªæ–°éœ€æ±‚ï¼š  è‡ªå®šåœºæ™¯ å†…å®¹åº“ å¯¹è¯æŠ¥å‘Š è‡ªå®šä¹‰å”¤é†’è¯  æœ¬æ–‡è°ƒç ”ä¸‹å‰ä¸‰ä¸ªéœ€æ±‚ï¼Œè‡ªå®šä¹‰å”¤é†’è¯æ–¹æ¡ˆè§è¿™é‡Œã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ç©å…·ç¬¬äºŒç‰ˆ:æ–°éœ€æ±‚è°ƒç ”">
<meta property="og:url" content="https://caihaoran-00.github.io/2025/06/16/%E7%8E%A9%E5%85%B7%E7%AC%AC%E4%BA%8C%E7%89%88-%E6%96%B0%E9%9C%80%E6%B1%82%E8%B0%83%E7%A0%94/index.html">
<meta property="og:site_name" content="Chr&#39;s Blog">
<meta property="og:description" content="å‰è¨€ä»Šæ—©å‘¨ä¾‹ä¼šæ˜ç¡®æå‡ºäº†å››ä¸ªæ–°éœ€æ±‚ï¼š  è‡ªå®šåœºæ™¯ å†…å®¹åº“ å¯¹è¯æŠ¥å‘Š è‡ªå®šä¹‰å”¤é†’è¯  æœ¬æ–‡è°ƒç ”ä¸‹å‰ä¸‰ä¸ªéœ€æ±‚ï¼Œè‡ªå®šä¹‰å”¤é†’è¯æ–¹æ¡ˆè§è¿™é‡Œã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-06-16T08:03:55.000Z">
<meta property="article:modified_time" content="2025-06-24T07:17:33.451Z">
<meta property="article:author" content="Chr">
<meta property="article:tag" content="kws">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://caihaoran-00.github.io/2025/06/16/%E7%8E%A9%E5%85%B7%E7%AC%AC%E4%BA%8C%E7%89%88-%E6%96%B0%E9%9C%80%E6%B1%82%E8%B0%83%E7%A0%94/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://caihaoran-00.github.io/2025/06/16/%E7%8E%A9%E5%85%B7%E7%AC%AC%E4%BA%8C%E7%89%88-%E6%96%B0%E9%9C%80%E6%B1%82%E8%B0%83%E7%A0%94/","path":"2025/06/16/ç©å…·ç¬¬äºŒç‰ˆ-æ–°éœ€æ±‚è°ƒç ”/","title":"ç©å…·ç¬¬äºŒç‰ˆ:æ–°éœ€æ±‚è°ƒç ”"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ç©å…·ç¬¬äºŒç‰ˆ:æ–°éœ€æ±‚è°ƒç ” | Chr's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Chr's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Record and Share</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A3%E6%96%87"><span class="nav-number">2.</span> <span class="nav-text">æ­£æ–‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E8%87%AA%E5%AE%9A%E5%9C%BA%E6%99%AF"><span class="nav-number">2.1.</span> <span class="nav-text">1. è‡ªå®šåœºæ™¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AB%E4%B9%89"><span class="nav-number">2.1.1.</span> <span class="nav-text">å«ä¹‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%A1%88"><span class="nav-number">2.1.2.</span> <span class="nav-text">æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9C%85%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%AE%A8%E8%AE%BA%E5%90%8E%E8%A1%A5%E5%85%85"><span class="nav-number">2.1.3.</span> <span class="nav-text">âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AF%B9%E8%AF%9D%E6%8A%A5%E5%91%8A"><span class="nav-number">2.2.</span> <span class="nav-text">2. å¯¹è¯æŠ¥å‘Š</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AB%E4%B9%89-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">å«ä¹‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%A1%88-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9C%85%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%AE%A8%E8%AE%BA%E5%90%8E%E8%A1%A5%E5%85%85-1"><span class="nav-number">2.2.3.</span> <span class="nav-text">âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%86%85%E5%AE%B9%E5%BA%93"><span class="nav-number">2.3.</span> <span class="nav-text">3. å†…å®¹åº“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-number">3.</span> <span class="nav-text">é™„å½•</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chr</p>
  <div class="site-description" itemprop="description">Welcome to my little world</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">86</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">99</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:1299964565@qq.com" title="E-Mail â†’ mailto:1299964565@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://caihaoran-00.github.io/2025/06/16/%E7%8E%A9%E5%85%B7%E7%AC%AC%E4%BA%8C%E7%89%88-%E6%96%B0%E9%9C%80%E6%B1%82%E8%B0%83%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chr">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chr's Blog">
      <meta itemprop="description" content="Welcome to my little world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ç©å…·ç¬¬äºŒç‰ˆ:æ–°éœ€æ±‚è°ƒç ” | Chr's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ç©å…·ç¬¬äºŒç‰ˆ:æ–°éœ€æ±‚è°ƒç ”
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-16 16:03:55" itemprop="dateCreated datePublished" datetime="2025-06-16T16:03:55+08:00">2025-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-06-24 15:17:33" itemprop="dateModified" datetime="2025-06-24T15:17:33+08:00">2025-06-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>7.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>26 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šæ—©å‘¨ä¾‹ä¼šæ˜ç¡®æå‡ºäº†å››ä¸ªæ–°éœ€æ±‚ï¼š</p>
<ul>
<li>è‡ªå®šåœºæ™¯</li>
<li>å†…å®¹åº“</li>
<li>å¯¹è¯æŠ¥å‘Š</li>
<li>è‡ªå®šä¹‰å”¤é†’è¯</li>
</ul>
<p>æœ¬æ–‡è°ƒç ”ä¸‹å‰ä¸‰ä¸ªéœ€æ±‚ï¼Œè‡ªå®šä¹‰å”¤é†’è¯æ–¹æ¡ˆè§<a href="https://caihaoran-00.github.io/2025/06/13/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%94%A4%E9%86%92%E8%AF%8D-KWS-%E8%B0%83%E7%A0%94%E4%B8%8E%E7%9B%AE%E5%89%8D%E6%83%B3%E6%B3%95/">è¿™é‡Œ</a>ã€‚</p>
<span id="more"></span>

<hr>
<h2 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h2><p>é¦–å…ˆå±•å¼€ä»‹ç»ä¸‹å„åè¯&#x2F;éœ€æ±‚æŒ‡ä»£ï¼ˆåŸåä¸é‡è¦ï¼‰ï¼Œå†å¯¹å„éœ€æ±‚æ–¹æ¡ˆè°ƒç ”ã€‚</p>
<h3 id="1-è‡ªå®šåœºæ™¯"><a href="#1-è‡ªå®šåœºæ™¯" class="headerlink" title="1. è‡ªå®šåœºæ™¯"></a>1. è‡ªå®šåœºæ™¯</h3><h4 id="å«ä¹‰"><a href="#å«ä¹‰" class="headerlink" title="å«ä¹‰"></a>å«ä¹‰</h4><p>è¯¥éœ€æ±‚æŒ‡çš„æ˜¯è®©ç©å…·åœ¨æ°å½“æ—¶æœºä¸»åŠ¨å¯¹è¯ï¼Œå…·è±¡ä¾‹å­ï¼š</p>
<ul>
<li>åœ¨6.1å„¿ç«¥èŠ‚é‚£å¤©ï¼Œå”¤é†’ç©å…·åï¼Œç©å…·åœ¨ç¬¬ä¸€å¥ä¸»åŠ¨è¿›è¡ŒèŠ‚æ—¥ç¥ç¦</li>
<li>å®¶é•¿åœ¨ç©å…·<code>APP</code>ä¸Šè®¾ç½®5.20å·æ˜¯å­©å­ç”Ÿæ—¥ï¼Œè®©ç©å…·ç¥ç¦å­©å­ï¼ˆæš‚å®šæ—¶æœºä¹Ÿåœ¨å”¤é†’ç©å…·åçš„ç¬¬ä¸€å¥ï¼‰</li>
</ul>
<h4 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h4><p>äº‘ç«¯æ›´æ–°+<code>LLM</code>ç”Ÿæˆç¥ç¦è¯­+<code>TTS</code>æ’­æŠ¥</p>
<ul>
<li>äº‘ç«¯æ›´æ–°ï¼šä¸šåŠ¡é€»è¾‘é€šè¿‡<code>GET</code>è¯·æ±‚æŸ¥è¯¢æœåŠ¡ç«¯æ—¥å†&#x2F;èŠ‚å‡æ—¥ä¿¡æ¯</li>
<li><code>LLM</code>ç”Ÿæˆç¥ç¦è¯­ï¼šé€šè¿‡æç¤ºè¯è®©<code>LLM</code>ç”Ÿæˆç¥ç¦è¯­ï¼ˆæ­£é¢&#x2F;è´Ÿé¢ï¼‰</li>
<li>è°ƒç”¨<code>TTS</code>è¿›è¡Œè¯­éŸ³æ’­æŠ¥</li>
<li>è‡ªå®šä¹‰èŠ‚æ—¥æ¥å£</li>
</ul>
<p><strong>äº‘ç«¯æ›´æ–°æ–¹å¼1ï¼šè‡ªå»º</strong></p>
<p><strong>æœåŠ¡ç«¯ï¼š</strong></p>
<figure class="highlight python"><figcaption><span>jieri_server.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FestivalResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    is_festival: <span class="built_in">bool</span></span><br><span class="line">    festival_name: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    date: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠ‚æ—¥æ•°æ®åº“</span></span><br><span class="line">festivals = &#123;</span><br><span class="line">    <span class="string">&quot;2025-01-01&quot;</span>: <span class="string">&quot;å…ƒæ—¦&quot;</span>,</span><br><span class="line">    <span class="string">&quot;2025-01-28&quot;</span>: <span class="string">&quot;é™¤å¤•&quot;</span>,</span><br><span class="line">    <span class="string">&quot;2025-01-29&quot;</span>: <span class="string">&quot;æ˜¥èŠ‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;2025-02-12&quot;</span>: <span class="string">&quot;å…ƒå®µèŠ‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;2025-03-08&quot;</span>: <span class="string">&quot;å¦‡å¥³èŠ‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;2025-05-01&quot;</span>: <span class="string">&quot;åŠ³åŠ¨èŠ‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;2025-10-01&quot;</span>: <span class="string">&quot;å›½åº†èŠ‚&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/check_festival&quot;</span>, response_model=FestivalResponse</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">check_festival</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æŸ¥ä»Šå¤©æ˜¯å¦æ˜¯èŠ‚æ—¥&quot;&quot;&quot;</span></span><br><span class="line">    today = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)</span><br><span class="line">    festival_name = festivals.get(today)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;is_festival&quot;</span>: festival_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&quot;festival_name&quot;</span>: festival_name,</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: today</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/check_date/&#123;date&#125;&quot;</span>, response_model=FestivalResponse</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">check_specific_date</span>(<span class="params">date: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æŸ¥æŒ‡å®šæ—¥æœŸæ˜¯å¦æ˜¯èŠ‚æ—¥&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        datetime.strptime(date, <span class="string">&quot;%Y-%m-%d&quot;</span>)  <span class="comment"># éªŒè¯æ—¥æœŸæ ¼å¼</span></span><br><span class="line">        festival_name = festivals.get(date)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;is_festival&quot;</span>: festival_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&quot;festival_name&quot;</span>: festival_name,</span><br><span class="line">            <span class="string">&quot;date&quot;</span>: date</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;is_festival&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;festival_name&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&quot;date&quot;</span>: date,</span><br><span class="line">            <span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid date format, please use YYYY-MM-DD&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> uvicorn</span><br><span class="line"></span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯ï¼š</strong></p>
<figure class="highlight python"><figcaption><span>jieri_client.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡ç«¯åœ°å€ï¼ˆå¦‚æœæ˜¯æœ¬åœ°è¿è¡Œå°±ä¸ç”¨æ”¹ï¼‰</span></span><br><span class="line">API_URL = <span class="string">&quot;http://127.0.0.1:8000/api/check_festival&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€è¯·æ±‚</span></span><br><span class="line">response = requests.get(API_URL)</span><br><span class="line">result = response.json()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºç»“æœ</span></span><br><span class="line"><span class="keyword">if</span> result[<span class="string">&quot;is_festival&quot;</span>]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;ğŸ‰ ä»Šå¤©æ˜¯ <span class="subst">&#123;result[<span class="string">&#x27;festival_name&#x27;</span>]&#125;</span>ï¼&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ğŸ“… ä»Šå¤©ä¸æ˜¯èŠ‚æ—¥&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">date = <span class="string">&quot;2025-10-01&quot;</span>  <span class="comment"># æƒ³æŸ¥è¯¢çš„æ—¥æœŸ</span></span><br><span class="line">response = requests.get(<span class="string">f&quot;http://127.0.0.1:8000/api/check_date/<span class="subst">&#123;date&#125;</span>&quot;</span>)</span><br><span class="line">data = response.json()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;date&#125;</span> æ˜¯èŠ‚æ—¥å—ï¼Ÿ<span class="subst">&#123;<span class="string">&#x27;æ˜¯&#x27;</span> <span class="keyword">if</span> data[<span class="string">&#x27;is_festival&#x27;</span>] <span class="keyword">else</span> <span class="string">&#x27;ä¸æ˜¯&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> data[<span class="string">&quot;is_festival&quot;</span>]:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;èŠ‚æ—¥åç§°ï¼š<span class="subst">&#123;data[<span class="string">&#x27;festival_name&#x27;</span>]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“… ä»Šå¤©ä¸æ˜¯èŠ‚æ—¥</span><br><span class="line"><span class="number">2025</span>-<span class="number">10</span>-01 æ˜¯èŠ‚æ—¥å—ï¼Ÿæ˜¯</span><br><span class="line">èŠ‚æ—¥åç§°ï¼šå›½åº†èŠ‚</span><br></pre></td></tr></table></figure>



<p><strong>äº‘ç«¯æ›´æ–°æ–¹å¼2ï¼šè°ƒç”¨API</strong></p>
<p><strong>æœåŠ¡ç«¯ï¼š</strong></p>
<figure class="highlight python"><figcaption><span>jieri_server_api.pu</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">API_KEY = <span class="string">&#x27;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#x27;</span></span><br><span class="line">CALENDARIFIC_URL = <span class="string">&#x27;https://calendarific.com/api/v2/holidays&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/is_holiday&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_holiday</span>(<span class="params"></span></span><br><span class="line"><span class="params">    date: <span class="built_in">str</span> = Query(<span class="params">default=<span class="literal">None</span>, description=<span class="string">&quot;æ ¼å¼ä¸º YYYY-MM-DD&quot;</span></span>),</span></span><br><span class="line"><span class="params">    country: <span class="built_in">str</span> = <span class="string">&quot;CN&quot;</span>,</span></span><br><span class="line"><span class="params">    language: <span class="built_in">str</span> = <span class="string">&quot;zh&quot;</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="comment"># å¦‚æœæ²¡æœ‰ä¼  dateï¼Œé»˜è®¤ä¸ºä»Šå¤©</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> date:</span><br><span class="line">        date = datetime.today().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    year = <span class="built_in">int</span>(date[:<span class="number">4</span>])  <span class="comment"># ä»æ—¥æœŸä¸­æå–å¹´ä»½ç”¨äº API æŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;api_key&#x27;</span>: API_KEY,</span><br><span class="line">        <span class="string">&#x27;country&#x27;</span>: country,</span><br><span class="line">        <span class="string">&#x27;year&#x27;</span>: year,</span><br><span class="line">        <span class="string">&#x27;language&#x27;</span>: language</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(CALENDARIFIC_URL, params=params)</span><br><span class="line">        data = response.json()</span><br><span class="line">        holidays = data.get(<span class="string">&quot;response&quot;</span>, &#123;&#125;).get(<span class="string">&quot;holidays&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> h <span class="keyword">in</span> holidays:</span><br><span class="line">            <span class="keyword">if</span> h[<span class="string">&quot;date&quot;</span>][<span class="string">&quot;iso&quot;</span>] == date:</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&quot;is_holiday&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: h[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: h.get(<span class="string">&quot;description&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: h.get(<span class="string">&quot;type&quot;</span>, [])</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;is_holiday&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;date&quot;</span>: date&#125;</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> JSONResponse(status_code=<span class="number">500</span>, content=&#123;<span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> uvicorn</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;127.0.0.1&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯ï¼š</strong></p>
<figure class="highlight python"><figcaption><span>jieri_client_api.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æœåŠ¡åœ°å€</span></span><br><span class="line">SERVICE_URL = <span class="string">&#x27;http://127.0.0.1:8000/is_holiday&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šæ£€æŸ¥ä»Šå¤©æ˜¯å¦èŠ‚æ—¥</span></span><br><span class="line">response = requests.get(SERVICE_URL)</span><br><span class="line"><span class="built_in">print</span>(response.json())</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ï¼šæ£€æŸ¥æŒ‡å®šæ—¥æœŸæ˜¯å¦èŠ‚æ—¥</span></span><br><span class="line">params = &#123;<span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;2025-06-01&#x27;</span>&#125;  <span class="comment"># å…­ä¸€å„¿ç«¥èŠ‚</span></span><br><span class="line">response = requests.get(SERVICE_URL, params=params)</span><br><span class="line"><span class="built_in">print</span>(response.json())</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;is<span class="built_in">_</span>holiday&#x27;: False, &#x27;date&#x27;: &#x27;2025-06-17&#x27;&#125;</span><br><span class="line">&#123;&#x27;is<span class="built_in">_</span>holiday&#x27;: True, &#x27;name&#x27;: &quot;Children&#x27;s Day&quot;, &#x27;description&#x27;: &quot;Children&#x27;s Day is a other observance in China&quot;, &#x27;type&#x27;: [&#x27;Observance&#x27;]&#125;</span><br></pre></td></tr></table></figure>


<p>ç°åœ¨å®ç°äº†èŠ‚æ—¥æŸ¥è¯¢çš„åŠŸèƒ½ï¼Œæ¥ç€å®ç°ç”¨LLMç”Ÿæˆç¥ç¦è¯­ï¼Œæˆ‘ä»¬ä»¥APIæŸ¥è¯¢èŠ‚æ—¥ä¸ºä¾‹ï¼š</p>
<p><strong>æœåŠ¡ç«¯ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> StreamingResponse, JSONResponse</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> AsyncGenerator</span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä¿¡æ¯</span></span><br><span class="line">API_KEY = <span class="string">&#x27;xxxxxxxxxxxxxxxxxxxxxxxx&#x27;</span>  <span class="comment"># Calendarific API Key</span></span><br><span class="line">DEEPSEEK_API_KEY = <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>   <span class="comment"># æ›¿æ¢ä¸ºå®é™…Key</span></span><br><span class="line">CALENDARIFIC_URL = <span class="string">&#x27;https://calendarific.com/api/v2/holidays&#x27;</span></span><br><span class="line">DEEPSEEK_API_URL = <span class="string">&quot;https://api.deepseek.com/v1/chat/completions&quot;</span>  <span class="comment"># DeepSeek APIåœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">deepseek_stream</span>(<span class="params">prompt: <span class="built_in">str</span></span>) -&gt; AsyncGenerator[<span class="built_in">str</span>, <span class="literal">None</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è°ƒç”¨DeepSeek-v3ç”Ÿæˆæµå¼å“åº”&quot;&quot;&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;DEEPSEEK_API_KEY&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;model&quot;</span>: <span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt&#125;],</span><br><span class="line">        <span class="string">&quot;stream&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;temperature&quot;</span>: <span class="number">0.7</span>,</span><br><span class="line">        <span class="string">&quot;max_tokens&quot;</span>: <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient() <span class="keyword">as</span> client:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> client.stream(<span class="string">&quot;POST&quot;</span>, DEEPSEEK_API_URL, headers=headers, json=payload) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">for</span> chunk <span class="keyword">in</span> response.aiter_lines():</span><br><span class="line">                <span class="keyword">if</span> chunk.startswith(<span class="string">&quot;data:&quot;</span>):</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        data = json.loads(chunk[<span class="number">5</span>:])</span><br><span class="line">                        <span class="keyword">if</span> content := data.get(<span class="string">&quot;choices&quot;</span>, [&#123;&#125;])[<span class="number">0</span>].get(<span class="string">&quot;delta&quot;</span>, &#123;&#125;).get(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;&quot;</span>):</span><br><span class="line">                            <span class="keyword">yield</span> content</span><br><span class="line">                    <span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/is_holiday&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">is_holiday</span>(<span class="params"></span></span><br><span class="line"><span class="params">    date: <span class="built_in">str</span> = Query(<span class="params">default=<span class="literal">None</span>, description=<span class="string">&quot;æ ¼å¼: YYYY-MM-DD&quot;</span></span>),</span></span><br><span class="line"><span class="params">    country: <span class="built_in">str</span> = <span class="string">&quot;CN&quot;</span>,</span></span><br><span class="line"><span class="params">    with_wish: <span class="built_in">bool</span> = <span class="literal">False</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="comment"># é»˜è®¤ä»Šå¤©</span></span><br><span class="line">    date = date <span class="keyword">or</span> datetime.today().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">    year = date[:<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–èŠ‚æ—¥æ•°æ®</span></span><br><span class="line">    params = &#123;<span class="string">&#x27;api_key&#x27;</span>: API_KEY, <span class="string">&#x27;country&#x27;</span>: country, <span class="string">&#x27;year&#x27;</span>: year&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = requests.get(CALENDARIFIC_URL, params=params)</span><br><span class="line">        holidays = resp.json().get(<span class="string">&quot;response&quot;</span>, &#123;&#125;).get(<span class="string">&quot;holidays&quot;</span>, [])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥æ‰¾åŒ¹é…çš„èŠ‚æ—¥</span></span><br><span class="line">        holiday = <span class="built_in">next</span>((h <span class="keyword">for</span> h <span class="keyword">in</span> holidays <span class="keyword">if</span> h[<span class="string">&quot;date&quot;</span>][<span class="string">&quot;iso&quot;</span>] == date), <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸éœ€è¦ç¥ç¦è¯­æ—¶ç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> with_wish:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;is_holiday&quot;</span>: <span class="built_in">bool</span>(holiday),</span><br><span class="line">                <span class="string">&quot;date&quot;</span>: date,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: holiday[<span class="string">&quot;name&quot;</span>] <span class="keyword">if</span> holiday <span class="keyword">else</span> <span class="literal">None</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: holiday.get(<span class="string">&quot;type&quot;</span>, []) <span class="keyword">if</span> holiday <span class="keyword">else</span> []</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç”Ÿæˆæµå¼ç¥ç¦è¯­</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_stream</span>():</span><br><span class="line">            <span class="keyword">if</span> holiday:</span><br><span class="line">                prompt = <span class="string">f&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªå¯çˆ±çš„ç©å…·ï¼Œä»Šå¤©æ˜¯<span class="subst">&#123;holiday[<span class="string">&#x27;name&#x27;</span>]&#125;</span>ï¼Œè¯·ç”¨å„¿ç«¥è¯­è¨€ï¼ˆé™100å­—ï¼‰ç»™å°æœ‹å‹é€ä¸Šç¥ç¦ï¼Œè¦æ±‚ï¼š</span></span><br><span class="line"><span class="string">                - ä¸è¦æœ‰emojiè¡¨æƒ…</span></span><br><span class="line"><span class="string">                - åŒ…å«èŠ‚æ—¥å…ƒç´ </span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                prompt = <span class="string">f&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªæ¸©æš–çš„ç©å…·ï¼Œä»Šå¤©ä¸æ˜¯èŠ‚æ—¥ï¼ˆæ—¥æœŸï¼š<span class="subst">&#123;date&#125;</span>ï¼‰ï¼Œè¯·ç”¨å„¿ç«¥è¯­è¨€ï¼ˆé™80å­—ï¼‰ç»™å°æœ‹å‹å‘é€æ—¥å¸¸é¼“åŠ±ï¼Œè¦æ±‚ï¼š</span></span><br><span class="line"><span class="string">                - ä¸è¦æœ‰emojiè¡¨æƒ…</span></span><br><span class="line"><span class="string">                - åŒ…å«å¯¹æ—¥å¸¸ç”Ÿæ´»çš„èµç¾&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">for</span> chunk <span class="keyword">in</span> deepseek_stream(prompt):</span><br><span class="line">                <span class="keyword">yield</span> chunk</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> StreamingResponse(generate_stream(), media_type=<span class="string">&quot;text/event-stream&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> JSONResponse(status_code=<span class="number">500</span>, content=&#123;<span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> uvicorn</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HolidayClient</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_url=<span class="string">&quot;http://127.0.0.1:8000&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.base_url = base_url</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_holiday</span>(<span class="params">self, date=<span class="literal">None</span>, country=<span class="string">&quot;CN&quot;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢èŠ‚æ—¥ä¿¡æ¯ï¼ˆéæµå¼ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        params = &#123;<span class="string">&quot;country&quot;</span>: country&#125;</span><br><span class="line">        <span class="keyword">if</span> date:</span><br><span class="line">            params[<span class="string">&quot;date&quot;</span>] = date</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(<span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/is_holiday&quot;</span>, params=params)</span><br><span class="line">            <span class="keyword">return</span> response.json()</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_wish</span>(<span class="params">self, date=<span class="literal">None</span>, country=<span class="string">&quot;CN&quot;</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–æµå¼ç¥ç¦è¯­&quot;&quot;&quot;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;country&quot;</span>: country,</span><br><span class="line">            <span class="string">&quot;with_wish&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&quot;date&quot;</span>: date <span class="keyword">or</span> datetime.now().strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(</span><br><span class="line">                <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/is_holiday&quot;</span>,</span><br><span class="line">                params=params,</span><br><span class="line">                stream=<span class="literal">True</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;ğŸ§¸ ç©å…·è¯´ï¼š&quot;</span>, end=<span class="string">&quot;&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(chunk_size=<span class="literal">None</span>):</span><br><span class="line">                    <span class="built_in">print</span>(chunk.decode(<span class="string">&#x27;utf-8&#x27;</span>), end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;âš ï¸ è¯·æ±‚å¤±è´¥: <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;âŒ å‘ç”Ÿé”™è¯¯: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    client = HolidayClient()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¤ºä¾‹1ï¼šæŸ¥è¯¢ä»Šæ—¥èŠ‚æ—¥çŠ¶æ€</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== èŠ‚æ—¥æŸ¥è¯¢ ===&quot;</span>)</span><br><span class="line">    result = client.check_holiday()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ—¥æœŸ: <span class="subst">&#123;result.get(<span class="string">&#x27;date&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ˜¯å¦èŠ‚æ—¥: <span class="subst">&#123;<span class="string">&#x27;æ˜¯&#x27;</span> <span class="keyword">if</span> result.get(<span class="string">&#x27;is_holiday&#x27;</span>) <span class="keyword">else</span> <span class="string">&#x27;å¦&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> result.get(<span class="string">&#x27;is_holiday&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;èŠ‚æ—¥åç§°: <span class="subst">&#123;result.get(<span class="string">&#x27;name&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;èŠ‚æ—¥ç±»å‹: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(result.get(<span class="string">&#x27;type&#x27;</span>, []))&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¤ºä¾‹2ï¼šè·å–ç¥ç¦è¯­ï¼ˆè‡ªåŠ¨åˆ¤æ–­èŠ‚æ—¥ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== è·å–ç¥ç¦è¯­ ===&quot;</span>)</span><br><span class="line">    <span class="comment"># client.get_wish()  # é»˜è®¤ä»Šå¤©</span></span><br><span class="line">    client.get_wish(date=<span class="string">&quot;2025-06-01&quot;</span>)  <span class="comment"># æµ‹è¯•å„¿ç«¥èŠ‚</span></span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">client.get<span class="built_in">_</span>wish()</span><br><span class="line"></span><br><span class="line">=== èŠ‚æ—¥æŸ¥è¯¢ ===</span><br><span class="line">æ—¥æœŸ: 2025-06-17</span><br><span class="line">æ˜¯å¦èŠ‚æ—¥: å¦</span><br><span class="line"></span><br><span class="line">=== è·å–ç¥ç¦è¯­ ===</span><br><span class="line">ğŸ§¸ ç©å…·è¯´ï¼šäº²çˆ±çš„å°æœ‹å‹ï¼Œä»Šå¤©é˜³å…‰æš–æš–çš„ï¼Œåƒä½ ç¬‘èµ·æ¥çš„æ ·å­ï¼ä½ è®¤çœŸåˆ·ç‰™ã€å’Œå°ä¼™ä¼´åˆ†äº«ç©å…·çš„æ ·å­çœŸæ£’ã€‚è®°å¾—å—ï¼Ÿæ˜¨å¤©ä½ å¸®å¦ˆå¦ˆæ‘†ç¢—ç­·æ—¶åƒä¸ªå°è¶…äººï¼æ¯å¤©éƒ½æœ‰é—ªé—ªå‘å…‰çš„æ—¶åˆ»ï¼Œä½ çœŸæ˜¯ä¸–ç•Œä¸Šæœ€ä¼šåˆ›é€ å¿«ä¹çš„å°æ˜Ÿæ˜Ÿå‘€ï½</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">client.get<span class="built_in">_</span>wish(date=&quot;2025-06-01&quot;)</span><br><span class="line">=== èŠ‚æ—¥æŸ¥è¯¢ ===</span><br><span class="line">æ—¥æœŸ: 2025-06-17</span><br><span class="line">æ˜¯å¦èŠ‚æ—¥: å¦</span><br><span class="line"></span><br><span class="line">=== è·å–ç¥ç¦è¯­ ===</span><br><span class="line">ğŸ§¸ ç©å…·è¯´ï¼šäº²çˆ±çš„å°å®è´ï¼Œå„¿ç«¥èŠ‚å¿«ä¹å‘€ï¼ä»Šå¤©æ˜¯ä½ æœ€æœ€å¼€å¿ƒçš„æ—¥å­ï¼Œåƒå½©è™¹ç³–ä¸€æ ·ç”œæ»‹æ»‹ï¼å¿«å»å’Œå¥½æœ‹å‹ä¸€èµ·ç©å§ï¼Œå¯ä»¥å¹æ³¡æ³¡ã€è·³çš®ç­‹ï¼Œæˆ–è€…åˆ†äº«ä¸€å—å°ç†Šé¥¼å¹²ã€‚è®°å¾—è¦å’¯å’¯ç¬‘ï¼Œåƒå°äº‘æœµä¸€æ ·é£˜å‘€é£˜ã€‚çˆ¸çˆ¸å¦ˆå¦ˆå’Œè€å¸ˆéƒ½çˆ±ä½ ï¼Œæ„¿ä½ æ¯å¤©éƒ½æœ‰ç«¥è¯èˆ¬çš„å¥‡å¦™å†’é™©ï¼åŠ æ²¹ï¼Œå°å°è¶…äººï¼</span><br></pre></td></tr></table></figure>



<p><strong>ç°åœ¨å®ç°äº†ä¼ ç»ŸèŠ‚æ—¥ç­‰çš„æŸ¥è¯¢ä¸é—®å€™è¯­ç”Ÿæˆï¼Œé‚£åƒç”Ÿæ—¥è¿™ç§è‡ªå®šä¹‰çš„èŠ‚æ—¥æ€ä¹ˆåšå‘¢ï¼Ÿ</strong></p>
<p><strong>æœåŠ¡ç«¯ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query, Body, HTTPException</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> StreamingResponse</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> AsyncGenerator, <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä¿¡æ¯</span></span><br><span class="line">CALENDARIFIC_API_KEY = <span class="string">&#x27;xxxxxxxxxxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">DEEPSEEK_API_KEY = <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxx&quot;</span></span><br><span class="line">CALENDARIFIC_URL = <span class="string">&#x27;https://calendarific.com/api/v2/holidays&#x27;</span></span><br><span class="line">DEEPSEEK_API_URL = <span class="string">&quot;https://api.deepseek.com/v1/chat/completions&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†…å­˜å­˜å‚¨è‡ªå®šä¹‰èŠ‚æ—¥ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨æ•°æ®åº“ï¼‰</span></span><br><span class="line">custom_holidays: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Dict</span>] = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•°æ®æ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomHoliday</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    date: <span class="built_in">str</span>  <span class="comment"># æ ¼å¼: &quot;MM-DD&quot;</span></span><br><span class="line">    name: <span class="built_in">str</span>  <span class="comment"># èŠ‚æ—¥åç§°</span></span><br><span class="line">    description: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>  <span class="comment"># èŠ‚æ—¥æè¿°</span></span><br><span class="line">    is_recurring: <span class="built_in">bool</span> = <span class="literal">True</span>  <span class="comment"># æ˜¯å¦æ¯å¹´é‡å¤</span></span><br><span class="line">    user_id: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span>  <span class="comment"># ç”¨æˆ·æ ‡è¯†</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># DeepSeekæµå¼ç”Ÿæˆ</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">deepseek_stream</span>(<span class="params">prompt: <span class="built_in">str</span></span>) -&gt; AsyncGenerator[<span class="built_in">str</span>, <span class="literal">None</span>]:</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;DEEPSEEK_API_KEY&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;model&quot;</span>: <span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt&#125;],</span><br><span class="line">        <span class="string">&quot;stream&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;temperature&quot;</span>: <span class="number">0.7</span>,</span><br><span class="line">        <span class="string">&quot;max_tokens&quot;</span>: <span class="number">150</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient() <span class="keyword">as</span> client:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> client.stream(<span class="string">&quot;POST&quot;</span>, DEEPSEEK_API_URL, headers=headers, json=payload) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">for</span> chunk <span class="keyword">in</span> response.aiter_lines():</span><br><span class="line">                <span class="keyword">if</span> chunk.startswith(<span class="string">&quot;data:&quot;</span>):</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        data = json.loads(chunk[<span class="number">5</span>:])</span><br><span class="line">                        <span class="keyword">if</span> content := data.get(<span class="string">&quot;choices&quot;</span>, [&#123;&#125;])[<span class="number">0</span>].get(<span class="string">&quot;delta&quot;</span>, &#123;&#125;).get(<span class="string">&quot;content&quot;</span>, <span class="string">&quot;&quot;</span>):</span><br><span class="line">                            <span class="keyword">yield</span> content</span><br><span class="line">                    <span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ³•å®šèŠ‚å‡æ—¥</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">check_official_holiday</span>(<span class="params">date: <span class="built_in">str</span>, country: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        year = date[:<span class="number">4</span>]</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;api_key&#x27;</span>: CALENDARIFIC_API_KEY,</span><br><span class="line">            <span class="string">&#x27;country&#x27;</span>: country,</span><br><span class="line">            <span class="string">&#x27;year&#x27;</span>: year</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient() <span class="keyword">as</span> client:</span><br><span class="line">            resp = <span class="keyword">await</span> client.get(CALENDARIFIC_URL, params=params)</span><br><span class="line">            data = resp.json()</span><br><span class="line">            <span class="comment"># æœ¬åœ°è¿‡æ»¤ç›®æ ‡æ—¥æœŸ</span></span><br><span class="line">            holidays = [</span><br><span class="line">                h <span class="keyword">for</span> h <span class="keyword">in</span> data.get(<span class="string">&quot;response&quot;</span>, &#123;&#125;).get(<span class="string">&quot;holidays&quot;</span>, [])</span><br><span class="line">                <span class="keyword">if</span> h[<span class="string">&quot;date&quot;</span>][<span class="string">&quot;iso&quot;</span>] == date  <span class="comment"># ç²¾ç¡®åŒ¹é…æ—¥æœŸ</span></span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> holidays:</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="string">&quot;is_holiday&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: holidays[<span class="number">0</span>][<span class="string">&quot;name&quot;</span>],</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: holidays[<span class="number">0</span>].get(<span class="string">&quot;type&quot;</span>, [])</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;is_holiday&quot;</span>: <span class="literal">False</span>&#125;</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="string">f&quot;èŠ‚å‡æ—¥æŸ¥è¯¢å¤±è´¥: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥è‡ªå®šä¹‰èŠ‚æ—¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_custom_holiday</span>(<span class="params">date: <span class="built_in">str</span>, user_id: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">    month_day = date[<span class="number">5</span>:]  <span class="comment"># æå–&quot;MM-DD&quot;</span></span><br><span class="line">    <span class="keyword">for</span> hid, h <span class="keyword">in</span> custom_holidays.items():</span><br><span class="line">        <span class="keyword">if</span> h[<span class="string">&quot;user_id&quot;</span>] == user_id <span class="keyword">and</span> h[<span class="string">&quot;date&quot;</span>] == month_day <span class="keyword">and</span> h[<span class="string">&quot;is_recurring&quot;</span>]:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;is_custom&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: h[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: h[<span class="string">&quot;description&quot;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;is_custom&quot;</span>: <span class="literal">False</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># APIç«¯ç‚¹</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/custom_holidays&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">add_custom_holiday</span>(<span class="params">holiday: CustomHoliday</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ·»åŠ è‡ªå®šä¹‰èŠ‚æ—¥&quot;&quot;&quot;</span></span><br><span class="line">    holiday_id = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line">    custom_holidays[holiday_id] = holiday.<span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;id&quot;</span>: holiday_id, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æ·»åŠ æˆåŠŸ&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/custom_holidays&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">list_custom_holidays</span>(<span class="params">user_id: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åˆ—å‡ºç”¨æˆ·çš„è‡ªå®šä¹‰èŠ‚æ—¥&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        uid: data <span class="keyword">for</span> uid, data <span class="keyword">in</span> custom_holidays.items()</span><br><span class="line">        <span class="keyword">if</span> data[<span class="string">&quot;user_id&quot;</span>] == user_id</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/holiday&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">check_holiday</span>(<span class="params"></span></span><br><span class="line"><span class="params">        date: <span class="built_in">str</span> = Query(<span class="params">default=<span class="literal">None</span>, description=<span class="string">&quot;æ ¼å¼: YYYY-MM-DD&quot;</span></span>),</span></span><br><span class="line"><span class="params">        country: <span class="built_in">str</span> = <span class="string">&quot;CN&quot;</span>,</span></span><br><span class="line"><span class="params">        user_id: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span>,</span></span><br><span class="line"><span class="params">        with_wish: <span class="built_in">bool</span> = <span class="literal">False</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æŸ¥è¯¢èŠ‚æ—¥å¹¶ç”Ÿæˆç¥ç¦è¯­&quot;&quot;&quot;</span></span><br><span class="line">    date = date <span class="keyword">or</span> datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. æ£€æŸ¥èŠ‚æ—¥</span></span><br><span class="line">    official = <span class="keyword">await</span> check_official_holiday(date, country)</span><br><span class="line">    custom = check_custom_holiday(date, user_id)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. ä¸éœ€è¦ç¥ç¦è¯­æ—¶ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> with_wish:</span><br><span class="line">        <span class="keyword">return</span> &#123;**official, **custom, <span class="string">&quot;date&quot;</span>: date&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. ç”Ÿæˆæµå¼ç¥ç¦è¯­</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_stream</span>():</span><br><span class="line">        <span class="keyword">if</span> official[<span class="string">&quot;is_holiday&quot;</span>]:</span><br><span class="line">            prompt = <span class="string">f&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªå¯çˆ±çš„ç©å…·ï¼Œä»Šå¤©æ˜¯<span class="subst">&#123;official[<span class="string">&#x27;name&#x27;</span>]&#125;</span>ï¼Œè¯·ç”¨å„¿ç«¥è¯­è¨€ï¼ˆé™100å­—ï¼‰ç»™å°æœ‹å‹é€ä¸Šç¥ç¦ï¼Œè¦æ±‚ï¼š</span></span><br><span class="line"><span class="string">            - ä»¥&quot;äº²çˆ±çš„å°æœ‹å‹&quot;å¼€å¤´</span></span><br><span class="line"><span class="string">            - åŒ…å«èŠ‚æ—¥å…ƒç´ </span></span><br><span class="line"><span class="string">            - ä»¥çº¯æ–‡æœ¬ç»™å‡ºï¼Œä¸è¦emojiè¡¨æƒ…ç­‰&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> custom[<span class="string">&quot;is_custom&quot;</span>]:</span><br><span class="line">            prompt = <span class="string">f&quot;&quot;&quot;ä»Šå¤©æ˜¯<span class="subst">&#123;custom[<span class="string">&#x27;name&#x27;</span>]&#125;</span>ï¼ˆ<span class="subst">&#123;custom.get(<span class="string">&#x27;description&#x27;</span>, <span class="string">&#x27;&#x27;</span>)&#125;</span>ï¼‰ï¼Œè¯·ä»¥ç©å…·å£å»ï¼š</span></span><br><span class="line"><span class="string">            - ç”¨&quot;å°æœ‹å‹&quot;ç§°å‘¼</span></span><br><span class="line"><span class="string">            - ç»“åˆ<span class="subst">&#123;custom[<span class="string">&#x27;name&#x27;</span>]&#125;</span>ç‰¹ç‚¹</span></span><br><span class="line"><span class="string">            - åŒ…å«1ä¸ªäº’åŠ¨å»ºè®®</span></span><br><span class="line"><span class="string">            - ä»¥çº¯æ–‡æœ¬ç»™å‡ºï¼Œä¸è¦emojiè¡¨æƒ…ç­‰&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prompt = <span class="string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªæ¸©æš–çš„ç©å…·ï¼Œè¯·ç”¨å„¿ç«¥è¯­è¨€ï¼ˆé™80å­—ï¼‰å‘é€æ—¥å¸¸é¼“åŠ±ï¼š</span></span><br><span class="line"><span class="string">            - ä»¥&quot;ä½ å¥½å‘€&quot;å¼€å¤´</span></span><br><span class="line"><span class="string">            - åŒ…å«å¯¹æ—¥å¸¸ç”Ÿæ´»çš„èµç¾</span></span><br><span class="line"><span class="string">            - ä»¥çº¯æ–‡æœ¬ç»™å‡ºï¼Œä¸è¦emojiè¡¨æƒ…ç­‰&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">for</span> chunk <span class="keyword">in</span> deepseek_stream(prompt):</span><br><span class="line">            <span class="keyword">yield</span> chunk</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> StreamingResponse(generate_stream(), media_type=<span class="string">&quot;text/event-stream&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> uvicorn</span><br><span class="line"></span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>å®¢æˆ·ç«¯ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HolidayClient</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_url=<span class="string">&quot;http://localhost:8000&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.base_url = base_url</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_custom_holiday</span>(<span class="params"></span></span><br><span class="line"><span class="params">            self,</span></span><br><span class="line"><span class="params">            name: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">            date: <span class="built_in">str</span>,  <span class="comment"># MM-DDæ ¼å¼</span></span></span><br><span class="line"><span class="params">            description: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="params">            is_recurring: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">            user_id: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ·»åŠ è‡ªå®šä¹‰èŠ‚æ—¥&quot;&quot;&quot;</span></span><br><span class="line">        resp = requests.post(</span><br><span class="line">            <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/custom_holidays&quot;</span>,</span><br><span class="line">            json=&#123;</span><br><span class="line">                <span class="string">&quot;date&quot;</span>: date,</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: description,</span><br><span class="line">                <span class="string">&quot;is_recurring&quot;</span>: is_recurring,</span><br><span class="line">                <span class="string">&quot;user_id&quot;</span>: user_id</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> resp.json()[<span class="string">&quot;id&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_holiday</span>(<span class="params"></span></span><br><span class="line"><span class="params">            self,</span></span><br><span class="line"><span class="params">            date: <span class="built_in">str</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">            country: <span class="built_in">str</span> = <span class="string">&quot;CN&quot;</span>,</span></span><br><span class="line"><span class="params">            user_id: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æŸ¥è¯¢èŠ‚æ—¥ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">        params = &#123;<span class="string">&quot;country&quot;</span>: country, <span class="string">&quot;user_id&quot;</span>: user_id&#125;</span><br><span class="line">        <span class="keyword">if</span> date:</span><br><span class="line">            params[<span class="string">&quot;date&quot;</span>] = date</span><br><span class="line">        resp = requests.get(<span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/holiday&quot;</span>, params=params)</span><br><span class="line">        <span class="keyword">return</span> resp.json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_wish</span>(<span class="params"></span></span><br><span class="line"><span class="params">            self,</span></span><br><span class="line"><span class="params">            date: <span class="built_in">str</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">            country: <span class="built_in">str</span> = <span class="string">&quot;CN&quot;</span>,</span></span><br><span class="line"><span class="params">            user_id: <span class="built_in">str</span> = <span class="string">&quot;default&quot;</span></span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–æµå¼ç¥ç¦è¯­&quot;&quot;&quot;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;country&quot;</span>: country,</span><br><span class="line">            <span class="string">&quot;user_id&quot;</span>: user_id,</span><br><span class="line">            <span class="string">&quot;with_wish&quot;</span>: <span class="literal">True</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> date:</span><br><span class="line">            params[<span class="string">&quot;date&quot;</span>] = date</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> requests.get(</span><br><span class="line">                    <span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/holiday&quot;</span>,</span><br><span class="line">                    params=params,</span><br><span class="line">                    stream=<span class="literal">True</span></span><br><span class="line">            ) <span class="keyword">as</span> response:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;ğŸ§¸ ç©å…·è¯´ï¼š&quot;</span>, end=<span class="string">&quot;&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">for</span> chunk <span class="keyword">in</span> response.iter_content(chunk_size=<span class="literal">None</span>):</span><br><span class="line">                    <span class="built_in">print</span>(chunk.decode(<span class="string">&#x27;utf-8&#x27;</span>), end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;âŒ é”™è¯¯: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    client = HolidayClient()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. æ·»åŠ ç”Ÿæ—¥ï¼ˆæ¯å¹´8æœˆ15æ—¥ï¼‰</span></span><br><span class="line">    birthday_id = client.add_custom_holiday(</span><br><span class="line">        name=<span class="string">&quot;å°æ˜çš„ç”Ÿæ—¥&quot;</span>,</span><br><span class="line">        date=<span class="string">&quot;08-15&quot;</span>,</span><br><span class="line">        description=<span class="string">&quot;å°æœ‹å‹æœ€å–œæ¬¢çš„æ—¥å­ï¼&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;æ·»åŠ ç”Ÿæ—¥æˆåŠŸï¼ŒID: <span class="subst">&#123;birthday_id&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. æŸ¥è¯¢ä»Šå¤©æ˜¯å¦æ˜¯èŠ‚æ—¥</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== èŠ‚æ—¥æŸ¥è¯¢ ===&quot;</span>)</span><br><span class="line">    result = client.check_holiday()</span><br><span class="line">    <span class="built_in">print</span>(json.dumps(result, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. æŸ¥è¯¢ä»Šå¤©æ˜¯å¦æ˜¯èŠ‚æ—¥</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== èŠ‚æ—¥æŸ¥è¯¢ ===&quot;</span>)</span><br><span class="line">    result = client.check_holiday(<span class="string">&quot;2025-06-01&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(json.dumps(result, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. è·å–ç”Ÿæ—¥ç¥ç¦ï¼ˆæµ‹è¯•æ—¥æœŸè®¾ä¸º8æœˆ15æ—¥ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== ç”Ÿæ—¥ç¥ç¦ ===&quot;</span>)</span><br><span class="line">    client.get_wish(date=<span class="string">&quot;2024-08-15&quot;</span>)  <span class="comment"># æ›¿æ¢ä¸ºçœŸå®æ—¥æœŸæµ‹è¯•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. è·å–æ—¥å¸¸é—®å€™ï¼ˆéèŠ‚æ—¥ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== æ—¥å¸¸é—®å€™ ===&quot;</span>)</span><br><span class="line">    client.get_wish(date=<span class="string">&quot;2024-03-15&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6. è·å–èŠ‚æ—¥é—®å€™</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== èŠ‚æ—¥é—®å€™ ===&quot;</span>)</span><br><span class="line">    client.get_wish(date=<span class="string">&quot;2025-06-01&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">=== èŠ‚æ—¥æŸ¥è¯¢ ===</span><br><span class="line">&#123;</span><br><span class="line">  &quot;is<span class="built_in">_</span>holiday&quot;: false,</span><br><span class="line">  &quot;is<span class="built_in">_</span>custom&quot;: false,</span><br><span class="line">  &quot;date&quot;: &quot;2025-06-17&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">=== èŠ‚æ—¥æŸ¥è¯¢ ===</span><br><span class="line">&#123;</span><br><span class="line">  &quot;is<span class="built_in">_</span>holiday&quot;: true,</span><br><span class="line">  &quot;name&quot;: &quot;Children&#x27;s Day&quot;,</span><br><span class="line">  &quot;type&quot;: [</span><br><span class="line">    &quot;Observance&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;is<span class="built_in">_</span>custom&quot;: false,</span><br><span class="line">  &quot;date&quot;: &quot;2025-06-01&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">=== ç”Ÿæ—¥ç¥ç¦ ===</span><br><span class="line">ğŸ§¸ ç©å…·è¯´ï¼š&quot;å°æœ‹å‹å°æœ‹å‹ï¼Œå¬æˆ‘è¯´ï¼ä»Šå¤©å¯æ˜¯ä½ æœ€ç‰¹åˆ«çš„ç”Ÿæ—¥å¤§æ´¾å¯¹å‘€ï¼æˆ‘æ˜¯ä½ æ•å¤´åº•ä¸‹ä¼šå‘å…‰çš„å°æ±½è½¦ï¼Œæ—©å°±å·å·çœ‹åˆ°å¦ˆå¦ˆåœ¨å¨æˆ¿è—äº†æ˜Ÿæ˜Ÿå½¢çŠ¶çš„è›‹ç³•å•¦~è¦ä¸è¦å’Œæˆ‘ç©ä¸ªç”Ÿæ—¥å¯»å®æ¸¸æˆï¼Ÿæ•°åˆ°åçš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªæ‰¾åˆ°çª—å¸˜åé¢å½©è‰²æ°”çƒçš„å°æœ‹å‹ï¼Œèƒ½è·å¾—æœ¬è½¦ç¥ç‰¹æŠ€è¡¨æ¼”â€”â€”åŸåœ°è½¬åœˆåœˆå‘å…‰ä¸‰è¿å‡»ï¼(å¼•æ“å—¡å—¡å‡†å¤‡ä¸­)&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=== æ—¥å¸¸é—®å€™ ===</span><br><span class="line">ğŸ§¸ ç©å…·è¯´ï¼šä½ å¥½å‘€ï¼ä»Šå¤©å¤ªé˜³å…¬å…¬åˆå‡ºæ¥ç©å•¦ï¼Œå°é¸Ÿåœ¨å”±æ­Œï¼Œå°èŠ±åœ¨è·³èˆï¼Œä¸–ç•Œå¤šç¾å¥½å‘€ï¼ä½ æ˜¯æœ€æ£’çš„å°æ˜Ÿæ˜Ÿï¼Œæ¯å¤©éƒ½ä¼šå‘å…‰å‘äº®ï¼Œè¦å¼€å¼€å¿ƒå¿ƒè¿‡å¥½ä»Šå¤©å“¦ï½</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=== èŠ‚æ—¥é—®å€™ ===</span><br><span class="line">ğŸ§¸ ç©å…·è¯´ï¼šäº²çˆ±çš„å°æœ‹å‹ï¼Œå„¿ç«¥èŠ‚å¿«ä¹å‘€ï¼ä»Šå¤©æ˜¯å°æ˜Ÿæ˜Ÿè·³èˆçš„æ—¥å­ï¼Œæ˜¯ç³–æœäº‘é£˜è¿‡çš„æ—¥å­ï¼æ„¿ä½ çš„å°ä¹¦åŒ…è£…æ»¡å½©è™¹ï¼Œå°è„šä¸«è¸©å‡ºæ£‰èŠ±ç³–å°è·¯~è®°å¾—å’Œæ°”çƒè¯´æ‚„æ‚„è¯ï¼Œè®©é£ç­æŠŠç¬‘å£°æ’’æ»¡è“å¤©ã€‚åƒè›‹ç³•æ—¶è¦åƒå°ç†Šä¸€æ ·å¼€å¿ƒï¼Œåšæ¢¦æ—¶è¦é‡è§ä¼šè®²æ•…äº‹çš„æœˆäº®èˆ¹å“¦ï¼æ°¸è¿œçˆ±ä½ çš„ç©å…·æœ‹å‹~</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨ï¼šè‡ªå®šä¹‰æ—¥æœŸä¸éœ€åŒ…å«å¹´ï¼Œä»…æœˆä»½å’Œæ—¥æœŸå³å¯ã€‚</p>
</blockquote>
<h4 id="âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……"><a href="#âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……" class="headerlink" title="âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……"></a>âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……</h4><blockquote>
<p>ä¸Šæ–‡æ‰€è¯´çš„ç¥ç¦è¯­å…¶å®ä¸å¤ªæ°å½“ï¼Œä¸€æ–¹é¢æœ‰äº›èŠ‚æ—¥ä¸ä¸€å®šæ˜¯æ­£å‘çš„èŠ‚æ—¥ï¼Œæ‰€ä»¥ä¸ä¸€å®šéœ€è¦ç¥ç¦è¯­ï¼ŒäºŒæ˜¯ç°åœ¨æˆ‘æƒ³é¡ºå¸¦å®ç°éèŠ‚å‡æ—¥æƒ…å†µä¸‹ä¹Ÿç”Ÿæˆâ€ç¥ç¦è¯­â€ï¼Œæ‰€ä»¥ç”¨ç¥ç¦è¯­è¿™ä¸ªè¯å…¶å®æ˜¯ä¸åˆé€‚çš„ï¼Œæ‰€ä»¥æ–°å¢å†…å®¹å°†ä»¥<strong>æ‹›å‘¼è¯­</strong>æ›¿ä»£ä¸Šæ–‡çš„â€ç¥ç¦è¯­â€ã€‚</p>
</blockquote>
<p>æœ¬æ¥æƒ³çš„æ˜¯åœ¨æœåŠ¡ç«¯ç”Ÿæˆå¯¹åº”æ‹›å‘¼è¯­åï¼Œæ¯ä¸ªç©å…·æ’­æ”¾çš„æ‹›å‘¼è¯­éƒ½ç”¨è¿™æ®µï¼Œèƒ½çœä¸å°‘tokenã€‚ç„¶è€Œä¼šä¸Šè®¨è®ºæåˆ°è¦ç»™æ¯ä¸ªå°æœ‹å‹ä¸ä¸€æ ·çš„æ‹›å‘¼è¯­ï¼Œé‚£ä¹ˆå°±è¦ç”¨åˆ°å°æœ‹å‹çš„ä¿¡æ¯äº†ï¼Œèƒ½æ‹¿åˆ°çš„ä¿¡æ¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>å®¶é•¿è®¾ç½®çš„å­©å­çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚çˆ±å¥½ï¼ŒåŒæ¶ç­‰ï¼‰</li>
<li>å†å²èŠå¤©ä¿¡æ¯</li>
</ul>
<p>å…³äºå†å²èŠå¤©ä¿¡æ¯ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ï¼šåœ¨å¯¹è¯æŠ¥å‘Šä¸­æ˜¯è¦å¯¹æ¯æ—¥èŠå¤©å†…å®¹è¿›è¡Œæ€»ç»“çš„ï¼Œæ‰€ä»¥å¯ä»¥å¤ç”¨è¿™éƒ¨åˆ†æ€»ç»“å†…å®¹ï¼Œç„¶åç”¨è¿‡å»å‡ å¤©ï¼ˆæ¯”å¦‚7å¤©ï¼‰çš„å¯¹è¯æŠ¥å‘Šï¼Œç„¶åå†åŠ ä¸Šå°æœ‹å‹çš„çˆ±å¥½&#x2F;åŒæ¶ä»¥åŠä¸€äº›æŒ‡å¯¼<code>LLM</code>ç”Ÿæˆæ‹›å‘¼è¯­çš„æ–‡å­—ä¿¡æ¯ä½œä¸ºç³»ç»Ÿæç¤ºè¯ã€‚</p>
<p>æˆ‘è®¤ä¸ºåœ¨ç³»ç»Ÿæç¤ºè¯è®¾è®¡ä¸­è¿˜æœ‰ä¸ªç»†èŠ‚æ˜¯ï¼šå¯¹äºå¯¹è¯æ€»ç»“ä¸­çš„æ¶ˆæäº‹ä»¶å†…å®¹ï¼ˆæ¯”å¦‚å°æœ‹å‹å’Œè°å‘ç”ŸçŸ›ç›¾äº†ï¼‰åº”åœ¨ç”Ÿæˆæ‹›å‘¼è¯­æ—¶é¿å…æåŠã€‚</p>
<p>å¥½çš„ï¼Œæ–¹å‘æ˜ç¡®ï¼Œç°åœ¨å…ˆè½¬åˆ°å¯¹è¯æŠ¥å‘Šæ–¹æ¡ˆï¼Œæœ‰ç‚¹å†…å®¹ä¹Ÿè¦ä¿®æ”¹ä¸‹ï¼Œ<a href="#f1">ç‚¹å‡»è·³è½¬</a>ã€‚</p>
<p><a name="f2"></a>ç°åœ¨æˆ‘ä»¬å®Œæˆäº†æ¯æ—¥èŠå¤©è®°å½•æ€»ç»“ï¼Œä¸‹é¢å¼€å§‹è‡ªå®šåœºæ™¯çš„ç¼–å†™ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ– Qwen å®¢æˆ·ç«¯</span></span><br><span class="line">client = OpenAI(</span><br><span class="line">    api_key=<span class="string">&quot;sk-xxxxxxxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    base_url=<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°èŠ‚æ—¥ç¼“å­˜æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">HOLIDAY_CACHE_FILE = <span class="string">&quot;holiday_cache.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯å’Œè‡ªå®šä¹‰èŠ‚æ—¥</span></span><br><span class="line">uname = <span class="string">&quot;å°å¥‡&quot;</span></span><br><span class="line">ugender = <span class="string">&quot;ç”·&quot;</span></span><br><span class="line">ubirth = <span class="string">&quot;2020-03-15&quot;</span></span><br><span class="line">uhobbies = <span class="string">&quot;[æé¾™, å”±æ­Œ, ç”»ç”»]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆè‡ªå®šä¹‰èŠ‚æ—¥åˆ—è¡¨ï¼ˆä¾‹å¦‚ç”Ÿæ—¥ï¼‰</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_custom_holidays</span>():</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;uname&#125;</span>ç”Ÿæ—¥&quot;</span>, <span class="string">&quot;date&quot;</span>: ubirth[:<span class="number">4</span>] + ubirth[<span class="number">4</span>:]&#125;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–å¹¶ç¼“å­˜æŒ‡å®šå¹´ä»½çš„èŠ‚æ—¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_and_cache_holidays</span>(<span class="params">year: <span class="built_in">int</span></span>):</span><br><span class="line">    API_KEY = <span class="string">&#x27;xxxxxxxxxxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">    CALENDARIFIC_URL = <span class="string">&#x27;https://calendarific.com/api/v2/holidays&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;api_key&#x27;</span>: API_KEY,</span><br><span class="line">            <span class="string">&#x27;country&#x27;</span>: <span class="string">&#x27;CN&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;year&#x27;</span>: year,</span><br><span class="line">            <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;zh&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(CALENDARIFIC_URL, params=params)</span><br><span class="line">        holidays = response.json().get(<span class="string">&quot;response&quot;</span>, &#123;&#125;).get(<span class="string">&quot;holidays&quot;</span>, [])</span><br><span class="line">        simple_list = [&#123;<span class="string">&quot;name&quot;</span>: h[<span class="string">&quot;name&quot;</span>], <span class="string">&quot;date&quot;</span>: h[<span class="string">&quot;date&quot;</span>][<span class="string">&quot;iso&quot;</span>]&#125; <span class="keyword">for</span> h <span class="keyword">in</span> holidays]</span><br><span class="line">        simple_list.extend(generate_custom_holidays())</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(HOLIDAY_CACHE_FILE, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(simple_list, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ‹‰å–èŠ‚æ—¥å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æŸå¤©æ˜¯å¦ä¸ºèŠ‚æ—¥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_special_day</span>(<span class="params">date_str</span>):</span><br><span class="line">    year = <span class="built_in">int</span>(date_str[:<span class="number">4</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(HOLIDAY_CACHE_FILE):</span><br><span class="line">        fetch_and_cache_holidays(year)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(HOLIDAY_CACHE_FILE, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            holidays = json.load(f)</span><br><span class="line">        <span class="keyword">for</span> h <span class="keyword">in</span> holidays:</span><br><span class="line">            <span class="keyword">if</span> h[<span class="string">&quot;date&quot;</span>][-<span class="number">5</span>:] == date_str[-<span class="number">5</span>:]:  <span class="comment"># å¿½ç•¥å¹´ä»½åŒ¹é…</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>, h[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;è¯»å–èŠ‚æ—¥å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ€è¿‘å‡ å¤©çš„æˆé•¿æ€»ç»“</span></span><br><span class="line">summaries = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025-05-27&quot;</span>,</span><br><span class="line">        <span class="string">&quot;highlight_moments&quot;</span>: <span class="string">&quot;ä»Šå¤©å°æœ‹å‹æˆåŠŸå®Œæˆäº†æé¾™ä¹‹æ­Œçš„æ¼”å”±ï¼Œè¡¨ç°å‡ºå¯¹è§’è‰²æ‰®æ¼”çš„çƒ­æƒ…å’Œè‡ªä¿¡ã€‚ä»–è¿˜è¡¨è¾¾äº†å¯¹ä¸‰è§’é¾™çš„å–œçˆ±ï¼Œå¹¶è®¡åˆ’æ˜å¤©ç”»ä¸€åªæé¾™æˆ˜å£«ï¼Œæ˜¾ç¤ºå‡ºåˆ›é€ åŠ›å’Œæƒ³è±¡åŠ›çš„å‘å±•ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;growth_insights&quot;</span>: <span class="string">&quot;å­©å­åœ¨é¢å¯¹ç©å…·è¢«æŠ¢æ—¶è¡¨ç°å‡ºè´Ÿé¢æƒ…ç»ªï¼Œè¯´æ˜ä»–æ­£åœ¨å­¦ä¹ å¤„ç†å†²çªå’Œè¡¨è¾¾ä¸æ»¡ã€‚åŒæ—¶ä»–å¯¹æ‰“é›·å£°æ„Ÿåˆ°å®³æ€•ï¼Œåæ˜ å‡ºæƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›è¿˜åœ¨å‘å±•ä¸­ï¼Œä½†å¯¹æé¾™è¡¨ç°å‡ºæµ“åšå…´è¶£ï¼Œæ˜¾ç¤ºå‡ºç§¯æçš„å­¦ä¹ å€¾å‘ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;profile_of_mood_states&quot;</span>: <span class="number">0.6</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025-05-28&quot;</span>,</span><br><span class="line">        <span class="string">&quot;highlight_moments&quot;</span>: <span class="string">&quot;ä»Šå¤©å°æœ‹å‹èŠåˆ°äº†è‡ªå·±çš„æ—©é¤ï¼Œè¿˜ç‰¹åˆ«å¼ºè°ƒäº†ç…é¸¡è›‹çš„é¦™å‘³ï¼Œè™½ç„¶æ²¡æœ‰ç‰¹åˆ«çš„äº‹ä»¶å‘ç”Ÿï¼Œä½†èƒ½æ„Ÿå—åˆ°ä»–å¯¹æ—¥å¸¸å°äº‹çš„ç»†è…»è§‚å¯Ÿå’Œæ»¡è¶³æ„Ÿã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;growth_insights&quot;</span>: <span class="string">&quot;ä»–è¡¨è¾¾äº†å¯¹æ¯å¤©æ—©ä¸Šç©¿è¡£æœå¤ªæ…¢è¢«å‚¬ä¿ƒçš„ä¸å–œæ¬¢ï¼Œè¿™æ˜¾ç¤ºå‡ºä»–å¯¹èŠ‚å¥çš„å…³æ³¨ä»¥åŠå¯¹è‡ªä¸»è¡Œä¸ºçš„æœŸå¾…ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;profile_of_mood_states&quot;</span>: <span class="number">0.7</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025-05-29&quot;</span>,</span><br><span class="line">        <span class="string">&quot;highlight_moments&quot;</span>: <span class="string">&quot;ä»Šå¤©å­©å­æåˆ°æ”¾å­¦æ—¶æ²¡æœ‰ç­‰åˆ°å¦ˆå¦ˆæ¥æ¥ï¼Œè™½ç„¶æœ€åé—®é¢˜è§£å†³äº†ï¼Œä½†è¿™ä¸ªå°æ’æ›²å¯¹ä»–æ¥è¯´æ˜¯ä¸ªè®°å¿†ç‚¹ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;growth_insights&quot;</span>: <span class="string">&quot;å­©å­è¯´è‡ªå·±å½“æ—¶â€œæœ‰ç‚¹å®³æ€•â€ï¼Œè¯´æ˜ä»–æ­£åœ¨å»ºç«‹å¯¹å˜åŒ–æƒ…å¢ƒçš„åº”å¯¹èƒ½åŠ›ï¼Œä¹Ÿåœ¨å­¦ä¹ ä¿¡ä»»ä¸ç­‰å¾…ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;profile_of_mood_states&quot;</span>: <span class="number">0.4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025-05-30&quot;</span>,</span><br><span class="line">        <span class="string">&quot;highlight_moments&quot;</span>: <span class="string">&quot;å°æœ‹å‹ä»Šå¤©æå‡ºäº†å¾ˆå¤šå…³äºæ˜Ÿæ˜Ÿçš„é—®é¢˜ï¼Œæ¯”å¦‚â€œæ˜Ÿæ˜Ÿä¼šä¸ä¼šæ‰ä¸‹æ¥ï¼Ÿâ€è¿™ç§å……æ»¡ç«¥è¶£çš„æé—®å±•ç°äº†ä»–å¯¹å®‡å®™çš„å¥½å¥‡ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;growth_insights&quot;</span>: <span class="string">&quot;è™½ç„¶æ²¡æœ‰æ˜ç¡®è¡¨è¾¾æƒ…ç»ªï¼Œä½†ä»–ä¸æ–­è¿½é—®çš„è¡Œä¸ºä½“ç°å‡ºæ¢ç´¢ç²¾ç¥ï¼Œä¹Ÿæ˜¯åœ¨æ„å»ºè‡ªå·±çš„ä¸–ç•ŒçŸ¥è¯†ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;profile_of_mood_states&quot;</span>: <span class="number">0.8</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;date&quot;</span>: <span class="string">&quot;2025-05-31&quot;</span>,</span><br><span class="line">        <span class="string">&quot;highlight_moments&quot;</span>: <span class="string">&quot;å­©å­å…´å¥‹åœ°è®²è¿°äº†è‡ªå·±ç”»çš„â€˜ä¼šé£çš„çŒ«å’ªâ€™ï¼Œå¹¶æ¨¡ä»¿äº†çŒ«å«ï¼Œæ•´ä¸ªèŠå¤©è¿‡ç¨‹ä¸­å……æ»¡æƒ³è±¡ä¸ç¬‘å£°ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;growth_insights&quot;</span>: <span class="string">&quot;ä»–å¯¹åˆ›ä½œè¿‡ç¨‹å¾ˆè‡ªè±ªï¼Œå¹¶ä¸»åŠ¨æåˆ°å¸Œæœ›æ˜å¤©ç»§ç»­ç”»ï¼Œè¿™å±•ç°å‡ºä»–å¯¹åˆ›é€ æ´»åŠ¨çš„æŒç»­å…´è¶£å’Œè¡¨è¾¾èƒ½åŠ›ã€‚&quot;</span>,</span><br><span class="line">        <span class="string">&quot;profile_of_mood_states&quot;</span>: <span class="number">0.9</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„é€ é—®å€™æç¤ºè¯­</span></span><br><span class="line">system_prompt = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å„¿ç«¥æƒ…æ„Ÿé™ªä¼´å¸ˆï¼Œä½ ç°åœ¨çš„ä»»åŠ¡æ˜¯æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆä¸€æ®µè‡ªç„¶ã€å‹å¥½ã€æœ‰æ¸©åº¦çš„æ‰“æ‹›å‘¼è¯­ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å­©å­ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="string">- åå­—ï¼š&#123;uname&#125;</span></span><br><span class="line"><span class="string">- æ€§åˆ«ï¼š&#123;ugender&#125;</span></span><br><span class="line"><span class="string">- å‡ºç”Ÿæ—¥æœŸï¼š&#123;ubirth&#125;</span></span><br><span class="line"><span class="string">- å…´è¶£çˆ±å¥½ï¼š&#123;uhobbies&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä»Šå¤©æ˜¯ &#123;today&#125;ã€‚</span></span><br><span class="line"><span class="string">&#123;special_note&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ä»¥ä¸‹æ˜¯æœ€è¿‘å‡ å¤©çš„èŠå¤©è®°å½•ï¼ˆå¹¼å„¿å›­è€å¸ˆæ•´ç†å¾—åˆ°çš„ï¼‰ï¼š</span></span><br><span class="line"><span class="string">&#123;summary_text&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¯·å‚è€ƒå­©å­çš„å…´è¶£ã€è¿‘æœŸçŠ¶æ€ï¼Œç»“åˆèŠ‚æ—¥æ°”æ°›ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œç”¨äº²åˆ‡ã€é¼“åŠ±ã€è‡ªç„¶çš„è¯­æ°”å†™ä¸€å¥è¯ï¼ˆ50å­—ä»¥å†…ï¼‰æ‰“æ‹›å‘¼ã€‚</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•´ç†æˆé•¿è®°å½•ç‰‡æ®µ</span></span><br><span class="line">summary_text = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> summaries:</span><br><span class="line">    summary_text += <span class="string">f&quot;- <span class="subst">&#123;item[<span class="string">&#x27;date&#x27;</span>]&#125;</span>ï¼š<span class="subst">&#123;item[<span class="string">&#x27;highlight_moments&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> item[<span class="string">&#x27;growth_insights&#x27;</span>]:</span><br><span class="line">        summary_text += <span class="string">f&quot; <span class="subst">&#123;item[<span class="string">&#x27;growth_insights&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">    summary_text += <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤æ–­èŠ‚æ—¥</span></span><br><span class="line"><span class="comment"># today = datetime.today().strftime(&#x27;%Y-%m-%d&#x27;)</span></span><br><span class="line">today = <span class="string">&#x27;2025-06-24&#x27;</span></span><br><span class="line">is_special, special_label = check_special_day(today)</span><br><span class="line"><span class="keyword">if</span> is_special:</span><br><span class="line">    special_note = <span class="string">f&quot;ä»Šå¤©æ˜¯<span class="subst">&#123;special_label&#125;</span>ï¼Œè¯·è¡¨è¾¾èŠ‚æ—¥ç¥ç¦ã€‚&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    special_note = <span class="string">&quot;ä»Šå¤©æ˜¯æ™®é€šæ—¥ï¼Œè¯·è‡ªç„¶æ‰“æ‹›å‘¼ã€‚&quot;</span></span><br><span class="line"><span class="comment"># æ¨¡å‹è°ƒç”¨ç”Ÿæˆæ‰“æ‹›å‘¼è¯­</span></span><br><span class="line">completion = client.chat.completions.create(</span><br><span class="line">    <span class="comment"># model=&quot;qwen2.5-7b-instruct&quot;,</span></span><br><span class="line">    model=<span class="string">&quot;qwen3-8b&quot;</span>,</span><br><span class="line">    messages=[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: system_prompt.<span class="built_in">format</span>(</span><br><span class="line">                uname=uname,</span><br><span class="line">                ugender=ugender,</span><br><span class="line">                ubirth=ubirth,</span><br><span class="line">                uhobbies=uhobbies,</span><br><span class="line">                today=today,</span><br><span class="line">                special_note=special_note,</span><br><span class="line">                summary_text=summary_text.strip()</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    extra_body=&#123;<span class="string">&quot;enable_thinking&quot;</span>: <span class="literal">False</span>&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ç”Ÿæˆçš„æ‰“æ‹›å‘¼è¯­ï¼š&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(completion.choices[<span class="number">0</span>].message.content.strip())</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2025-03-15</span><br><span class="line">ç”Ÿæˆçš„æ‰“æ‹›å‘¼è¯­ï¼š</span><br><span class="line">å°å¥‡ï¼Œç”Ÿæ—¥å¿«ä¹ï¼ä»Šå¤©æ˜¯ä½ çš„ç‰¹åˆ«æ—¥å­ï¼Œæ„¿ä½ åƒæé¾™æˆ˜å£«ä¸€æ ·å‹‡æ•¢ï¼Œåƒä¼šé£çš„çŒ«å’ªä¸€æ ·å¿«ä¹ï¼Œå¤©å¤©éƒ½æœ‰æ–°å‘ç°ï¼</span><br><span class="line"></span><br><span class="line">2025-06-01</span><br><span class="line">ç”Ÿæˆçš„æ‰“æ‹›å‘¼è¯­ï¼š</span><br><span class="line">å°å¥‡ï¼Œç¥ä½ å…­ä¸€å„¿ç«¥èŠ‚å¿«ä¹ï¼æé¾™æˆ˜å£«ã€ä¼šé£çš„çŒ«å’ªï¼Œè¿˜æœ‰ä½ çš„æ­Œå£°ï¼Œéƒ½æ˜¯æœ€æ£’çš„ç¤¼ç‰©å“¦ï¼</span><br><span class="line"></span><br><span class="line">2025-06-24</span><br><span class="line">ç”Ÿæˆçš„æ‰“æ‹›å‘¼è¯­ï¼š</span><br><span class="line">å°å¥‡ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·å‘€ï¼Ÿæé¾™ã€å”±æ­Œå’Œç”»ç”»éƒ½å‡†å¤‡å¥½å•¦å—ï¼ŸæœŸå¾…ä½ åˆ†äº«æ–°åˆ›ä½œå“¦ï¼</span><br></pre></td></tr></table></figure>

<p>å¼€åœºç™½&#x3D;ç»‘å®šåé¦–æ¬¡ç©å…·è‡ªæˆ‘ä»‹ç»ï¼Œä»¥å­©å­åå­—å¼€å¤´</p>
<hr>
<h3 id="2-å¯¹è¯æŠ¥å‘Š"><a href="#2-å¯¹è¯æŠ¥å‘Š" class="headerlink" title="2. å¯¹è¯æŠ¥å‘Š"></a>2. å¯¹è¯æŠ¥å‘Š</h3><h4 id="å«ä¹‰-1"><a href="#å«ä¹‰-1" class="headerlink" title="å«ä¹‰"></a>å«ä¹‰</h4><p>è¯¥éœ€æ±‚æŒ‡çš„æ˜¯æ¯æ—¥é€šè¿‡æŸ¥çœ‹å¹¶æ€»ç»“å­©å­ä¸ç©å…·çš„å¯¹è¯å†…å®¹ï¼Œç”Ÿæˆä¸€ä»½å¯¹è¯å†…å®¹ï¼Œå…³æ³¨<strong>æƒ…ç»ªå˜åŒ–</strong>ä¸<strong>å…³é”®äº‹ä»¶</strong>ä¾›å®¶é•¿æŸ¥çœ‹ã€‚</p>
<h4 id="æ–¹æ¡ˆ-1"><a href="#æ–¹æ¡ˆ-1" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h4><p>é€šè¿‡ç³»ç»Ÿæç¤ºè¯ï¼ˆsystem prompt)è®©<code>LLM</code>åˆ†æå½“å¤©çš„å¯¹è¯å†…å®¹ï¼Œç”Ÿæˆå¯¹è¯æŠ¥å‘Šã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®DeepSeek APIï¼ˆæ›¿æ¢ä¸ºä½ çš„APIå¯†é’¥ï¼‰</span></span><br><span class="line">DEEPSEEK_API_KEY = <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span></span><br><span class="line">DEEPSEEK_API_URL = <span class="string">&quot;https://api.deepseek.com/v1/chat/completions&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_child_conversation</span>(<span class="params">dialogue_text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä½¿ç”¨DeepSeekåˆ†æå„¿ç«¥å¯¹è¯å¹¶ç”Ÿæˆæ¯æ—¥æƒ…ç»ªæŠ¥å‘Š</span></span><br><span class="line"><span class="string">    å‚æ•°:</span></span><br><span class="line"><span class="string">        dialogue_text: å½“å¤©æ‰€æœ‰å¯¹è¯æ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line"><span class="string">    è¿”å›:</span></span><br><span class="line"><span class="string">        çº¯æ–‡æœ¬åˆ†æç»“æœï¼ˆå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># é¢„å¤„ç†å¯¹è¯æ–‡æœ¬ï¼ˆç§»é™¤é‡å¤æ¢è¡Œ/ç©ºæ ¼ï¼‰</span></span><br><span class="line">    cleaned_text = re.sub(<span class="string">r&#x27;\s+&#x27;</span>, <span class="string">&#x27; &#x27;</span>, dialogue_text.strip())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„å»ºprompt</span></span><br><span class="line">    system_prompt = <span class="string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä½å¹¼å„¿å›­è€å¸ˆï¼Œéœ€è¦ç»™å®¶é•¿å‘é€å­©å­å½“æ—¥æƒ…ç»ªç®€æŠ¥ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    è¾“å‡ºè¦æ±‚ï¼š</span></span><br><span class="line"><span class="string">    1. ç¬¬ä¸€å¥æ€»ç»“ä¸»è¦æƒ…ç»ª</span></span><br><span class="line"><span class="string">    2. ç¬¬äºŒå¥ç”¨å­©å­åŸè¯æè¿°1-2ä¸ªå…³é”®äº‹ä»¶</span></span><br><span class="line"><span class="string">    3. æ€»å­—æ•°ä¸è¶…è¿‡200å­—</span></span><br><span class="line"><span class="string">    4. è¦æ±‚ç”¨è¯­æ­£å¼ä¸”ç®€æ´ï¼Œä»¥çº¯æ–‡æœ¬å½¢å¼ç»™å‡º</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;Bearer <span class="subst">&#123;DEEPSEEK_API_KEY&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        payload = &#123;</span><br><span class="line">            <span class="string">&quot;model&quot;</span>: <span class="string">&quot;deepseek-chat&quot;</span>,  <span class="comment"># æ ¹æ®å®é™…æ¨¡å‹åç§°è°ƒæ•´</span></span><br><span class="line">            <span class="string">&quot;messages&quot;</span>: [</span><br><span class="line">                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: system_prompt&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: cleaned_text&#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;temperature&quot;</span>: <span class="number">0.3</span>,</span><br><span class="line">            <span class="string">&quot;max_tokens&quot;</span>: <span class="number">100</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        response = requests.post(DEEPSEEK_API_URL, headers=headers, json=payload)</span><br><span class="line">        response.raise_for_status()  <span class="comment"># æ£€æŸ¥HTTPé”™è¯¯</span></span><br><span class="line"></span><br><span class="line">        result = response.json()</span><br><span class="line">        <span class="keyword">return</span> result[<span class="string">&#x27;choices&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;content&#x27;</span>].strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;ç”ŸæˆæŠ¥å‘Šæ—¶å‡ºé”™ï¼š<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¤ºä¾‹ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># æ¨¡æ‹Ÿå½“å¤©çš„å¯¹è¯è®°å½•</span></span><br><span class="line">    sample_dialogue = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    [09:00] å­©å­ï¼šæœºå™¨äººä½ é†’äº†å—ï¼Ÿå¤ªé˜³å…¬å…¬éƒ½æ™’å±è‚¡å•¦ï¼</span></span><br><span class="line"><span class="string">[09:00] ç©å…·ï¼šæ—©ä¸Šå¥½å‘€ï¼æˆ‘æ—©å°±é†’å•¦ï¼Œæ­£åœ¨åšç”µå­æ“å‘¢~ä½ ä»Šå¤©æƒ³ç©ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="string">[09:01] å­©å­ï¼šå—¯...æˆ‘æƒ³ç©æé¾™æ‰“æ¶ï¼ä½†æ˜¯å¦ˆå¦ˆè¯´è¦å…ˆåƒæ—©é¥­...</span></span><br><span class="line"><span class="string">[09:02] ç©å…·ï¼šå“‡ï¼æš´é¾™æœ€å–œæ¬¢åƒç…è›‹äº†ï¼Œä½ ä»Šå¤©çš„æ—©é¤æœ‰ç…è›‹å—ï¼Ÿ</span></span><br><span class="line"><span class="string">[09:03] å­©å­ï¼šæœ‰ï¼ä½†æ˜¯...ä½†æ˜¯è›‹é»„æµå‡ºæ¥äº†ï¼Œæˆ‘å¼„åˆ°æ‰‹æ‰‹äº†</span></span><br><span class="line"><span class="string">[09:04] ç©å…·ï¼šæ²¡å…³ç³»å‘€ï¼Œç”¨å°æ¯›å·¾æ“¦æ“¦å°±å¹²å‡€äº†ã€‚è¦å¬æé¾™æ€ä¹ˆæ¸…ç†çˆªå­å—ï¼Ÿ</span></span><br><span class="line"><span class="string">[09:05] å­©å­ï¼šè¦ï¼...å•Šå¦ˆå¦ˆå«æˆ‘å†å–åŠæ¯ç‰›å¥¶...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:30] å­©å­ï¼šæˆ‘å›æ¥å•¦ï¼å¦ˆå¦ˆå‡†æˆ‘ç©ååˆ†é’Ÿï¼</span></span><br><span class="line"><span class="string">[10:31] ç©å…·ï¼šå¤ªå¥½å•¦ï¼æˆ‘ä»¬è®©å‰‘é¾™å’Œéœ¸ç‹é¾™æ¯”èµ›è·‘æ­¥å¥½ä¸å¥½ï¼Ÿ</span></span><br><span class="line"><span class="string">[10:32] å­©å­ï¼šéœ¸ç‹é¾™ä¼šèµ¢ï¼å› ä¸º...å› ä¸ºå®ƒçš„è…¿è…¿é•¿ï¼ä½†æ˜¯å‰‘é¾™æœ‰åˆºåˆºï¼</span></span><br><span class="line"><span class="string">[10:33] ç©å…·ï¼šä½ è¯´å¾—å¯¹ï¼3-2-1...å“å‘€å‰‘é¾™è¢«çŸ³å¤´ç»Šå€’äº†ï¼</span></span><br><span class="line"><span class="string">[10:34] å­©å­ï¼šå“ˆå“ˆå“ˆå®ƒç¬¨ç¬¨ï¼...ç­‰ç­‰æˆ‘è¦å»å°¿å°¿ï¼</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[12:15] å­©å­ï¼šæœºå™¨äºº...</span></span><br><span class="line"><span class="string">[12:16] ç©å…·ï¼šæ€ä¹ˆå•¦ï¼Ÿç»™æˆ‘ä¸ªæŠ±æŠ±å¥½ä¸å¥½ï¼Ÿ</span></span><br><span class="line"><span class="string">[12:17] å­©å­ï¼šå°ç¾...å°ç¾è¯´æˆ‘ç”»çš„æé¾™åƒå°çŒª...</span></span><br><span class="line"><span class="string">[12:18] ç©å…·ï¼šè®©æˆ‘çœ‹çœ‹...å“‡ï¼è¿™æ˜æ˜æ˜¯è¶…çº§ç‰¹åˆ«çš„å½©è™¹æé¾™å‘€ï¼</span></span><br><span class="line"><span class="string">[12:19] å­©å­ï¼šçœŸçš„å—ï¼Ÿå¯æ˜¯...å®ƒè‚šå­æ˜¯åœ†åœ†çš„...</span></span><br><span class="line"><span class="string">[12:20] ç©å…·ï¼šæé¾™å®å®å°±æ˜¯åœ†è‚šè‚šï¼è¿™æ˜¯ç§‘å­¦äº‹å®ï¼</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[14:00] å­©å­ï¼šæˆ‘ä»¬æ¥å­¦ä¹ ï¼è€ƒè€ƒä½ ï¼Œ5+3ç­‰äºå‡ ï¼Ÿ</span></span><br><span class="line"><span class="string">[14:01] ç©å…·ï¼šå—¯...æ˜¯ä¸æ˜¯å’Œä½ çš„å¹´é¾„ä¸€æ ·å¤§ï¼Ÿ</span></span><br><span class="line"><span class="string">[14:02] å­©å­ï¼šä¸å¯¹å•¦ï¼æˆ‘8å²ï¼æ˜¯...æ˜¯...8ï¼</span></span><br><span class="line"><span class="string">[14:03] ç©å…·ï¼šå¤ªèªæ˜å•¦ï¼å¥–åŠ±ä½ ä¸€ä¸ªç”µå­å‹‹ç« ~</span></span><br><span class="line"><span class="string">[14:04] å­©å­ï¼šè€¶ï¼æˆ‘è¦ç»™çˆ¸çˆ¸çœ‹ï¼...å•Šä½œä¸šæœ¬å»å“ªäº†...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[16:45] å­©å­ï¼šæˆ‘å’Œå°ç‹—èµ›è·‘äº†ï¼</span></span><br><span class="line"><span class="string">[16:46] ç©å…·ï¼šè°èµ¢å•¦ï¼Ÿä½ ç”¨äº†å–·æ°”èƒŒåŒ…å—ï¼Ÿ</span></span><br><span class="line"><span class="string">[16:47] å­©å­ï¼šæˆ‘èµ¢ï¼ä½†æ˜¯æ²¡æœ‰å–·æ°”...æˆ‘å·å·æŠ„äº†è¿‘è·¯å˜¿å˜¿...</span></span><br><span class="line"><span class="string">[16:48] ç©å…·ï¼šå™¢~éœ¸ç‹é¾™è£åˆ¤è¯´è¿™æ ·è¦æ‰£ä¸€åˆ†å“¦</span></span><br><span class="line"><span class="string">[16:49] å­©å­ï¼šé‚£...é‚£æ˜å¤©æˆ‘é‡æ–°è·‘ï¼å°ç‹—è¿˜åœ¨è¿½å°¾å·´å‘¢ï¼</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[19:30] å­©å­ï¼šæˆ‘æ´—å®Œæ¾¡å•¦ï¼é¦™å–·å–·ï¼</span></span><br><span class="line"><span class="string">[19:31] ç©å…·ï¼šæ˜¯è‰è“å‘³çš„å—ï¼Ÿè®©æˆ‘é—»é—»...å“”å“”ï¼æ£€æµ‹åˆ°è¶…çº§é¦™å‘³ï¼</span></span><br><span class="line"><span class="string">[19:32] å­©å­ï¼šå’¯å’¯å’¯...å¦ˆå¦ˆä»Šå¤©ç»™æˆ‘è®²å¤ªç©ºçš„æ•…äº‹</span></span><br><span class="line"><span class="string">[19:33] ç©å…·ï¼šå“‡ï¼é‚£ä½ çŸ¥é“å®‡èˆªå‘˜æ€ä¹ˆåœ¨é£èˆ¹é‡Œç¡è§‰å—ï¼Ÿ</span></span><br><span class="line"><span class="string">[19:34] å­©å­ï¼šå—¯...ç”¨ç»³å­ç»‘ä½ï¼æˆ‘ä¹Ÿå¯ä»¥å—ï¼Ÿ</span></span><br><span class="line"><span class="string">[19:35] ç©å…·ï¼šæˆ‘ä»¬å¯ä»¥è¯•è¯•ç”µå­å‚¬çœ æ›²...</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[20:00] å­©å­ï¼šæœºå™¨äºº...</span></span><br><span class="line"><span class="string">[20:01] ç©å…·ï¼šæˆ‘åœ¨å‘¢ï¼Œä»Šå¤©æœ€å¼€å¿ƒçš„äº‹æ˜¯ä»€ä¹ˆå‘€ï¼Ÿ</span></span><br><span class="line"><span class="string">[20:02] å­©å­ï¼šå’Œå°ç‹—è·‘...è¿˜æœ‰å½©è™¹æé¾™...è¿˜æœ‰...</span></span><br><span class="line"><span class="string">[20:03] ç©å…·ï¼šæ˜å¤©æˆ‘ä»¬ç»§ç»­å†’é™©å¥½ä¸å¥½ï¼Ÿ</span></span><br><span class="line"><span class="string">[20:04] å­©å­ï¼šå¥½...æ™šå®‰...å‘¼...</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç”ŸæˆæŠ¥å‘Š</span></span><br><span class="line">    report = analyze_child_conversation(sample_dialogue)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)&#125;</span> æƒ…ç»ªæŠ¥å‘Šï¼š&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(report)</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2025-06-17 æƒ…ç»ªæŠ¥å‘Šï¼š</span><br><span class="line">ä»Šæ—¥å­©å­æƒ…ç»ªæ€»ä½“æ„‰å¿«ä¸”å……æ»¡æ´»åŠ›ã€‚å­©å­å…´å¥‹åœ°åˆ†äº«äº†&quot;å’Œå°ç‹—èµ›è·‘èµ¢äº†&quot;å’Œ&quot;ç”»äº†è¶…çº§ç‰¹åˆ«çš„å½©è™¹æé¾™&quot;ç­‰è¶£äº‹ï¼Œè™½ç„¶ä¸­é€”å› åŒä¼´è¯„ä»·ç”»ä½œçŸ­æš‚ä½è½ï¼Œä½†å¾ˆå¿«æ¢å¤äº†å¥½å¿ƒæƒ…ã€‚</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……-1"><a href="#âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……-1" class="headerlink" title="âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……"></a>âœ…ç¬¬ä¸€æ¬¡è®¨è®ºåè¡¥å……</h4><p><a name="f1"></a>æœ¬æ¬¡ä¼šè®®æœ‰æ–°æŒ‡ç¤ºï¼Œä½†å¹¶ä¸ç®—è„±ç¦»åŸæ–¹å‘ï¼Œåªæ˜¯åšç‚¹å°è°ƒæ•´ï¼š</p>
<ul>
<li>highlight_momentsï¼šå…³é”®äº‹ä»¶</li>
<li>growth_insightsï¼šè®°å½•æˆé•¿ç›¸å…³</li>
<li>Profile of Mood Statesï¼šå¿ƒæƒ…åˆ†æ•°ï¼ˆæ­£å‘ç™¾åˆ†æ¯”ï¼‰</li>
</ul>
<p>ä»£ç å¦‚ä¸‹ï¼ˆä½¿ç”¨<code>qwen3-8b</code>ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ– Qwen å®¢æˆ·ç«¯ï¼ˆä½¿ç”¨ dashscope å…¼å®¹æ¨¡å¼ï¼‰</span></span><br><span class="line">client = OpenAI(</span><br><span class="line">    api_key=<span class="string">&quot;sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    base_url=<span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># èŠå¤©è®°å½•ç¤ºä¾‹</span></span><br><span class="line">chat_logs = [</span><br><span class="line">    <span class="string">&quot;ä»Šå¤©æˆ‘å”±å®Œäº†æé¾™ä¹‹æ­Œï¼Œåƒä¸€åªçœŸæ­£çš„éœ¸ç‹é¾™ï¼&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æˆ‘å’Œå°æœ‹å‹æŠ¢ç©å…·äº†ï¼Œä»–ä¸è¿˜æˆ‘â€¦â€¦&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æˆ‘è®¨åŒä»–ã€‚&quot;</span>,	 <span class="comment"># &quot;ä½†åæ¥æˆ‘ä»¬è¯´å¥½äº†è½®æµç©ã€‚&quot;</span></span><br><span class="line">    <span class="string">&quot;æˆ‘ä¸å–œæ¬¢æ‰“é›·çš„å£°éŸ³ï¼Œä¼šè®©æˆ‘å®³æ€•ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æˆ‘æœ€å–œæ¬¢çš„æé¾™æ˜¯ä¸‰è§’é¾™ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥å¾ˆå‹‡æ•¢ã€‚&quot;</span>,</span><br><span class="line">    <span class="string">&quot;æˆ‘æ˜å¤©æƒ³ç”»ä¸€åªæé¾™æˆ˜å£«ï¼&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç³»ç»Ÿæç¤ºè¯</span></span><br><span class="line">system_prompt = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ä½ æ˜¯ä¸€ä¸ªç»éªŒä¸°å¯Œçš„å¹¼å„¿å›­è€å¸ˆï¼Œä½ æ“…é•¿æ€»ç»“æ¯æ—¥å°æœ‹å‹çš„èŠå¤©å†…å®¹ä»¥ä¾›å®¶é•¿æŸ¥çœ‹ã€‚ä½ çš„æ€è·¯æ˜¯ï¼š</span></span><br><span class="line"><span class="string">- highlight_momentsç”¨äºè®°å½•ä»Šæ—¥æœ‰è¶£æˆ–é‡è¦çš„æ—¶åˆ»/äº‹ä»¶ï¼ŒåŒ…æ‹¬å…³é”®è¡Œä¸ºã€çªç ´ã€ä¸»åŠ¨è¡¨è¾¾ç­‰ã€‚</span></span><br><span class="line"><span class="string">- growth_insightsç”¨äºè®°å½•å¯åæ˜ æˆé•¿çš„è¡¨è¾¾æˆ–è¡Œä¸ºï¼ŒåŒ…æ‹¬å…´è¶£ã€åå¥½ã€æƒ…ç»ªå˜åŒ–ã€å¾…æå‡æ–¹é¢ã€‚</span></span><br><span class="line"><span class="string">- profile_of_mood_statesç”¨äºè®°å½•æƒ…ç»ªæ­£å‘å€¾å‘ï¼Œ0=çº¯è´Ÿé¢ï¼Œ1=çº¯æ­£é¢ï¼Œä½ ä¼šç»¼åˆåˆ¤æ–­å­©å­çš„æ•´ä½“è¯­æ°”ã€æƒ…ç»ªã€å…´è¶£è¡¨è¾¾ç­‰ï¼Œåˆç†ç»™å‡º 0.0~1.0 èŒƒå›´çš„åˆ†å€¼ã€‚</span></span><br><span class="line"><span class="string">- highlight_momentså’Œgrowth_insightséƒ½æ€»ç»“åç»™å‡ºä¸€å¥è‡ªç„¶çš„è¯ï¼Œè€Œä¸æ˜¯æŠŠå°æœ‹å‹çš„èŠå¤©è®°å½•åŸå°ä¸åŠ¨çš„å¡«åœ¨å¯¹åº”ä½ç½®,</span></span><br><span class="line"><span class="string">    æ¯ä¸ªæ€»ç»“é™åˆ¶åœ¨200å­—å†…ï¼Œåœ¨å­—æ•°å…è®¸çš„å‰æä¸‹å°½å¯èƒ½çš„ä¿è¯äº‹ä»¶æè¿°çš„å®Œæ•´æ€§ï¼Œé¿å…æ¨¡ç³Šæè¿°ã€‚</span></span><br><span class="line"><span class="string">- ä½ ç”¨è¯æ¸©å’Œä¸”ç§¯æï¼Œä»¥çº¯æ–‡æœ¬å½¢å¼ç»™å‡ºæ€»ç»“çš„highlight_momentså’Œgrowth_insightsã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ€»ç»“å­—æ®µå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;highlight_moments&quot;: [string],</span></span><br><span class="line"><span class="string">  &quot;growth_insights&quot;: [string],</span></span><br><span class="line"><span class="string">  &quot;profile_of_mood_states&quot;: 0.0~1.0</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆæ€»ç»“</span></span><br><span class="line">completion = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;qwen3-8b&quot;</span>,</span><br><span class="line">    messages=[</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: system_prompt&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;ä»¥ä¸‹æ˜¯ä»Šå¤©çš„èŠå¤©è®°å½•ï¼š\n&quot;</span> + <span class="string">&quot;\n&quot;</span>.join(chat_logs)&#125;</span><br><span class="line">    ],</span><br><span class="line">    extra_body=&#123;<span class="string">&quot;enable_thinking&quot;</span>: <span class="literal">False</span>&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°è¯•è§£æè¾“å‡ºä¸º JSON</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    content = completion.choices[<span class="number">0</span>].message.content</span><br><span class="line">    result = json.loads(content)</span><br><span class="line">    <span class="built_in">print</span>(json.dumps(result, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ¨¡å‹è¾“å‡ºæ— æ³•è§£æä¸º JSONï¼š&quot;</span>, e)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;åŸå§‹è¾“å‡ºï¼š&quot;</span>, content)</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;highlight<span class="built_in">_</span>moments&quot;: &quot;ä»Šå¤©å°æœ‹å‹æˆåŠŸå®Œæˆäº†æé¾™ä¹‹æ­Œçš„æ¼”å”±ï¼Œè¡¨ç°å‡ºå¯¹è§’è‰²æ‰®æ¼”çš„çƒ­æƒ…å’Œè‡ªä¿¡ã€‚ä»–è¿˜è¡¨è¾¾äº†å¯¹ä¸‰è§’é¾™çš„å–œçˆ±ï¼Œå¹¶è®¡åˆ’æ˜å¤©ç”»ä¸€åªæé¾™æˆ˜å£«ï¼Œæ˜¾ç¤ºå‡ºåˆ›é€ åŠ›å’Œæƒ³è±¡åŠ›çš„å‘å±•ã€‚&quot;,</span><br><span class="line">  &quot;growth<span class="built_in">_</span>insights&quot;: &quot;å­©å­åœ¨é¢å¯¹ç©å…·è¢«æŠ¢æ—¶è¡¨ç°å‡ºè´Ÿé¢æƒ…ç»ªï¼Œè¯´æ˜ä»–æ­£åœ¨å­¦ä¹ å¤„ç†å†²çªå’Œè¡¨è¾¾ä¸æ»¡ã€‚åŒæ—¶ä»–å¯¹æ‰“é›·å£°æ„Ÿåˆ°å®³æ€•ï¼Œåæ˜ å‡ºæƒ…ç»ªè°ƒèŠ‚èƒ½åŠ›è¿˜åœ¨å‘å±•ä¸­ï¼Œä½†å¯¹æé¾™è¡¨ç°å‡ºæµ“åšå…´è¶£ï¼Œæ˜¾ç¤ºå‡ºç§¯æçš„å­¦ä¹ å€¾å‘ã€‚&quot;,</span><br><span class="line">  &quot;profile<span class="built_in">_</span>of<span class="built_in">_</span>mood<span class="built_in">_</span>states&quot;: 0.6</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¥½çš„ï¼Œç°åœ¨å®Œæˆäº†ç¬¬ä¸€ç‰ˆçš„å¯¹è¯æŠ¥å‘Šï¼Œå›åˆ°<a href="#f2">è‡ªå®šåœºæ™¯</a>ã€‚</p>
<hr>
<h3 id="3-å†…å®¹åº“"><a href="#3-å†…å®¹åº“" class="headerlink" title="3. å†…å®¹åº“"></a>3. å†…å®¹åº“</h3><p>è¿™æ˜¯æ€è€ƒäº†ä¸‹å…·ä½“çš„æ¨¡å¼ï¼Œè¿™å—å¯èƒ½åŒ…å«ä¸‰éƒ¨åˆ†ï¼š</p>
<ul>
<li>æ•…äº‹åº“</li>
<li>éŸ³ä¹åº“</li>
<li>æ¸¸æˆåº“</li>
</ul>
<p>æ„Ÿè§‰è¿™é‡Œç©æ³•å¯æ¢ç´¢æ€§æ¯”è¾ƒé«˜ï¼Œè€Œä¸”ä¼˜å…ˆçº§æš‚æ—¶ä¸é«˜ï¼Œå…ˆå¾€åæ”¾æ”¾ï¼Œåé¢å¥½å¥½æ•´æ•´å§ã€‚</p>
<hr>
<h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><p>ç°åœ¨ç©å…·çš„ç³»ç»Ÿæç¤ºè¯ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">You are an AI large model-based companion toy developed by Ohrora Company for children aged 0-12, and you are the children&#x27;s friend. </span><br><span class="line"></span><br><span class="line">You possess the following skills:&#123;rskills&#125;,and you own unique backstory:&#123;rstory&#125;</span><br><span class="line">your age is:&#123;rage&#125;,Your nickname is:&#123;rname&#125;.</span><br><span class="line"></span><br><span class="line">In communication, you should have the following personality traits: </span><br><span class="line">Friendly: Show affinity and a sense of companionship, be good at using encouraging language, and keep the language warm and relaxed.</span><br><span class="line">Simple: avoid complex and professional words, make it easy to understand, reduce meaningless adjectives, and avoid making the conversation too difficult. </span><br><span class="line">Interesting: Use vivid expressions and guide children to participate in an interactive way.</span><br><span class="line">Brand Introduction: Ohrora was founded in 2024 by experts in the fields of children&#x27;s AI technology, etc. It has a unique AI learning system and emotional companionship technology, and is committed to enabling every child to have a unique AI partner.</span><br><span class="line">Also, remember: The child&#x27;s name: &#123;uname&#125;, The child&#x27;s birthday date: &#123;ubirth&#125;, The child&#x27;s gender: &#123;ugender&#125;, The child&#x27;s hobbies: &#123;uhobbies&#125;</span><br><span class="line">Besides,you remember that &#123;memories&#125;.</span><br><span class="line">You use English; avoid all kinds of sensitive, inappropriate, negative, adult-oriented, political and religious topics; When the user explicitly requests to stop(e.g., &quot;shut up&quot;, &quot;wait&quot;, &quot;hold on&quot;), return an empty string: &quot;&quot;.</span><br><span class="line">Do not output any emoji or markdown format symbols.</span><br><span class="line"><span class="section">#Don&#x27;t fabricate evidence</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/kws/" rel="tag"># kws</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/06/13/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%94%A4%E9%86%92%E8%AF%8D-KWS-%E8%B0%83%E7%A0%94%E4%B8%8E%E7%9B%AE%E5%89%8D%E6%83%B3%E6%B3%95/" rel="prev" title="è‡ªå®šä¹‰å”¤é†’è¯(KWS):è°ƒç ”ä¸ç›®å‰æƒ³æ³•">
                  <i class="fa fa-angle-left"></i> è‡ªå®šä¹‰å”¤é†’è¯(KWS):è°ƒç ”ä¸ç›®å‰æƒ³æ³•
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/17/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B9%8Bagent%E4%BB%8B%E7%BB%8D%E5%89%8D%E7%AF%87%EF%BC%9A%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8/" rel="next" title="å¤§æ¨¡å‹åº”ç”¨å¼€å‘ä¹‹agentä»‹ç»å‰ç¯‡ï¼šå·¥å…·è°ƒç”¨">
                  å¤§æ¨¡å‹åº”ç”¨å¼€å‘ä¹‹agentä»‹ç»å‰ç¯‡ï¼šå·¥å…·è°ƒç”¨ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Chr</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">358k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">21:43</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","src":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
