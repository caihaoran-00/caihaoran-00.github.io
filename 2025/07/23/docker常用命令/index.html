<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"caihaoran-00.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前言今天在查看Shadowfita&#x2F;parakeet-tdt-0.6b-v2-fastapi这个仓库，看看他的实现有没有可取之处时，发现其使用了docker，转念一想，我还没从头捋下docker的命令，正好现在有时间，把这个坑填了吧。本文从两部分进行展开介绍docker基础用法：  从Docker Hub拉取镜像 自己构建镜像  Let’s go!">
<meta property="og:type" content="article">
<meta property="og:title" content="docker常用命令">
<meta property="og:url" content="https://caihaoran-00.github.io/2025/07/23/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/index.html">
<meta property="og:site_name" content="Chr&#39;s Blog">
<meta property="og:description" content="前言今天在查看Shadowfita&#x2F;parakeet-tdt-0.6b-v2-fastapi这个仓库，看看他的实现有没有可取之处时，发现其使用了docker，转念一想，我还没从头捋下docker的命令，正好现在有时间，把这个坑填了吧。本文从两部分进行展开介绍docker基础用法：  从Docker Hub拉取镜像 自己构建镜像  Let’s go!">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-23T11:39:47.000Z">
<meta property="article:modified_time" content="2025-07-28T06:35:14.727Z">
<meta property="article:author" content="Chr">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="nigix">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://caihaoran-00.github.io/2025/07/23/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://caihaoran-00.github.io/2025/07/23/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","path":"2025/07/23/docker常用命令/","title":"docker常用命令"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>docker常用命令 | Chr's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Chr's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Record and Share</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A3%E6%96%87"><span class="nav-number">2.</span> <span class="nav-text">正文</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E4%BB%8EDocker-Hub%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="nav-number">2.1.</span> <span class="nav-text">✅ 从Docker Hub拉取镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%A7%B0-%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E7%A1%AE%E8%AE%A4-Docker-%E5%B7%B2%E5%AE%89%E8%A3%85"><span class="nav-number">2.1.1.</span> <span class="nav-text">🧰 第一步：确认 Docker 已安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%93%A6-%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E4%BB%8E-Docker-Hub-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="nav-number">2.1.2.</span> <span class="nav-text">📦 第二步：从 Docker Hub 拉取镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%94%8D-%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E6%9F%A5%E7%9C%8B%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F"><span class="nav-number">2.1.3.</span> <span class="nav-text">🔍 第三步：查看本地镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%96%B6%EF%B8%8F-%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%EF%BC%88%E6%9C%80%E6%A0%B8%E5%BF%83%E6%93%8D%E4%BD%9C%EF%BC%89"><span class="nav-number">2.1.4.</span> <span class="nav-text">▶️ 第四步：运行容器（最核心操作）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%9A%80-%E7%AC%AC%E4%BA%94%E6%AD%A5%EF%BC%9A%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%EF%BC%88%E6%8E%A8%E8%8D%90%E6%96%B9%E5%BC%8F%EF%BC%89"><span class="nav-number">2.1.5.</span> <span class="nav-text">🚀 第五步：后台运行容器（推荐方式）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%8C%90-%E7%AC%AC%E5%85%AD%E6%AD%A5%EF%BC%9A%E6%98%A0%E5%B0%84%E7%AB%AF%E5%8F%A3%EF%BC%88%E8%AE%A9%E5%A4%96%E9%83%A8%E8%83%BD%E8%AE%BF%E9%97%AE%EF%BC%89"><span class="nav-number">2.1.6.</span> <span class="nav-text">🌐 第六步：映射端口（让外部能访问）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%8C%8D-%E7%AC%AC%E4%B8%83%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E8%BF%90%E8%A1%8C"><span class="nav-number">2.1.7.</span> <span class="nav-text">🌍 第七步：验证服务是否运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%94%8E-%E7%AC%AC%E5%85%AB%E6%AD%A5%EF%BC%9A%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81"><span class="nav-number">2.1.8.</span> <span class="nav-text">🔎 第八步：查看容器状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%93%8B-%E7%AC%AC%E4%B9%9D%E6%AD%A5%EF%BC%9A%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97"><span class="nav-number">2.1.9.</span> <span class="nav-text">📋 第九步：查看容器日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%9B%91-%E7%AC%AC%E5%8D%81%E6%AD%A5%EF%BC%9A%E5%81%9C%E6%AD%A2%E5%92%8C%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="nav-number">2.1.10.</span> <span class="nav-text">🛑 第十步：停止和启动容器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%A7%B9-%E7%AC%AC%E5%8D%81%E4%B8%80%E6%AD%A5%EF%BC%9A%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8%EF%BC%88%E6%B8%85%E7%90%86%EF%BC%89"><span class="nav-number">2.1.11.</span> <span class="nav-text">🧹 第十一步：删除容器（清理）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%97%91%EF%B8%8F-%E7%AC%AC%E5%8D%81%E4%BA%8C%E6%AD%A5%EF%BC%9A%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="nav-number">2.1.12.</span> <span class="nav-text">🗑️ 第十二步：删除镜像（可选）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9C%85-%E6%80%BB%E7%BB%93%EF%BC%9A%E5%AE%8C%E6%95%B4%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">2.1.13.</span> <span class="nav-text">✅ 总结：完整基础操作流程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E8%87%AA%E5%B7%B1%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="nav-number">2.2.</span> <span class="nav-text">✅ 自己构建镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9C%85-%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84%EF%BC%9A%E4%B8%89%E6%AD%A5%E8%B5%B0%EF%BC%88%E4%BF%AE%E6%AD%A3%E7%89%88%EF%BC%89"><span class="nav-number">2.2.1.</span> <span class="nav-text">✅ 正确的学习路径：三步走（修正版）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%8E%AF-%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84-FastAPI-%E9%95%9C%E5%83%8F"><span class="nav-number">2.2.2.</span> <span class="nav-text">🎯 第一步：最简单的 FastAPI 镜像</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%92%A1-%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="nav-number">2.3.</span> <span class="nav-text">💡 注意：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%9C%85-%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E6%8C%82%E8%BD%BD%E6%96%87%E4%BB%B6%EF%BC%88-v%EF%BC%89%E5%AE%9E%E7%8E%B0%E7%83%AD%E6%9B%B4%E6%96%B0"><span class="nav-number">2.3.1.</span> <span class="nav-text">✅ 第二步：挂载文件（-v）实现热更新</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E7%82%B9%E4%BA%94%E6%AD%A5%EF%BC%9A-it-%E4%BA%A4%E4%BA%92%E5%BC%8F%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8-v-%E6%8C%82%E8%BD%BD%E6%96%87%E4%BB%B6-%E5%B0%8F%E6%A1%88%E4%BE%8B-%E7%A4%BA%E4%BE%8B"><span class="nav-number">2.3.2.</span> <span class="nav-text">第二点五步：-it (交互式进入容器)+ -v(挂载文件)小案例&#x2F;示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%94%8D-%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E9%AA%8C%E8%AF%81%E2%80%9C%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E2%80%9D"><span class="nav-number">2.3.3.</span> <span class="nav-text">🔍 第三步：验证“数据持久化”</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E5%BC%95%E5%85%A5-Redis%EF%BC%88%E7%94%A8-docker-compose%EF%BC%89"><span class="nav-number">2.4.</span> <span class="nav-text">✅ 引入 Redis（用 docker-compose）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BF%AE%E6%94%B9-weather-script-py%EF%BC%88%E5%8A%A0%E5%85%A5-Redis-%E8%AE%A1%E6%95%B0%E5%99%A8%EF%BC%89"><span class="nav-number">2.4.1.</span> <span class="nav-text">1. 修改 weather_script.py（加入 Redis 计数器）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-docker-compose-yml"><span class="nav-number">2.4.2.</span> <span class="nav-text">2. docker-compose.yml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%96%B6-%E4%B8%80%E9%94%AE%E5%90%AF%E5%8A%A8%E4%B8%A4%E4%B8%AA%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.4.3.</span> <span class="nav-text">▶ 一键启动两个服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%F0%9F%A7%B1-%E5%9C%A8-docker-compose-yml-%E4%B8%AD%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="nav-number">2.4.4.</span> <span class="nav-text">🧱 在 docker-compose.yml 中构建镜像</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8C%90-Docker-Hub-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%EF%BC%88%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">🌐 Docker Hub 是什么？（补充知识）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-number">4.</span> <span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#compose%E5%81%9C%E6%AD%A2%E4%BD%86%E4%B8%8D%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="nav-number">4.1.</span> <span class="nav-text">compose停止但不删除容器</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chr</p>
  <div class="site-description" itemprop="description">Welcome to my little world</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">89</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">101</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:1299964565@qq.com" title="E-Mail → mailto:1299964565@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://caihaoran-00.github.io/2025/07/23/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chr">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chr's Blog">
      <meta itemprop="description" content="Welcome to my little world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="docker常用命令 | Chr's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          docker常用命令
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-07-23 19:39:47" itemprop="dateCreated datePublished" datetime="2025-07-23T19:39:47+08:00">2025-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-28 14:35:14" itemprop="dateModified" datetime="2025-07-28T14:35:14+08:00">2025-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>32 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今天在查看<a target="_blank" rel="noopener" href="https://github.com/Shadowfita/parakeet-tdt-0.6b-v2-fastapi/tree/main">Shadowfita&#x2F;parakeet-tdt-0.6b-v2-fastapi</a>这个仓库，看看他的实现有没有可取之处时，发现其使用了docker，转念一想，我还没从头捋下docker的命令，正好现在有时间，把这个坑填了吧。本文从两部分进行展开介绍docker基础用法：</p>
<ul>
<li>从Docker Hub拉取镜像</li>
<li>自己构建镜像</li>
</ul>
<p>Let’s go!</p>
<span id="more"></span>

<hr>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>正式开始Docker的基础命令介绍之前，有必要先介绍下什么是Docker以及Docker的核心概念。</p>
<p>Docker 是一个“<strong>打包工具</strong> ”，可以把你的程序（比如一个网站、一个后端服务）和它运行所需的环境（操作系统、软件、配置文件等）一起“打包”成一个“集装箱”（叫 <strong>容器</strong> ），然后在任何地方运行，效果都一样。</p>
<blockquote>
<p>🧩 类比：就像你把家里的家具、电器、装修风格都打包进一个集装箱，运到另一个城市，打开后，一切原封不动。 </p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">DOCKER概念</th>
<th align="center">生活类比</th>
<th align="center">详细解释</th>
<th align="center">技术特点</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>Docker</strong></td>
<td align="center">快餐店的标准化打包系统</td>
<td align="center">一套让程序“在哪都能一样运行”的工具，解决“在我电脑能跑，你电脑不行”的问题。</td>
<td align="center">容器化技术平台，统一环境、打包、运行方式。</td>
</tr>
<tr>
<td align="center"><strong>镜像（Image）</strong></td>
<td align="center">打包好的快餐套餐（未打开）<br />📦 比如：香辣鸡腿堡套餐</td>
<td align="center">就是一个“做好的软件包”，包含程序 + 环境 + 依赖，<strong>不能直接运行</strong>，但可以多次复制。</td>
<td align="center">静态文件、分层存储、可共享、通过<code>docker images</code>查看。</td>
</tr>
<tr>
<td align="center"><strong>容器（Container）</strong></td>
<td align="center">你正在吃的那份套餐<br>🍽️ 打开盒子开始吃</td>
<td align="center">是镜像“运行起来”的实例。程序真正在干活的状态。可以启动、停止、删除。</td>
<td align="center">动态运行、每个容器相互隔离、通过<code>docker ps</code>查看。</td>
</tr>
<tr>
<td align="center"><strong><code>Dockerfile</code></strong></td>
<td align="center">汉堡制作说明书 &#x2F; 菜谱</td>
<td align="center">一个文本文件，写明“怎么一步步做出这个镜像”，比如装系统、放代码、设启动命令。</td>
<td align="center">构建镜像的脚本，用<code>docker build</code>执行。</td>
</tr>
<tr>
<td align="center"><strong><code>Docker Hub</code></strong></td>
<td align="center">美团外卖 &#x2F; 快餐店菜单</td>
<td align="center">一个“应用商店”，你可以在这里下载别人做好的镜像，比如 <code>Nginx</code>、<code>Redis</code>。</td>
<td align="center">公共镜像仓库，官方维护，命令：<code>docker pull 镜像名</code>。</td>
</tr>
</tbody></table>
<blockquote>
<p>上面镜像描述中提到的不能直接运行是指需要通过docker run 镜像名来启动，实时上这一步包含了：</p>
<ul>
<li>检查有没有 <code>Nginx</code> 镜像（没有就去下载）</li>
<li>从镜像创建一个容器</li>
<li>启动容器内的主进程（<code>Nginx</code> 服务）</li>
<li>开始运行</li>
</ul>
<p>所以说不能直接运行。</p>
</blockquote>
<p>好的，介绍完基础概念了，咱们正式开始Docker基础命令介绍。</p>
<hr>
<h3 id="✅-从Docker-Hub拉取镜像"><a href="#✅-从Docker-Hub拉取镜像" class="headerlink" title="✅ 从Docker Hub拉取镜像"></a>✅ 从Docker Hub拉取镜像</h3><p>我们先从Docker Hub拉取镜像开始基础命令的介绍。我们会完成以下 6 个完整基础操作 ：</p>
<ul>
<li>从 Docker Hub 拉取镜像（pull）</li>
<li>查看本地镜像（images）</li>
<li>运行容器（run）</li>
<li>映射端口（-p）</li>
<li>后台运行（-d）</li>
<li>查看和管理容器（ps, stop, start, logs）</li>
</ul>
<blockquote>
<p>所有操作都基于 官方镜像 ，不自己构建，先掌握“使用别人做好的镜像” </p>
</blockquote>
<h4 id="🧰-第一步：确认-Docker-已安装"><a href="#🧰-第一步：确认-Docker-已安装" class="headerlink" title="🧰 第一步：确认 Docker 已安装"></a>🧰 第一步：确认 Docker 已安装</h4><p>打开终端（命令行），输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker --version</span><br></pre></td></tr></table></figure>

<p>你应该看到类似：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Docker</span> version <span class="number">27</span>.<span class="number">3</span>.<span class="number">1</span>, build ce12230</span><br></pre></td></tr></table></figure>

<p>表示 Docker 已安装好（没装好的话请自行安装）。</p>
<hr>
<h4 id="📦-第二步：从-Docker-Hub-拉取镜像"><a href="#📦-第二步：从-Docker-Hub-拉取镜像" class="headerlink" title="📦 第二步：从 Docker Hub 拉取镜像"></a>📦 第二步：从 Docker Hub 拉取镜像</h4><p>我们来下载一个叫 <code>Nginx</code> 的官方镜像。</p>
<p><code>Nginx</code> 是一个流行的网页服务器。</p>
<p><strong>命令：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>

<p>📌 解释：</p>
<ul>
<li><code>docker pull</code>：从 Docker Hub 下载镜像</li>
<li><code>nginx</code>：镜像名称</li>
<li>默认会下载 <code>latest</code> 标签（最新版）</li>
</ul>
<p>👉 执行后你会看到：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Using default <span class="params">tag:</span> latest</span><br><span class="line"><span class="params">latest:</span> Pulling from library<span class="symbol">/nginx</span></span><br><span class="line"><span class="number">59</span><span class="params">e22667830b:</span> Pull complete </span><br><span class="line"><span class="number">140</span><span class="params">da4f89dcb:</span> Pull complete </span><br><span class="line"><span class="number">96</span><span class="params">e47e70491e:</span> Pull complete </span><br><span class="line"><span class="number">2</span><span class="params">ef442a3816e:</span> Pull complete </span><br><span class="line"><span class="number">4</span><span class="params">b1e45a9989f:</span> Pull complete </span><br><span class="line"><span class="number">1</span><span class="params">d9f51194194:</span> Pull complete </span><br><span class="line"><span class="params">f30ffbee4c54:</span> Pull complete </span><br><span class="line"><span class="params">Digest:</span> sha256:<span class="number">84</span>ec966e61a8c7846f509da7eb081c55c1d56817448728924a87ab32f12a72fb</span><br><span class="line"><span class="params">Status:</span> Downloaded newer image for nginx:latest</span><br><span class="line">docker.io<span class="operator">/</span>library<span class="operator">/</span>nginx:latest</span><br></pre></td></tr></table></figure>

<p>✅ 成功！你已经从互联网下载了一个“软件安装包”（镜像）。</p>
<hr>
<h4 id="🔍-第三步：查看本地镜像"><a href="#🔍-第三步：查看本地镜像" class="headerlink" title="🔍 第三步：查看本地镜像"></a>🔍 第三步：查看本地镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p>你会看到：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">REPOSITORY</span>          TAG                    IMAGE ID              CREATED      	   SIZE</span><br><span class="line"><span class="attribute">nginx</span>               latest                <span class="number">2</span>cd1d97f893f   		<span class="number">9</span> days ago   	   <span class="number">192</span>MB</span><br></pre></td></tr></table></figure>

<p>📌 字段说明：</p>
<ul>
<li><code>REPOSITORY</code>：镜像名字</li>
<li><code>TAG</code>：版本标签（如 <code>latest</code>, <code>1.24</code>, <code>alpine</code>）</li>
<li><code>IMAGE ID</code>：镜像的唯一编号</li>
<li><code>SIZE</code>：大小</li>
</ul>
<p>✅ 这个 <code>nginx</code> 镜像现在就在你电脑里了，可以随时使用。</p>
<hr>
<h4 id="▶️-第四步：运行容器（最核心操作）"><a href="#▶️-第四步：运行容器（最核心操作）" class="headerlink" title="▶️ 第四步：运行容器（最核心操作）"></a>▶️ 第四步：运行容器（最核心操作）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run nginx</span><br></pre></td></tr></table></figure>

<p>会发生什么？</p>
<ul>
<li>Docker 用 <code>nginx</code> 镜像启动一个容器</li>
<li>Nginx 服务开始运行</li>
<li>但你会看到一大堆日志输出（前台运行）</li>
<li>按 <code>Ctrl+C</code> 会停止容器</li>
</ul>
<p>💡 这就像你在电脑上双击运行一个程序，终端被占用了。</p>
<p><strong>输出：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking <span class="keyword">for</span> shell scripts <span class="keyword">in</span> /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="keyword">in</span> /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready <span class="keyword">for</span> start up</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: using the <span class="string">&quot;epoll&quot;</span> event method</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: nginx/1.29.0</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14+deb12u1) </span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: OS: Linux 6.5.0-44-generic</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker processes</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 29</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 30</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 31</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 32</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 33</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 34</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 35</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 36</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 37</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 38</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 39</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 40</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 41</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 42</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 43</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 44</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 45</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 46</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 47</span><br><span class="line">2025/07/24 02:03:13 [notice] 1#1: start worker process 48</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="🚀-第五步：后台运行容器（推荐方式）"><a href="#🚀-第五步：后台运行容器（推荐方式）" class="headerlink" title="🚀 第五步：后台运行容器（推荐方式）"></a>🚀 第五步：后台运行容器（推荐方式）</h4><p>我们让容器在后台运行，不占用终端。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d nginx</span><br></pre></td></tr></table></figure>

<p>📌 参数说明：</p>
<ul>
<li><code>-d</code>：detached mode，后台运行</li>
<li>容器启动后，终端返回提示符，你可以继续输入命令</li>
</ul>
<p>你会看到一串字符（容器 ID），比如：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">031194</span>ac<span class="number">6682746</span>f<span class="number">4</span>ffdb<span class="number">852177</span><span class="keyword">c</span><span class="number">0</span>d<span class="number">67</span>ef<span class="number">659</span>a<span class="number">3</span>d<span class="number">2263287e7</span>a<span class="number">9e96</span>dc<span class="number">333e1</span>ced</span><br></pre></td></tr></table></figure>

<p>✅ 容器已在后台运行！</p>
<hr>
<h4 id="🌐-第六步：映射端口（让外部能访问）"><a href="#🌐-第六步：映射端口（让外部能访问）" class="headerlink" title="🌐 第六步：映射端口（让外部能访问）"></a>🌐 第六步：映射端口（让外部能访问）</h4><p>现在容器在运行，但我们访问不了网页，因为没有“开门”。</p>
<p>Nginx 默认在容器的 80 端口运行，我们要把它映射到主机的某个端口（比如 8080）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前运行的容器</span></span><br><span class="line">docker docker ps</span><br></pre></td></tr></table></figure>

<p><strong>你会看到：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID    IMAGE       COMMAND        		 CREATED           STATUS         PORTS       	NAMES</span><br><span class="line">031194ac6682    nginx   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   4 minutes ago   Up 4 minutes    80/tcp  	relaxed_carson</span><br></pre></td></tr></table></figure>

<p><strong>我们来一个一个拆解着看：</strong></p>
<p><strong>1️⃣ <code>CONTAINER ID</code>（容器 ID）</strong></p>
<ul>
<li><p><strong>含义</strong>：这个容器的<strong>唯一编号</strong>，就像身份证号。</p>
</li>
<li><p><strong>示例</strong>：<code>031194ac6682</code></p>
</li>
<li><p><strong>用途</strong>：</p>
<ul>
<li>用这个 ID 可以精确操作容器，比如：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop 031194ac6682</span><br><span class="line">docker <span class="built_in">rm</span> 031194ac6682</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<blockquote>
<p>💡 通常用前几位就够了（如 <code>031194ac</code>）。</p>
</blockquote>
<p><strong>2️⃣ <code>IMAGE</code>（镜像名）</strong></p>
<ul>
<li><strong>含义</strong>：这个容器是<strong>基于哪个镜像创建的</strong>。</li>
<li><strong>示例</strong>：<code>nginx</code></li>
<li><strong>说明</strong>：<ul>
<li>表示这个容器是用 <code>nginx</code> 镜像启动的。</li>
</ul>
</li>
</ul>
<p><strong>3️⃣ <code>COMMAND</code>（启动命令）</strong></p>
<ul>
<li><strong>含义</strong>：容器启动时运行的<strong>主命令</strong>是什么。</li>
<li><strong>示例</strong>：<code>&quot;/docker-entrypoint.sh …&quot;</code></li>
<li><strong>说明</strong>：<ul>
<li>这是 Nginx 官方镜像的启动脚本，用来初始化 Nginx 服务。</li>
<li>它会自动运行 <code>nginx -g &#39;daemon off;&#39;</code> 来启动服务器。</li>
<li>显示 <code>…</code> 是因为内容太长，被截断了。</li>
</ul>
</li>
</ul>
<blockquote>
<p>🔍 你可以用 <code>docker inspect 容器名</code> 看完整命令。</p>
</blockquote>
<p><strong>4️⃣ <code>CREATED</code>（创建时间）</strong></p>
<ul>
<li><strong>含义</strong>：这个容器是什么时候<strong>被创建出来的</strong>。</li>
<li><strong>示例</strong>：<code>4 minutes ago</code></li>
<li><strong>说明</strong>：<ul>
<li>表示 4 分钟前运行了 <code>docker run</code> 命令。</li>
</ul>
</li>
</ul>
<p><strong>5️⃣ <code>STATUS</code>（状态）</strong></p>
<ul>
<li><strong>含义</strong>：这个容器当前的<strong>运行状态</strong>。</li>
<li><strong>示例</strong>：<code>Up 4 minutes</code></li>
<li><strong>常见状态</strong>：</li>
</ul>
<table>
<thead>
<tr>
<th>状态</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Up 4 minutes</code></td>
<td>正在运行，已运行 4 分钟 ✅</td>
</tr>
<tr>
<td><code>Exited (0) 2 hours ago</code></td>
<td>已停止，正常退出 ❌</td>
</tr>
<tr>
<td><code>Restarting</code></td>
<td>正在重启中 🔄</td>
</tr>
<tr>
<td><code>Created</code></td>
<td>已创建，但还没启动 ⏸️</td>
</tr>
</tbody></table>
<blockquote>
<p>✅ 只有 <code>Up</code> 状态的容器才是“活”的。</p>
</blockquote>
<p><strong>6️⃣ <code>PORTS</code>（端口映射）</strong></p>
<ul>
<li><strong>含义</strong>：容器的端口和主机端口的<strong>映射关系</strong>。</li>
<li><strong>示例</strong>：<code>80/tcp</code></li>
<li><strong>问题来了</strong>：你看到的是 <code>80/tcp</code>，但<strong>没有显示主机端口</strong>！</li>
</ul>
<p>❓ 为什么？</p>
<p>因为你运行容器时<strong>没有用 <code>-p</code> 参数</strong>！</p>
<p>比如你可能用了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d nginx</span><br></pre></td></tr></table></figure>

<p>这表示：</p>
<ul>
<li>容器内部的 Nginx 在 80 端口运行</li>
<li>但<strong>没有把主机的端口映射过来</strong>，所以你在浏览器访问 <code>http://localhost:80</code> 是打不开的！</li>
</ul>
<p>✅ 正确做法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 nginx</span><br></pre></td></tr></table></figure>

<p>这样 <code>PORTS</code> 列就会显示：</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.0.0.0:8080</span>-&gt;<span class="number">80</span>/tcp</span><br></pre></td></tr></table></figure>

<p>意思是：</p>
<ul>
<li>主机的 <code>8080</code> 端口 → 映射到容器的 <code>80</code> 端口</li>
<li>你就可以通过 <code>http://localhost:8080</code> 访问网页了！</li>
</ul>
<p><strong>7️⃣ <code>NAMES</code>（容器名字）</strong></p>
<ul>
<li><p><strong>含义</strong>：Docker 给容器起的<strong>名字</strong>，方便记忆和管理。</p>
</li>
<li><p><strong>示例</strong>：<code>relaxed_carson</code></p>
</li>
<li><p><strong>说明</strong>：</p>
<ul>
<li><p>如果你启动时没用 <code>--name</code> 指定名字，Docker 会<strong>随机生成</strong>一个（如 <code>relaxed_carson</code>、<code>happy_turing</code>）。</p>
</li>
<li><p><strong>你可以用这个名字来操作容器：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop relaxed_carson</span><br><span class="line">docker <span class="built_in">rm</span> relaxed_carson</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><strong>✅ 推荐做法：自己起个好记的名字</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name my-nginx nginx</span><br></pre></td></tr></table></figure>

<p>这样名字就是 <code>my-nginx</code>，一看就知道是干嘛的。</p>
<p><strong>✅ 总结：表格对照</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
<th>你的例子</th>
</tr>
</thead>
<tbody><tr>
<td><code>CONTAINER ID</code></td>
<td>容器的唯一编号</td>
<td><code>031194ac6682</code></td>
</tr>
<tr>
<td><code>IMAGE</code></td>
<td>基于哪个镜像创建</td>
<td><code>nginx</code></td>
</tr>
<tr>
<td><code>COMMAND</code></td>
<td>启动时运行的命令</td>
<td><code>&quot;/docker-entrypoint.sh …&quot;</code></td>
</tr>
<tr>
<td><code>CREATED</code></td>
<td>容器创建时间</td>
<td><code>4 minutes ago</code></td>
</tr>
<tr>
<td><code>STATUS</code></td>
<td>当前状态</td>
<td><code>Up 4 minutes</code> ✅</td>
</tr>
<tr>
<td><code>PORTS</code></td>
<td>端口映射</td>
<td><code>80/tcp</code>（⚠️ 缺少主机映射）</td>
</tr>
<tr>
<td><code>NAMES</code></td>
<td>容器名字（随机生成）</td>
<td><code>relaxed_carson</code></td>
</tr>
</tbody></table>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止之前的容器（它没映射端口）</span></span><br><span class="line">docker stop 031194ac6682</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">031194ac6682</span><br></pre></td></tr></table></figure>

<p>然后重新运行，加 <code>-p</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:80 --name my-nginx nginx</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d1c05ed0591871d6a3bbc5b49705a1e470e6ba416adf3ab5df9cde59984151f6</span><br></pre></td></tr></table></figure>

<p>📌 参数详解：</p>
<ul>
<li><code>-p 8080:80</code>：把<strong>主机的 8080 端口</strong>映射到<strong>容器的 80 端口</strong></li>
<li><code>--name my-nginx</code>：给容器起个好记的名字</li>
<li><code>nginx</code>：镜像名</li>
</ul>
<p>✅ 现在你可以通过 <code>http://localhost:8080</code> 访问 Nginx！</p>
<hr>
<h4 id="🌍-第七步：验证服务是否运行"><a href="#🌍-第七步：验证服务是否运行" class="headerlink" title="🌍 第七步：验证服务是否运行"></a>🌍 第七步：验证服务是否运行</h4><p>打开浏览器，访问：</p>
<p>👉 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a></p>
<p>你应该看到：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Welcome <span class="keyword">to</span> nginx!</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> you see this page, the nginx web <span class="keyword">server</span> <span class="keyword">is</span> successfully installed <span class="keyword">and</span> working. Further <span class="keyword">configuration</span> <span class="keyword">is</span> required.</span><br><span class="line"></span><br><span class="line"><span class="keyword">For</span> online documentation <span class="keyword">and</span> support please refer <span class="keyword">to</span> nginx.org.</span><br><span class="line">Commercial support <span class="keyword">is</span> available at nginx.com.</span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> <span class="keyword">using</span> nginx.</span><br></pre></td></tr></table></figure>

<p>🎉 成功了！你已经用 Docker 部署了一个真正的 Web 服务！</p>
<hr>
<h4 id="🔎-第八步：查看容器状态"><a href="#🔎-第八步：查看容器状态" class="headerlink" title="🔎 第八步：查看容器状态"></a>🔎 第八步：查看容器状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p>你会看到：</p>
<blockquote>
<p>具体显示请看第六步，这里只展示少部分。</p>
</blockquote>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID  IMAGE              	PORTS            								NAMES</span><br><span class="line"><span class="function"><span class="title">d1c05ed05918</span>  nginx       0.0.0.0:8080-&gt;</span><span class="number">80</span>/<span class="function"><span class="title">tcp</span>, [::]:8080-&gt;</span><span class="number">80</span>/tcp                 	my-nginx</span><br></pre></td></tr></table></figure>

<p>✅ 表示 <code>my-nginx</code> 正在运行，端口已映射。</p>
<p>  **<code>0.0.0.0:8080-&gt;80/tcp</code> **</p>
<table>
<thead>
<tr>
<th><code>0.0.0.0</code></th>
<th>表示“所有 IPv4 地址”</th>
</tr>
</thead>
<tbody><tr>
<td><code>8080</code></td>
<td>主机（你电脑）的端口号</td>
</tr>
<tr>
<td><code>-&gt;</code></td>
<td>“映射到”</td>
</tr>
<tr>
<td><code>80</code></td>
<td>容器内部的端口号</td>
</tr>
<tr>
<td><code>tcp</code></td>
<td>使用 TCP 网络协议</td>
</tr>
</tbody></table>
<p>✅ 效果： </p>
<ul>
<li>你在浏览器访问 <code>http://localhost:8080</code> 或 <code>http://127.0.0.1:8080</code></li>
<li>请求会被 Docker 转发给容器的 80 端口</li>
<li>容器里的 Nginx 就能处理这个请求</li>
</ul>
<p>**<code>[::]:8080-&gt;80/tcp</code> **</p>
<table>
<thead>
<tr>
<th><code>[::]</code></th>
<th>表示“所有 IPv6 地址”（IPv6 的 <code>0.0.0.0</code>）</th>
</tr>
</thead>
<tbody><tr>
<td><code>8080</code></td>
<td>主机端口</td>
</tr>
<tr>
<td><code>-&gt;80/tcp</code></td>
<td>同上，转发给容器的 80 端口</td>
</tr>
</tbody></table>
<p>✅ 这是为了支持 IPv6 网络，功能和前面一样。 </p>
<hr>
<h4 id="📋-第九步：查看容器日志"><a href="#📋-第九步：查看容器日志" class="headerlink" title="📋 第九步：查看容器日志"></a>📋 第九步：查看容器日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs my-nginx</span><br></pre></td></tr></table></figure>

<p>你会看到 Nginx 的启动日志，在第四步展示的基础上增加了(因为我们在第七步验证服务是否运行时访问了该服务）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.17.0.1 - - [24/Jul/2025:02:46:27 +0000] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 615 <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">2025/07/24 02:46:27 [error] 29#29: *1 open() <span class="string">&quot;/usr/share/nginx/html/favicon.ico&quot;</span> failed (2: No such file or directory), client: 172.17.0.1, server: localhost, request: <span class="string">&quot;GET /favicon.ico HTTP/1.1&quot;</span>, host: <span class="string">&quot;localhost:8080&quot;</span>, referrer: <span class="string">&quot;http://localhost:8080/&quot;</span></span><br><span class="line">172.17.0.1 - - [24/Jul/2025:02:46:27 +0000] <span class="string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> 404 153 <span class="string">&quot;http://localhost:8080/&quot;</span> <span class="string">&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0&quot;</span> <span class="string">&quot;-&quot;</span></span><br></pre></td></tr></table></figure>

<p>想实时查看？加 <code>-f</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f my-nginx</span><br></pre></td></tr></table></figure>

<p>按 <code>Ctrl+C</code> 停止查看。</p>
<hr>
<h4 id="🛑-第十步：停止和启动容器"><a href="#🛑-第十步：停止和启动容器" class="headerlink" title="🛑 第十步：停止和启动容器"></a>🛑 第十步：停止和启动容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止(输出my-nginx)</span></span><br><span class="line">docker stop my-nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次启动(输出my-nginx)</span></span><br><span class="line">docker start my-nginx</span><br></pre></td></tr></table></figure>

<p>👉 停止后浏览器打不开页面，启动后又能访问。</p>
<hr>
<h4 id="🧹-第十一步：删除容器（清理）"><a href="#🧹-第十一步：删除容器（清理）" class="headerlink" title="🧹 第十一步：删除容器（清理）"></a>🧹 第十一步：删除容器（清理）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先停止(输出my-nginx)</span></span><br><span class="line">docker stop my-nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再删除</span></span><br><span class="line">docker <span class="built_in">rm</span> my-nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>docker stop my-nginx</code>后，<code>docker ps</code>（查看运行中的镜像）中就不显示<code>my_ngix</code>这个镜像了，但<code>docker ps -a</code>（查看所有镜像）中有显示，<code>docker rm my-nginx</code>后，<code>docker ps -a</code>也不显示<code>my_ngix</code>这个镜像了，说明这个镜像被删除了。</p>
<p>直接删运行中的容器会报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) chr@chr:~/桌面/dify/docker$ <span class="built_in">sudo</span> docker <span class="built_in">rm</span> my-nginx</span><br><span class="line">Error response from daemon: cannot remove container <span class="string">&quot;/my-nginx&quot;</span>: container is running: stop the container before removing or force remove</span><br></pre></td></tr></table></figure></blockquote>
<hr>
<h4 id="🗑️-第十二步：删除镜像（可选）"><a href="#🗑️-第十二步：删除镜像（可选）" class="headerlink" title="🗑️ 第十二步：删除镜像（可选）"></a>🗑️ 第十二步：删除镜像（可选）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(base) chr@chr:~&#x2F;桌面&#x2F;dify&#x2F;docker$ sudo docker rmi nginx<br>Error response from daemon: conflict: unable to remove repository reference “nginx” (must force) - container 7bb6d320d860 is using its referenced image 2cd1d97f893f</p>
</blockquote>
<p>会提示“有容器依赖”，先删容器再删镜像。先执行第十一步的步骤再删除镜像。最终：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(base) chr@chr:~/桌面/dify/docker$ <span class="built_in">sudo</span> docker rmi nginx</span><br><span class="line">Untagged: nginx:latest</span><br><span class="line">Untagged: nginx@sha256:84ec966e61a8c7846f509da7eb081c55c1d56817448728924a87ab32f12a72fb</span><br><span class="line">Deleted: sha256:2cd1d97f893f70cee86a38b7160c30e5750f3ed6ad86c598884ca9c6a563a501</span><br><span class="line">Deleted: sha256:3c1159cd77f83ede793fc21502ae30b39b04378b6b1b625451d701d555cc1cb9</span><br><span class="line">Deleted: sha256:221aaee6035b28a744a32189b7ff7853e07f6574185366a2272fb5e525e4e99e</span><br><span class="line">Deleted: sha256:701d5f8b1f92711c04588f86fe9b55b671bce6ba151a905644d5c79130a86db9</span><br><span class="line">Deleted: sha256:ab872be34a56e3b35c2caf7d2cbe335802742bd186e3fcbdd7d5228c36f6ef27</span><br><span class="line">Deleted: sha256:5064a019a0ed54289625d07404c88528252b0515dd3426dd8c400940e939c5a9</span><br><span class="line">Deleted: sha256:afe100bec4630446753dc1c0de8318b853d4bea6c897fa4c2aa19fab4d0bbdf4</span><br><span class="line">Deleted: sha256:7cc7fe68eff66f19872441a51938eecc4ad33746d2baa3abc081c1e6fe25988e</span><br></pre></td></tr></table></figure>

<p>再运行<code>docker images</code>会发现里面没有<code>nginx</code>镜像了。</p>
<hr>
<h4 id="✅-总结：完整基础操作流程"><a href="#✅-总结：完整基础操作流程" class="headerlink" title="✅ 总结：完整基础操作流程"></a>✅ 总结：完整基础操作流程</h4><table>
<thead>
<tr>
<th>步骤</th>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1. 拉取镜像</td>
<td><code>docker pull nginx</code></td>
<td>从 Docker Hub 下载</td>
</tr>
<tr>
<td>2. 查看镜像</td>
<td><code>docker images</code></td>
<td>确认镜像已下载</td>
</tr>
<tr>
<td>3. 运行容器</td>
<td><code>docker run -d -p 8080:80 --name my-nginx nginx</code></td>
<td>后台运行 + 端口映射 + 起名</td>
</tr>
<tr>
<td>4. 查看状态</td>
<td><code>docker ps</code></td>
<td>看正在运行的容器</td>
</tr>
<tr>
<td>5. 查看日志</td>
<td><code>docker logs my-nginx</code></td>
<td>看输出信息</td>
</tr>
<tr>
<td>6. 停止容器</td>
<td><code>docker stop my-nginx</code></td>
<td>安全停止</td>
</tr>
<tr>
<td>7. 启动容器</td>
<td><code>docker start my-nginx</code></td>
<td>重新启动</td>
</tr>
<tr>
<td>8. 删除容器</td>
<td><code>docker rm my-nginx</code></td>
<td>彻底删除</td>
</tr>
<tr>
<td>9. 删除镜像</td>
<td><code>docker rmi nginx</code></td>
<td>释放空间</td>
</tr>
</tbody></table>
<hr>
<h3 id="✅-自己构建镜像"><a href="#✅-自己构建镜像" class="headerlink" title="✅ 自己构建镜像"></a>✅ 自己构建镜像</h3><p>本部分分为三小部分：</p>
<ol>
<li><strong>第一步：纯 FastAPI 脚本 + Dockerfile（不依赖任何外部服务）</strong> </li>
<li><strong>第二步：使用 <code>-v</code> 挂载实现代码热更新</strong> </li>
<li><strong>第三步：用 <code>docker-compose</code> 引入 Redis（或其他服务）</strong></li>
</ol>
<p>你说得<strong>完全正确！</strong> 🙌</p>
<p>我刚才为了展示“多服务联动”的效果，<strong>操之过急地引入了 Redis</strong>，但这对“第一个例子”来说确实<strong>超纲了</strong>，不利于小白循序渐进地理解。</p>
<p>我们现在就来<strong>重新调整教学顺序</strong>，更加符合“由浅入深”的学习逻辑：</p>
<h4 id="✅-正确的学习路径：三步走（修正版）"><a href="#✅-正确的学习路径：三步走（修正版）" class="headerlink" title="✅ 正确的学习路径：三步走（修正版）"></a>✅ 正确的学习路径：三步走（修正版）</h4><ol>
<li><strong>第一步：纯 FastAPI 脚本 + Dockerfile（不依赖任何外部服务）</strong></li>
<li><strong>第二步：使用 <code>-v</code> 挂载实现代码热更新</strong></li>
<li><strong>第三步：用 <code>docker-compose</code> 引入 Redis（或其他服务）</strong></li>
</ol>
<hr>
<h4 id="🎯-第一步：最简单的-FastAPI-镜像"><a href="#🎯-第一步：最简单的-FastAPI-镜像" class="headerlink" title="🎯 第一步：最简单的 FastAPI 镜像"></a>🎯 第一步：最简单的 FastAPI 镜像</h4><p><strong>📁 创建项目目录</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> my-fastapi-app</span><br><span class="line"><span class="built_in">cd</span> my-fastapi-app</span><br></pre></td></tr></table></figure>

<p><strong><code>main.py</code>（最简单的 FastAPI 脚本）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_root</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello from Docker!&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span>, q: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;q&quot;</span>: q&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>✅ 完全独立，不依赖数据库、缓存、网络等任何外部服务</p>
</blockquote>
<p><strong>requirements.txt</strong></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fastapi</span><br><span class="line">uvicorn[standard]</span><br></pre></td></tr></table></figure>

<p><strong>Dockerfile</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span>-slim</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;uvicorn&quot;</span>, <span class="string">&quot;main:app&quot;</span>, <span class="string">&quot;--host&quot;</span>, <span class="string">&quot;0.0.0.0&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;8001&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解析：</p>
<p><strong>🐳 Dockerfile 逐行解析</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span>-slim</span><br></pre></td></tr></table></figure>
<p>✅ 含义：</p>
<ul>
<li>使用官方的 Python 镜像作为<strong>基础镜像</strong></li>
<li><code>python:3.9-slim</code> 表示：<ul>
<li>Python 版本：3.9</li>
<li><code>slim</code>：精简版（只包含最基本系统工具，体积小，适合生产）</li>
</ul>
</li>
</ul>
<p>💡 为什么用 <code>slim</code>？</p>
<ul>
<li>更小的镜像体积（通常 100MB 左右 vs 普通版 500MB+）</li>
<li>更少的攻击面（安全）</li>
<li>更快的构建和传输速度</li>
</ul>
<blockquote>
<p>✅ 推荐用于生产环境<br>❌ 不要用 <code>python:3.9</code>（太大），也不要用于开发的可以用 <code>python:3.9-bullseye</code>（带更多工具）</p>
</blockquote>
<hr>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br></pre></td></tr></table></figure>
<p>✅ 含义：</p>
<ul>
<li>设置“工作目录”为 <code>/app</code></li>
<li>后续所有命令（如 <code>COPY</code>、<code>RUN</code>、<code>CMD</code>）都会在这个目录下执行</li>
</ul>
<p>💡 类比：</p>
<p>就像你在 Linux 中执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /app</span><br></pre></td></tr></table></figure>

<p>📌 最佳实践：</p>
<ul>
<li>总是使用 <code>WORKDIR</code> 明确指定路径</li>
<li>路径尽量简洁，如 <code>/app</code>、<code>/code</code>、<code>/app/project</code></li>
</ul>
<hr>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br></pre></td></tr></table></figure>
<p>✅ 含义：</p>
<ul>
<li>把本地的 <code>requirements.txt</code> 文件拷贝到容器的当前目录（即 <code>/app</code>）</li>
<li><code>.</code> 表示“当前工作目录”</li>
</ul>
<p>💡 为什么先拷贝 <code>requirements.txt</code>？</p>
<p>这是为了<strong>利用 Docker 的缓存机制</strong>，提升构建速度！</p>
<blockquote>
<p>Docker 每一步都会缓存。如果 <code>requirements.txt</code> 没变，<code>pip install</code> 这步就不会重新执行，即使你改了 <code>.py</code> 文件。</p>
</blockquote>
<hr>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir -r requirements.txt</span></span><br></pre></td></tr></table></figure>
<p>✅ 含义：</p>
<ul>
<li>在容器中运行命令：安装 <code>requirements.txt</code> 中列出的所有 Python 包</li>
<li><code>--no-cache-dir</code>：不保存 pip 缓存，减小镜像体积</li>
<li><code>-r requirements.txt</code>：读取依赖文件</li>
</ul>
<p>💡 为什么加 <code>--no-cache-dir</code>？</p>
<ul>
<li>pip 默认会缓存包到 <code>/root/.cache/pip</code>，增加镜像大小</li>
<li>容器是“一次性的”，不需要缓存</li>
</ul>
<blockquote>
<p>✅ 减小镜像体积<br>❌ 如果不加，可能多出 50~100MB</p>
</blockquote>
<hr>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br></pre></td></tr></table></figure>
<p>✅ 含义：</p>
<ul>
<li>把当前目录下的所有文件（<code>main.py</code>、<code>Dockerfile</code> 同级文件）拷贝到容器的 <code>/app</code> 目录下</li>
</ul>
<h3 id="💡-注意："><a href="#💡-注意：" class="headerlink" title="💡 注意："></a>💡 注意：</h3><ul>
<li>这一步应该在 <code>pip install</code> 之后，否则每次改代码都会导致重新安装依赖</li>
<li>如果你改了 <code>main.py</code>，只有这一步及之后的层会重新构建</li>
</ul>
<hr>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8001</span></span><br></pre></td></tr></table></figure>
<p>✅ 含义：</p>
<ul>
<li><strong>声明</strong>这个容器会在运行时监听 8001 端口</li>
<li>⚠️ 它不会自动映射端口！只是“说明文档”性质</li>
</ul>
<p>💡 类比：</p>
<p>就像你在 README 里写：“本服务运行在 8001 端口”</p>
<p>📌 实际映射靠运行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8000:8001 my-fastapi:1.0</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-p 8000:8001</code> 才是真正把容器的 8001 映射到主机的 8000</li>
</ul>
<hr>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;uvicorn&quot;</span>, <span class="string">&quot;main:app&quot;</span>, <span class="string">&quot;--host&quot;</span>, <span class="string">&quot;0.0.0.0&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;8001&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<p><strong>✅ 含义：</strong></p>
<ul>
<li>容器<strong>启动时默认运行的命令</strong></li>
<li>使用 <code>uvicorn</code> 服务器运行 <code>main.py</code> 中的 <code>app</code> 实例</li>
<li><code>--host 0.0.0.0</code>：允许外部访问（重要！不能用 <code>127.0.0.1</code>）</li>
<li><code>--port 8000</code>：监听 8000 端口</li>
</ul>
<p><strong>💡 <code>CMD</code> 的三种写法对比：</strong></p>
<table>
<thead>
<tr>
<th>写法</th>
<th>示例</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>exec 形式（推荐）</strong></td>
<td><code>CMD [&quot;uvicorn&quot;, &quot;main:app&quot;, ...]</code></td>
<td>安全、可传参、推荐用于生产</td>
</tr>
<tr>
<td><strong>shell 形式</strong></td>
<td><code>CMD uvicorn main:app --host 0.0.0.0</code></td>
<td>简单，但无法传复杂参数</td>
</tr>
<tr>
<td><strong>覆盖方式</strong></td>
<td><code>docker run myapp python other.py</code></td>
<td>可覆盖 <code>CMD</code></td>
</tr>
</tbody></table>
<blockquote>
<p>✅ 推荐使用 <code>exec</code> 形式（数组写法）</p>
</blockquote>
<p><strong>🧠 总结：每一行的作用</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>作用</th>
<th>最佳实践</th>
</tr>
</thead>
<tbody><tr>
<td><code>FROM</code></td>
<td>选择基础镜像</td>
<td>用 <code>slim</code> 或 <code>alpine</code> 减小体积</td>
</tr>
<tr>
<td><code>WORKDIR</code></td>
<td>设置工作目录</td>
<td>避免路径混乱</td>
</tr>
<tr>
<td><code>COPY requirements.txt .</code></td>
<td>先拷贝依赖文件</td>
<td>利用缓存加速构建</td>
</tr>
<tr>
<td><code>RUN pip install</code></td>
<td>安装依赖</td>
<td>加 <code>--no-cache-dir</code></td>
</tr>
<tr>
<td><code>COPY . .</code></td>
<td>拷贝应用代码</td>
<td>放在依赖安装之后</td>
</tr>
<tr>
<td><code>EXPOSE</code></td>
<td>声明端口</td>
<td>文档作用，非强制</td>
</tr>
<tr>
<td><code>CMD</code></td>
<td>容器启动命令</td>
<td>用数组形式，指定服务器和参数</td>
</tr>
</tbody></table>
<p><strong>🛠 构建过程的“分层”原理（关键！）</strong></p>
<p>Docker 镜像是<strong>分层的</strong>，每一行是一个“层”：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Layer</span> <span class="number">1</span>: FROM python:<span class="number">3</span>.<span class="number">9</span>-slim</span><br><span class="line"><span class="attribute">Layer</span> <span class="number">2</span>: WORKDIR /app</span><br><span class="line"><span class="attribute">Layer</span> <span class="number">3</span>: COPY requirements.txt .</span><br><span class="line"><span class="attribute">Layer</span> <span class="number">4</span>: RUN pip install ...</span><br><span class="line"><span class="attribute">Layer</span> <span class="number">5</span>: COPY . .</span><br><span class="line"><span class="attribute">Layer</span> <span class="number">6</span>: EXPOSE <span class="number">8001</span></span><br><span class="line"><span class="attribute">Layer</span> <span class="number">7</span>: CMD<span class="meta"> [...]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果 <code>requirements.txt</code> 没变，Layer 4 会<strong>直接使用缓存</strong></li>
<li>只有 <code>COPY . .</code> 这一步会因代码修改而重新构建</li>
<li>这样<strong>大幅加快开发构建速度</strong></li>
</ul>
<p><strong>✅ 举个实际例子</strong></p>
<p>假设你改了 <code>main.py</code>，重新构建：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t my-fastapi:1.0 .</span><br></pre></td></tr></table></figure>

<p>输出可能像这样：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Step <span class="number">1</span>/<span class="number">7</span> : <span class="type">FROM</span> python:<span class="number">3.9</span>-slim</span><br><span class="line"> <span class="comment">---&gt; 已使用缓存</span></span><br><span class="line">Step <span class="number">2</span>/<span class="number">7</span> : <span class="type">WORKDIR</span> /app</span><br><span class="line"> <span class="comment">---&gt; 已使用缓存</span></span><br><span class="line">Step <span class="number">3</span>/<span class="number">7</span> : <span class="type">COPY</span> requirements.txt .</span><br><span class="line"> <span class="comment">---&gt; 已使用缓存</span></span><br><span class="line">Step <span class="number">4</span>/<span class="number">7</span> : <span class="type">RUN</span> pip install ...</span><br><span class="line"> <span class="comment">---&gt; 已使用缓存</span></span><br><span class="line">Step <span class="number">5</span>/<span class="number">7</span> : <span class="type">COPY</span> . .</span><br><span class="line"> <span class="comment">---&gt; 使用新文件（重新打包）</span></span><br><span class="line">Step <span class="number">6</span>/<span class="number">7</span> : <span class="type">EXPOSE</span> <span class="number">8001</span></span><br><span class="line"> <span class="comment">---&gt; 已使用缓存</span></span><br><span class="line">Step <span class="number">7</span>/<span class="number">7</span> : <span class="type">CMD</span> [...]</span><br><span class="line"> <span class="comment">---&gt; 已使用缓存</span></span><br></pre></td></tr></table></figure>

<p>✅ 只有第 5 步重新执行，其他都用缓存，<strong>秒级构建</strong>！</p>
<p><strong>📌 小贴士：可以加 <code>.dockerignore</code></strong></p>
<p>创建 <code>.dockerignore</code> 文件，避免不必要的文件被打包进镜像：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="emphasis">__pycache__</span></span><br><span class="line">*.pyc</span><br><span class="line"><span class="title">.git</span></span><br><span class="line"><span class="title">.gitignore</span></span><br><span class="line">Dockerfile</span><br><span class="line">README.md</span><br><span class="line"><span class="title">.env</span></span><br></pre></td></tr></table></figure>

<p>这样 <code>COPY . .</code> 时就不会把缓存、版本控制文件等拷贝进去，进一步优化构建。</p>
</blockquote>
<p><strong>🛠 构建镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t my-fastapi:1.0 .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>流程：</p>
<ul>
<li>Docker 把 当前目录（.）  打包 → 发送给 Docker 守护进程</li>
<li>Docker 读取目录中的 Dockerfile</li>
<li>按照 Dockerfile 的指令一步步构建镜像</li>
<li>构建完成后，给镜像起名为 my-fastapi:1.0</li>
</ul>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">(base) chr@chr:~/桌面/docker_learn/my-fastapi-app$ <span class="built_in">sudo</span> docker build -t my-fastapi:1.0 .</span><br><span class="line">[<span class="built_in">sudo</span>] chr 的密码： </span><br><span class="line">[+] Building 25.6s (10/10) FINISHED                                                                                   docker:default</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                                            0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 241B                                                                                            0.0s</span><br><span class="line"> =&gt; [internal] load metadata <span class="keyword">for</span> docker.io/library/python:3.9-slim                                                              4.7s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                               0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                 0.0s</span><br><span class="line"> =&gt; [1/5] FROM docker.io/library/python:3.9-slim@sha256:4b826e2ca2191c24a03bdbf0c342a73c6ee4ce929eac5ebc47fef78f66b839d6        7.4s</span><br><span class="line"> =&gt; =&gt; resolve docker.io/library/python:3.9-slim@sha256:4b826e2ca2191c24a03bdbf0c342a73c6ee4ce929eac5ebc47fef78f66b839d6        0.0s</span><br><span class="line"> =&gt; =&gt; sha256:563a905f7a66ef3bd4d02019b2673b65510a5588298d4434061587089143a0e2 5.29kB / 5.29kB                                  0.0s</span><br><span class="line"> =&gt; =&gt; sha256:59e22667830bf04fb35e15ed9c70023e9d121719bb87f0db7f3159ee7c7e0b8d 28.23MB / 28.23MB                                4.6s</span><br><span class="line"> =&gt; =&gt; sha256:91067d9e380715f9eefb1d983fd5bd87963b4e1f4ebff09f171db071138341f8 3.51MB / 3.51MB                                  2.7s</span><br><span class="line"> =&gt; =&gt; sha256:02ba7daa58b611ed94c8be35617179d4c23f2697ad7c68d96c0de753049fc5f5 14.94MB / 14.94MB                                7.1s</span><br><span class="line"> =&gt; =&gt; sha256:4b826e2ca2191c24a03bdbf0c342a73c6ee4ce929eac5ebc47fef78f66b839d6 10.41kB / 10.41kB                                0.0s</span><br><span class="line"> =&gt; =&gt; sha256:e8eb0fa155c06b960988a9ff99b882ef654542f7d022de051b79bab4c4534d71 1.75kB / 1.75kB                                  0.0s</span><br><span class="line"> =&gt; =&gt; sha256:58b24570cdddb5b19c3f0b31392902adec6f970f3522b1253d83e35cf68a3482 249B / 249B                                      3.5s</span><br><span class="line"> =&gt; =&gt; extracting sha256:59e22667830bf04fb35e15ed9c70023e9d121719bb87f0db7f3159ee7c7e0b8d                                       0.3s</span><br><span class="line"> =&gt; =&gt; extracting sha256:91067d9e380715f9eefb1d983fd5bd87963b4e1f4ebff09f171db071138341f8                                       0.0s</span><br><span class="line"> =&gt; =&gt; extracting sha256:02ba7daa58b611ed94c8be35617179d4c23f2697ad7c68d96c0de753049fc5f5                                       0.2s</span><br><span class="line"> =&gt; =&gt; extracting sha256:58b24570cdddb5b19c3f0b31392902adec6f970f3522b1253d83e35cf68a3482                                       0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                               0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 586B                                                                                               0.0s</span><br><span class="line"> =&gt; [2/5] WORKDIR /app                                                                                                          0.0s</span><br><span class="line"> =&gt; [3/5] COPY requirements.txt .                                                                                               0.0s</span><br><span class="line"> =&gt; [4/5] RUN pip install --no-cache-dir -r requirements.txt                                                                   13.1s</span><br><span class="line"> =&gt; [5/5] COPY . .                                                                                                              0.1s</span><br><span class="line"> =&gt; exporting to image                                                                                                          0.1s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                         0.1s</span><br><span class="line"> =&gt; =&gt; writing image sha256:a88f12b3278b1ea5fafde0017154709fb399974355443b001c874ff76ef611dc                                    0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/my-fastapi:1.0</span><br></pre></td></tr></table></figure></blockquote>
<p>✅ 检查是否成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images | grep my-fastapi</span><br></pre></td></tr></table></figure>

<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my-fastapi      1.0     a88f12b3278b      3 minutes ago       165MB</span><br></pre></td></tr></table></figure></blockquote>
<p><strong>▶ 运行容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8000:8001 --name my-fastapi-app my-fastapi:1.0</span><br></pre></td></tr></table></figure>

<p><strong>🔍 测试</strong></p>
<p>打开浏览器访问：</p>
<ul>
<li><code>http://localhost:8000</code> → 应该看到 JSON 返回</li>
<li><code>http://localhost:8000/items/123?q=test</code> → 测试路径参数</li>
<li><code>http://localhost:8000/docs</code> → 自动 API 文档（Swagger UI）🎉</li>
</ul>
<p>✅ 成功！</p>
<hr>
<h4 id="✅-第二步：挂载文件（-v）实现热更新"><a href="#✅-第二步：挂载文件（-v）实现热更新" class="headerlink" title="✅ 第二步：挂载文件（-v）实现热更新"></a>✅ 第二步：挂载文件（-v）实现热更新</h4><p>现在我们想：<strong>改代码不用重新 build</strong>。</p>
<p>🔁 停止并重新运行（启用热重载 + 挂载）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止旧容器</span></span><br><span class="line">docker stop my-fastapi-app</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新运行，挂载代码 + 启用热重载</span></span><br><span class="line">docker run -d -p 8000:8001 \</span><br><span class="line">  -v $(<span class="built_in">pwd</span>):/app \</span><br><span class="line">  --name my-fastapi-app \</span><br><span class="line">  my-fastapi:1.0 \</span><br><span class="line">  uvicorn main:app --host 0.0.0.0 --port 8001 --reload</span><br></pre></td></tr></table></figure>

<blockquote>
<p>💡 <code>--reload</code>：Uvicorn 的热重载功能<br><code>-v $(pwd):/app</code>：把本地代码挂载进容器</p>
</blockquote>
<p><strong>✏ 修改 <code>main.py</code>，立即生效！</strong></p>
<p>比如改成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_root</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello from Docker! (Updated)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>保存后，<strong>刷新浏览器</strong>，立刻看到变化！</p>
<blockquote>
<p>🎉 无需 <code>docker build</code>，开发效率大幅提升！</p>
</blockquote>
<hr>
<h4 id="第二点五步：-it-交互式进入容器-v-挂载文件-小案例-示例"><a href="#第二点五步：-it-交互式进入容器-v-挂载文件-小案例-示例" class="headerlink" title="第二点五步：-it (交互式进入容器)+ -v(挂载文件)小案例&#x2F;示例"></a>第二点五步：-it (交互式进入容器)+ -v(挂载文件)小案例&#x2F;示例</h4><p><strong>教学案例：用 Docker 运行一个“天气查询服务”</strong></p>
<p><strong>目标</strong></p>
<p>通过一个简单的 Python 天气服务，演示：</p>
<ol>
<li>如何用 <code>-it</code> 进入容器</li>
<li>如何用 <code>-v</code> 挂载配置和日志</li>
<li>为什么“先进容器再操作”适合教学</li>
</ol>
<p><strong>项目结构</strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">weather-app/</span><br><span class="line">├── Dockerfile               <span class="params">#</span> 构建镜像用</span><br><span class="line">├── requirements.txt         <span class="params">#</span> 依赖列表</span><br><span class="line">├── weather<span class="built_in">_</span>app.py           <span class="params">#</span> 天气查询脚本</span><br><span class="line">├── config/</span><br><span class="line">│   └── city.txt             <span class="params">#</span> 配置文件（挂载用）</span><br><span class="line">└── logs/</span><br><span class="line">    └── app.log              <span class="params">#</span> 日志文件（容器写入，挂载到主机）</span><br></pre></td></tr></table></figure>

<p><strong>第一步：准备<code>requests</code></strong></p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requests</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们用 requests 模拟调用天气 API.。</p>
</blockquote>
<p><strong>第二步：<code>weather_script.py</code>（模拟天气查询）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># weather_script.py</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取要查询的城市</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;config/city.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        city = f.read().strip()</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    city = <span class="string">&quot;北京&quot;</span>  <span class="comment"># 默认城市</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;🌤️  正在启动天气服务（城市：<span class="subst">&#123;city&#125;</span>）...&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;日志将写入 logs/app.log&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟持续输出天气</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    temp = random.randint(<span class="number">15</span>, <span class="number">35</span>)</span><br><span class="line">    status = random.choice([<span class="string">&quot;晴&quot;</span>, <span class="string">&quot;多云&quot;</span>, <span class="string">&quot;小雨&quot;</span>])</span><br><span class="line">    log_line = <span class="string">f&quot;[<span class="subst">&#123;i:03d&#125;</span>] <span class="subst">&#123;city&#125;</span>：<span class="subst">&#123;temp&#125;</span>°C，<span class="subst">&#123;status&#125;</span>\n&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 写入日志文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;logs/app.log&quot;</span>, <span class="string">&quot;a&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(log_line)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;→ <span class="subst">&#123;city&#125;</span>：<span class="subst">&#123;temp&#125;</span>°C，<span class="subst">&#123;status&#125;</span>&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>第三步：创建配置(config&#x2F;)和日志(logs&#x2F;)目录</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p config logs</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;上海&quot;</span> &gt; config/city.txt</span><br></pre></td></tr></table></figure>

<p><strong>第四步：写<code>Dockerfile</code></strong></p>
<figure class="highlight dockerfile"><figcaption><span>Dockerfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用官方 Python 镜像</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.9</span>-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝依赖文件</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝依赖文件（如果有 requirements.txt）</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者直接在 Dockerfile 中安装（简单场景）</span></span><br><span class="line"><span class="comment"># RUN pip install --no-cache-dir requests</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝应用脚本</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> weather_script.py .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝配置目录（可选，防止运行时报错）</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> config/ config/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明日志目录</span></span><br><span class="line"><span class="comment"># （实际由 -v 挂载，这里只是说明）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认启动命令</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;weather_script.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><strong>第五步：构建镜像</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t weather-app:1.0 .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，如果运行的是<code>docker build -t weather-app:1.0 .</code>，也就是说带除<code>latest</code>外的TAG了，那么使用或移除该镜像时需带上TAG。例如：<code>docker run</code>的时候也要带上对应TAG（不写TAG或指定TAG为<code>latest</code>，那么TAG即为<code>latest</code>，此时<code>docker run</code>不用带TAG）。</p>
</blockquote>
<p>构建成功后检查： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images | grep weather-app</span><br></pre></td></tr></table></figure>

<p><strong>第六步：运行容器（-it 交互式）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -it \</span><br><span class="line">  --name weather-debug \</span><br><span class="line">  -p 8899:8899 \</span><br><span class="line">  -v <span class="variable">$PWD</span>/config:/app/config \</span><br><span class="line">  -v <span class="variable">$PWD</span>/logs:/app/logs \</span><br><span class="line">  weather-app:1.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>💡 解释：</p>
<ul>
<li><code>-it</code>：可以进入容器交互</li>
<li><code>-v $PWD/config:/app/config</code>：挂载配置</li>
<li><code>-v $PWD/logs:/app/logs</code>：挂载日志</li>
<li><code>python:3.9-slim</code>：基础镜像</li>
<li><code>/bin/bash</code>：进去后打开 shell</li>
</ul>
</blockquote>
<p>然后终端就开始输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">🌤️  正在启动天气服务（城市：上海）...</span><br><span class="line">日志将写入 logs/app.log</span><br><span class="line">→ 上海：35°C，多云</span><br><span class="line">→ 上海：16°C，晴</span><br><span class="line">→ 上海：17°C，小雨</span><br><span class="line">→ 上海：29°C，小雨</span><br><span class="line">→ 上海：30°C，晴</span><br><span class="line">→ 上海：30°C，晴</span><br></pre></td></tr></table></figure>

<p>我们想要的不是这个效果，我们想进容器内部启动，调整下上面的流程：</p>
<ul>
<li><p><code>ctrl+c</code>停止当前容器</p>
</li>
<li><p><code>docker rm weather-debug</code>删除容器</p>
</li>
<li><p><code>docker rmi weather-app:1.0</code>删除镜像</p>
</li>
<li><p>注释容器最后一行的<code>CMD [&quot;python&quot;, &quot;weather_script.py&quot;]</code></p>
</li>
<li><p><code>sudo docker build -t weather-app:1.0 .</code>构建容器</p>
</li>
<li><pre><code class="language-bash">docker run -it \
  --name weather-debug \
  -p 8899:8899 \
  -v $PWD/config:/app/config \
  -v $PWD/logs:/app/logs \
  weather-app:1.0
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  运行容器。</span><br><span class="line"></span><br><span class="line">然后你会发现，进入Python命令行了。这咋回事啊，使用`docker ps`，发现（省略了PORTS）：</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">CONTAINER ID   IMAGE       			COMMAND     CREATED            STATUS                     NAMES</span><br><span class="line"><span class="number">5</span>d56c859613d   weather-app:<span class="number">1.0</span>  	<span class="string">&quot;python3&quot;</span>    <span class="number">29</span> seconds ago   Up <span class="number">28</span> seconds        weather-debug</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<p>哦，这里还有<code>COMMAND</code>啊，<code>Dockerfile</code>中没指定<code>COMMAND</code>就用镜像自带的<code>COMMAND</code>。</p>
<p><strong>那我们就在命令行指定：</strong></p>
<blockquote>
<p>顺便一提，即使Dockerfile中没注释掉<code>CMD</code>也会被下面的<code>/bin/bash</code>替代掉。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -it \</span><br><span class="line">  --name weather-debug \</span><br><span class="line">  -p 8899:8899 \</span><br><span class="line">  -v <span class="variable">$PWD</span>/config:/app/config \</span><br><span class="line">  -v <span class="variable">$PWD</span>/logs:/app/logs \</span><br><span class="line">  weather-app:1.0 \</span><br><span class="line">  /bin/bash</span><br></pre></td></tr></table></figure>

<p><strong>进入容器后，一步步操作</strong></p>
<p>你现在在容器里了，会看到类似于：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@4cbb4f6434da:/app#</span><br></pre></td></tr></table></figure>

<p><strong>① 查看当前文件夹下有什么</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@4cbb4f6434da:/app# <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line">config	logs  requirements.txt	weather_script.py</span><br></pre></td></tr></table></figure>

<p><strong>② 验证挂载是否成功</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> config/</span><br><span class="line"><span class="comment"># 输出：city.txt</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> config/city.txt</span><br><span class="line"><span class="comment"># 输出：上海</span></span><br></pre></td></tr></table></figure>

<p>✅ 说明：<strong>主机的配置文件已经同步进来了！</strong></p>
<p><strong>③ 运行天气脚本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python weather_script.py</span><br></pre></td></tr></table></figure>

<p>你会看到：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">🌤️  正在启动天气服务（城市：上海）<span class="params">...</span></span><br><span class="line">日志将写入 logs/app.<span class="keyword">log</span></span><br><span class="line">→ 上海：<span class="number">27</span>°C，多云</span><br><span class="line">→ 上海：<span class="number">17</span>°C，晴</span><br><span class="line">→ 上海：<span class="number">25</span>°C，小雨</span><br><span class="line"><span class="params">...</span></span><br></pre></td></tr></table></figure>

<p>按<code>ctrl+c</code>停止输出，然后运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f logs/app.log</span><br></pre></td></tr></table></figure>

<p>实时查看日志内容。</p>
<p>上面脚本运行后就占用终端了，那么能不能在后台运行呢，需要时再查看日志。答案是肯定的。</p>
<p>**用 <code>nohup</code> 启动（即使退出终端也不停止） **</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> python weather_script.py &gt; logs/output.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出：[1] 12</p>
</blockquote>
<ul>
<li><code>nohup</code>：<strong>no hang up</strong>，即使你退出终端，程序也不停止</li>
<li><code>&gt;</code>：把<strong>标准输出</strong>重定向到文件</li>
<li><code>2&gt;&amp;1</code>：把<strong>错误输出</strong>也重定向到同一个文件</li>
<li><code>&amp;</code>：让程序在<strong>后台运行</strong></li>
<li><code>logs/output.log</code>：日志文件（你可以看 <code>cat</code> 或 <code>tail -f</code>）</li>
</ul>
<p>**查看日志 **</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f logs/output.log</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意此时log是一次返回的，可使用<code>nohup python -u weather_script.py &gt; logs/output.log 2&gt;&amp;1 &amp;</code>使其实时。</p>
</blockquote>
<p>**停止程序 **</p>
<blockquote>
<p>方法 1：用作业号 <code>kill %1</code></p>
<p>方法 2：用进程 ID <code>kill 12</code></p>
<p>方法 3：用程序名 <code>pkill -f weather_script.py</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkill -f weather_script.py</span><br></pre></td></tr></table></figure>

<h4 id="🔍-第三步：验证“数据持久化”"><a href="#🔍-第三步：验证“数据持久化”" class="headerlink" title="🔍 第三步：验证“数据持久化”"></a>🔍 第三步：验证“数据持久化”</h4><p><strong>打开另一个终端，查看主机上的日志</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f logs/app.log</span><br></pre></td></tr></table></figure>
<p>✅ 你会看到和容器里一样的日志内容！</p>
<blockquote>
<p>🎉 说明：容器写入的日志，<strong>实时同步到你本地电脑</strong></p>
</blockquote>
<p><strong>修改主机上的城市配置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;深圳&quot;</span> &gt; config/city.txt</span><br></pre></td></tr></table></figure>

<p><strong>重启脚本（在容器里 Ctrl+C 停止，再运行）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python weather_script.py</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">🌤️  正在启动天气服务（城市：深圳）...</span><br><span class="line">→ 深圳：<span class="number">26</span>°C，多云</span><br></pre></td></tr></table></figure>

<p>✅ 说明：<strong>改本地配置，容器能立刻读到！</strong></p>
<p>🧠 对比：生产环境怎么写？</p>
<p>生产环境应该用“一键启动”：</p>
<ul>
<li><p>法一：去掉<code>Dockerfile</code>中的<code>CMD</code>注释，再通过下面命令启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name weather-prod \</span><br><span class="line">  -p 8899:8899 \</span><br><span class="line">  -v <span class="variable">$PWD</span>/config:/app/config \</span><br><span class="line">  -v <span class="variable">$PWD</span>/logs:/app/logs \</span><br><span class="line">  --restart unless-stopped \</span><br><span class="line">  weather-app:1.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>法二：使用<code>docker-compose.yml</code>（见下文教学）</p>
</li>
</ul>
<hr>
<h3 id="✅-引入-Redis（用-docker-compose）"><a href="#✅-引入-Redis（用-docker-compose）" class="headerlink" title="✅ 引入 Redis（用 docker-compose）"></a>✅ 引入 Redis（用 docker-compose）</h3><p>现在我们再升级一步，加入 Redis，展示“多服务协同”。</p>
<h4 id="1-修改-weather-script-py（加入-Redis-计数器）"><a href="#1-修改-weather-script-py（加入-Redis-计数器）" class="headerlink" title="1. 修改 weather_script.py（加入 Redis 计数器）"></a>1. 修改 <code>weather_script.py</code>（加入 Redis 计数器）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从环境变量读取 Redis 配置</span></span><br><span class="line">redis_host = os.getenv(<span class="string">&quot;REDIS_HOST&quot;</span>, <span class="string">&quot;redis&quot;</span>)</span><br><span class="line">redis_port = <span class="built_in">int</span>(os.getenv(<span class="string">&quot;REDIS_PORT&quot;</span>, <span class="number">6379</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接 Redis</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = redis.Redis(host=redis_host, port=redis_port, db=<span class="number">0</span>, decode_responses=<span class="literal">True</span>)</span><br><span class="line">    r.ping()  <span class="comment"># 测试连接</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;✅ 成功连接到 Redis&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;❌ 无法连接 Redis: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取城市</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;config/city.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        city = f.read().strip()</span><br><span class="line"><span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">    city = <span class="string">&quot;上海&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;🌤️  天气服务启动（城市：<span class="subst">&#123;city&#125;</span>）...&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;日志将写入 logs/app.log&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟输出天气</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    temp = random.randint(<span class="number">15</span>, <span class="number">35</span>)</span><br><span class="line">    status = random.choice([<span class="string">&quot;晴&quot;</span>, <span class="string">&quot;多云&quot;</span>, <span class="string">&quot;小雨&quot;</span>, <span class="string">&quot;阴&quot;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 记录访问次数</span></span><br><span class="line">    r.incr(<span class="string">&quot;weather_requests&quot;</span>)</span><br><span class="line">    count = r.get(<span class="string">&quot;weather_requests&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    log_line = <span class="string">f&quot;[<span class="subst">&#123;i:03d&#125;</span>] <span class="subst">&#123;city&#125;</span>：<span class="subst">&#123;temp&#125;</span>°C，<span class="subst">&#123;status&#125;</span> (请求次数: <span class="subst">&#123;count&#125;</span>)\n&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;logs/app.log&quot;</span>, <span class="string">&quot;a&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(log_line)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;→ <span class="subst">&#123;city&#125;</span>：<span class="subst">&#123;temp&#125;</span>°C，<span class="subst">&#123;status&#125;</span> | 📊 请求次数: <span class="subst">&#123;count&#125;</span>&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="2-docker-compose-yml"><a href="#2-docker-compose-yml" class="headerlink" title="2. docker-compose.yml"></a>2. <code>docker-compose.yml</code></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一组服务（可以有多个）</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 服务 1：天气服务</span></span><br><span class="line">  <span class="attr">weather:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用本地构建的镜像</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">weather-app:1.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 容器名字</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">weather-prod</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 端口映射：主机:容器</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8899:8899&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 数据挂载（持久化）</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config:/app/config</span>    <span class="comment"># 主机当前目录的 config → 容器的 /app/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./logs:/app/logs</span>        <span class="comment"># 主机的 logs → 容器的 /app/logs</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 重启策略</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 环境变量</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PYTHONUNBUFFERED=1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_HOST=redis</span>        <span class="comment"># 指向 redis 服务（服务名即主机名）</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_PORT=6379</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 健康检查</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;ls logs/app.log&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 声明依赖：必须等 redis 启动后才启动 weather</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 服务 2：Redis 缓存数据库</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用官方 Redis 镜像</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6-alpine</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 容器名字</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-prod</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 暴露端口（可选：如果你要从主机连接 Redis）</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 数据持久化：把 Redis 数据保存到主机</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/redis:/data</span>      <span class="comment"># Redis 持久化文件（RDB/AOF）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 重启策略</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 健康检查：Redis 是否响应 PING</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;redis-cli&quot;</span>, <span class="string">&quot;ping&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">3s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>**🎯 这个配置实现了什么？ **</p>
<table>
<thead>
<tr>
<th>✅ 两个服务</th>
<th><code>weather</code> 和 <code>redis</code></th>
</tr>
</thead>
<tbody><tr>
<td>✅ 自动组网</td>
<td>Docker 会创建一个默认网络，两个容器可以互相通信</td>
</tr>
<tr>
<td>✅ 服务发现</td>
<td><code>weather</code> 可以用 <code>redis</code> 作为主机名访问 Redis</td>
</tr>
<tr>
<td>✅ 依赖启动</td>
<td><code>depends_on</code> 确保 Redis 先启动</td>
</tr>
<tr>
<td>✅ 数据持久化</td>
<td>Redis 数据保存在 <code>./data/redis</code></td>
</tr>
<tr>
<td>✅ 健康检查</td>
<td>两个服务都有健康监控</td>
</tr>
</tbody></table>
<hr>
<h4 id="▶-一键启动两个服务"><a href="#▶-一键启动两个服务" class="headerlink" title="▶ 一键启动两个服务"></a>▶ 一键启动两个服务</h4><blockquote>
<p>注意在这一步开始之前先使用更改后的重新构造weather-app:1.0镜像，以下默认镜像重新构建了。</p>
<p>Dockerfile如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">#</span> 使用官方 Python 镜像</span><br><span class="line">FROM python:3.9-slim</span><br><span class="line"></span><br><span class="line"><span class="params">#</span> 设置工作目录</span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"><span class="params">#</span> 拷贝依赖文件</span><br><span class="line">COPY requirements.txt .</span><br><span class="line"></span><br><span class="line"><span class="params">#</span> 拷贝依赖文件（如果有 requirements.txt）</span><br><span class="line">COPY requirements.txt .</span><br><span class="line">RUN pip install --no-cache-dir -r requirements.txt</span><br><span class="line"></span><br><span class="line"><span class="params">#</span> 或者直接在 Dockerfile 中安装（简单场景）</span><br><span class="line"><span class="params">#</span> RUN pip install --no-cache-dir requests</span><br><span class="line"></span><br><span class="line"><span class="params">#</span> 拷贝应用脚本</span><br><span class="line">COPY weather<span class="built_in">_</span>script.py .</span><br><span class="line"></span><br><span class="line"><span class="params">#</span> 拷贝配置目录（可选，防止运行时报错）</span><br><span class="line">COPY config/ config/</span><br><span class="line"></span><br><span class="line">ENV PYTHONUNBUFFERED=1</span><br><span class="line"></span><br><span class="line"><span class="params">#</span> 声明日志目录</span><br><span class="line"><span class="params">#</span> （实际由 -v 挂载，这里只是说明）</span><br><span class="line"></span><br><span class="line"><span class="params">#</span> 设置默认启动命令</span><br><span class="line">CMD [&quot;python&quot;, &quot;weather<span class="built_in">_</span>script.py&quot;]</span><br></pre></td></tr></table></figure></blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保 data 目录存在</span></span><br><span class="line"><span class="built_in">mkdir</span> -p data/redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一键启动两个服务</span></span><br><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[+] Running 3/3</span><br><span class="line"> ✔ Network weather-app-compose_default  Created                                                                                                                                                                                                         0.1s </span><br><span class="line"> ✔ Container redis-prod                 Started                                                                                                                                                                                                         0.2s </span><br><span class="line"> ✔ Container weather-prod               Started  </span><br></pre></td></tr></table></figure>

<p><strong>查看两个容器是否都在运行</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose ps</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME           IMAGE             COMMAND            SERVICE   CREATED          STATUS              PORTS</span><br><span class="line">redis-prod  redis:6-alpine <span class="string">&quot;docker-entrypoint.s…&quot;</span>   redis     38 seconds ago   Up 37 seconds (healthy)      0.0.0.0:6379-&gt;6379/tcp, :::6379-&gt;6379/tcp</span><br><span class="line">weather-prod   weather-app:1.0   <span class="string">&quot;python3&quot;</span>          weather   38 seconds ago   Restarting (0) 9 seconds ago  </span><br></pre></td></tr></table></figure>

<p><strong>查看日志</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose logs -f weather</span><br></pre></td></tr></table></figure>

<p><strong>输出：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">weather-prod  | ✅ 成功连接到 Redis</span><br><span class="line">weather-prod  | 🌤️  天气服务启动（城市：上海）...</span><br><span class="line">weather-prod  | 日志将写入 logs/app.log</span><br><span class="line">weather-prod  | → 上海：27°C，小雨 | 📊 请求次数: 1</span><br><span class="line">weather-prod  | → 上海：16°C，晴 | 📊 请求次数: 2</span><br><span class="line">weather-prod  | → 上海：27°C，阴 | 📊 请求次数: 3</span><br><span class="line">weather-prod  | → 上海：34°C，多云 | 📊 请求次数: 4</span><br><span class="line">weather-prod  | → 上海：26°C，小雨 | 📊 请求次数: 5</span><br><span class="line">weather-prod  | → 上海：26°C，晴 | 📊 请求次数: 6</span><br></pre></td></tr></table></figure>

<p><strong>进入Redis查看计数</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it redis-prod redis-cli</span><br></pre></td></tr></table></figure>

<p>在<code>Redis CLI</code>中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET weather_requests</span><br><span class="line"><span class="comment"># 输出： &quot;109&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(base) chr@chr:~/桌面/docker_learn/weather-app-compose$ <span class="built_in">sudo</span> docker <span class="built_in">exec</span> -it redis-prod redis-cli</span><br><span class="line">127.0.0.1:6379&gt; GET weather_requests</span><br><span class="line"><span class="string">&quot;109&quot;</span></span><br></pre></td></tr></table></figure>

<p>**🚀 常用 <code>docker compose</code> 命令 **</p>
<table>
<thead>
<tr>
<th><code>docker compose up -d</code></th>
<th>启动所有服务（后台运行）</th>
</tr>
</thead>
<tbody><tr>
<td><code>docker compose up</code></td>
<td>启动并查看日志（前台）</td>
</tr>
<tr>
<td><code>docker compose down</code></td>
<td>停止并删除容器</td>
</tr>
<tr>
<td><code>docker compose down -v</code></td>
<td>删除容器和挂载的卷（慎用）</td>
</tr>
<tr>
<td><code>docker compose logs -f</code></td>
<td>查看实时日志（<code>-f</code> 表示 follow）</td>
</tr>
<tr>
<td><code>docker compose ps</code></td>
<td>查看运行中的服务</td>
</tr>
<tr>
<td><code>docker compose restart</code></td>
<td>重启服务</td>
</tr>
<tr>
<td><code>docker compose build</code></td>
<td>重新构建镜像（如果写了 <code>build:</code>）</td>
</tr>
</tbody></table>
<blockquote>
<p><code>docker compose down</code>是停止并删除容器，停止但不删除容器请看附录1：compose停止但不删除容器。</p>
</blockquote>
<hr>
<p>上面方法有个弊端，如果有重名的镜像，但这个镜像并不是用最新的代码build的，就会出现代码行为与预期不一致的情况，那么如何处理这种情况呢？运行时重新构建镜像即可，</p>
<h4 id="🧱-在-docker-compose-yml-中构建镜像"><a href="#🧱-在-docker-compose-yml-中构建镜像" class="headerlink" title="🧱 在 docker-compose.yml 中构建镜像"></a>🧱 在 <code>docker-compose.yml</code> 中构建镜像</h4><p>可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="comment"># 服务 1：天气服务</span></span><br><span class="line">  <span class="attr">weather:</span></span><br><span class="line">    <span class="comment"># 使用本地构建</span></span><br><span class="line">    <span class="attr">build:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">weather-prod</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8899:8899&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config:/app/config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./logs:/app/logs</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PYTHONUNBUFFERED=1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_PORT=6379</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="comment"># 可选：健康检查（如果 weather 服务有 /health 接口）</span></span><br><span class="line">    <span class="comment"># healthcheck:</span></span><br><span class="line">    <span class="comment">#   test: [&quot;CMD&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;ls logs/app.log&quot;]</span></span><br><span class="line">    <span class="comment">#   interval: 30s</span></span><br><span class="line">    <span class="comment">#   timeout: 10s</span></span><br><span class="line">    <span class="comment">#   retries: 3</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 服务 2：Redis 服务</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-prod</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data/redis:/data</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--appendonly</span> <span class="literal">yes</span>  <span class="comment"># 启用 AOF 持久化</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;redis-cli&quot;</span>, <span class="string">&quot;ping&quot;</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">3s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>然后运行： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d --build</span><br></pre></td></tr></table></figure>

<p>✅ 会自动构建镜像并启动。</p>
<hr>
<h2 id="🌐-Docker-Hub-是什么？（补充知识）"><a href="#🌐-Docker-Hub-是什么？（补充知识）" class="headerlink" title="🌐 Docker Hub 是什么？（补充知识）"></a>🌐 Docker Hub 是什么？（补充知识）</h2><p>👉 <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a></p>
<p>这是 Docker 的“应用商店”或“镜像仓库”，你可以在这里：</p>
<ul>
<li>🔍 搜索官方或社区提供的镜像</li>
<li>🔽 使用 <code>docker pull</code> 下载镜像</li>
<li>🚀 使用 <code>docker run</code> 启动服务</li>
</ul>
<p>常见镜像：</p>
<ul>
<li><code>nginx</code>：高性能网页服务器</li>
<li><code>redis</code>：内存数据库</li>
<li><code>mysql</code>, <code>postgres</code>：关系型数据库</li>
<li><code>python</code>, <code>node</code>, <code>golang</code>：编程语言环境</li>
<li><code>alpine</code>：超轻量 Linux 基础镜像（~5MB）</li>
</ul>
<p>命令格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取镜像</span></span><br><span class="line">docker pull 镜像名[:标签]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行容器</span></span><br><span class="line">docker run [选项] 镜像名[:标签]</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br><span class="line">docker run -d -p 80:80 nginx</span><br><span class="line"></span><br><span class="line">docker pull redis:7</span><br><span class="line">docker run -d -p 6379:6379 redis:7</span><br></pre></td></tr></table></figure>

<p>小贴士：</p>
<ul>
<li>不写标签默认是 <code>:latest</code></li>
<li>国内用户建议配置<strong>镜像加速器</strong>提升下载速度</li>
<li>你也可以把自己的镜像上传到 Docker Hub，分享给他人</li>
</ul>
<hr>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="compose停止但不删除容器"><a href="#compose停止但不删除容器" class="headerlink" title="compose停止但不删除容器"></a>compose停止但不删除容器</h3><p>📌 命令对比</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
<th>是否删除容器</th>
</tr>
</thead>
<tbody><tr>
<td><code>docker compose stop</code></td>
<td><strong>停止容器</strong>，但保留容器、网络、卷</td>
<td>✅ 不删除</td>
</tr>
<tr>
<td><code>docker compose start</code></td>
<td>重新启动已停止的容器</td>
<td>✅ 可恢复</td>
</tr>
<tr>
<td><code>docker compose down</code></td>
<td>停止并<strong>删除</strong>容器、网络（卷可选）</td>
<td>❌ 删除</td>
</tr>
</tbody></table>
<p>✅ 使用场景对比</p>
<p>场景 1：只想暂停服务（比如改配置）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 停止但不删除</span></span><br><span class="line">docker compose stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 docker-compose.yml 或代码</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新启动</span></span><br><span class="line">docker compose start</span><br></pre></td></tr></table></figure>
<p>✅ 容器、网络、数据都还在，启动快！</p>
<p>场景 2：彻底清理（比如换镜像）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker compose down</span><br><span class="line"><span class="comment"># 容器和网络都被删除</span></span><br></pre></td></tr></table></figure>

<p>如果加 <code>-v</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose down -v</span><br></pre></td></tr></table></figure>
<p>✅ 连<strong>数据卷</strong>也删除（慎用！）</p>
<p>✅ 验证：<code>stop</code> 后容器还在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 停止</span></span><br><span class="line">docker compose stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 查看所有容器（包括已停止的）</span></span><br><span class="line">docker compose ps</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME               COMMAND             SERVICE   STATUS</span><br><span class="line">weather-<span class="keyword">prod</span>       <span class="string">&quot;python script.py&quot;</span>  weather   exited</span><br><span class="line">redis-<span class="keyword">prod</span>         <span class="string">&quot;redis-server&quot;</span>      redis     exited</span><br></pre></td></tr></table></figure>
<p>✅ 容器还在，只是 <code>exited</code>（已停止）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. 重新启动</span></span><br><span class="line">docker compose start</span><br></pre></td></tr></table></figure>
<p>✅ 服务恢复，数据不丢失</p>
<p>✅ 进阶：只停止某个服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只停止 weather 服务</span></span><br><span class="line">docker compose stop weather</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只停止 redis</span></span><br><span class="line">docker compose stop redis</span><br></pre></td></tr></table></figure>

<p>然后可以单独启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose start weather</span><br></pre></td></tr></table></figure>

<p>✅ 总结</p>
<table>
<thead>
<tr>
<th>你想做什么</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>停止但不删除容器</td>
<td><code>docker compose stop</code></td>
</tr>
<tr>
<td>重新启动已停止的容器</td>
<td><code>docker compose start</code></td>
</tr>
<tr>
<td>彻底删除容器和网络</td>
<td><code>docker compose down</code></td>
</tr>
<tr>
<td>删除容器 + 卷</td>
<td><code>docker compose down -v</code></td>
</tr>
</tbody></table>
<p>🎯 类比：电脑操作</p>
<table>
<thead>
<tr>
<th>Docker 命令</th>
<th>类比</th>
</tr>
</thead>
<tbody><tr>
<td><code>docker compose stop</code></td>
<td>关机（下次能开机）</td>
</tr>
<tr>
<td><code>docker compose start</code></td>
<td>开机</td>
</tr>
<tr>
<td><code>docker compose down</code></td>
<td>格式化硬盘 + 拆电脑</td>
</tr>
<tr>
<td><code>docker compose up</code></td>
<td>装新电脑</td>
</tr>
</tbody></table>
<hr>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
              <a href="/tags/nigix/" rel="tag"># nigix</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/07/21/RAG%E5%AE%9E%E6%88%98%E7%AF%87%EF%BC%9APython/" rel="prev" title="RAG实战篇：Python">
                  <i class="fa fa-angle-left"></i> RAG实战篇：Python
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Chr</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">375k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">22:42</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","src":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
