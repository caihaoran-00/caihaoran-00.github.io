<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"caihaoran-00.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å‰è¨€åœ¨ç°ä»£å¤§æ¨¡å‹åº”ç”¨å¼€å‘ä¸­ï¼Œæ„å»ºèƒ½å¤Ÿå¤„ç†å¤æ‚ä»»åŠ¡å’Œå¤šæ­¥éª¤æ¨ç†çš„ Agent æ˜¯ä¸€ä¸ªé‡è¦éœ€æ±‚ã€‚LangGraph æ˜¯ä¸€ä¸ªåŸºäº LangChain çš„æ¡†æ¶ï¼Œä¸“é—¨è®¾è®¡ç”¨äºæ„å»ºå’Œç¼–æ’å¤æ‚çš„ Agent å·¥ä½œæµã€‚å®ƒé€šè¿‡å›¾ï¼ˆGraphï¼‰ç»“æ„å®šä¹‰ä»»åŠ¡æµç¨‹ï¼Œæ”¯æŒå¾ªç¯ã€åˆ†æ”¯ã€å¹¶è¡Œç­‰å¤æ‚é€»è¾‘ï¼Œæ˜¯å¼€å‘é«˜æ•ˆã€çµæ´» Agent åº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚ æœ¬æ–‡å°†ä»‹ç» LangGraph çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶é€šè¿‡å‡ ä¸ªåŸºç¡€ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒæ„">
<meta property="og:type" content="article">
<meta property="og:title" content="langgraphä»‹ç»åŠdemo">
<meta property="og:url" content="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/index.html">
<meta property="og:site_name" content="Chr&#39;s Blog">
<meta property="og:description" content="å‰è¨€åœ¨ç°ä»£å¤§æ¨¡å‹åº”ç”¨å¼€å‘ä¸­ï¼Œæ„å»ºèƒ½å¤Ÿå¤„ç†å¤æ‚ä»»åŠ¡å’Œå¤šæ­¥éª¤æ¨ç†çš„ Agent æ˜¯ä¸€ä¸ªé‡è¦éœ€æ±‚ã€‚LangGraph æ˜¯ä¸€ä¸ªåŸºäº LangChain çš„æ¡†æ¶ï¼Œä¸“é—¨è®¾è®¡ç”¨äºæ„å»ºå’Œç¼–æ’å¤æ‚çš„ Agent å·¥ä½œæµã€‚å®ƒé€šè¿‡å›¾ï¼ˆGraphï¼‰ç»“æ„å®šä¹‰ä»»åŠ¡æµç¨‹ï¼Œæ”¯æŒå¾ªç¯ã€åˆ†æ”¯ã€å¹¶è¡Œç­‰å¤æ‚é€»è¾‘ï¼Œæ˜¯å¼€å‘é«˜æ•ˆã€çµæ´» Agent åº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚ æœ¬æ–‡å°†ä»‹ç» LangGraph çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶é€šè¿‡å‡ ä¸ªåŸºç¡€ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒæ„">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250211153745222.png">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250224115957563.png">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250224120037990.png">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250224151902529.png">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250225103010292.png">
<meta property="og:image" content="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250225104331399.png">
<meta property="article:published_time" content="2025-02-10T09:14:33.000Z">
<meta property="article:modified_time" content="2025-04-28T07:18:21.979Z">
<meta property="article:author" content="Chr">
<meta property="article:tag" content="llm">
<meta property="article:tag" content="langgraph">
<meta property="article:tag" content="langchain">
<meta property="article:tag" content="agent">
<meta property="article:tag" content="react">
<meta property="article:tag" content="cot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250211153745222.png">


<link rel="canonical" href="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/","path":"2025/02/10/langgraphä»‹ç»åŠdemo/","title":"langgraphä»‹ç»åŠdemo"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>langgraphä»‹ç»åŠdemo | Chr's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Chr's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Record and Share</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Langgraph"><span class="nav-number">2.</span> <span class="nav-text">Langgraph</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">2.1.</span> <span class="nav-text">æ ¸å¿ƒæ¦‚å¿µ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LangGraph-%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-number">3.</span> <span class="nav-text">LangGraph çš„ä¼˜åŠ¿</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B1%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="nav-number">4.</span> <span class="nav-text">ç¤ºä¾‹1ï¼šæ„å»ºåŸºæœ¬èŠå¤©æœºå™¨äºº</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TypedDict"><span class="nav-number">4.1.</span> <span class="nav-text">TypedDict</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Annotated"><span class="nav-number">4.2.</span> <span class="nav-text">Annotated</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B2%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%E5%A2%9E%E5%BC%BA%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="nav-number">5.</span> <span class="nav-text">ç¤ºä¾‹2ï¼šä½¿ç”¨å·¥å…·å¢å¼ºèŠå¤©æœºå™¨äºº</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%B7%B1%E6%9E%84%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="nav-number">5.1.</span> <span class="nav-text">è‡ªå·±æ„å»ºæ–¹å¼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B3%EF%BC%9A%E4%B8%BA%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA%E6%B7%BB%E5%8A%A0%E5%86%85%E5%AD%98%EF%BC%88%E8%AE%B0%E5%BF%86%EF%BC%89"><span class="nav-number">6.</span> <span class="nav-text">ç¤ºä¾‹3ï¼šä¸ºèŠå¤©æœºå™¨äººæ·»åŠ å†…å­˜ï¼ˆè®°å¿†ï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B4%EF%BC%9A%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA"><span class="nav-number">7.</span> <span class="nav-text">ç¤ºä¾‹4ï¼šæµå¼è¾“å‡º</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B5%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7"><span class="nav-number">8.</span> <span class="nav-text">ç¤ºä¾‹5ï¼šè‡ªå®šä¹‰å·¥å…·</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B6%EF%BC%9A%E7%B3%BB%E7%BB%9F%E6%8F%90%E7%A4%BA%E8%AF%8D"><span class="nav-number">9.</span> <span class="nav-text">ç¤ºä¾‹6ï¼šç³»ç»Ÿæç¤ºè¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B7%EF%BC%9A%E7%BB%88%E6%9E%81%E7%AE%80%E5%8C%96%E7%89%88"><span class="nav-number">10.</span> <span class="nav-text">ç¤ºä¾‹7ï¼šç»ˆæç®€åŒ–ç‰ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B8%EF%BC%9A%E8%81%8A%E5%A4%A9%E5%8E%86%E5%8F%B2%E7%AE%A1%E7%90%86"><span class="nav-number">11.</span> <span class="nav-text">ç¤ºä¾‹8ï¼šèŠå¤©å†å²ç®¡ç†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-number">12.</span> <span class="nav-text">é™„å½•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ReAct"><span class="nav-number">12.1.</span> <span class="nav-text">ReAct</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E7%BB%B4%E9%93%BE%EF%BC%88Chain-of-Thought-CoT%EF%BC%89"><span class="nav-number">12.2.</span> <span class="nav-text">æ€ç»´é“¾ï¼ˆChain of Thought, CoTï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#workflow"><span class="nav-number">12.3.</span> <span class="nav-text">workflow</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="nav-number">13.</span> <span class="nav-text">å‚è€ƒé“¾æ¥</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chr</p>
  <div class="site-description" itemprop="description">Welcome to my little world</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:1299964565@qq.com" title="E-Mail â†’ mailto:1299964565@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://caihaoran-00.github.io/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chr">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chr's Blog">
      <meta itemprop="description" content="Welcome to my little world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="langgraphä»‹ç»åŠdemo | Chr's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          langgraphä»‹ç»åŠdemo
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-02-10 17:14:33" itemprop="dateCreated datePublished" datetime="2025-02-10T17:14:33+08:00">2025-02-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-04-28 15:18:21" itemprop="dateModified" datetime="2025-04-28T15:18:21+08:00">2025-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/code/" itemprop="url" rel="index"><span itemprop="name">code</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>8.5k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>31 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ç°ä»£å¤§æ¨¡å‹åº”ç”¨å¼€å‘ä¸­ï¼Œæ„å»ºèƒ½å¤Ÿå¤„ç†å¤æ‚ä»»åŠ¡å’Œå¤šæ­¥éª¤æ¨ç†çš„ Agent æ˜¯ä¸€ä¸ªé‡è¦éœ€æ±‚ã€‚<strong>LangGraph</strong> æ˜¯ä¸€ä¸ªåŸºäº LangChain çš„æ¡†æ¶ï¼Œä¸“é—¨è®¾è®¡ç”¨äºæ„å»ºå’Œç¼–æ’å¤æ‚çš„ Agent å·¥ä½œæµã€‚å®ƒé€šè¿‡å›¾ï¼ˆGraphï¼‰ç»“æ„å®šä¹‰ä»»åŠ¡æµç¨‹ï¼Œæ”¯æŒå¾ªç¯ã€åˆ†æ”¯ã€å¹¶è¡Œç­‰å¤æ‚é€»è¾‘ï¼Œæ˜¯å¼€å‘é«˜æ•ˆã€çµæ´» Agent åº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚</p>
<p>æœ¬æ–‡å°†ä»‹ç» LangGraph çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶é€šè¿‡å‡ ä¸ªåŸºç¡€ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒæ„å»º Agent åº”ç”¨ã€‚</p>
<span id="more"></span>

<hr>
<h2 id="Langgraph"><a href="#Langgraph" class="headerlink" title="Langgraph"></a>Langgraph</h2><p>LangGraph æ˜¯ä¸€ä¸ªåŸºäºå›¾çš„æ¡†æ¶ï¼Œç”¨äºå®šä¹‰å’Œè¿è¡Œå¤æ‚çš„ Agent å·¥ä½œæµã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼Œå¹¶é€šè¿‡è¾¹ï¼ˆEdgeï¼‰è¿æ¥è¿™äº›èŠ‚ç‚¹ï¼Œå½¢æˆä¸€ä¸ªæœ‰å‘å›¾ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ï¼ˆå¦‚è°ƒç”¨ APIã€ç”Ÿæˆæ–‡æœ¬ã€å¤„ç†æ•°æ®ç­‰ï¼‰ï¼Œè€Œè¾¹åˆ™å®šä¹‰äº†ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºå’Œæ¡ä»¶åˆ†æ”¯ã€‚</p>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><ol>
<li><strong>èŠ‚ç‚¹ï¼ˆNodeï¼‰</strong>ï¼šä»»åŠ¡çš„åŸºæœ¬å•å…ƒï¼Œæ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½</li>
<li><strong>è¾¹ï¼ˆEdgeï¼‰</strong>ï¼šè¿æ¥èŠ‚ç‚¹çš„è·¯å¾„ï¼Œå®šä¹‰ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº</li>
<li><strong>å›¾ï¼ˆGraphï¼‰</strong>ï¼šç”±èŠ‚ç‚¹å’Œè¾¹ç»„æˆçš„å·¥ä½œæµ</li>
<li><strong>æ¡ä»¶åˆ†æ”¯ï¼ˆConditional Edgeï¼‰</strong>ï¼šæ ¹æ®æ¡ä»¶å†³å®šä¸‹ä¸€æ­¥æ‰§è¡Œçš„èŠ‚ç‚¹</li>
<li><strong>å¾ªç¯ï¼ˆCycleï¼‰</strong>ï¼šæ”¯æŒå¾ªç¯æ‰§è¡ŒæŸäº›èŠ‚ç‚¹ã€‚</li>
</ol>
<hr>
<h2 id="LangGraph-çš„ä¼˜åŠ¿"><a href="#LangGraph-çš„ä¼˜åŠ¿" class="headerlink" title="LangGraph çš„ä¼˜åŠ¿"></a>LangGraph çš„ä¼˜åŠ¿</h2><ul>
<li><strong>çµæ´»æ€§</strong>ï¼šæ”¯æŒå¤æ‚çš„å·¥ä½œæµè®¾è®¡ï¼ŒåŒ…æ‹¬åˆ†æ”¯ã€å¾ªç¯å’Œå¹¶è¡Œä»»åŠ¡ã€‚</li>
<li><strong>æ¨¡å—åŒ–</strong>ï¼šå°†ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªèŠ‚ç‚¹ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚</li>
<li><strong>é«˜æ•ˆæ€§</strong>ï¼šé€šè¿‡å›¾ç»“æ„ä¼˜åŒ–ä»»åŠ¡æ‰§è¡Œé¡ºåºï¼Œå‡å°‘å†—ä½™è®¡ç®—ã€‚</li>
<li><strong>æ˜“ç”¨æ€§</strong>ï¼šä¸ LangChain æ— ç¼é›†æˆï¼Œæä¾›ä¸°å¯Œçš„å·¥å…·å’Œæ¨¡å—ã€‚</li>
</ul>
<hr>
<h2 id="ç¤ºä¾‹1ï¼šæ„å»ºåŸºæœ¬èŠå¤©æœºå™¨äºº"><a href="#ç¤ºä¾‹1ï¼šæ„å»ºåŸºæœ¬èŠå¤©æœºå™¨äºº" class="headerlink" title="ç¤ºä¾‹1ï¼šæ„å»ºåŸºæœ¬èŠå¤©æœºå™¨äºº"></a>ç¤ºä¾‹1ï¼šæ„å»ºåŸºæœ¬èŠå¤©æœºå™¨äºº</h2><figure class="highlight python"><figcaption><span>introduction_part1.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">https://langchain-ai.github.io/langgraph/tutorials/introduction/#part-1-build-a-basic-chatbot</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å±€åŸŸç½‘æœ¬åœ°éƒ¨ç½²æ¨¡å‹</span></span><br><span class="line"><span class="comment"># llm = ChatOpenAI(model_name=&quot;Qwen&quot;,</span></span><br><span class="line"><span class="comment">#                    openai_api_key=&#x27;Empty&#x27;,</span></span><br><span class="line"><span class="comment">#                    openai_api_base=&#x27;http://192.168.0.138:8000/v1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-*******&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen2.5-7b-instruct&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The first argument is the unique node name</span></span><br><span class="line"><span class="comment"># The second argument is the function or object that will be called whenever</span></span><br><span class="line"><span class="comment"># the node is used.</span></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line">graph_builder.set_entry_point(<span class="string">&quot;chatbot&quot;</span>)    <span class="comment"># graph_builder.add_edge(START, &quot;chatbot&quot;)</span></span><br><span class="line">graph_builder.set_finish_point(<span class="string">&quot;chatbot&quot;</span>)   <span class="comment"># graph_builder.add_edge(&quot;chatbot&quot;, END)</span></span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;):</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> event.values():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Assistant:&quot;</span>, value[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æµç¨‹ï¼š</p>
<ul>
<li>å®šä¹‰å¯¹è¯çŠ¶æ€ï¼ˆStateï¼‰</li>
<li>åˆå§‹åŒ–Langgraph</li>
<li>é…ç½®LLM</li>
<li>å®šä¹‰èŠå¤©æœºå™¨äººï¼ˆchatbotï¼‰</li>
<li>æ„å»ºå¯¹è¯æµï¼Œè¿™é‡Œæ˜¯æœ€ç®€å•çš„çº¿æ€§ç»“æ„</li>
<li>è¿è¡ŒèŠå¤©å¾ªç¯</li>
</ul>
<img src="/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250211153745222.png" class="" title="image-20250211153745222">

<p><strong>ä»£ç æ‹†è§£&amp;è®²è§£ï¼š</strong></p>
<h3 id="TypedDict"><a href="#TypedDict" class="headerlink" title="TypedDict"></a>TypedDict</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆï¼Œ<code>TypedDict</code> æ˜¯ Python 3.8+ å¼•å…¥çš„ä¸€ç§<strong>ç±»å‹æç¤ºå·¥å…·</strong>ï¼Œç”¨äºä¸ºå­—å…¸å®šä¹‰ç»“æ„åŒ–ç±»å‹çº¦æŸã€‚<br>å®ƒæœ¬è´¨ä¸Šæ˜¯<strong>ä¸€ç§â€œä¼ªç±»â€</strong>ï¼Œä½†å®ƒçš„å®ä¾‹<strong>ä»ç„¶æ˜¯æ™®é€šçš„ Python å­—å…¸</strong>ï¼Œè€Œä¸æ˜¯ç±»çš„å®ä¾‹ã€‚</p>
<p>æ˜¯ä¸æ˜¯å’Œ<a href="https://caihaoran-00.github.io/2025/02/05/fastapi-request%E6%9E%84%E5%BB%BA%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E5%BE%AE%E6%9C%8D%E5%8A%A1/#more">è¿™é‡Œçš„</a><code>pydantic</code>çš„<code>BaseModel</code>æ¨¡å—ï¼ˆç»“æ„åŒ–ç±»å‹çº¦æŸæ–¹é¢ï¼‰æ¯”è¾ƒç›¸ä¼¼ï¼Ÿï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="comment"># å®šä¹‰è¯·æ±‚æ•°æ®æ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    age: <span class="built_in">int</span></span><br><span class="line">    email: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>  <span class="comment"># å¯é€‰å­—æ®µ</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># POST æ¥å£ï¼Œæ¥æ”¶ JSON è¯·æ±‚ä½“</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/users/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user: User</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;ç”¨æˆ·å·²åˆ›å»º&quot;</span>, <span class="string">&quot;user&quot;</span>: user&#125;</span><br></pre></td></tr></table></figure>

<p>è¯è¯´å›æ¥ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>TypeDict</code>ï¼Ÿ</p>
<p>åœ¨Pythonä¸­ï¼Œå­—å…¸æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æ²¡æœ‰é™æ€ç±»å‹æ£€æŸ¥ï¼š<code>person[&quot;age&quot;]</code> å¯èƒ½è¢«æ„å¤–èµ‹å€¼ä¸º <code>str</code> ç±»å‹ï¼ˆå¦‚ <code>&quot;25&quot;</code>ï¼‰ã€‚</li>
<li>æ²¡æœ‰å›ºå®šç»“æ„ï¼šå­—å…¸å¯ä»¥åŠ¨æ€æ·»åŠ &#x2F;åˆ é™¤é”®ï¼Œå®¹æ˜“å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œ<code>TypeDict</code>åº”è¿è€Œç”Ÿã€‚</p>
<p><code>TypeDict</code>çš„åŸºæœ¬ç”¨æ³•</p>
<p>å®šä¹‰ä¸€ä¸ªç»“æ„åŒ–çš„å­—å…¸ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    age: <span class="built_in">int</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª<code>Person</code><strong>çœ‹èµ·æ¥åƒç±»</strong>ï¼Œä½†å®ƒ<strong>ä¸èƒ½è¢«å®ä¾‹åŒ–</strong>ï¼ˆpyhton 3.8+ç‰ˆæœ¬ä¸èƒ½å®ä¾‹åŒ–ï¼ŒPython3.9+å°±èƒ½å®ä¾‹åŒ–äº†ï¼Œæˆ‘ä½¿ç”¨çš„python 3.10+æ‰€ä»¥å¯ä»¥è¢«å®ä¾‹åŒ–ï¼‰ï¼š</p>
<figure class="highlight python"><figcaption><span>typeddict_t.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    age: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Person()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;type(p)=<span class="subst">&#123;<span class="built_in">type</span>(p)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;type(p1)=<span class="subst">&#123;<span class="built_in">type</span>(p1)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">p2: Person = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bob&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p2=<span class="subst">&#123;p2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">p3: Person = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">23</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p3=<span class="subst">&#123;p3&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">p4: Person = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="string">&quot;23&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p4=<span class="subst">&#123;p4&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">p5: Person = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">23</span>, <span class="string">&quot;height&quot;</span>: <span class="number">168</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p5=<span class="subst">&#123;p5&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250224115957563.png" class="" title="image-20250224115957563">

<img src="/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250224120037990.png" class="" title="image-20250224120037990">



<p><strong>æ³¨æ„æ³¨æ„æ³¨æ„ï¼š</strong></p>
<p>ä¸Šé¢è¯´çš„<strong>ä¸ºå­—å…¸å®šä¹‰ç»“æ„åŒ–ç±»å‹çº¦æŸ</strong>ï¼Œå¹¶æœªä½“ç°å‡ºæ¥å•Šï¼Œç±»å‹ä¸åŒ¹é…æˆ–è€…å¢åŠ æ–°çš„é”®å€¼å¯¹ä¸æ˜¯ä¹Ÿèƒ½è¿è¡Œå—ï¼Ÿä¹Ÿæ²¡æŠ¥é”™å•Šï¼Ÿå¥½çš„ï¼Œä½ è¶Šæ¥è¶Šæ¥è¿‘çœŸç›¸äº†ï¼Œè¿™é‡Œå¼•å…¥ï¼ˆç§‘æ™®ï¼‰ä¸¤ä¸ªæ¦‚å¿µï¼Œ</p>
<ul>
<li><p><strong>é™æ€æ£€æŸ¥</strong>æ˜¯åœ¨ä½ è¿è¡Œä»£ç ä¹‹å‰ï¼ˆæ¯”å¦‚ä½¿ç”¨PyCharmçš„ç±»å‹æ£€æŸ¥åŠŸèƒ½ï¼‰è¿›è¡Œçš„ã€‚è¿™äº›å·¥å…·ä¼šæ ¹æ®ä½ å†™çš„ç±»å‹æç¤ºï¼ˆä¾‹å¦‚ TypedDictï¼‰æ¥æ£€æŸ¥ä»£ç æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å¦‚æœå‘ç°ç±»å‹ä¸åŒ¹é…ï¼Œå®ƒä»¬ä¼šç»™å‡ºè­¦å‘Šæˆ–é”™è¯¯æç¤ºï¼Œä½†è¿™å¹¶ä¸ä¼šé˜»æ­¢ä»£ç è¿è¡Œã€‚</p>
</li>
<li><p><strong>è¿è¡Œæ—¶</strong>åˆ™æ˜¯åœ¨ä½ ç‚¹å‡»â€œè¿è¡Œâ€ä¹‹åï¼ŒPython çœŸæ­£æ‰§è¡Œä½ çš„ä»£ç ã€‚æ­¤æ—¶ Python ä¸ä¼šè‡ªåŠ¨æ£€æŸ¥ç±»å‹çº¦æŸï¼Œæ‰€ä»¥å³ä½¿ç±»å‹ä¸åŒ¹é…ï¼ˆæ¯”å¦‚ p4 çš„ age ä¼ äº†å­—ç¬¦ä¸²ï¼‰ï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ã€‚</p>
</li>
</ul>
<p>å“¦ï¼æ˜ç™½äº†ï¼åŸæ¥TypedDictæ˜¯ä½œç”¨åœ¨é™æ€æ£€æŸ¥é˜¶æ®µçš„å•Šï¼å°±è¯´ä¸ºä»€ä¹ˆp2ã€p4å’Œp5ä¼šå‡ºç°é˜´å½±æ ‡æ³¨å‘¢ï¼Œè€Œä¸”é¼ æ ‡æ”¾ä¸Šå»è¿˜ä¼šæœ‰æç¤ºï¼Œä½†å®é™…ä¸ŠTypedDictå¹¶ä¸å½±å“è¿è¡Œæ—¶ã€‚</p>
<h3 id="Annotated"><a href="#Annotated" class="headerlink" title="Annotated"></a>Annotated</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br></pre></td></tr></table></figure>

<p>ä¸Šæ–‡è§£é‡Šäº†TypedDictçš„ä½œç”¨ï¼Œé‚£ä¹ˆAnnotatedçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p><code>Annotated</code> æ˜¯ <code>typing</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š<br>ğŸ’¡ <strong>â€œç»™ç±»å‹æç¤ºï¼ˆType Hintï¼‰æ·»åŠ é¢å¤–çš„å…ƒæ•°æ®ï¼ˆMetadataï¼‰ã€‚â€</strong></p>
<p>ç®€å•æ¥è¯´ï¼Œå®ƒå¯ä»¥åœ¨ <strong>ç±»å‹ä¸Šé™„åŠ é¢å¤–çš„ä¿¡æ¯</strong>ï¼Œè¿™äº›ä¿¡æ¯ä¸ä¼šå½±å“ Python è¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œä½†å¯ä»¥è¢«å·¥å…·ï¼ˆå¦‚ <code>mypy</code>ã€æ¡†æ¶ã€åº“ï¼‰ç”¨æ¥åšé¢å¤–çš„æ£€æŸ¥æˆ–å¤„ç†ã€‚</p>
<p>ç®€å•çš„Annotatedä¾‹å­ï¼š</p>
<figure class="highlight python"><figcaption><span>annotated_t.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§„å®š age åªèƒ½åœ¨ 0~120 ä¹‹é—´</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    age: Annotated[<span class="built_in">int</span>, Field(ge=<span class="number">0</span>, le=<span class="number">120</span>)]  <span class="comment"># ge=greater or equal, le=less or equal</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = Person(name=<span class="string">&quot;Alice&quot;</span>, age=<span class="number">25</span>)  <span class="comment"># âœ… æ­£ç¡®</span></span><br><span class="line">p1 = Person(name=<span class="number">1</span>, age=<span class="number">25</span>)  <span class="comment"># âŒ è¿è¡Œæ—¶æŠ¥é”™</span></span><br><span class="line">p2 = Person(name=<span class="string">&quot;Bob&quot;</span>, age=<span class="number">150</span>)  <span class="comment"># âŒ è¿è¡Œæ—¶æŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<p>å“¦ï¼Œé‚£çœ‹èµ·æ¥å®šä¹‰çš„è¿™ä¸ªStateé¦–å…ˆæ˜¯ä¸ªå­—å…¸ï¼Œç„¶åé”®æ˜¯â€messagesâ€ï¼Œå€¼å¯¹åº”çš„æ˜¯ä¸ªListï¼Œå¯¹è¿™ä¸ªmessagesé™„åŠ çš„é¢å¤–ä¿¡æ¯æ˜¯add_messagesï¼Œé‚£ä¹ˆæ„æ€æ˜¯ä»–æœ‰è‡ªåŠ¨ç´¯ç§¯å†å²å¯¹è¯çš„åŠŸèƒ½å’¯ï¼ŸéªŒè¯ä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[DEBUG] Incoming state[&#x27;messages&#x27;]: <span class="subst">&#123;state[<span class="string">&#x27;messages&#x27;</span>]&#125;</span>&quot;</span>)  <span class="comment"># æ‰“å°å†å²æ¶ˆæ¯</span></span><br><span class="line">    response = llm.invoke(state[<span class="string">&quot;messages&quot;</span>])  <span class="comment"># ç”Ÿæˆå›å¤</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [response]&#125;  <span class="comment"># ä»…è¿”å›å½“å‰çš„å›å¤ï¼Œä¸æ‰‹åŠ¨ç´¯ç§¯</span></span><br></pre></td></tr></table></figure>

<img src="/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250224151902529.png" class="" title="image-20250224151902529">

<p>å¯è§ï¼Œ<strong>è¿™é‡Œçš„add_messageså¹¶æ²¡æœ‰ä»€ä¹ˆå®é™…æ•ˆæœ</strong>ï¼Ÿ</p>
<hr>
<h2 id="ç¤ºä¾‹2ï¼šä½¿ç”¨å·¥å…·å¢å¼ºèŠå¤©æœºå™¨äºº"><a href="#ç¤ºä¾‹2ï¼šä½¿ç”¨å·¥å…·å¢å¼ºèŠå¤©æœºå™¨äºº" class="headerlink" title="ç¤ºä¾‹2ï¼šä½¿ç”¨å·¥å…·å¢å¼ºèŠå¤©æœºå™¨äºº"></a>ç¤ºä¾‹2ï¼šä½¿ç”¨å·¥å…·å¢å¼ºèŠå¤©æœºå™¨äºº</h2><h3 id="è‡ªå·±æ„å»ºæ–¹å¼"><a href="#è‡ªå·±æ„å»ºæ–¹å¼" class="headerlink" title="è‡ªå·±æ„å»ºæ–¹å¼"></a>è‡ªå·±æ„å»ºæ–¹å¼</h3><ul>
<li><p>å»<a target="_blank" rel="noopener" href="https://tavily.com/">è¿™é‡Œ</a>ç”³è¯·ä¸‹tavilyçš„API_KEY</p>
</li>
<li><p>å®šä¹‰ï¼ˆè°ƒç”¨ï¼‰å·¥å…·</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;tvly-*****&quot;</span></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool]</span><br><span class="line">tool.invoke(<span class="string">&quot;What&#x27;s a &#x27;node&#x27; in LangGraph?&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D:\Anaconda3\envs\langchain\python.exe E:\chr_git\langchain_t\langgraph\introduction_part2.py </span><br><span class="line">[&#123;<span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://medium.com/@kbdhunga/beginners-guide-to-langgraph-understanding-state-nodes-and-edges-part-1-897e6114fa48&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&quot;Beginnerâ€™s Guide to LangGraph: Understanding State, Nodes, and Edges â€” Part 1 | by Kamal Dhungana | Medium Beginnerâ€™s Guide to LangGraph: Understanding State, Nodes, and Edges â€” Part 1 LangGraph â€” State, Node and Edge Explained Mainly, we will focus on various components of LangGraph: State, Node, and Edges, and how to build a complete graph from these components. Once we understand these components, we will be able to build relatively complex LangGraph-based agents. Each node represents a specific function or operation that processes the current state. Nodes can perform computations, modify the state, or generate outputs based on the input they receive. Follow 1.2K Followers Data scientist with a passion for AI, Regularly blogging about LLM and OpenAI&#x27;s innovations,Sharing insights for AI community growth Follow&quot;</span>&#125;, &#123;<span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://blog.langchain.dev/langgraph/&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;TL;DR: LangGraph is module built on top of LangChain to better enable creation of cyclical graphs, often needed for agent runtimes. This state is updated by nodes in the graph, which return operations to attributes of this state (in the form of a key-value store). After adding nodes, you can then add edges to create the graph. An example of this may be in the basic agent runtime, where we always want the model to be called after we call a tool. graph.add_edge(&quot;tools&quot;, &quot;model&quot;) The state of this graph by default contains concepts that should be familiar to you if you\&#x27;ve used LangChain agents: input, chat_history, intermediate_steps (and agent_outcome to represent the most recent agent outcome)&#x27;</span>&#125;]</span><br><span class="line"></span><br><span class="line">è¿›ç¨‹å·²ç»“æŸï¼Œé€€å‡ºä»£ç ä¸º <span class="number">0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»“åˆç¤ºä¾‹1å°±å¾—åˆ°äº†ï¼š</p>
</li>
</ul>
<figure class="highlight python"><figcaption><span>introduction_part2.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">https://langchain-ai.github.io/langgraph/tutorials/introduction/#requirements</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;tvly-*****&quot;</span></span><br><span class="line"></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool]</span><br><span class="line"><span class="comment"># print(tool.invoke(&quot;What&#x27;s a &#x27;node&#x27; in LangGraph?&quot;))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph,START,END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line"><span class="comment"># llm = ChatOpenAI(model_name=&quot;Qwen&quot;,</span></span><br><span class="line"><span class="comment">#                    openai_api_key=&#x27;Empty&#x27;,</span></span><br><span class="line"><span class="comment">#                    openai_api_base=&#x27;http://192.168.0.138:8000/v1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-***********&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen2.5-7b-instruct&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> ToolMessage</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicToolNode</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A node that runs the tools requested in the last AIMessage.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, tools: <span class="built_in">list</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>.tools_by_name = &#123;tool.name: tool <span class="keyword">for</span> tool <span class="keyword">in</span> tools&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, inputs: <span class="built_in">dict</span></span>):</span><br><span class="line">        <span class="keyword">if</span> messages := inputs.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">            message = messages[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;No message found in input&quot;</span>)</span><br><span class="line">        outputs = []</span><br><span class="line">        <span class="keyword">for</span> tool_call <span class="keyword">in</span> message.tool_calls:</span><br><span class="line">            tool_result = <span class="variable language_">self</span>.tools_by_name[tool_call[<span class="string">&quot;name&quot;</span>]].invoke(</span><br><span class="line">                tool_call[<span class="string">&quot;args&quot;</span>]</span><br><span class="line">            )</span><br><span class="line">            outputs.append(</span><br><span class="line">                ToolMessage(</span><br><span class="line">                    content=json.dumps(tool_result),</span><br><span class="line">                    name=tool_call[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">                    tool_call_id=tool_call[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: outputs&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tool_node = BasicToolNode(tools=tools)</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route_tools</span>(<span class="params"></span></span><br><span class="line"><span class="params">    state: State,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Use in the conditional_edge to route to the ToolNode if the last message</span></span><br><span class="line"><span class="string">    has tool calls. Otherwise, route to the end.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(state, <span class="built_in">list</span>):</span><br><span class="line">        ai_message = state[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">elif</span> messages := state.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">        ai_message = messages[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f&quot;No messages found in input state to tool_edge: <span class="subst">&#123;state&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(ai_message, <span class="string">&quot;tool_calls&quot;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(ai_message.tool_calls) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;tools&quot;</span></span><br><span class="line">    <span class="keyword">return</span> END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The `tools_condition` function returns &quot;tools&quot; if the chatbot asks to use a tool, and &quot;END&quot; if</span></span><br><span class="line"><span class="comment"># it is fine directly responding. This conditional routing defines the main agent loop.</span></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    route_tools,</span><br><span class="line">    <span class="comment"># The following dictionary lets you tell the graph to interpret the condition&#x27;s outputs as a specific node</span></span><br><span class="line">    <span class="comment"># It defaults to the identity function, but if you</span></span><br><span class="line">    <span class="comment"># want to use a node named something else apart from &quot;tools&quot;,</span></span><br><span class="line">    <span class="comment"># You can update the value of the dictionary to something else</span></span><br><span class="line">    <span class="comment"># e.g., &quot;tools&quot;: &quot;my_tools&quot;</span></span><br><span class="line">    &#123;<span class="string">&quot;tools&quot;</span>: <span class="string">&quot;tools&quot;</span>, END: END&#125;,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;):</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> event.values():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Assistant:&quot;</span>, value[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<img src="/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250225103010292.png" class="" title="image-20250225103010292">

<p>ä¸ç¤ºä¾‹1ç›¸æ¯”ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ”¹åŠ¨ï¼š</p>
<ul>
<li><p>å®šä¹‰ï¼ˆè°ƒç”¨ï¼‰äº†TavilySearchResultså·¥å…·ï¼Œå¹¶æ”¾åœ¨äº†toolsåˆ—è¡¨ä¸­ï¼Œæœ€åé€šè¿‡bind_toolså°†toolsåˆ—è¡¨ä¸llmç»‘å®šï¼Œchatbotä¸­çš„ä½¿ç”¨çš„æ˜¯ç»‘å®štoolsåçš„llmï¼Œå³llm_with_tools</p>
</li>
<li><p>æ–°å¢äº†å·¥å…·èŠ‚ç‚¹ï¼ˆnodeï¼‰ï¼Œé€šè¿‡BasicToolNodeç±»æ¥å®šä¹‰å·¥å…·èŠ‚ç‚¹ï¼ˆtool_nodeï¼‰ï¼Œ</p>
<ul>
<li><code>__init__</code>æ–¹æ³•æ¥å—ä¸€ä¸ªå·¥å…·åˆ—è¡¨ï¼ˆæ¯ä¸ªå·¥å…·å¯¹è±¡éƒ½æœ‰nameï¼‰ï¼Œç„¶åæŠŠå·¥å…·åˆ—è¡¨è½¬æ¢æˆå­—å…¸ï¼Œä»¥å·¥å…·çš„<code>name</code>ä½œä¸ºé”®ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡<code>name</code>ç›´æ¥æŸ¥æ‰¾å·¥å…·ï¼Œè€Œä¸å¿…éå†æ•´ä¸ªåˆ—è¡¨ï¼Œæé«˜æŸ¥æ‰¾é€Ÿåº¦ã€‚</li>
<li><code>__call__</code>æ–¹æ³•ä½¿è¿™ä¸ªç±»çš„å®ä¾‹å¯ä»¥åƒå‡½æ•°ä¸€æ ·è°ƒç”¨</li>
<li><code>inputs: dict</code>ï¼š<strong>è¾“å…¥æ•°æ®</strong>ï¼Œå…¶ä¸­åº”è¯¥åŒ…å« <code>&quot;messages&quot;</code>ï¼Œè®°å½•äº†å½“å‰çš„å¯¹è¯å†å²ã€‚</li>
<li><code>inputs.get(&quot;messages&quot;, [])</code>ï¼šå°è¯•è·å– <code>&quot;messages&quot;</code>ï¼Œå¦‚æœä¸å­˜åœ¨å°±è¿”å›ç©ºåˆ—è¡¨ <code>[]</code>ã€‚</li>
<li><code>message = messages[-1]</code>ï¼šè·å–æœ€æ–°çš„æ¶ˆæ¯ï¼ˆé€šå¸¸æ˜¯ AI ç”Ÿæˆçš„å›å¤ï¼‰ã€‚æœ€æ–°çš„ AI æ¶ˆæ¯å¯èƒ½åŒ…å« <code>&quot;tool_calls&quot;</code>ï¼Œè¿™äº›æ˜¯ AI è®©å·¥å…·æ‰§è¡Œçš„æŒ‡ä»¤ã€‚å¦‚æœ <code>&quot;messages&quot;</code> ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ <code>ValueError</code></li>
<li><code>message.tool_calls</code>ï¼šè¿™ä¸ª AI æ¶ˆæ¯ä¸­çš„å·¥å…·è°ƒç”¨åˆ—è¡¨</li>
<li><code>for tool_call in message.tool_calls:</code>ï¼š<strong>éå†æ‰€æœ‰å·¥å…·è°ƒç”¨</strong></li>
<li><code>tool_call[&quot;name&quot;]</code>ï¼šä» <code>tool_call</code> è·å–å·¥å…·åç§°</li>
<li><code>self.tools_by_name[tool_call[&quot;name&quot;]]</code>ï¼šä» <code>self.tools_by_name</code> <strong>æ‰¾åˆ°å¯¹åº”çš„å·¥å…·</strong></li>
<li><code>.invoke(tool_call[&quot;args&quot;])</code>ï¼š<strong>è°ƒç”¨å·¥å…·</strong>ï¼Œä¼ å…¥ <code>tool_call[&quot;args&quot;]</code> ä½œä¸ºå‚æ•°ï¼Œå¾—åˆ° <code>tool_result</code>ï¼ˆå·¥å…·æ‰§è¡Œç»“æœï¼‰</li>
<li><code>ToolMessage</code> æ˜¯ LangGraph æˆ– LangChain ä¸­çš„å·¥å…·è°ƒç”¨å“åº”æ ¼å¼ï¼Œè¡¨ç¤º <strong>å·¥å…·çš„è¿”å›ä¿¡æ¯</strong>ã€‚</li>
<li><code>json.dumps(tool_result)</code>ï¼šå°† <code>tool_result</code> è½¬æ¢ä¸º JSON æ ¼å¼ï¼Œæ–¹ä¾¿ä¼ è¾“</li>
<li><code>name=tool_call[&quot;name&quot;]</code>ï¼šå·¥å…·çš„åç§°</li>
<li><code>tool_call_id=tool_call[&quot;id&quot;]</code>ï¼šå·¥å…·è°ƒç”¨çš„ IDï¼ˆç”¨äºè¿½è¸ªï¼‰</li>
<li><code>outputs</code> æ˜¯<strong>æ‰€æœ‰å·¥å…·æ‰§è¡Œç»“æœçš„åˆ—è¡¨</strong></li>
<li>è¿”å›ä¸€ä¸ªå­—å…¸ <code>&#123;&quot;messages&quot;: outputs&#125;</code>ï¼Œç¬¦åˆ <code>LangGraph</code> å¤„ç†èŠ‚ç‚¹çš„æ ¼å¼</li>
</ul>
</li>
<li><p>æ–°å¢æ¡ä»¶è¾¹ï¼ˆadd_conditional_edges,  route_toolsï¼‰ï¼Œæ ¹æ®AIç”Ÿæˆçš„æ¶ˆæ¯æ˜¯å¦åŒ…å«å·¥å…·è°ƒç”¨ï¼ˆtool callsï¼‰æ¥å†³å®šä¸‹ä¸€ä¸ªæ‰§è¡Œçš„èŠ‚ç‚¹ã€‚å¦‚æœæ¶ˆæ¯é‡Œæœ‰å·¥å…·è°ƒç”¨ï¼Œå°±è½¬åˆ°<code>tools</code>å¤„ç†å·¥å…·è¯·æ±‚ï¼›å¦åˆ™ï¼Œç›´æ¥ç»“æŸå¯¹è¯ï¼ˆ<code>END</code>ï¼‰</p>
<ul>
<li><p><code>route_tools</code>å‡½æ•°ç”¨åœ¨<code>graph_builder.add_conditional_edges</code>é‡Œï¼Œä½œç”¨æ˜¯å†³å®šå¯¹è¯æµç¨‹çš„èµ°å‘</p>
</li>
<li><p><code>state</code> æ˜¯ <code>TypedDict</code> ç»“æ„ï¼ŒåŒ…å«ä¸€ä¸ª <code>&quot;messages&quot;</code> é”®ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ï¼‰</p>
</li>
<li><p>è¿™ä¸ªå‡½æ•°ä¼š<strong>æ£€æŸ¥æœ€è¿‘çš„ä¸€æ¡æ¶ˆæ¯</strong>ï¼Œçœ‹å®ƒæ˜¯å¦åŒ…å« <code>&quot;tool_calls&quot;</code>ï¼Œå¦‚æœæœ‰ï¼Œå°±è¿”å› <code>&quot;tools&quot;</code>ï¼Œå¦åˆ™è¿”å› <code>&quot;END&quot;</code></p>
</li>
<li><p>æ£€æŸ¥ <code>state</code> æ˜¯å¦æ˜¯<strong>åˆ—è¡¨</strong>ï¼š</p>
<ul>
<li><p>å¦‚æœ <code>state</code> æ˜¯åˆ—è¡¨ï¼Œå°±å–æœ€åä¸€æ¡æ¶ˆæ¯ï¼ˆ<code>state[-1]</code>ï¼‰</p>
</li>
<li><p>è¿™ç§æƒ…å†µå¯èƒ½å‡ºç°åœ¨æŸäº›æ¶ˆæ¯æ ¼å¼ä¸åŒçš„æƒ…å†µï¼Œæ¯”å¦‚ <code>state</code> ç›´æ¥æ˜¯æ¶ˆæ¯åˆ—è¡¨ï¼Œè€Œä¸æ˜¯ <code>TypedDict</code> ç»“æ„</p>
</li>
<li><p><code>state.get(&quot;messages&quot;, [])</code> å°è¯•è·å– <code>&quot;messages&quot;</code> åˆ—è¡¨ï¼Œé»˜è®¤è¿”å› &#96;[]&#96;&#96;</p>
</li>
<li><p>&#96;&#96;:&#x3D;<code>ï¼ˆæµ·è±¡è¿ç®—ç¬¦ï¼‰ç¡®ä¿ </code>messages<code>å˜é‡èµ‹å€¼åèƒ½ç»§ç»­åœ¨</code>if&#96; ä»£ç å—ä¸­ä½¿ç”¨</p>
</li>
<li><p><code>messages[-1]</code> å–å‡ºæœ€åä¸€æ¡æ¶ˆæ¯</p>
</li>
<li><p>å¦‚æœ <code>state</code> æ—¢ä¸æ˜¯åˆ—è¡¨ï¼Œä¹Ÿæ²¡æœ‰ <code>&quot;messages&quot;</code>ï¼Œå°±æŠ¥é”™ï¼Œè¯´æ˜è¾“å…¥ <code>state</code> ç»“æ„ä¸å¯¹</p>
</li>
</ul>
</li>
<li><p><code>hasattr(ai_message, &quot;tool_calls&quot;)</code> æ£€æŸ¥ <code>ai_message</code> æ˜¯å¦æœ‰ <code>tool_calls</code> å±æ€§</p>
</li>
<li><p><code>len(ai_message.tool_calls) &gt; 0</code> ç¡®ä¿ <code>tool_calls</code> é‡Œç¡®å®æœ‰å†…å®¹</p>
</li>
<li><p>å¦‚æœ <code>tool_calls</code> <strong>å­˜åœ¨ä¸”ä¸ä¸ºç©º</strong>ï¼Œè¿”å› <code>&quot;tools&quot;</code>ï¼Œè¡¨ç¤ºåº”è¯¥å»å·¥å…·èŠ‚ç‚¹å¤„ç†å·¥å…·è¯·æ±‚</p>
</li>
<li><p>æ·»åŠ æ¡ä»¶è¾¹ï¼ˆconditional edgesï¼‰ï¼Œæ ¹æ®<code>route_tools</code>çš„è¿”å›å€¼å†³å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p>
</li>
<li><p><code>chatbot</code>æ˜¯å½“å‰èŠ‚ç‚¹ï¼Œè¡¨ç¤ºä»<code>chatbot</code>èŠ‚ç‚¹å‡ºå‘ï¼›<code>route_tools</code>æ˜¯æ¡ä»¶åˆ¤æ–­å‡½æ•°ï¼Œä¼šæ ¹æ®<code>state</code>åˆ¤æ–­ä¸‹ä¸€ä¸ªè¦èµ°çš„è·¯å¾„ï¼›<code>&#123;&quot;tools&quot;: &quot;tools&quot;, END: END&#125;</code>å®šä¹‰äº† <code>route_tools</code> è¿”å›å€¼å’Œå›¾èŠ‚ç‚¹çš„æ˜ å°„ï¼Œå¦‚æœ <code>route_tools</code> è¿”å› <code>&quot;tools&quot;</code>ï¼Œé‚£ä¹ˆ<strong>è·³è½¬åˆ° <code>&quot;tools&quot;</code> èŠ‚ç‚¹</strong>ï¼Œå¦‚æœ <code>route_tools</code> è¿”å› <code>END</code>ï¼Œé‚£ä¹ˆ<strong>è·³è½¬åˆ° <code>END</code> èŠ‚ç‚¹ï¼ˆç»“æŸå¯¹è¯ï¼‰</strong></p>
</li>
</ul>
</li>
</ul>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li><p>é¦–å…ˆLLMé€šè¿‡llm.bind_tools(tools)ç»‘å®šä¸€ç»„å·¥å…·toolsï¼Œä»¥å‘Šè¯‰LLMå¯ä»¥è°ƒç”¨å“ªäº›å·¥å…·ï¼ŒåŒæ—¶å®šä¹‰æ¯ä¸ªå·¥å…·çš„è°ƒç”¨æ ¼å¼ï¼Œè®©LLMç”Ÿæˆç¬¦åˆæ ¼å¼çš„<code>tool_calls</code>è¯·æ±‚</p>
</li>
<li><p>BasicToolNodeè´Ÿè´£æ‰§è¡Œå·¥å…·</p>
</li>
<li><p>ç»“åˆ <code>route_tools</code> å®ç°è‡ªåŠ¨å·¥å…·è°ƒç”¨</p>
</li>
</ul>
<p>å¥½çš„ï¼Œè¿™é‡Œçš„ä»£ç åªæ˜¯ä¸ºäº†å¸®åŠ©ç†è§£<code>Langgraph</code>ä¸­çš„ç®€å•å†™æ³•çš„åŸºæœ¬åŸç†ï¼Œå®é™…ä½¿ç”¨æ—¶è¿™æ ·ä½¿ç”¨ï¼š</p>
<figure class="highlight python"><figcaption><span>introduction_part2_simple.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">https://langchain-ai.github.io/langgraph/tutorials/introduction/#requirements</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode, tools_condition</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;tvly-***********&quot;</span></span><br><span class="line"></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool]</span><br><span class="line"><span class="comment"># print(tool.invoke(&quot;What&#x27;s a &#x27;node&#x27; in LangGraph?&quot;))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line"><span class="comment"># llm = ChatOpenAI(model_name=&quot;Qwen&quot;,</span></span><br><span class="line"><span class="comment">#                    openai_api_key=&#x27;Empty&#x27;,</span></span><br><span class="line"><span class="comment">#                    openai_api_base=&#x27;http://192.168.0.138:8000/v1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-*********&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen2.5-7b-instruct&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    response = llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])</span><br><span class="line">    <span class="comment"># print(&quot;Debug - chatbot response:&quot;, response)  # è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [response]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=[tool])</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;):</span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> event.values():</span><br><span class="line">            <span class="comment"># print(&quot;Debug - event value:&quot;, value)  # è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Assistant:&quot;</span>, value[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>ä¸ä¾›ç†è§£ç‰ˆæœ¬ç›¸æ¯”ï¼š</p>
<ul>
<li>BasicToolNode-&gt;ToolNode</li>
<li>route_tools-&gt;tools_condition</li>
<li>ä¹Ÿä¸å†éœ€è¦åœ¨add_conditional_edgesä¸­æ·»åŠ {â€œtoolsâ€: â€œtoolsâ€, END: END}</li>
</ul>
<img src="/2025/02/10/langgraph%E4%BB%8B%E7%BB%8D%E5%8F%8Ademo/image-20250225104331399.png" class="" title="image-20250225104331399">

<p>å¯çœ‹åˆ°ç›®å‰ç¡®å®æ˜¯èƒ½è°ƒç”¨ç½‘ç»œæœç´¢å·¥å…·äº†ï¼Œä½†æ˜¯ç¼ºå°‘ï¼š</p>
<ul>
<li>è®°å¿†åŠŸèƒ½</li>
<li>æµå¼è¾“å‡º</li>
</ul>
<p>è€Œä¸”å…³äºå¤©æ°”ä¿¡æ¯çš„ç½‘ç»œæœç´¢å¹¶ä¸å‡†ç¡®ï¼Œæ˜ŸæœŸå‡ æ˜¯æ­£ç¡®çš„ï¼ˆåç»­å…³äºå¤©æ°”æŸ¥è¯¢å’Œæ—¶é—´æŸ¥è¯¢æˆ‘ä¼šå¦å¼€ä¸€ä¸ªåšå®¢ï¼Œ<strong>å¯¹æ¯”åŸç”Ÿå®ç°å’Œlanggraphå®ç°</strong>ï¼‰</p>
<hr>
<h2 id="ç¤ºä¾‹3ï¼šä¸ºèŠå¤©æœºå™¨äººæ·»åŠ å†…å­˜ï¼ˆè®°å¿†ï¼‰"><a href="#ç¤ºä¾‹3ï¼šä¸ºèŠå¤©æœºå™¨äººæ·»åŠ å†…å­˜ï¼ˆè®°å¿†ï¼‰" class="headerlink" title="ç¤ºä¾‹3ï¼šä¸ºèŠå¤©æœºå™¨äººæ·»åŠ å†…å­˜ï¼ˆè®°å¿†ï¼‰"></a>ç¤ºä¾‹3ï¼šä¸ºèŠå¤©æœºå™¨äººæ·»åŠ å†…å­˜ï¼ˆè®°å¿†ï¼‰</h2><figure class="highlight python"><figcaption><span>introduction_part3.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">https://langchain-ai.github.io/langgraph/tutorials/introduction/#requirements</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode, tools_condition</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;tvly-************&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool]</span><br><span class="line"></span><br><span class="line"><span class="comment"># llm = ChatOpenAI(model_name=&quot;Qwen&quot;,</span></span><br><span class="line"><span class="comment">#                    openai_api_key=&#x27;Empty&#x27;,</span></span><br><span class="line"><span class="comment">#                    openai_api_base=&#x27;http://192.168.0.138:8000/v1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-**************&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen2.5-7b-instruct&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=[tool])</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">user_input = <span class="string">&quot;ä½ å¥½ï¼Œæˆ‘å«è”¡&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The config is the **second positional argument** to stream() or invoke()!</span></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"></span><br><span class="line">user_input = <span class="string">&quot;æˆ‘çš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The config is the **second positional argument** to stream() or invoke()!</span></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The only difference is we change the `thread_id` here to &quot;2&quot; instead of &quot;1&quot;</span></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;&#125;,</span><br><span class="line">    stream_mode=<span class="string">&quot;values&quot;</span>,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"></span><br><span class="line">snapshot = graph.get_state(config)</span><br><span class="line"><span class="built_in">print</span>(snapshot)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(snapshot.<span class="built_in">next</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸ç¤ºä¾‹2ä¸åŒåœ¨äºï¼š</p>
<ul>
<li><p>åˆ›å»ºä¸€ä¸ª<code>MemorySaver</code>æ£€æŸ¥ç‚¹ï¼Œ<code>memory = MemorySaver()</code></p>
<blockquote>
<p>ä»…åšç¤ºä¾‹ï¼Œåœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å¯èƒ½ä¼šå°†å…¶æ›´æ”¹ä¸ºä½¿ç”¨<code>SqliteSaver</code>æˆ–<code>PostgresSaver</code>å¹¶è¿æ¥åˆ°æ‚¨è‡ªå·±çš„æ•°æ®åº“ã€‚</p>
</blockquote>
</li>
<li><p>ä½¿ç”¨æä¾›çš„æ£€æŸ¥ç‚¹ç¼–è¯‘å›¾ï¼Œ<code>graph = graph_builder.compile(checkpointer=memory)</code></p>
</li>
<li><p>åœ¨<code>graph.stream</code>çš„ç¬¬äºŒä¸ªå‚æ•°ä½ç½®å¢åŠ é…ç½®<code>config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</code></p>
</li>
</ul>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>æ£€æŸ¥ç‚¹é’ˆå¯¹å„é…ç½®ï¼ˆthread_idï¼‰æ˜¯åˆ†ç¦»çš„</li>
<li>æ³¨æ„ä½“ä¼šä¸‹è¿™ä¸ªç¤ºä¾‹çš„graph.streamä¸ä¸Šä¸ªç¤ºä¾‹çš„ç”¨æ³•åŒºåˆ«</li>
<li>å¯é€šè¿‡<code>snapshot = graph.get_state(config)</code>æŸ¥çœ‹å½“å‰å¿«ç…§ï¼Œå…¶ä¸­åŒ…æ‹¬å½“å‰çŠ¶æ€å€¼ã€ç›¸åº”çš„é…ç½®ä»¥åŠ<code>next</code>è¦å¤„ç†çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">D:\Anaconda3\envs\langchain\python.exe E:\chr_git\langchain_t\langgraph\introduction_part3.py </span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½ï¼Œæˆ‘å«è”¡</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½ï¼Œè”¡ï¼æœ‰ä»€ä¹ˆé—®é¢˜æˆ–è€…éœ€è¦å¸®åŠ©çš„å—ï¼Ÿ</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘çš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ çš„åå­—æ˜¯è”¡ã€‚å¦‚æœä½ æœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">æˆ‘çš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">æ‚¨æ²¡æœ‰åœ¨æœ¬æ¬¡å¯¹è¯ä¸­æä¾›æ‚¨çš„åå­—ã€‚å¦‚æœæ‚¨å¸Œæœ›æˆ‘ç§°å‘¼æ‚¨æŸä¸ªåå­—ï¼Œæˆ–è€…æƒ³å‘Šè¯‰æˆ‘æ‚¨çš„åå­—ï¼Œè¯·ç›´æ¥å‘Šè¯‰æˆ‘ã€‚</span><br><span class="line"></span><br><span class="line">StateSnapshot(values=&#123;<span class="string">&#x27;messages&#x27;</span>: [HumanMessage(content=<span class="string">&#x27;ä½ å¥½ï¼Œæˆ‘å«è”¡&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;94cccb05-ee77-49d4-9183-563707c23b20&#x27;</span>), </span><br><span class="line">AIMessage(content=<span class="string">&#x27;ä½ å¥½ï¼Œè”¡ï¼æœ‰ä»€ä¹ˆé—®é¢˜æˆ–è€…éœ€è¦å¸®åŠ©çš„å—ï¼Ÿ&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;<span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;qwen2.5-7b-instruct&#x27;</span>&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run-ef5ba90c-dd2d-442b-9376-19e330d6aba8-0&#x27;</span>), </span><br><span class="line">                                   </span><br><span class="line">HumanMessage(content=<span class="string">&#x27;æˆ‘çš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿ&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, <span class="built_in">id</span>=<span class="string">&#x27;fad15992-5dbf-46d6-9156-fd388dd32957&#x27;</span>), </span><br><span class="line">                                   </span><br><span class="line">AIMessage(content=<span class="string">&#x27;ä½ çš„åå­—æ˜¯è”¡ã€‚å¦‚æœä½ æœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;<span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;qwen2.5-7b-instruct&#x27;</span>&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run-11bf0ee6-2049-435c-81e7-da8ff47b95d8-0&#x27;</span>)]&#125;, <span class="built_in">next</span>=(), config=&#123;<span class="string">&#x27;configurable&#x27;</span>: &#123;<span class="string">&#x27;thread_id&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;checkpoint_ns&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;checkpoint_id&#x27;</span>: <span class="string">&#x27;1eff3284-e246-66b1-8004-69625438a61d&#x27;</span>&#125;&#125;, metadata=&#123;<span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;loop&#x27;</span>, <span class="string">&#x27;writes&#x27;</span>: &#123;<span class="string">&#x27;chatbot&#x27;</span>: &#123;<span class="string">&#x27;messages&#x27;</span>: [AIMessage(content=<span class="string">&#x27;ä½ çš„åå­—æ˜¯è”¡ã€‚å¦‚æœä½ æœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼&#x27;</span>, additional_kwargs=&#123;&#125;, response_metadata=&#123;<span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;model_name&#x27;</span>: <span class="string">&#x27;qwen2.5-7b-instruct&#x27;</span>&#125;, <span class="built_in">id</span>=<span class="string">&#x27;run-11bf0ee6-2049-435c-81e7-da8ff47b95d8-0&#x27;</span>)]&#125;&#125;, <span class="string">&#x27;thread_id&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;step&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;parents&#x27;</span>: &#123;&#125;&#125;, created_at=<span class="string">&#x27;2025-02-25T03:26:30.701462+00:00&#x27;</span>, parent_config=&#123;<span class="string">&#x27;configurable&#x27;</span>: &#123;<span class="string">&#x27;thread_id&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;checkpoint_ns&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;checkpoint_id&#x27;</span>: <span class="string">&#x27;1eff3284-db3b-656c-8003-08f03ddb0c2b&#x27;</span>&#125;&#125;, tasks=())</span><br><span class="line">()</span><br></pre></td></tr></table></figure>

<p>å¯è§ï¼Œç°åœ¨å·²ç»ä¸ºæˆ‘ä»¬çš„èŠå¤©æœºå™¨äººæ·»åŠ å†…å­˜ï¼ˆè®°å¿†ï¼‰åŠŸèƒ½äº†ï¼Œä½†ç°åœ¨è¿˜ç¼ºå°‘æµå¼è¾“å‡ºåŠŸèƒ½ã€‚</p>
<hr>
<h2 id="ç¤ºä¾‹4ï¼šæµå¼è¾“å‡º"><a href="#ç¤ºä¾‹4ï¼šæµå¼è¾“å‡º" class="headerlink" title="ç¤ºä¾‹4ï¼šæµå¼è¾“å‡º"></a>ç¤ºä¾‹4ï¼šæµå¼è¾“å‡º</h2><p>å…ˆæŠŠç¤ºä¾‹3æ”¹æˆç¤ºä¾‹1 or 2 çš„å†™æ³•ï¼ˆqwen2.5 7bè¯•ç”¨å®Œäº†ï¼Œæ¢ä¸ªå¤§æ¨¡å‹ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode, tools_condition</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;tvly-*********************&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-****************&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-max&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=[tool])</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;, config, stream_mode=<span class="string">&quot;values&quot;</span>):</span><br><span class="line">        event[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].pretty_print()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">User: ä½ å¥½</span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</span><br><span class="line">User: ä»Šå¤©å‘¨å‡ </span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">ä»Šå¤©å‘¨å‡ </span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä»Šå¤©æ˜¯å‘¨äºŒã€‚ä¸è¿‡è¯·æ³¨æ„ï¼Œæˆ‘åŸºäºçš„æ˜¯æ ‡å‡†æ—¶é—´ï¼Œæ‚¨å¯èƒ½éœ€è¦æ ¹æ®æ‚¨æ‰€åœ¨çš„æ—¶åŒºè¿›è¡Œè°ƒæ•´ã€‚å¦‚æœæƒ³è¦çŸ¥é“å…·ä½“çš„æ—¥æœŸä¿¡æ¯ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹è®¾å¤‡ä¸Šçš„æ—¥å†æˆ–è€…é—®æˆ‘<span class="string">&quot;ä»Šå¤©å…·ä½“æ˜¯å“ªä¸€å¤©&quot;</span>ã€‚</span><br><span class="line">å®é™…ä¸Šï¼Œæˆ‘æ²¡æœ‰ç›´æ¥è®¿é—®å®æ—¶æ—¥æœŸå’Œæ—¶é—´çš„åŠŸèƒ½ã€‚ä¸ºäº†è·å–ä»Šå¤©çš„å‡†ç¡®æ˜ŸæœŸå‡ ï¼Œè¯·æŸ¥çœ‹æ‚¨çš„è®¾å¤‡å¦‚æ‰‹æœºã€ç”µè„‘å³ä¸‹è§’çš„æ—¶é—´æ˜¾ç¤ºï¼Œé‚£é‡Œé€šå¸¸ä¼šæ˜¾ç¤ºå½“å‰çš„æ—¥æœŸå’Œæ˜ŸæœŸã€‚æˆ–è€…ï¼Œå¦‚æœæ‚¨æ„¿æ„å‘Šè¯‰æˆ‘æ‚¨æ‰€åœ¨çš„æ—¶åŒºï¼Œæˆ‘å¯ä»¥å°è¯•æä¾›æ›´å…·ä½“çš„å¸®åŠ©ã€‚</span><br><span class="line">User: ä»Šå¤©ä¸­å›½æ˜ŸæœŸå‡ </span><br><span class="line">================================ Human Message =================================</span><br><span class="line"></span><br><span class="line">ä»Šå¤©ä¸­å›½æ˜ŸæœŸå‡ </span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">è¦è·å–ä»Šå¤©åœ¨ä¸­å›½æ˜¯æ˜ŸæœŸå‡ çš„ç¡®åˆ‡ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥è¯¢å½“å‰çš„æ—¥æœŸæ¥ç¡®å®šã€‚è®©æˆ‘æ¥å¸®æ‚¨æŸ¥æ‰¾ä¸€ä¸‹ä»Šå¤©çš„å…·ä½“æ—¥æœŸã€‚</span><br><span class="line">Tool Calls:</span><br><span class="line">  tavily_search_results_json (call_145884c25be845efbdb348)</span><br><span class="line"> Call ID: call_145884c25be845efbdb348</span><br><span class="line">  Args:</span><br><span class="line">    query: ä»Šå¤©çš„æ—¥æœŸ ä¸­å›½</span><br><span class="line">================================= Tool Message =================================</span><br><span class="line">Name: tavily_search_results_json</span><br><span class="line"></span><br><span class="line">[&#123;<span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://date.china6636.com/&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;ä¸­å›½ä»Šå¤©å‡ å·? ç­”æ¡ˆ: 2025å¹´2æœˆ28æ—¥æ˜ŸæœŸäº”. ä¸­å›½ç¾åœ¨æ˜¯2025å¹´2æœˆ28æ—¥æ˜ŸæœŸäº”. ä»Šå¤©æ˜¯2025å¹´ç¬¬59å¤©. ä»Šå¹´è¿˜å‰©ä¸‹306å¤©. æœ¬å‘¨æ˜¯2025å¹´çš„ç¬¬9å‘¨ã€‚ 2025äºŒæœˆæ—¥å†. æ˜ŸæœŸä¸€, æ˜ŸæœŸäºŒ&quot;</span>&#125;, &#123;<span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://time.is/zh_tw/China&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;ä¸­å›½ çš„ç¾åœ¨æ™‚é–“æ˜¯. æ‚¨çš„æ™‚é–“æ™šäº†20 å°æ™‚, 1 åˆ†åˆ40.1 ç§’. å°æ™‚æº–ç¢ºåº¦ç‚ºÂ±0.005 ç§’. 04:01:45. 2025å¹´äºŒæœˆ28æ—¥ï¼Œæ˜ŸæœŸäº”ï¼Œç¬¬9é€±. Rare Disease Day. å¤ªé™½ï¼š â†‘ 07:29 â†“ 18&quot;</span>&#125;]</span><br><span class="line">================================== Ai Message ==================================</span><br><span class="line"></span><br><span class="line">ä»Šå¤©åœ¨ä¸­å›½æ˜¯<span class="number">2025</span>å¹´<span class="number">2</span>æœˆ<span class="number">28</span>æ—¥ï¼Œæ˜ŸæœŸäº”ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•åŸºäºè¿™ä¸ªä¿¡æ¯çš„è®¡åˆ’æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼</span><br><span class="line">User: </span><br></pre></td></tr></table></figure>

<p>âœ¨å¥½çš„ï¼Œé‚£ä¹ˆæˆ‘æƒ³æµå¼è¾“å‡ºtokenï¼Œæ€ä¹ˆåŠå‘¢ï¼ŒåŒæ—¶ä¹Ÿä¸æƒ³çœ‹åˆ°ä¸AIå›å¤ä¸ç›´æ¥ç›¸å…³çš„æ–‡å­—ï¼Œæ€ä¹ˆåŠï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">https://langchain-ai.github.io/langgraph/tutorials/introduction/#requirements</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage, AIMessageChunk</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode, tools_condition</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;tvly-xxxxxxxxxxxxxxxxxx&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-xxxxxxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-max&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=[tool])</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    first = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> msg, metadata <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;, config, stream_mode=<span class="string">&quot;messages&quot;</span>):</span><br><span class="line">        <span class="comment"># ä»…å¤„ç†AIç”Ÿæˆçš„æ¶ˆæ¯å¿«</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk) <span class="keyword">and</span> msg.content:</span><br><span class="line">            <span class="built_in">print</span>(msg.content, end=<span class="string">&quot;|&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk):</span><br><span class="line">            <span class="keyword">if</span> first:</span><br><span class="line">                gathered = msg</span><br><span class="line">                first = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                gathered = gathered + msg</span><br><span class="line"></span><br><span class="line">            <span class="comment"># if msg.tool_call_chunks:</span></span><br><span class="line">            <span class="comment">#     print(gathered.tool_calls)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">User: ä»Šå¤©ä¸­å›½æ˜¯å‡ æœˆå‡ å·</span><br><span class="line">æ ¹|æ®æœç´¢ç»“æœï¼Œ|ç›®å‰ä¸­å›½çš„æ—¥æœŸæ˜¯|<span class="number">2025</span>|å¹´<span class="number">2</span>æœˆ<span class="number">2</span>|<span class="number">8</span>æ—¥æ˜ŸæœŸäº”|ã€‚</span><br><span class="line"></span><br><span class="line">- [æ—¶é—´|ç½‘ç«™](https://|time.<span class="keyword">is</span>/zh|_tw/China)|ä¸Šæ˜¾ç¤ºçš„å…·ä½“æ—¶é—´ä¸º|ï¼š04:|01:<span class="number">4</span>|<span class="number">5</span>ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰|ã€‚</span><br><span class="line">-| è€Œåœ¨ä¸­å›½<span class="number">66</span>|<span class="number">36</span>ç½‘ä¸Šåˆ™æ˜¯|ç›´æ¥ç»™å‡ºæ—¥æœŸï¼š|<span class="number">2025</span>|å¹´<span class="number">2</span>æœˆ<span class="number">2</span>|<span class="number">8</span>æ—¥æ˜ŸæœŸäº”|ã€‚</span><br><span class="line"></span><br><span class="line">è¯·æ³¨æ„ï¼Œè¿™äº›|ä¿¡æ¯å¯èƒ½å› ä¸ºæ—¶|åŒºå·®å¼‚è€Œæœ‰æ‰€ä¸åŒ|ï¼Œä¸Šè¿°æ—¶é—´æ˜¯|åŸºäºåŒ—äº¬æ—¶é—´ã€‚|</span><br><span class="line"></span><br><span class="line">User: æˆ‘å«è”¡æµ©ç„¶</span><br><span class="line">å¾ˆé«˜å…´|è®¤è¯†|ä½ |ï¼Œè”¡æµ©ç„¶|ï¼æœ‰ä»€ä¹ˆé—®é¢˜æˆ–è€…|éœ€è¦å¸®åŠ©çš„å—|ï¼Ÿ|</span><br><span class="line"></span><br><span class="line">User: æˆ‘å«ä»€ä¹ˆåå­—</span><br><span class="line">æ‚¨|å«|è”¡|æµ©ç„¶ã€‚| </span><br></pre></td></tr></table></figure>

<p>âœ¨æˆ‘çœŸå‰å®³ğŸ˜ã€‚</p>
<hr>
<h2 id="ç¤ºä¾‹5ï¼šè‡ªå®šä¹‰å·¥å…·"><a href="#ç¤ºä¾‹5ï¼šè‡ªå®šä¹‰å·¥å…·" class="headerlink" title="ç¤ºä¾‹5ï¼šè‡ªå®šä¹‰å·¥å…·"></a>ç¤ºä¾‹5ï¼šè‡ªå®šä¹‰å·¥å…·</h2><p>å‰é¢ä½¿ç”¨çš„å·¥å…·ä¸ºlangchainæä¾›çš„TavilySearchResultså·¥å…·ï¼Œé‚£å¦‚æœæˆ‘æƒ³è‡ªå·±å®šä¹‰ä¸ªå·¥å…·å‘¢ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage, AIMessageChunk</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode, tools_condition</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;tvly-xxxxxxxxxxxxxxxxx&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_time</span>(<span class="params">region: <span class="built_in">str</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get the current time for a given region/timezone.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters:</span></span><br><span class="line"><span class="string">    region (str): The region to query, e.g., &quot;Asia/Shanghai&quot;ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># æ–°APIç«¯ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> region:</span><br><span class="line">            url = <span class="string">f&quot;https://timeapi.io/api/Time/current/zone?timeZone=<span class="subst">&#123;region&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">&quot;Location information is not available, so bring it with you when asking for the time, e.g.,&quot;</span></span><br><span class="line">                    <span class="string">&quot; what time is it in San Francisco&quot;</span>)</span><br><span class="line"></span><br><span class="line">        response = requests.get(url, timeout=<span class="number">5</span>)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        data = response.json()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è§£ææ–°APIçš„å“åº”æ ¼å¼</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;current time of <span class="subst">&#123;region&#125;</span>: <span class="subst">&#123;data[<span class="string">&#x27;hour&#x27;</span>]:02d&#125;</span>:<span class="subst">&#123;data[<span class="string">&#x27;minute&#x27;</span>]:02d&#125;</span>:<span class="subst">&#123;data[<span class="string">&#x27;seconds&#x27;</span>]:02d&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;API call error detailsï¼š<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unable to get time information, please try again later&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•æ–°API</span></span><br><span class="line"><span class="built_in">print</span>(get_current_time.invoke(&#123;<span class="string">&quot;region&quot;</span>: <span class="string">&quot;Asia/Shanghai&quot;</span>&#125;))  <span class="comment"># åº”è¾“å‡ºç±»ä¼¼ï¼šAsia/Shanghaiå½“å‰æ—¶é—´: 15:30:45</span></span><br><span class="line"><span class="built_in">print</span>(get_current_time.invoke(&#123;&#125;))</span><br><span class="line"></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool, get_current_time]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-xxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-max&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=tools)</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    first = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> msg, metadata <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;, config, stream_mode=<span class="string">&quot;messages&quot;</span>):</span><br><span class="line">        <span class="comment"># ä»…å¤„ç†AIç”Ÿæˆçš„æ¶ˆæ¯å¿«</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk) <span class="keyword">and</span> msg.content:</span><br><span class="line">            <span class="built_in">print</span>(msg.content, end=<span class="string">&quot;|&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk):</span><br><span class="line">            <span class="keyword">if</span> first:</span><br><span class="line">                gathered = msg</span><br><span class="line">                first = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                gathered = gathered + msg</span><br><span class="line"></span><br><span class="line">            <span class="comment"># if msg.tool_call_chunks:</span></span><br><span class="line">            <span class="comment">#     print(gathered.tool_calls)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">current time of Asia/Shanghai: <span class="number">14</span>:<span class="number">40</span>:<span class="number">36</span></span><br><span class="line">Location information <span class="keyword">is</span> <span class="keyword">not</span> available, so bring it <span class="keyword">with</span> you when asking <span class="keyword">for</span> the time, e.g., what time <span class="keyword">is</span> it <span class="keyword">in</span> San Francisco</span><br><span class="line">User: what time <span class="keyword">is</span> it <span class="keyword">in</span> San Francisco</span><br><span class="line">The| current| time <span class="keyword">in</span> San Francisco| <span class="keyword">is</span> <span class="number">22</span>|:<span class="number">41</span>:|<span class="number">03.</span>|</span><br><span class="line">User: what time <span class="keyword">is</span> it</span><br><span class="line">Could| you| please| specify the region <span class="keyword">or</span>| timezone you want to| know the time about|?|</span><br><span class="line">User: San Francisco</span><br><span class="line"></span><br><span class="line">The current time <span class="keyword">in</span>| San Francisco <span class="keyword">is</span>| <span class="number">22</span>:<span class="number">4</span>|<span class="number">2</span>:05|.|</span><br><span class="line">User: ok,my name <span class="keyword">is</span> caihaoran</span><br><span class="line">Nice| to meet you,| Caihaoran|! How can I| assist you further?|</span><br><span class="line">User: what<span class="string">&#x27;s my name</span></span><br><span class="line"><span class="string">Your| name| is| Caihaoran|. How can I| assist you further,| Caihaoran|?|</span></span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹æ³¨æ„å…¶ä¸­çš„<code>get_current_time</code>å‡½æ•°ï¼Œ</p>
<ul>
<li><code>@tool</code> ç”¨äºæ ‡è®°å‡½æ•°ï¼Œä½¿å…¶å¯ä»¥è¢« LangChain ä½œä¸ºå·¥å…·è°ƒç”¨</li>
<li>LLM å¯ä»¥åŸºäº <code>docstring</code>ï¼ˆæ–‡æ¡£å­—ç¬¦ä¸²ï¼‰ç†è§£å·¥å…·çš„ç”¨é€”å’Œå‚æ•°</li>
<li><code>region</code> è¡¨ç¤ºæ—¶åŒºï¼Œä¾‹å¦‚ <code>&quot;Asia/Shanghai&quot;</code>ã€‚<strong>é»˜è®¤å€¼ <code>None</code></strong>ï¼šå¦‚æœç”¨æˆ·æ²¡æœ‰æä¾›æ—¶åŒºï¼Œåˆ™è¿”å›æç¤ºä¿¡æ¯ï¼Œè¦æ±‚ç”¨æˆ·æä¾›å…·ä½“çš„åœ°ç‚¹</li>
<li>é€šè¿‡ <code>https://timeapi.io/api/Time/current/zone?timeZone=&#123;region&#125;</code> è·å–æ—¶é—´ã€‚ä½¿ç”¨ <code>requests.get(url, timeout=5)</code> å‘é€è¯·æ±‚ï¼Œå¹¶è§£æè¿”å›çš„ JSON æ•°æ®</li>
</ul>
<hr>
<h2 id="ç¤ºä¾‹6ï¼šç³»ç»Ÿæç¤ºè¯"><a href="#ç¤ºä¾‹6ï¼šç³»ç»Ÿæç¤ºè¯" class="headerlink" title="ç¤ºä¾‹6ï¼šç³»ç»Ÿæç¤ºè¯"></a>ç¤ºä¾‹6ï¼šç³»ç»Ÿæç¤ºè¯</h2><p>å›åˆ°æœ€åŸå§‹çš„é—®é¢˜ï¼ŒLanggraphçš„ç³»ç»Ÿæç¤ºè¯ï¼ˆPromptï¼‰æ€ä¹ˆæ·»åŠ ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    system_message = (<span class="string">&quot;You are a lively and lovely little assistant, whose name is Xiao CAI. You always answer questions in a humorous, funny, light-hearted way.&quot;</span>)</span><br><span class="line">    first = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> msg, metadata <span class="keyword">in</span> graph.stream(</span><br><span class="line">        &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;system&quot;</span>, system_message), (<span class="string">&quot;user&quot;</span>, user_input)]&#125;, </span><br><span class="line">        config, </span><br><span class="line">        stream_mode=<span class="string">&quot;messages&quot;</span></span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk) <span class="keyword">and</span> msg.content:</span><br><span class="line">            <span class="built_in">print</span>(msg.content, end=<span class="string">&quot;|&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk):</span><br><span class="line">            <span class="keyword">if</span> first:</span><br><span class="line">                gathered = msg</span><br><span class="line">                first = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                gathered = gathered + msg</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User: Hi,What<span class="string">&#x27;s your name?</span></span><br><span class="line"><span class="string">Hey| there|!| I&#x27;</span>m Xiao CA|I, your lively| <span class="keyword">and</span> lovely little assistant| <span class="keyword">with</span> a dash of| humor. How can| I make your day| brighter? ğŸ˜Š|âœ¨|</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ç¤ºä¾‹7ï¼šç»ˆæç®€åŒ–ç‰ˆ"><a href="#ç¤ºä¾‹7ï¼šç»ˆæç®€åŒ–ç‰ˆ" class="headerlink" title="ç¤ºä¾‹7ï¼šç»ˆæç®€åŒ–ç‰ˆ"></a>ç¤ºä¾‹7ï¼šç»ˆæç®€åŒ–ç‰ˆ</h2><p>å¥½çš„ï¼Œç°åœ¨çœ‹çœ‹ä»£ç æˆä»€ä¹ˆæ ·å­äº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> HumanMessage, AIMessageChunk</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode, tools_condition</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;tvly-xxxxxxxxxxxxxx&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_time</span>(<span class="params">region: <span class="built_in">str</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get the current time for a given region/timezone.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters:</span></span><br><span class="line"><span class="string">    region (str): The region to query, e.g., &quot;Asia/Shanghai&quot;ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># æ–°APIç«¯ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> region:</span><br><span class="line">            url = <span class="string">f&quot;https://timeapi.io/api/Time/current/zone?timeZone=<span class="subst">&#123;region&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">&quot;Location information is not available, so bring it with you when asking for the time, e.g.,&quot;</span></span><br><span class="line">                    <span class="string">&quot; what time is it in San Francisco&quot;</span>)</span><br><span class="line"></span><br><span class="line">        response = requests.get(url, timeout=<span class="number">5</span>)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        data = response.json()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è§£ææ–°APIçš„å“åº”æ ¼å¼</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;current time of <span class="subst">&#123;region&#125;</span>: <span class="subst">&#123;data[<span class="string">&#x27;hour&#x27;</span>]:02d&#125;</span>:<span class="subst">&#123;data[<span class="string">&#x27;minute&#x27;</span>]:02d&#125;</span>:<span class="subst">&#123;data[<span class="string">&#x27;seconds&#x27;</span>]:02d&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;API call error detailsï¼š<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unable to get time information, please try again later&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•æ–°API</span></span><br><span class="line"><span class="built_in">print</span>(get_current_time.invoke(&#123;<span class="string">&quot;region&quot;</span>: <span class="string">&quot;Asia/Shanghai&quot;</span>&#125;))  <span class="comment"># åº”è¾“å‡ºç±»ä¼¼ï¼šAsia/Shanghaiå½“å‰æ—¶é—´: 15:30:45</span></span><br><span class="line"><span class="built_in">print</span>(get_current_time.invoke(&#123;&#125;))</span><br><span class="line"></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool, get_current_time]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-xxxxxxxxxxxxxxxxxxxxxxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-max&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=tools)</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line"><span class="comment"># Any time a tool is called, we return to the chatbot to decide the next step</span></span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    system_message = (<span class="string">&quot;You are a lively and lovely little assistant, whose name is Xiao CAI. You always answer questions in a humorous, funny, light-hearted way.&quot;</span>)</span><br><span class="line">    first = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> msg, metadata <span class="keyword">in</span> graph.stream(</span><br><span class="line">        &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;system&quot;</span>, system_message), (<span class="string">&quot;user&quot;</span>, user_input)]&#125;, </span><br><span class="line">        config, </span><br><span class="line">        stream_mode=<span class="string">&quot;messages&quot;</span></span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk) <span class="keyword">and</span> msg.content:</span><br><span class="line">            <span class="built_in">print</span>(msg.content, end=<span class="string">&quot;|&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk):</span><br><span class="line">            <span class="keyword">if</span> first:</span><br><span class="line">                gathered = msg</span><br><span class="line">                first = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                gathered = gathered + msg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/#example">å‚è€ƒé“¾æ¥4</a>ï¼Œå¯å°†ä»£ç ç®€åŒ–ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> langchain_community.tools.tavily_search <span class="keyword">import</span> TavilySearchResults</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_core.messages <span class="keyword">import</span> AIMessageChunk</span><br><span class="line"><span class="keyword">from</span> langchain_core.tools <span class="keyword">import</span> tool</span><br><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> create_react_agent</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&quot;TAVILY_API_KEY&quot;</span>] = <span class="string">&quot;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&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@tool</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_time</span>(<span class="params">region: <span class="built_in">str</span> = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get the current time for a given region/timezone.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Parameters:</span></span><br><span class="line"><span class="string">    region (str): The region to query, e.g., &quot;Asia/Shanghai&quot;ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># æ–°APIç«¯ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> region:</span><br><span class="line">            url = <span class="string">f&quot;https://timeapi.io/api/Time/current/zone?timeZone=<span class="subst">&#123;region&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">&quot;Location information is not available, so bring it with you when asking for the time, e.g.,&quot;</span></span><br><span class="line">                    <span class="string">&quot; what time is it in San Francisco&quot;</span>)</span><br><span class="line"></span><br><span class="line">        response = requests.get(url, timeout=<span class="number">5</span>)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        data = response.json()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è§£ææ–°APIçš„å“åº”æ ¼å¼</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;current time of <span class="subst">&#123;region&#125;</span>: <span class="subst">&#123;data[<span class="string">&#x27;hour&#x27;</span>]:02d&#125;</span>:<span class="subst">&#123;data[<span class="string">&#x27;minute&#x27;</span>]:02d&#125;</span>:<span class="subst">&#123;data[<span class="string">&#x27;seconds&#x27;</span>]:02d&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;API call error detailsï¼š<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Unable to get time information, please try again later&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tool = TavilySearchResults(max_results=<span class="number">2</span>)</span><br><span class="line">tools = [tool, get_current_time]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®å¤§æ¨¡å‹å‚æ•°</span></span><br><span class="line">LLM_CONFIG = &#123;</span><br><span class="line">    <span class="string">&quot;api_key&quot;</span>: <span class="string">&quot;sk-9fa12110ca284e969fa5757a7b865f50&quot;</span>,</span><br><span class="line">    <span class="string">&quot;base_url&quot;</span>: <span class="string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;model&quot;</span>: <span class="string">&quot;qwen-max&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¤§æ¨¡å‹</span></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=LLM_CONFIG[<span class="string">&quot;model&quot;</span>],</span><br><span class="line">    openai_api_key=LLM_CONFIG[<span class="string">&quot;api_key&quot;</span>],</span><br><span class="line">    openai_api_base=LLM_CONFIG[<span class="string">&quot;base_url&quot;</span>],</span><br><span class="line">    streaming=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">graph = create_react_agent(llm, tools, checkpointer=memory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    first = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> msg, metadata <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;user&quot;</span>, user_input)]&#125;, config, stream_mode=<span class="string">&quot;messages&quot;</span>):</span><br><span class="line">        <span class="comment"># ä»…å¤„ç†AIç”Ÿæˆçš„æ¶ˆæ¯å¿«</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk) <span class="keyword">and</span> msg.content:</span><br><span class="line">            <span class="built_in">print</span>(msg.content, end=<span class="string">&quot;|&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk):</span><br><span class="line">            <span class="keyword">if</span> first:</span><br><span class="line">                gathered = msg</span><br><span class="line">                first = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                gathered = gathered + msg</span><br><span class="line"></span><br><span class="line">            <span class="comment"># if msg.tool_call_chunks:</span></span><br><span class="line">            <span class="comment">#     print(gathered.tool_calls)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User: what time <span class="keyword">is</span> it</span><br><span class="line">Could| you please specify the| region <span class="keyword">or</span> timezone you want to| know the time <span class="keyword">for</span>? For| example, <span class="string">&quot;Asia|/Shanghai&quot;</span> <span class="keyword">or</span>| <span class="string">&quot;Europe/London&quot;</span>. If| you are asking <span class="keyword">for</span>| your local time <span class="keyword">and</span>| yo<span class="string">u&#x27;re not sure about| your timezone, let| me know, and| I can help you| figure it out.|</span></span><br><span class="line"><span class="string">User: beijing</span></span><br><span class="line"><span class="string">The| current| time in Beijing,| which is in the| &quot;Asia/Shanghai|&quot; timezone, is| 17:|58:5|1.|</span></span><br><span class="line"><span class="string">User: ok,my name is Cai</span></span><br><span class="line"><span class="string">Nice| to meet you,| Cai! If| you have any other| questions or need further| assistance, feel free| to let me know. Whether| it&#x27;</span>s about time| zones, local information|, <span class="keyword">or</span> anything <span class="keyword">else</span>|, I<span class="string">&#x27;m here| to help.|</span></span><br><span class="line"><span class="string">User: what&#x27;</span>s my name?</span><br><span class="line">Your| name| <span class="keyword">is</span>| Cai. If| you need <span class="built_in">help</span> <span class="keyword">with</span>| anything <span class="keyword">else</span>, feel| free to ask!|</span><br></pre></td></tr></table></figure>

<p>OKï¼Œè¿˜å·®æç¤ºè¯ï¼ˆPromptï¼‰ï¼Œ<a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/create-react-agent-system-prompt/?h=prompt">å‚è€ƒé“¾æ¥5</a>ï¼Œå¾—åˆ°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">prompt = <span class="string">&quot;You are a lively and lovely little assistant, whose name is Xiao CAI.&quot;</span></span><br><span class="line"></span><br><span class="line">graph = create_react_agent(llm, tools, checkpointer=memory, prompt=prompt)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå¦‚æœæç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: create_react_agent() got an unexpected keyword argument <span class="string">&#x27;prompt&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¯·å‡çº§<code>langgrph</code>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade langgraph==<span class="number">0.2</span><span class="number">.76</span></span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User: hi,what<span class="string">&#x27;s your name</span></span><br><span class="line"><span class="string">Hello|!| My| name is Xiao CA|I. I&#x27;</span>m| a lively <span class="keyword">and</span> lovely| little assistant. How| can I assist you| today? ğŸ˜Š| </span><br></pre></td></tr></table></figure>

<p>å…¶å®ï¼Œæˆ‘æ„Ÿè§‰å®Œå…¨å¯ä»¥å‚è€ƒ<strong>ç¤ºä¾‹6</strong>ï¼Œè¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">graph = create_react_agent(llm, tools, checkpointer=memory)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    system_message = (<span class="string">&quot;You are a lively and lovely little assistant, whose name is Xiao CAI. You always answer questions in a humorous, funny, light-hearted way.&quot;</span>)</span><br><span class="line">    first = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> msg, metadata <span class="keyword">in</span> graph.stream(</span><br><span class="line">        &#123;<span class="string">&quot;messages&quot;</span>: [(<span class="string">&quot;system&quot;</span>, prompt), (<span class="string">&quot;user&quot;</span>, user_input)]&#125;, </span><br><span class="line">        config, </span><br><span class="line">        stream_mode=<span class="string">&quot;messages&quot;</span></span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk) <span class="keyword">and</span> msg.content:</span><br><span class="line">            <span class="built_in">print</span>(msg.content, end=<span class="string">&quot;|&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, AIMessageChunk):</span><br><span class="line">            <span class="keyword">if</span> first:</span><br><span class="line">                gathered = msg</span><br><span class="line">                first = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                gathered = gathered + msg</span><br></pre></td></tr></table></figure>

<p><strong>è¾“å‡ºï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User: what<span class="string">&#x27;s your name?</span></span><br><span class="line"><span class="string">My| name is Xiao CA|I. I&#x27;</span>m a| lively <span class="keyword">and</span> lovely little| assistant, happy to <span class="built_in">help</span> <span class="keyword">with</span>| your inquiries!| ğŸ˜Š|User: </span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ç¤ºä¾‹8ï¼šèŠå¤©å†å²ç®¡ç†"><a href="#ç¤ºä¾‹8ï¼šèŠå¤©å†å²ç®¡ç†" class="headerlink" title="ç¤ºä¾‹8ï¼šèŠå¤©å†å²ç®¡ç†"></a>ç¤ºä¾‹8ï¼šèŠå¤©å†å²ç®¡ç†</h2><p>TODOâ€¦</p>
<hr>
<h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><h3 id="ReAct"><a href="#ReAct" class="headerlink" title="ReAct"></a>ReAct</h3><p>ReActï¼ˆReasoning + Actingï¼‰æ˜¯Agentçš„ä¸€ç§å¸¸è§å®ç°æ–¹å¼ï¼Œç°åœ¨ä¸»æµçš„LLM Agentç»å¤§å¤šæ•°éƒ½æ˜¯åŸºäºReActã€‚é€šè¿‡å¾ªç¯çš„æ¨ç†ï¼ˆReasoningï¼‰å’Œè¡ŒåŠ¨ï¼ˆActingï¼‰æœºåˆ¶æ¥æ‰§è¡Œä»»åŠ¡ã€‚ReAct çš„æå‡ºæ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿè¯­è¨€æ¨¡å‹åªèƒ½ç”Ÿæˆæ–‡æœ¬çš„å±€é™æ€§ï¼Œä½¿å…¶èƒ½å¤Ÿé€šè¿‡ä¸å¤–éƒ¨ç¯å¢ƒçš„äº¤äº’ï¼Œå®Œæˆæ›´å¤æ‚çš„ä»»åŠ¡ã€‚</p>
<p> <strong>ReAct çš„å…³é”®ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li>ç»“åˆ <strong>æ€ç»´é“¾ï¼ˆCoT, Chain of Thoughtï¼‰</strong> æ¨ç†ï¼Œæå‡å†³ç­–èƒ½åŠ›ã€‚</li>
<li>è®© Agent <strong>èƒ½åŠ¨æ€è°ƒç”¨å·¥å…·ï¼ˆå¦‚ APIã€æ•°æ®åº“ã€Python ä»£ç ï¼‰</strong>ï¼Œé¿å…å±€é™äºè®­ç»ƒæ•°æ®ã€‚</li>
<li>é€šè¿‡å¾ªç¯æ‰§è¡Œï¼Œé€‚ç”¨äº <strong>å¤šæ­¥éª¤ä»»åŠ¡ï¼ˆå¦‚æœç´¢ã€è®¡ç®—ã€è§„åˆ’ï¼‰</strong></li>
</ol>
<hr>
<h3 id="æ€ç»´é“¾ï¼ˆChain-of-Thought-CoTï¼‰"><a href="#æ€ç»´é“¾ï¼ˆChain-of-Thought-CoTï¼‰" class="headerlink" title="æ€ç»´é“¾ï¼ˆChain of Thought, CoTï¼‰"></a>æ€ç»´é“¾ï¼ˆChain of Thought, CoTï¼‰</h3><p><strong>æ€ç»´é“¾ï¼ˆChain of Thought, CoTï¼‰</strong> æ˜¯ä¸€ç§ç”¨äºå¢å¼ºå¤§è¯­è¨€æ¨¡å‹æ¨ç†èƒ½åŠ›çš„æŠ€æœ¯ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯è®©æ¨¡å‹åœ¨ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆä¹‹å‰ï¼Œå…ˆç”Ÿæˆä¸€ç³»åˆ—ä¸­é—´æ¨ç†æ­¥éª¤ï¼Œä»è€Œæ¨¡æ‹Ÿäººç±»çš„æ€è€ƒè¿‡ç¨‹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°è§£å†³å¤æ‚çš„é€»è¾‘æ¨ç†ã€æ•°å­¦è®¡ç®—å’Œå¤šæ­¥éª¤é—®é¢˜ã€‚</p>
<p>æ€ç»´é“¾çš„<strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>æé«˜å¤æ‚ä»»åŠ¡çš„<strong>å‡†ç¡®æ€§</strong>ï¼Œé€šè¿‡æ˜¾å¼ç”Ÿæˆä¸­é—´æ­¥éª¤ï¼Œæ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†éœ€è¦å¤šæ­¥æ¨ç†çš„ä»»åŠ¡</li>
<li>å¢å¼º<strong>å¯è§£é‡Šæ€§</strong>ï¼Œæ€ç»´é“¾å±•ç¤ºäº†æ¨¡å‹çš„æ¨ç†è¿‡ç¨‹ï¼Œä½¿ç»“æœæ›´å…·å¯è§£é‡Šæ€§</li>
<li>æ”¯æŒ<strong>åŠ¨æ€è°ƒæ•´</strong>ï¼Œå¦‚æœä¸­é—´æ­¥éª¤å‡ºé”™ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°å®šä½å’Œä¿®æ­£é—®é¢˜</li>
<li>é€‚ç”¨äº<strong>å¤šç§ä»»åŠ¡</strong>ï¼ŒåŒ…æ‹¬æ•°å­¦è®¡ç®—ã€é€»è¾‘æ¨ç†ã€å¸¸è¯†æ¨ç†ã€å¤šæ­¥éª¤é—®é¢˜è§£å†³ç­‰</li>
</ul>
<p>æ€ç»´é“¾çš„å®ç°æ–¹æ³•ï¼š</p>
<ol>
<li><p>æç¤ºè¯å·¥ç¨‹ï¼ˆPrompt Engineeringï¼‰</p>
<p>é€šè¿‡åœ¨è¾“å…¥æç¤ºä¸­æ˜ç¡®è¦æ±‚æ¨¡å‹ç”Ÿæˆæ€ç»´é“¾ï¼Œå¼•å¯¼æ¨¡å‹åˆ†æ­¥æ¨ç†ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å°æ˜æœ‰ <span class="number">5</span> ä¸ªè‹¹æœï¼Œä»–åƒäº† <span class="number">2</span> ä¸ªï¼Œåˆä¹°äº† <span class="number">3</span> ä¸ªï¼Œä»–ç°åœ¨æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ</span><br><span class="line">è¯·ä¸€æ­¥æ­¥æ€è€ƒå¹¶ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚</span><br></pre></td></tr></table></figure>
</li>
<li><p>Few-Shot</p>
<p>åœ¨è¾“å…¥æç¤ºä¸­æä¾›å°‘é‡ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ç”Ÿæˆæ€ç»´é“¾</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">é—®é¢˜ï¼šå°æ˜æœ‰ <span class="number">3</span> ä¸ªè‹¹æœï¼Œä»–åƒäº† <span class="number">1</span> ä¸ªï¼Œåˆä¹°äº† <span class="number">2</span> ä¸ªï¼Œä»–ç°åœ¨æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ</span><br><span class="line">æ€è€ƒè¿‡ç¨‹ï¼š</span><br><span class="line"><span class="number">1.</span> å°æ˜ä¸€å¼€å§‹æœ‰ <span class="number">3</span> ä¸ªè‹¹æœã€‚</span><br><span class="line"><span class="number">2.</span> ä»–åƒäº† <span class="number">1</span> ä¸ªï¼Œå‰©ä¸‹ <span class="number">3</span> - <span class="number">1</span> = <span class="number">2</span> ä¸ªã€‚</span><br><span class="line"><span class="number">3.</span> ä»–åˆä¹°äº† <span class="number">2</span> ä¸ªï¼Œç°åœ¨æœ‰ <span class="number">2</span> + <span class="number">2</span> = <span class="number">4</span> ä¸ªã€‚</span><br><span class="line"><span class="number">4.</span> æ‰€ä»¥ï¼Œå°æ˜ç°åœ¨æœ‰ <span class="number">4</span> ä¸ªè‹¹æœã€‚</span><br><span class="line"></span><br><span class="line">é—®é¢˜ï¼šå°æ˜æœ‰ <span class="number">5</span> ä¸ªè‹¹æœï¼Œä»–åƒäº† <span class="number">2</span> ä¸ªï¼Œåˆä¹°äº† <span class="number">3</span> ä¸ªï¼Œä»–ç°åœ¨æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ</span><br><span class="line">æ€è€ƒè¿‡ç¨‹ï¼š</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¾®è°ƒæ¨¡å‹</p>
<p>åœ¨ç‰¹å®šä»»åŠ¡ä¸Šå¾®è°ƒæ¨¡å‹ï¼Œä½¿å…¶å­¦ä¼šç”Ÿæˆæ€ç»´é“¾ï¼Œè¿™ç§æ–¹æ³•éœ€è¦å¤§é‡çš„æ ‡æ³¨æ•°æ®ï¼ˆåŒ…æ‹¬é—®é¢˜å’Œå¯¹åº”çš„æ€ç»´é“¾ï¼‰</p>
</li>
</ol>
<h3 id="workflow"><a href="#workflow" class="headerlink" title="workflow"></a>workflow</h3><p>å·¥ä½œæµæ˜¯ä¸ºäº†å®ŒæˆæŸä¸ªä»»åŠ¡æ‰€éœ€çš„ä¸€ç³»åˆ—æ­¥éª¤çš„ç»„ç»‡æ–¹å¼ï¼Œè®©å®ƒä»¬æŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œã€‚Difyæ˜¯ä¸€ä¸ªLLMå·¥ä½œæµç®¡ç†å·¥å…·ã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol>
<li><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/#langgraph-platform">https://langchain-ai.github.io/langgraph/#langgraph-platform</a></li>
<li><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/tutorials/introduction/#requirements">https://langchain-ai.github.io/langgraph/tutorials/introduction/#requirements</a></li>
<li><a target="_blank" rel="noopener" href="https://www.aidoczh.com/langgraph/how-tos/streaming-tokens/#llm_1%E2%9C%A8">https://www.aidoczh.com/langgraph/how-tos/streaming-tokens/#llm_1âœ¨</a></li>
<li><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/#example">https://langchain-ai.github.io/langgraph/#example</a></li>
<li><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/create-react-agent-system-prompt/?h=prompt">https://langchain-ai.github.io/langgraph/how-tos/create-react-agent-system-prompt/?h=prompt</a></li>
<li><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/reference/prebuilt/">https://langchain-ai.github.io/langgraph/reference/prebuilt/</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/llm/" rel="tag"># llm</a>
              <a href="/tags/langgraph/" rel="tag"># langgraph</a>
              <a href="/tags/langchain/" rel="tag"># langchain</a>
              <a href="/tags/agent/" rel="tag"># agent</a>
              <a href="/tags/react/" rel="tag"># react</a>
              <a href="/tags/cot/" rel="tag"># cot</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/02/10/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B9%8Bagent%E4%BB%8B%E7%BB%8D/" rel="prev" title="å¤§æ¨¡å‹åº”ç”¨å¼€å‘ä¹‹agentä»‹ç»">
                  <i class="fa fa-angle-left"></i> å¤§æ¨¡å‹åº”ç”¨å¼€å‘ä¹‹agentä»‹ç»
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/02/11/%E8%AF%B4%E8%AF%9D%E4%BA%BA%E7%A1%AE%E8%AE%A4%E4%B9%8BCAM/" rel="next" title="è¯´è¯äººç¡®è®¤ä¹‹CAM++">
                  è¯´è¯äººç¡®è®¤ä¹‹CAM++ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Chr</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">233k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">14:09</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","src":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
